{"file_contents":{"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport NotFound from \"@/pages/not-found\";\nimport Landing from \"@/pages/Landing\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport Alunos from \"@/pages/Alunos\";\nimport Professores from \"@/pages/Professores\";\nimport Turmas from \"@/pages/Turmas\";\nimport Financeiro from \"@/pages/Financeiro\";\nimport Relatorios from \"@/pages/Relatorios\";\nimport Filiais from \"@/pages/Filiais\";\nimport Layout from \"@/components/Layout\";\n\nfunction Router() {\n  const { isAuthenticated, isLoading } = useAuth();\n\n  return (\n    <Switch>\n      {isLoading || !isAuthenticated ? (\n        <Route path=\"/\" component={Landing} />\n      ) : (\n        <Layout>\n          <Route path=\"/\" component={Dashboard} />\n          <Route path=\"/alunos\" component={Alunos} />\n          <Route path=\"/professores\" component={Professores} />\n          <Route path=\"/turmas\" component={Turmas} />\n          <Route path=\"/filiais\" component={Filiais} />\n          <Route path=\"/financeiro\" component={Financeiro} />\n          <Route path=\"/relatorios\" component={Relatorios} />\n        </Layout>\n      )}\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":1641},"client/src/hooks/useAdminAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\n\ninterface AdminUser {\n  id: number;\n  nome: string;\n  email: string;\n  papel: string;\n}\n\nexport function useAdminAuth() {\n  const { data: user, isLoading, error } = useQuery<AdminUser>({\n    queryKey: [\"/api/admin/user\"],\n    retry: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user && !error,\n    error,\n  };\n}","size_bytes":390},"client/src/pages/UnidadeAlunos.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { Plus, Search, Edit, Trash2, User, ArrowLeft, Eye, Building2 } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport AlunoForm from \"@/components/forms/AlunoForm\";\nimport ExtratoAluno from \"@/components/ExtratoAluno\";\nimport type { AlunoWithFilial, Filial, InsertAluno } from \"@shared/schema\";\n\nexport default function UnidadeAlunos() {\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedAluno, setSelectedAluno] = useState<AlunoWithFilial | null>(null);\n  const [viewingExtrato, setViewingExtrato] = useState<AlunoWithFilial | null>(null);\n  const [editingAluno, setEditingAluno] = useState<AlunoWithFilial | null>(null);\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const { toast } = useToast();\n\n  // Recuperar unidade selecionada\n  const unidadeSelecionada = localStorage.getItem(\"unidade_selecionada\");\n  const filialId = unidadeSelecionada ? parseInt(unidadeSelecionada) : null;\n\n  if (!filialId) {\n    setLocation(\"/login-unidade\");\n    return null;\n  }\n\n  const { data: filial } = useQuery<Filial>({\n    queryKey: [`/api/filiais/${filialId}`],\n  });\n\n  const { data: alunos = [], isLoading } = useQuery<AlunoWithFilial[]>({\n    queryKey: [`/api/filiais/${filialId}/alunos`],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertAluno) => {\n      return await apiRequest(\"POST\", \"/api/alunos\", {\n        ...data,\n        filialId\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/filiais/${filialId}/alunos`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/alunos\"] }); // Sincroniza com matriz\n      setDialogOpen(false);\n      toast({\n        title: \"Sucesso\",\n        description: \"Aluno cadastrado e sincronizado com a matriz!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao cadastrar aluno: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: InsertAluno) => {\n      if (!editingAluno) return;\n      return await apiRequest(\"PUT\", `/api/alunos/${editingAluno.id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/filiais/${filialId}/alunos`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/alunos\"] }); // Sincroniza com matriz\n      setEditingAluno(null);\n      setDialogOpen(false);\n      toast({\n        title: \"Sucesso\",\n        description: \"Aluno atualizado e sincronizado com a matriz!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao atualizar aluno: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return await apiRequest(\"DELETE\", `/api/alunos/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/filiais/${filialId}/alunos`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/alunos\"] }); // Sincroniza com matriz\n      toast({\n        title: \"Sucesso\",\n        description: \"Aluno removido e sincronizado com a matriz!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao remover aluno: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredAlunos = alunos.filter(aluno =>\n    aluno.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    aluno.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    aluno.cpf?.includes(searchTerm)\n  );\n\n  const handleSubmit = (data: InsertAluno) => {\n    if (editingAluno) {\n      updateMutation.mutate(data);\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const openEditDialog = (aluno: AlunoWithFilial) => {\n    setEditingAluno(aluno);\n    setDialogOpen(true);\n  };\n\n  const openCreateDialog = () => {\n    setEditingAluno(null);\n    setDialogOpen(true);\n  };\n\n  if (viewingExtrato) {\n    return (\n      <ExtratoAluno \n        aluno={viewingExtrato} \n        onBack={() => setViewingExtrato(null)} \n      />\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <div className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center gap-4\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setLocation(\"/unidade/sistema\")}\n                className=\"flex items-center gap-2\"\n              >\n                <ArrowLeft className=\"w-4 h-4\" />\n                Voltar ao Sistema\n              </Button>\n              <div className=\"flex items-center gap-2\">\n                <Building2 className=\"w-5 h-5 text-blue-600\" />\n                <div>\n                  <h1 className=\"text-xl font-bold\">Gestão de Alunos</h1>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {filial?.nome} - {alunos.length} alunos cadastrados\n                  </p>\n                </div>\n              </div>\n            </div>\n            <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n              <DialogTrigger asChild>\n                <Button onClick={openCreateDialog} className=\"flex items-center gap-2\">\n                  <Plus className=\"w-4 h-4\" />\n                  Novo Aluno\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n                <DialogHeader>\n                  <DialogTitle>\n                    {editingAluno ? \"Editar Aluno\" : \"Novo Aluno\"}\n                  </DialogTitle>\n                </DialogHeader>\n                <AlunoForm\n                  initialData={editingAluno || undefined}\n                  onSuccess={handleSubmit}\n                  isLoading={createMutation.isPending || updateMutation.isPending}\n                  filialId={filialId}\n                />\n              </DialogContent>\n            </Dialog>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Informações da Unidade */}\n        <div className=\"mb-6\">\n          <Card className=\"border-blue-200 bg-blue-50\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-2 rounded-lg bg-blue-100\">\n                  <Building2 className=\"h-5 w-5 text-blue-600\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold text-blue-900\">\n                    Sistema Sincronizado com a Matriz\n                  </h3>\n                  <p className=\"text-blue-800 text-sm\">\n                    Todos os alunos cadastrados são automaticamente enviados para o sistema central.\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Search */}\n        <div className=\"flex items-center gap-4 mb-6\">\n          <div className=\"relative flex-1 max-w-md\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4\" />\n            <Input\n              placeholder=\"Buscar por nome, email ou CPF...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-10\"\n            />\n          </div>\n        </div>\n\n        {/* Content */}\n        {isLoading ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {[...Array(6)].map((_, i) => (\n              <Card key={i} className=\"animate-pulse\">\n                <CardHeader>\n                  <div className=\"h-4 bg-muted rounded w-3/4\"></div>\n                  <div className=\"h-3 bg-muted rounded w-1/2\"></div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2\">\n                    <div className=\"h-3 bg-muted rounded\"></div>\n                    <div className=\"h-3 bg-muted rounded w-2/3\"></div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : filteredAlunos.length === 0 ? (\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-12\">\n              <User className=\"w-12 h-12 text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">\n                {searchTerm ? \"Nenhum aluno encontrado\" : \"Nenhum aluno cadastrado\"}\n              </h3>\n              <p className=\"text-muted-foreground text-center mb-6\">\n                {searchTerm \n                  ? \"Tente ajustar os termos de busca\" \n                  : \"Comece cadastrando o primeiro aluno da unidade\"\n                }\n              </p>\n              {!searchTerm && (\n                <Button onClick={openCreateDialog} className=\"flex items-center gap-2\">\n                  <Plus className=\"w-4 h-4\" />\n                  Cadastrar Primeiro Aluno\n                </Button>\n              )}\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {filteredAlunos.map((aluno) => (\n              <Card key={aluno.id} className=\"hover:shadow-md transition-shadow\">\n                <CardHeader>\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <CardTitle className=\"text-lg\">{aluno.nome}</CardTitle>\n                      <p className=\"text-sm text-muted-foreground\">{aluno.email}</p>\n                    </div>\n                    {aluno.statusPagamento && (\n                      <Badge variant={aluno.statusPagamento.emDia ? \"default\" : \"destructive\"}>\n                        {aluno.statusPagamento.emDia ? \"Em dia\" : `${aluno.statusPagamento.diasAtraso} dias`}\n                      </Badge>\n                    )}\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">CPF:</span>\n                      <span>{aluno.cpf || \"Não informado\"}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Telefone:</span>\n                      <span>{aluno.telefone || \"Não informado\"}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Data de Nascimento:</span>\n                      <span>\n                        {aluno.dataNascimento \n                          ? new Date(aluno.dataNascimento).toLocaleDateString('pt-BR')\n                          : \"Não informado\"\n                        }\n                      </span>\n                    </div>\n                  </div>\n\n                  <Separator className=\"my-4\" />\n\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setViewingExtrato(aluno)}\n                      className=\"flex-1\"\n                    >\n                      <Eye className=\"w-4 h-4 mr-1\" />\n                      Extrato\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => openEditDialog(aluno)}\n                    >\n                      <Edit className=\"w-4 h-4\" />\n                    </Button>\n                    <AlertDialog>\n                      <AlertDialogTrigger asChild>\n                        <Button variant=\"outline\" size=\"sm\">\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      </AlertDialogTrigger>\n                      <AlertDialogContent>\n                        <AlertDialogHeader>\n                          <AlertDialogTitle>Confirmar exclusão</AlertDialogTitle>\n                          <AlertDialogDescription>\n                            Tem certeza que deseja excluir o aluno <strong>{aluno.nome}</strong>? \n                            Esta ação será sincronizada com a matriz e não pode ser desfeita.\n                          </AlertDialogDescription>\n                        </AlertDialogHeader>\n                        <AlertDialogFooter>\n                          <AlertDialogCancel>Cancelar</AlertDialogCancel>\n                          <AlertDialogAction\n                            onClick={() => deleteMutation.mutate(aluno.id)}\n                            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                          >\n                            Excluir\n                          </AlertDialogAction>\n                        </AlertDialogFooter>\n                      </AlertDialogContent>\n                    </AlertDialog>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":14350},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\n\nexport function useAuth() {\n  const { data: user, isLoading } = useQuery({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n  };\n}\n","size_bytes":257},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/pages/AlunosFixed.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { UserPlus, Search, Edit, Trash2, Phone, Mail, Calendar, Users, Building2, Receipt, Filter } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { AlunoWithFilial, Filial } from \"@shared/schema\";\nimport AlunoForm from \"@/components/forms/AlunoForm\";\nimport ExtratoAluno from \"@/components/ExtratoAluno\";\n\nexport default function Alunos() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [unidadeFilter, setUnidadeFilter] = useState<string>(\"todas\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"todos\");\n  const [pagamentoFilter, setPagamentoFilter] = useState<string>(\"todos\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingAluno, setEditingAluno] = useState<AlunoWithFilial | null>(null);\n  const [viewingExtrato, setViewingExtrato] = useState<AlunoWithFilial | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [, navigate] = useLocation();\n\n  const { data: alunos, isLoading } = useQuery<AlunoWithFilial[]>({\n    queryKey: [\"/api/alunos\"],\n  });\n\n  const { data: filiais } = useQuery<Filial[]>({\n    queryKey: [\"/api/filiais\"],\n  });\n\n  const deleteAlunoMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/alunos/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/alunos\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Aluno removido com sucesso.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao remover aluno. Tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEdit = (aluno: AlunoWithFilial) => {\n    setEditingAluno(aluno);\n    setIsDialogOpen(true);\n  };\n\n  const handleViewExtrato = (aluno: AlunoWithFilial) => {\n    setViewingExtrato(aluno);\n  };\n\n  const handleDelete = (id: number) => {\n    if (confirm(\"Tem certeza que deseja remover este aluno?\")) {\n      deleteAlunoMutation.mutate(id);\n    }\n  };\n\n  const handleDialogClose = () => {\n    setIsDialogOpen(false);\n    setEditingAluno(null);\n  };\n\n\n\n  const calculateAge = (birthDate: string | null) => {\n    if (!birthDate) return \"-\";\n    const today = new Date();\n    const birth = new Date(birthDate);\n    const age = today.getFullYear() - birth.getFullYear();\n    const monthDiff = today.getMonth() - birth.getMonth();\n    \n    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\n      return age - 1;\n    }\n    return age;\n  };\n\n  // Função para filtrar alunos\n  const filteredAlunos = alunos?.filter((aluno) => {\n    // Filtro por nome\n    const matchesSearch = aluno.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         aluno.email?.toLowerCase().includes(searchTerm.toLowerCase());\n\n    // Filtro por unidade\n    const matchesUnidade = unidadeFilter === \"todas\" || \n                          (unidadeFilter === \"sem-unidade\" && !aluno.filialId) ||\n                          aluno.filialId?.toString() === unidadeFilter;\n\n    // Filtro por status ativo/passivo\n    const matchesStatus = statusFilter === \"todos\" ||\n                         (statusFilter === \"ativo\" && aluno.ativo) ||\n                         (statusFilter === \"inativo\" && !aluno.ativo);\n\n    // Filtro por status de pagamento\n    const matchesPagamento = pagamentoFilter === \"todos\" ||\n                            (pagamentoFilter === \"em-dia\" && aluno.statusPagamento?.emDia) ||\n                            (pagamentoFilter === \"atrasado\" && !aluno.statusPagamento?.emDia);\n\n    return matchesSearch && matchesUnidade && matchesStatus && matchesPagamento;\n  }) || [];\n\n  // Se estiver visualizando extrato, mostrar o componente de extrato\n  if (viewingExtrato) {\n    return (\n      <ExtratoAluno \n        aluno={viewingExtrato} \n        onBack={() => setViewingExtrato(null)} \n      />\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-3xl font-bold text-neutral-800\">Gestão de Alunos</h2>\n          <p className=\"text-neutral-600\">Cadastre e gerencie os alunos da escola</p>\n        </div>\n        <div className=\"flex space-x-3\">\n          <Button \n            onClick={() => navigate(\"/cadastro-aluno\")}\n            className=\"bg-primary hover:bg-primary/90\"\n          >\n            <UserPlus className=\"w-4 h-4 mr-2\" />\n            Cadastrar Aluno\n          </Button>\n          \n          <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n            <DialogContent className=\"max-w-2xl\">\n              <DialogHeader>\n                <DialogTitle>Editar Aluno</DialogTitle>\n              </DialogHeader>\n              <AlunoForm \n                aluno={editingAluno} \n                onSuccess={handleDialogClose}\n              />\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {/* Search and Summary */}\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400 w-4 h-4\" />\n              <Input\n                placeholder=\"Buscar alunos...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n            <div className=\"flex items-center space-x-6 text-sm\">\n              <div className=\"text-center\">\n                <p className=\"font-semibold text-lg\">{filteredAlunos.length}</p>\n                <p className=\"text-neutral-500\">Total</p>\n              </div>\n              <div className=\"text-center\">\n                <p className=\"font-semibold text-lg text-green-600\">\n                  {filteredAlunos.filter(a => a.ativo).length}\n                </p>\n                <p className=\"text-neutral-500\">Ativos</p>\n              </div>\n              <div className=\"text-center\">\n                <p className=\"font-semibold text-lg text-green-600\">\n                  {filteredAlunos.filter(a => a.statusPagamento?.emDia).length}\n                </p>\n                <p className=\"text-neutral-500\">Em Dia</p>\n              </div>\n              <div className=\"text-center\">\n                <p className=\"font-semibold text-lg text-red-600\">\n                  {filteredAlunos.filter(a => a.statusPagamento && !a.statusPagamento.emDia).length}\n                </p>\n                <p className=\"text-neutral-500\">Atrasados</p>\n              </div>\n            </div>\n          </div>\n\n          {/* Filtros Avançados */}\n          <div className=\"flex items-center gap-4 pt-4 border-t\">\n            <div className=\"flex items-center gap-2\">\n              <Filter className=\"w-4 h-4 text-neutral-500\" />\n              <span className=\"text-sm font-medium text-neutral-700\">Filtros:</span>\n            </div>\n            \n            {/* Filtro por Unidade */}\n            <Select value={unidadeFilter} onValueChange={setUnidadeFilter}>\n              <SelectTrigger className=\"w-[180px]\">\n                <SelectValue placeholder=\"Todas as unidades\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"todas\">Todas as unidades</SelectItem>\n                <SelectItem value=\"sem-unidade\">Sem unidade</SelectItem>\n                {filiais?.map((filial) => (\n                  <SelectItem key={filial.id} value={filial.id.toString()}>\n                    {filial.nome}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n\n            {/* Filtro por Status */}\n            <Select value={statusFilter} onValueChange={setStatusFilter}>\n              <SelectTrigger className=\"w-[140px]\">\n                <SelectValue placeholder=\"Todos os status\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"todos\">Todos</SelectItem>\n                <SelectItem value=\"ativo\">Ativos</SelectItem>\n                <SelectItem value=\"inativo\">Inativos</SelectItem>\n              </SelectContent>\n            </Select>\n\n            {/* Filtro por Pagamento */}\n            <Select value={pagamentoFilter} onValueChange={setPagamentoFilter}>\n              <SelectTrigger className=\"w-[160px]\">\n                <SelectValue placeholder=\"Todos pagamentos\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"todos\">Todos</SelectItem>\n                <SelectItem value=\"em-dia\">Em dia</SelectItem>\n                <SelectItem value=\"atrasado\">Atrasados</SelectItem>\n              </SelectContent>\n            </Select>\n\n            {/* Botão para limpar filtros */}\n            {(unidadeFilter !== \"todas\" || statusFilter !== \"todos\" || pagamentoFilter !== \"todos\") && (\n              <Button \n                variant=\"ghost\" \n                size=\"sm\"\n                onClick={() => {\n                  setUnidadeFilter(\"todas\");\n                  setStatusFilter(\"todos\");\n                  setPagamentoFilter(\"todos\");\n                }}\n                className=\"text-neutral-500 hover:text-neutral-700\"\n              >\n                Limpar filtros\n              </Button>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Alunos Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-xl\">Alunos Cadastrados</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"space-y-3\">\n              {[...Array(5)].map((_, i) => (\n                <Skeleton key={i} className=\"h-12 w-full\" />\n              ))}\n            </div>\n          ) : filteredAlunos.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <p className=\"text-neutral-500\">Nenhum aluno encontrado</p>\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Aluno</TableHead>\n                  <TableHead>CPF</TableHead>\n                  <TableHead>Idade</TableHead>\n                  <TableHead>Unidade</TableHead>\n                  <TableHead>Matrícula</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Pagamento</TableHead>\n                  <TableHead>Contato</TableHead>\n                  <TableHead className=\"text-right\">Ações</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredAlunos.map((aluno) => (\n                  <TableRow key={aluno.id}>\n                    <TableCell>\n                      <div className=\"flex items-center space-x-3\">\n                        {aluno.fotoUrl ? (\n                          <div className=\"relative group\">\n                            <img \n                              src={aluno.fotoUrl} \n                              alt={aluno.nome}\n                              className=\"w-10 h-10 rounded-full object-cover cursor-pointer\"\n                              onError={(e) => {\n                                e.currentTarget.style.display = 'none';\n                              }}\n                              onClick={() => {\n                                const link = document.createElement('a');\n                                link.href = aluno.fotoUrl!;\n                                link.download = `foto-${aluno.nome.replace(/\\s+/g, '-').toLowerCase()}.jpg`;\n                                link.target = '_blank';\n                                document.body.appendChild(link);\n                                link.click();\n                                document.body.removeChild(link);\n                              }}\n                            />\n                            <div className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 rounded-full transition-all duration-200 flex items-center justify-center\">\n                              <span className=\"text-white text-xs opacity-0 group-hover:opacity-100\">⬇</span>\n                            </div>\n                          </div>\n                        ) : (\n                          <div className=\"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center\">\n                            <span className=\"text-gray-400 text-xs\">Foto</span>\n                          </div>\n                        )}\n                        <div>\n                          <p className=\"font-medium\">{aluno.nome}</p>\n                          {aluno.email && (\n                            <p className=\"text-sm text-neutral-500\">{aluno.email}</p>\n                          )}\n                        </div>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <span className=\"font-mono text-sm\">\n                        {aluno.cpf || \"Não informado\"}\n                      </span>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center space-x-2\">\n                        <Calendar className=\"w-4 h-4 text-neutral-400\" />\n                        <span>{calculateAge(aluno.dataNascimento)} anos</span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center space-x-2\">\n                        <Building2 className=\"w-4 h-4 text-neutral-400\" />\n                        <span>{aluno.filial?.nome || \"Não informada\"}</span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"text-sm\">\n                        {aluno.dataMatricula ? \n                          format(new Date(aluno.dataMatricula), \"dd/MM/yyyy\", { locale: ptBR }) :\n                          \"Não informada\"\n                        }\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <Badge variant={aluno.ativo ? \"default\" : \"secondary\"}>\n                        {aluno.ativo ? \"Ativo\" : \"Inativo\"}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      {aluno.statusPagamento ? (\n                        <Badge \n                          variant={aluno.statusPagamento.emDia ? \"default\" : \"destructive\"}\n                        >\n                          {aluno.statusPagamento.emDia ? \"Em dia\" : \n                           `${aluno.statusPagamento.diasAtraso || 0} dias atraso`}\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"outline\">Sem dados</Badge>\n                      )}\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"space-y-1\">\n                        {aluno.telefone && (\n                          <div className=\"flex items-center space-x-1 text-sm\">\n                            <Phone className=\"w-3 h-3 text-neutral-400\" />\n                            <span>{aluno.telefone}</span>\n                          </div>\n                        )}\n                        {aluno.email && (\n                          <div className=\"flex items-center space-x-1 text-sm\">\n                            <Mail className=\"w-3 h-3 text-neutral-400\" />\n                            <span>{aluno.email}</span>\n                          </div>\n                        )}\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <div className=\"flex justify-end space-x-2\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleViewExtrato(aluno)}\n                        >\n                          <Receipt className=\"w-4 h-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleEdit(aluno)}\n                        >\n                          <Edit className=\"w-4 h-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleDelete(aluno.id)}\n                          className=\"text-red-600 hover:text-red-700\"\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":17880},"server/auth.ts":{"content":"import type { Request, Response, NextFunction } from \"express\";\n\n// Admin authentication middleware\nexport const requireAdminAuth = (req: Request, res: Response, next: NextFunction) => {\n  if (!req.session || !req.session.adminId || !req.session.adminUser) {\n    return res.status(401).json({ message: \"Admin authentication required\" });\n  }\n  next();\n};\n\n// Unit manager authentication middleware\nexport const requireGestorAuth = (req: Request, res: Response, next: NextFunction) => {\n  if (!req.session?.gestorUnidadeId) {\n    return res.status(401).json({ message: \"Unit manager authentication required\" });\n  }\n  next();\n};\n\n// Guardian authentication middleware\nexport const requireResponsavelAuth = (req: Request, res: Response, next: NextFunction) => {\n  if (!req.session?.responsavelId) {\n    return res.status(401).json({ message: \"Guardian authentication required\" });\n  }\n  next();\n};","size_bytes":895},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/pages/ProfessoresUnidade.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { Plus, Search, Edit, Trash2, User, ArrowLeft, GraduationCap } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport ProfessorForm from \"@/components/forms/ProfessorForm\";\nimport type { Professor, Filial, InsertProfessor } from \"@shared/schema\";\n\nexport default function ProfessoresUnidade() {\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [editingProfessor, setEditingProfessor] = useState<Professor | null>(null);\n  const [dialogOpen, setDialogOpen] = useState(false);\n\n  // Recuperar unidade selecionada\n  const unidadeSelecionada = localStorage.getItem(\"unidade_selecionada\");\n  const filialId = unidadeSelecionada ? parseInt(unidadeSelecionada) : null;\n\n  if (!filialId) {\n    setLocation(\"/login-unidade\");\n    return null;\n  }\n\n  const { data: filial } = useQuery<Filial>({\n    queryKey: [`/api/filiais/${filialId}`],\n  });\n\n  const { data: professores = [], isLoading } = useQuery<Professor[]>({\n    queryKey: [`/api/filiais/${filialId}/professores`],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertProfessor) => {\n      return await apiRequest(\"POST\", \"/api/professores\", {\n        ...data,\n        filialId\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/filiais/${filialId}/professores`] });\n      setDialogOpen(false);\n      toast({\n        title: \"Sucesso\",\n        description: \"Professor cadastrado com sucesso!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao cadastrar professor: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: InsertProfessor) => {\n      if (!editingProfessor) return;\n      return await apiRequest(\"PUT\", `/api/professores/${editingProfessor.id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/filiais/${filialId}/professores`] });\n      setEditingProfessor(null);\n      setDialogOpen(false);\n      toast({\n        title: \"Sucesso\",\n        description: \"Professor atualizado com sucesso!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao atualizar professor: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return await apiRequest(\"DELETE\", `/api/professores/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/filiais/${filialId}/professores`] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Professor removido com sucesso!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao remover professor: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredProfessores = professores.filter(professor =>\n    professor.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    professor.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    professor.cpf?.includes(searchTerm) ||\n    professor.especialidade?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const handleSubmit = (data: InsertProfessor) => {\n    if (editingProfessor) {\n      updateMutation.mutate(data);\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const openEditDialog = (professor: Professor) => {\n    setEditingProfessor(professor);\n    setDialogOpen(true);\n  };\n\n  const openCreateDialog = () => {\n    setEditingProfessor(null);\n    setDialogOpen(true);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setLocation(\"/painel-unidade\")}\n            className=\"flex items-center gap-2\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n            Voltar ao Painel\n          </Button>\n          <div>\n            <h1 className=\"text-3xl font-bold\">Gestão de Professores</h1>\n            <p className=\"text-muted-foreground\">\n              {filial?.nome} - {professores.length} professores cadastrados\n            </p>\n          </div>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={openCreateDialog} className=\"flex items-center gap-2\">\n              <Plus className=\"w-4 h-4\" />\n              Novo Professor\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingProfessor ? \"Editar Professor\" : \"Novo Professor\"}\n              </DialogTitle>\n            </DialogHeader>\n            <ProfessorForm\n              onSubmit={handleSubmit}\n              defaultValues={editingProfessor || undefined}\n              isLoading={createMutation.isPending || updateMutation.isPending}\n              filialId={filialId}\n            />\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4\" />\n          <Input\n            placeholder=\"Buscar por nome, email, CPF ou especialidade...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n      </div>\n\n      {/* Content */}\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {[...Array(6)].map((_, i) => (\n            <Card key={i} className=\"animate-pulse\">\n              <CardHeader>\n                <div className=\"h-4 bg-muted rounded w-3/4\"></div>\n                <div className=\"h-3 bg-muted rounded w-1/2\"></div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <div className=\"h-3 bg-muted rounded\"></div>\n                  <div className=\"h-3 bg-muted rounded w-2/3\"></div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : filteredProfessores.length === 0 ? (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <GraduationCap className=\"w-12 h-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">\n              {searchTerm ? \"Nenhum professor encontrado\" : \"Nenhum professor cadastrado\"}\n            </h3>\n            <p className=\"text-muted-foreground text-center mb-6\">\n              {searchTerm \n                ? \"Tente ajustar os termos de busca\" \n                : \"Comece cadastrando o primeiro professor da unidade\"\n              }\n            </p>\n            {!searchTerm && (\n              <Button onClick={openCreateDialog} className=\"flex items-center gap-2\">\n                <Plus className=\"w-4 h-4\" />\n                Cadastrar Primeiro Professor\n              </Button>\n            )}\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {filteredProfessores.map((professor) => (\n            <Card key={professor.id} className=\"hover:shadow-md transition-shadow\">\n              <CardHeader>\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <CardTitle className=\"text-lg\">{professor.nome}</CardTitle>\n                    <p className=\"text-sm text-muted-foreground\">{professor.email}</p>\n                  </div>\n                  {professor.ativo ? (\n                    <Badge variant=\"default\">Ativo</Badge>\n                  ) : (\n                    <Badge variant=\"secondary\">Inativo</Badge>\n                  )}\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">CPF:</span>\n                    <span>{professor.cpf || \"Não informado\"}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Telefone:</span>\n                    <span>{professor.telefone || \"Não informado\"}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Especialidade:</span>\n                    <span>{professor.especialidade || \"Não informado\"}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Salário:</span>\n                    <span>\n                      {professor.salario \n                        ? `R$ ${professor.salario.toFixed(2)}`\n                        : \"Não informado\"\n                      }\n                    </span>\n                  </div>\n                </div>\n\n                <Separator className=\"my-4\" />\n\n                <div className=\"flex gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => openEditDialog(professor)}\n                    className=\"flex-1\"\n                  >\n                    <Edit className=\"w-4 h-4 mr-1\" />\n                    Editar\n                  </Button>\n                  <AlertDialog>\n                    <AlertDialogTrigger asChild>\n                      <Button variant=\"outline\" size=\"sm\">\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    </AlertDialogTrigger>\n                    <AlertDialogContent>\n                      <AlertDialogHeader>\n                        <AlertDialogTitle>Confirmar exclusão</AlertDialogTitle>\n                        <AlertDialogDescription>\n                          Tem certeza que deseja excluir o professor <strong>{professor.nome}</strong>? \n                          Esta ação não pode ser desfeita.\n                        </AlertDialogDescription>\n                      </AlertDialogHeader>\n                      <AlertDialogFooter>\n                        <AlertDialogCancel>Cancelar</AlertDialogCancel>\n                        <AlertDialogAction\n                          onClick={() => deleteMutation.mutate(professor.id)}\n                          className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                        >\n                          Excluir\n                        </AlertDialogAction>\n                      </AlertDialogFooter>\n                    </AlertDialogContent>\n                  </AlertDialog>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":12109},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/pages/Landing.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Users, Calendar, TrendingUp, Shield, Zap, Building2, DollarSign, GraduationCap, CheckCircle } from \"lucide-react\";\n\nexport default function Landing() {\n  const handleLogin = () => {\n    window.location.href = \"/api/login\";\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-green-900 to-emerald-900\">\n      {/* Header */}\n      <header className=\"bg-white/5 backdrop-blur-md border-b border-white/10 sticky top-0 z-50\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"relative\">\n                <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center shadow-lg shadow-green-500/30\">\n                  <svg \n                    xmlns=\"http://www.w3.org/2000/svg\" \n                    viewBox=\"0 0 24 24\" \n                    fill=\"none\" \n                    stroke=\"currentColor\" \n                    strokeWidth=\"2\" \n                    strokeLinecap=\"round\" \n                    strokeLinejoin=\"round\" \n                    className=\"w-6 h-6 text-white\"\n                  >\n                    <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n                    <path d=\"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2z\"/>\n                    <path d=\"M8 12h8\"/>\n                    <path d=\"M12 8v8\"/>\n                  </svg>\n                </div>\n              </div>\n              <div>\n                <h1 className=\"text-xl font-bold text-white\">EscolaFut</h1>\n                <p className=\"text-sm text-white/60\">Sistema de Gestão</p>\n              </div>\n            </div>\n            <Button \n              onClick={handleLogin} \n              data-testid=\"button-entrar\"\n              className=\"bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-600/30\"\n            >\n              Entrar no Sistema\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      {/* Hero Section */}\n      <section className=\"py-20 px-4 sm:px-6 lg:px-8\">\n        <div className=\"max-w-5xl mx-auto text-center\">\n          <div className=\"mb-8\">\n            <div className=\"inline-flex items-center justify-center w-20 h-20 bg-green-500/20 rounded-2xl mb-6 shadow-lg shadow-green-500/20\">\n              <svg \n                xmlns=\"http://www.w3.org/2000/svg\" \n                viewBox=\"0 0 24 24\" \n                fill=\"none\" \n                stroke=\"currentColor\" \n                strokeWidth=\"2\" \n                strokeLinecap=\"round\" \n                strokeLinejoin=\"round\" \n                className=\"w-10 h-10 text-green-400\"\n              >\n                <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n                <path d=\"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2z\"/>\n                <path d=\"M8 12h8\"/>\n                <path d=\"M12 8v8\"/>\n              </svg>\n            </div>\n            <h1 className=\"text-5xl lg:text-7xl font-bold text-white mb-6 leading-tight\">\n              Sistema de Gestão para\n              <span className=\"text-green-400 block mt-2\">Escola de Futebol</span>\n            </h1>\n            <p className=\"text-xl text-white/80 mb-10 max-w-3xl mx-auto leading-relaxed\">\n              Gerencie alunos, professores, turmas e finanças da sua escola de futebol \n              de forma simples e eficiente com nossa plataforma completa.\n            </p>\n            <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n              <Button \n                onClick={handleLogin}\n                size=\"lg\"\n                data-testid=\"button-acessar-sistema\"\n                className=\"bg-green-600 hover:bg-green-700 text-white px-10 py-6 text-lg shadow-xl shadow-green-600/30 hover:shadow-green-600/40 transition-all\"\n              >\n                Acessar Sistema\n              </Button>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Features Section */}\n      <section className=\"py-20 px-4 sm:px-6 lg:px-8 bg-white/5 backdrop-blur-sm border-y border-white/10\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-4xl font-bold text-white mb-4\">\n              Tudo que você precisa em um só lugar\n            </h2>\n            <p className=\"text-lg text-white/70 max-w-2xl mx-auto\">\n              Nossa plataforma oferece todas as ferramentas necessárias para \n              administrar sua escola de futebol com eficiência e profissionalismo.\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {/* Feature 1 */}\n            <Card className=\"bg-white/10 backdrop-blur-sm border-white/20 hover:bg-white/15 transition-all\">\n              <CardHeader>\n                <div className=\"w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center mb-4\">\n                  <Users className=\"w-6 h-6 text-green-400\" />\n                </div>\n                <CardTitle className=\"text-xl text-white\">Gestão de Alunos</CardTitle>\n                <CardDescription className=\"text-white/70\">\n                  Cadastre e gerencie informações completas dos alunos, \n                  incluindo dados pessoais, responsáveis e status de pagamento.\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            {/* Feature 2 */}\n            <Card className=\"bg-white/10 backdrop-blur-sm border-white/20 hover:bg-white/15 transition-all\">\n              <CardHeader>\n                <div className=\"w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center mb-4\">\n                  <GraduationCap className=\"w-6 h-6 text-blue-400\" />\n                </div>\n                <CardTitle className=\"text-xl text-white\">Controle de Professores</CardTitle>\n                <CardDescription className=\"text-white/70\">\n                  Gerencie o corpo docente com informações profissionais, \n                  especialidades e controle de turmas atribuídas.\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            {/* Feature 3 */}\n            <Card className=\"bg-white/10 backdrop-blur-sm border-white/20 hover:bg-white/15 transition-all\">\n              <CardHeader>\n                <div className=\"w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center mb-4\">\n                  <Calendar className=\"w-6 h-6 text-purple-400\" />\n                </div>\n                <CardTitle className=\"text-xl text-white\">Organização de Turmas</CardTitle>\n                <CardDescription className=\"text-white/70\">\n                  Crie e organize turmas por categoria, horários e \n                  professores responsáveis de forma intuitiva.\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            {/* Feature 4 */}\n            <Card className=\"bg-white/10 backdrop-blur-sm border-white/20 hover:bg-white/15 transition-all\">\n              <CardHeader>\n                <div className=\"w-12 h-12 bg-amber-500/20 rounded-xl flex items-center justify-center mb-4\">\n                  <DollarSign className=\"w-6 h-6 text-amber-400\" />\n                </div>\n                <CardTitle className=\"text-xl text-white\">Controle Financeiro</CardTitle>\n                <CardDescription className=\"text-white/70\">\n                  Gerencie mensalidades, pagamentos e tenha visão \n                  completa da situação financeira da escola.\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            {/* Feature 5 */}\n            <Card className=\"bg-white/10 backdrop-blur-sm border-white/20 hover:bg-white/15 transition-all\">\n              <CardHeader>\n                <div className=\"w-12 h-12 bg-emerald-500/20 rounded-xl flex items-center justify-center mb-4\">\n                  <Building2 className=\"w-6 h-6 text-emerald-400\" />\n                </div>\n                <CardTitle className=\"text-xl text-white\">Multi-Filiais</CardTitle>\n                <CardDescription className=\"text-white/70\">\n                  Gerencie múltiplas filiais da sua escola em uma única \n                  plataforma centralizada e organizada.\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            {/* Feature 6 */}\n            <Card className=\"bg-white/10 backdrop-blur-sm border-white/20 hover:bg-white/15 transition-all\">\n              <CardHeader>\n                <div className=\"w-12 h-12 bg-rose-500/20 rounded-xl flex items-center justify-center mb-4\">\n                  <TrendingUp className=\"w-6 h-6 text-rose-400\" />\n                </div>\n                <CardTitle className=\"text-xl text-white\">Dashboard Intuitivo</CardTitle>\n                <CardDescription className=\"text-white/70\">\n                  Visualize métricas importantes, status de pagamentos e \n                  KPIs em tempo real de forma clara e objetiva.\n                </CardDescription>\n              </CardHeader>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* Benefits Section */}\n      <section className=\"py-20 px-4 sm:px-6 lg:px-8\">\n        <div className=\"max-w-5xl mx-auto\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-4xl font-bold text-white mb-4\">\n              Por que escolher o EscolaFut?\n            </h2>\n            <p className=\"text-lg text-white/70\">\n              Uma solução completa pensada especificamente para escolas de futebol\n            </p>\n          </div>\n\n          <div className=\"grid md:grid-cols-2 gap-8\">\n            <div className=\"flex items-start space-x-4\">\n              <div className=\"flex-shrink-0\">\n                <div className=\"w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center\">\n                  <CheckCircle className=\"w-5 h-5 text-green-400\" />\n                </div>\n              </div>\n              <div>\n                <h3 className=\"text-xl font-semibold text-white mb-2\">Interface Moderna e Intuitiva</h3>\n                <p className=\"text-white/70\">\n                  Design pensado para facilitar o uso diário, sem necessidade de treinamento extensivo.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex items-start space-x-4\">\n              <div className=\"flex-shrink-0\">\n                <div className=\"w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center\">\n                  <CheckCircle className=\"w-5 h-5 text-green-400\" />\n                </div>\n              </div>\n              <div>\n                <h3 className=\"text-xl font-semibold text-white mb-2\">Controle de Pagamentos</h3>\n                <p className=\"text-white/70\">\n                  Acompanhe quem está em dia e quem está atrasado com as mensalidades em tempo real.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex items-start space-x-4\">\n              <div className=\"flex-shrink-0\">\n                <div className=\"w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center\">\n                  <CheckCircle className=\"w-5 h-5 text-green-400\" />\n                </div>\n              </div>\n              <div>\n                <h3 className=\"text-xl font-semibold text-white mb-2\">Gestão Centralizada</h3>\n                <p className=\"text-white/70\">\n                  Todos os dados em um só lugar: alunos, professores, turmas e finanças integrados.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex items-start space-x-4\">\n              <div className=\"flex-shrink-0\">\n                <div className=\"w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center\">\n                  <CheckCircle className=\"w-5 h-5 text-green-400\" />\n                </div>\n              </div>\n              <div>\n                <h3 className=\"text-xl font-semibold text-white mb-2\">Acesso Responsivo</h3>\n                <p className=\"text-white/70\">\n                  Acesse de qualquer dispositivo: computador, tablet ou smartphone.\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* CTA Section */}\n      <section className=\"py-20 px-4 sm:px-6 lg:px-8 bg-gradient-to-r from-green-600 to-emerald-600\">\n        <div className=\"max-w-4xl mx-auto text-center\">\n          <h2 className=\"text-4xl font-bold text-white mb-4\">\n            Pronto para revolucionar sua escola de futebol?\n          </h2>\n          <p className=\"text-xl text-white/90 mb-10 max-w-2xl mx-auto\">\n            Entre no sistema e comece a gerenciar sua escola de forma profissional e eficiente hoje mesmo.\n          </p>\n          <Button \n            onClick={handleLogin}\n            size=\"lg\"\n            data-testid=\"button-acessar-agora\"\n            className=\"bg-white text-green-600 hover:bg-gray-100 px-10 py-6 text-lg shadow-xl font-semibold\"\n          >\n            Acessar Sistema Agora\n          </Button>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"bg-white/5 backdrop-blur-sm border-t border-white/10 py-8 px-4 sm:px-6 lg:px-8\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"flex flex-col md:flex-row items-center justify-between gap-4\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center shadow-lg\">\n                <svg \n                  xmlns=\"http://www.w3.org/2000/svg\" \n                  viewBox=\"0 0 24 24\" \n                  fill=\"none\" \n                  stroke=\"currentColor\" \n                  strokeWidth=\"2\" \n                  strokeLinecap=\"round\" \n                  strokeLinejoin=\"round\" \n                  className=\"w-4 h-4 text-white\"\n                >\n                  <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n                  <path d=\"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2z\"/>\n                  <path d=\"M8 12h8\"/>\n                  <path d=\"M12 8v8\"/>\n                </svg>\n              </div>\n              <div>\n                <p className=\"font-semibold text-white\">EscolaFut</p>\n                <p className=\"text-sm text-white/60\">Sistema de Gestão</p>\n              </div>\n            </div>\n            <p className=\"text-sm text-white/60\">\n              © 2024 EscolaFut. Todos os direitos reservados.\n            </p>\n          </div>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","size_bytes":14857},"server/storage.ts":{"content":"import {\n  users,\n  alunos,\n  professores,\n  turmas,\n  matriculas,\n  pagamentos,\n  filiais,\n  type User,\n  type UpsertUser,\n  type Aluno,\n  type InsertAluno,\n  type Professor,\n  type InsertProfessor,\n  type Turma,\n  type InsertTurma,\n  type TurmaWithProfessor,\n  type Matricula,\n  type InsertMatricula,\n  type Pagamento,\n  type InsertPagamento,\n  type AlunoWithTurmas,\n  type AlunoWithFilial,\n  type Filial,\n  type InsertFilial,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, sql, count } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User operations (mandatory for Replit Auth)\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n\n  // Alunos operations\n  getAlunos(): Promise<AlunoWithFilial[]>;\n  getAluno(id: number): Promise<AlunoWithTurmas | undefined>;\n  createAluno(aluno: InsertAluno): Promise<Aluno>;\n  updateAluno(id: number, aluno: Partial<InsertAluno>): Promise<Aluno>;\n  deleteAluno(id: number): Promise<void>;\n\n  // Professores operations\n  getProfessores(): Promise<Professor[]>;\n  getProfessor(id: number): Promise<Professor | undefined>;\n  createProfessor(professor: InsertProfessor): Promise<Professor>;\n  updateProfessor(id: number, professor: Partial<InsertProfessor>): Promise<Professor>;\n  deleteProfessor(id: number): Promise<void>;\n\n  // Turmas operations\n  getTurmas(): Promise<TurmaWithProfessor[]>;\n  getTurma(id: number): Promise<TurmaWithProfessor | undefined>;\n  createTurma(turma: InsertTurma): Promise<Turma>;\n  updateTurma(id: number, turma: Partial<InsertTurma>): Promise<Turma>;\n  deleteTurma(id: number): Promise<void>;\n\n  // Matriculas operations\n  getMatriculas(): Promise<Matricula[]>;\n  createMatricula(matricula: InsertMatricula): Promise<Matricula>;\n  deleteMatricula(id: number): Promise<void>;\n\n  // Pagamentos operations\n  getPagamentos(): Promise<Pagamento[]>;\n  getPagamentosByAluno(alunoId: number): Promise<Pagamento[]>;\n  createPagamento(pagamento: InsertPagamento): Promise<Pagamento>;\n  deletePagamento(id: number): Promise<void>;\n\n  // Filiais operations\n  getFiliais(): Promise<Filial[]>;\n  getFilial(id: number): Promise<Filial | undefined>;\n  createFilial(filial: InsertFilial): Promise<Filial>;\n  updateFilial(id: number, filial: Partial<InsertFilial>): Promise<Filial>;\n  deleteFilial(id: number): Promise<void>;\n\n  // Dashboard metrics\n  getDashboardMetrics(): Promise<{\n    totalAlunos: number;\n    totalProfessores: number;\n    totalTurmas: number;\n    receitaMensal: number;\n  }>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // User operations (mandatory for Replit Auth)\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  // Alunos operations\n  async getAlunos(): Promise<AlunoWithFilial[]> {\n    const alunosData = await db\n      .select({\n        id: alunos.id,\n        nome: alunos.nome,\n        email: alunos.email,\n        telefone: alunos.telefone,\n        dataNascimento: alunos.dataNascimento,\n        endereco: alunos.endereco,\n        nomeResponsavel: alunos.nomeResponsavel,\n        telefoneResponsavel: alunos.telefoneResponsavel,\n        filialId: alunos.filialId,\n        ativo: alunos.ativo,\n        createdAt: alunos.createdAt,\n        updatedAt: alunos.updatedAt,\n        filial: filiais,\n      })\n      .from(alunos)\n      .leftJoin(filiais, eq(alunos.filialId, filiais.id))\n      .where(eq(alunos.ativo, true))\n      .orderBy(desc(alunos.createdAt));\n\n    // Calcular status de pagamento para cada aluno\n    const alunosComStatus = await Promise.all(\n      alunosData.map(async (aluno) => {\n        const statusPagamento = await this.calcularStatusPagamento(aluno.id);\n        return {\n          ...aluno,\n          statusPagamento,\n        };\n      })\n    );\n\n    return alunosComStatus;\n  }\n\n  private async calcularStatusPagamento(alunoId: number) {\n    // Buscar o último pagamento do aluno\n    const ultimoPagamento = await db\n      .select()\n      .from(pagamentos)\n      .where(eq(pagamentos.alunoId, alunoId))\n      .orderBy(desc(pagamentos.mesReferencia))\n      .limit(1);\n\n    if (ultimoPagamento.length === 0) {\n      // Aluno nunca fez pagamento\n      return {\n        emDia: false,\n        ultimoPagamento: undefined,\n        diasAtraso: undefined,\n      };\n    }\n\n    const ultimoMesReferencia = ultimoPagamento[0].mesReferencia;\n    const agora = new Date();\n    const mesAtual = `${agora.getFullYear()}-${String(agora.getMonth() + 1).padStart(2, '0')}`;\n    \n    // Verificar se o último pagamento é do mês atual\n    const emDia = ultimoMesReferencia === mesAtual;\n    \n    // Calcular dias de atraso se não estiver em dia\n    let diasAtraso = 0;\n    if (!emDia) {\n      const [anoUltimo, mesUltimo] = ultimoMesReferencia.split('-').map(Number);\n      const dataUltimoPagamento = new Date(anoUltimo, mesUltimo - 1, 1);\n      const proximoMesDevido = new Date(anoUltimo, mesUltimo, 1);\n      const diffTempo = agora.getTime() - proximoMesDevido.getTime();\n      diasAtraso = Math.floor(diffTempo / (1000 * 60 * 60 * 24));\n    }\n\n    return {\n      emDia,\n      ultimoPagamento: ultimoMesReferencia,\n      diasAtraso: !emDia ? diasAtraso : undefined,\n    };\n  }\n\n  async getAluno(id: number): Promise<AlunoWithTurmas | undefined> {\n    const [aluno] = await db\n      .select()\n      .from(alunos)\n      .where(and(eq(alunos.id, id), eq(alunos.ativo, true)));\n\n    if (!aluno) return undefined;\n\n    const matriculasData = await db\n      .select({\n        matricula: matriculas,\n        turma: turmas,\n        professor: professores,\n      })\n      .from(matriculas)\n      .leftJoin(turmas, eq(matriculas.turmaId, turmas.id))\n      .leftJoin(professores, eq(turmas.professorId, professores.id))\n      .where(and(eq(matriculas.alunoId, id), eq(matriculas.ativo, true)));\n\n    return {\n      ...aluno,\n      matriculas: matriculasData.map((item) => ({\n        ...item.matricula,\n        turma: {\n          ...item.turma!,\n          professor: item.professor,\n        },\n      })),\n    };\n  }\n\n  async createAluno(aluno: InsertAluno): Promise<Aluno> {\n    const [newAluno] = await db.insert(alunos).values(aluno).returning();\n    return newAluno;\n  }\n\n  async updateAluno(id: number, aluno: Partial<InsertAluno>): Promise<Aluno> {\n    const [updatedAluno] = await db\n      .update(alunos)\n      .set({ ...aluno, updatedAt: new Date() })\n      .where(eq(alunos.id, id))\n      .returning();\n    return updatedAluno;\n  }\n\n  async deleteAluno(id: number): Promise<void> {\n    await db.update(alunos).set({ ativo: false }).where(eq(alunos.id, id));\n  }\n\n  // Professores operations\n  async getProfessores(): Promise<Professor[]> {\n    return await db.select().from(professores).where(eq(professores.ativo, true)).orderBy(desc(professores.createdAt));\n  }\n\n  async getProfessor(id: number): Promise<Professor | undefined> {\n    const [professor] = await db\n      .select()\n      .from(professores)\n      .where(and(eq(professores.id, id), eq(professores.ativo, true)));\n    return professor;\n  }\n\n  async createProfessor(professor: InsertProfessor): Promise<Professor> {\n    const [newProfessor] = await db.insert(professores).values(professor).returning();\n    return newProfessor;\n  }\n\n  async updateProfessor(id: number, professor: Partial<InsertProfessor>): Promise<Professor> {\n    const [updatedProfessor] = await db\n      .update(professores)\n      .set({ ...professor, updatedAt: new Date() })\n      .where(eq(professores.id, id))\n      .returning();\n    return updatedProfessor;\n  }\n\n  async deleteProfessor(id: number): Promise<void> {\n    await db.update(professores).set({ ativo: false }).where(eq(professores.id, id));\n  }\n\n  // Turmas operations\n  async getTurmas(): Promise<TurmaWithProfessor[]> {\n    const turmasData = await db\n      .select({\n        turma: turmas,\n        professor: professores,\n        filial: filiais,\n        matriculasCount: count(matriculas.id),\n      })\n      .from(turmas)\n      .leftJoin(professores, eq(turmas.professorId, professores.id))\n      .leftJoin(filiais, eq(turmas.filialId, filiais.id))\n      .leftJoin(matriculas, and(eq(matriculas.turmaId, turmas.id), eq(matriculas.ativo, true)))\n      .where(eq(turmas.ativo, true))\n      .groupBy(turmas.id, professores.id, filiais.id)\n      .orderBy(desc(turmas.createdAt));\n\n    return turmasData.map((item) => ({\n      ...item.turma,\n      professor: item.professor,\n      filial: item.filial,\n      _count: {\n        matriculas: item.matriculasCount,\n      },\n    }));\n  }\n\n  async getTurma(id: number): Promise<TurmaWithProfessor | undefined> {\n    const [turmaData] = await db\n      .select({\n        turma: turmas,\n        professor: professores,\n        filial: filiais,\n      })\n      .from(turmas)\n      .leftJoin(professores, eq(turmas.professorId, professores.id))\n      .leftJoin(filiais, eq(turmas.filialId, filiais.id))\n      .where(and(eq(turmas.id, id), eq(turmas.ativo, true)));\n\n    if (!turmaData) return undefined;\n\n    return {\n      ...turmaData.turma,\n      professor: turmaData.professor,\n      filial: turmaData.filial,\n    };\n  }\n\n  async createTurma(turma: InsertTurma): Promise<Turma> {\n    const [newTurma] = await db.insert(turmas).values(turma).returning();\n    return newTurma;\n  }\n\n  async updateTurma(id: number, turma: Partial<InsertTurma>): Promise<Turma> {\n    const [updatedTurma] = await db\n      .update(turmas)\n      .set({ ...turma, updatedAt: new Date() })\n      .where(eq(turmas.id, id))\n      .returning();\n    return updatedTurma;\n  }\n\n  async deleteTurma(id: number): Promise<void> {\n    await db.update(turmas).set({ ativo: false }).where(eq(turmas.id, id));\n  }\n\n  // Matriculas operations\n  async getMatriculas(): Promise<Matricula[]> {\n    return await db.select().from(matriculas).where(eq(matriculas.ativo, true)).orderBy(desc(matriculas.createdAt));\n  }\n\n  async createMatricula(matricula: InsertMatricula): Promise<Matricula> {\n    const [newMatricula] = await db.insert(matriculas).values(matricula).returning();\n    return newMatricula;\n  }\n\n  async deleteMatricula(id: number): Promise<void> {\n    await db.update(matriculas).set({ ativo: false }).where(eq(matriculas.id, id));\n  }\n\n  // Pagamentos operations\n  async getPagamentos(): Promise<Pagamento[]> {\n    return await db.select().from(pagamentos).orderBy(desc(pagamentos.createdAt));\n  }\n\n  async getPagamentosByAluno(alunoId: number): Promise<Pagamento[]> {\n    return await db.select().from(pagamentos).where(eq(pagamentos.alunoId, alunoId)).orderBy(desc(pagamentos.createdAt));\n  }\n\n  async createPagamento(pagamento: InsertPagamento): Promise<Pagamento> {\n    const [newPagamento] = await db.insert(pagamentos).values(pagamento).returning();\n    return newPagamento;\n  }\n\n  async deletePagamento(id: number): Promise<void> {\n    await db.delete(pagamentos).where(eq(pagamentos.id, id));\n  }\n\n  // Dashboard metrics\n  async getDashboardMetrics(): Promise<{\n    totalAlunos: number;\n    totalProfessores: number;\n    totalTurmas: number;\n    receitaMensal: number;\n  }> {\n    const currentMonth = new Date().toISOString().slice(0, 7); // YYYY-MM format\n\n    const [alunosCount] = await db\n      .select({ count: count() })\n      .from(alunos)\n      .where(eq(alunos.ativo, true));\n\n    const [professoresCount] = await db\n      .select({ count: count() })\n      .from(professores)\n      .where(eq(professores.ativo, true));\n\n    const [turmasCount] = await db\n      .select({ count: count() })\n      .from(turmas)\n      .where(eq(turmas.ativo, true));\n\n    const [receitaResult] = await db\n      .select({\n        total: sql<number>`COALESCE(SUM(${pagamentos.valor}), 0)`,\n      })\n      .from(pagamentos)\n      .where(eq(pagamentos.mesReferencia, currentMonth));\n\n    return {\n      totalAlunos: alunosCount.count,\n      totalProfessores: professoresCount.count,\n      totalTurmas: turmasCount.count,\n      receitaMensal: Number(receitaResult.total),\n    };\n  }\n\n  // Filiais operations\n  async getFiliais(): Promise<Filial[]> {\n    return await db.select().from(filiais).where(eq(filiais.ativa, true)).orderBy(desc(filiais.createdAt));\n  }\n\n  async getFilial(id: number): Promise<Filial | undefined> {\n    const [filial] = await db.select().from(filiais).where(and(eq(filiais.id, id), eq(filiais.ativa, true)));\n    return filial;\n  }\n\n  async createFilial(filial: InsertFilial): Promise<Filial> {\n    const [newFilial] = await db.insert(filiais).values(filial).returning();\n    return newFilial;\n  }\n\n  async updateFilial(id: number, filial: Partial<InsertFilial>): Promise<Filial> {\n    const [updatedFilial] = await db\n      .update(filiais)\n      .set({ ...filial, updatedAt: new Date() })\n      .where(eq(filiais.id, id))\n      .returning();\n    return updatedFilial;\n  }\n\n  async deleteFilial(id: number): Promise<void> {\n    await db.update(filiais).set({ ativa: false }).where(eq(filiais.id, id));\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":13282},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}","size_bytes":115},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/pages/PortalUnidades.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { \n  Building2, \n  Users, \n  DollarSign, \n  Calendar,\n  MapPin,\n  Phone,\n  Mail,\n  Clock,\n  Search,\n  Eye,\n  Settings,\n  RefreshCw,\n  CheckCircle,\n  AlertCircle\n} from \"lucide-react\";\nimport { Link } from \"wouter\";\n\ninterface Filial {\n  id: number;\n  nome: string;\n  endereco: string | null;\n  telefone: string | null;\n  email: string | null;\n  horarioFuncionamento: string | null;\n  ativo: boolean | null;\n  totalAlunos: number;\n  totalProfessores: number;\n  receitaMensal: number;\n}\n\nexport default function PortalUnidades() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const { toast } = useToast();\n\n  const { data: unidades = [], isLoading } = useQuery({\n    queryKey: [\"/api/filiais/detalhadas\"],\n  });\n\n  const { data: syncStatus } = useQuery({\n    queryKey: [\"/api/sync/status\"],\n    refetchInterval: 10000, // Atualiza a cada 10 segundos\n  });\n\n  const forceSyncMutation = async () => {\n    try {\n      await apiRequest(\"POST\", \"/api/sync/force\");\n      toast({\n        title: \"Sincronização Forçada\",\n        description: \"Todas as unidades foram sincronizadas com sucesso.\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Erro na Sincronização\",\n        description: \"Não foi possível forçar a sincronização.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const filteredUnidades = (unidades as Filial[]).filter((unidade: Filial) =>\n    unidade.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    unidade.endereco?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-blue-50\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-blue-50 p-4\">\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        {/* Header */}\n        <div className=\"bg-white rounded-lg shadow-sm border p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900\">Portal das Unidades</h1>\n              <p className=\"text-gray-600 mt-2\">\n                Gerencie todas as unidades da escola de futebol de forma centralizada\n              </p>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              {/* Sync Status */}\n              <div className=\"flex items-center space-x-2 bg-blue-50 px-4 py-2 rounded-lg\">\n                {syncStatus?.isActive ? (\n                  <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                ) : (\n                  <AlertCircle className=\"h-5 w-5 text-yellow-600\" />\n                )}\n                <div className=\"text-sm\">\n                  <p className=\"font-medium text-gray-900\">\n                    Sincronização: {syncStatus?.isActive ? \"Ativa\" : \"Inativa\"}\n                  </p>\n                  <p className=\"text-gray-600\">\n                    {syncStatus?.pendingSyncs || 0} operações pendentes\n                  </p>\n                </div>\n              </div>\n              \n              {/* Force Sync Button */}\n              <Button onClick={forceSyncMutation} variant=\"outline\" size=\"sm\">\n                <RefreshCw className=\"h-4 w-4 mr-2\" />\n                Forçar Sincronização\n              </Button>\n              \n              <Building2 className=\"h-12 w-12 text-blue-600\" />\n            </div>\n          </div>\n        </div>\n\n        {/* Search and Stats */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\n          <div className=\"lg:col-span-1\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n              <Input\n                placeholder=\"Buscar unidades...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n          </div>\n          \n          <div className=\"lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center space-x-2\">\n                  <Building2 className=\"h-6 w-6 text-blue-600\" />\n                  <div>\n                    <p className=\"text-sm text-gray-600\">Total de Unidades</p>\n                    <p className=\"text-2xl font-bold\">{(unidades as Filial[]).length}</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center space-x-2\">\n                  <Users className=\"h-6 w-6 text-green-600\" />\n                  <div>\n                    <p className=\"text-sm text-gray-600\">Total de Alunos</p>\n                    <p className=\"text-2xl font-bold\">\n                      {(unidades as Filial[]).reduce((acc: number, u: Filial) => acc + u.totalAlunos, 0)}\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center space-x-2\">\n                  <DollarSign className=\"h-6 w-6 text-yellow-600\" />\n                  <div>\n                    <p className=\"text-sm text-gray-600\">Receita Total</p>\n                    <p className=\"text-2xl font-bold\">\n                      R$ {(unidades as Filial[]).reduce((acc: number, u: Filial) => acc + u.receitaMensal, 0).toLocaleString()}\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n\n        {/* Units Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {filteredUnidades.map((unidade: Filial) => (\n            <Card key={unidade.id} className=\"overflow-hidden hover:shadow-lg transition-shadow\">\n              <CardHeader className=\"bg-gradient-to-r from-blue-600 to-blue-700 text-white\">\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-lg\">{unidade.nome}</CardTitle>\n                  <Badge variant={unidade.ativo ? \"default\" : \"secondary\"}>\n                    {unidade.ativo ? \"Ativo\" : \"Inativo\"}\n                  </Badge>\n                </div>\n                <CardDescription className=\"text-blue-100\">\n                  Unidade da escola de futebol\n                </CardDescription>\n              </CardHeader>\n              \n              <CardContent className=\"p-6 space-y-4\">\n                {/* Contact Info */}\n                {unidade.endereco && (\n                  <div className=\"flex items-start space-x-2\">\n                    <MapPin className=\"h-4 w-4 text-gray-500 mt-0.5\" />\n                    <span className=\"text-sm text-gray-700\">{unidade.endereco}</span>\n                  </div>\n                )}\n                \n                {unidade.telefone && (\n                  <div className=\"flex items-center space-x-2\">\n                    <Phone className=\"h-4 w-4 text-gray-500\" />\n                    <span className=\"text-sm text-gray-700\">{unidade.telefone}</span>\n                  </div>\n                )}\n                \n                {unidade.email && (\n                  <div className=\"flex items-center space-x-2\">\n                    <Mail className=\"h-4 w-4 text-gray-500\" />\n                    <span className=\"text-sm text-gray-700\">{unidade.email}</span>\n                  </div>\n                )}\n                \n                {unidade.horarioFuncionamento && (\n                  <div className=\"flex items-center space-x-2\">\n                    <Clock className=\"h-4 w-4 text-gray-500\" />\n                    <span className=\"text-sm text-gray-700\">{unidade.horarioFuncionamento}</span>\n                  </div>\n                )}\n\n                <Separator />\n\n                {/* Stats */}\n                <div className=\"grid grid-cols-3 gap-4 text-center\">\n                  <div>\n                    <p className=\"text-2xl font-bold text-blue-600\">{unidade.totalAlunos}</p>\n                    <p className=\"text-xs text-gray-500\">Alunos</p>\n                  </div>\n                  <div>\n                    <p className=\"text-2xl font-bold text-green-600\">{unidade.totalProfessores}</p>\n                    <p className=\"text-xs text-gray-500\">Professores</p>\n                  </div>\n                  <div>\n                    <p className=\"text-lg font-bold text-yellow-600\">\n                      R$ {unidade.receitaMensal.toLocaleString()}\n                    </p>\n                    <p className=\"text-xs text-gray-500\">Receita</p>\n                  </div>\n                </div>\n\n                <Separator />\n\n                {/* Sync Status for Unit */}\n                <div className=\"flex items-center justify-center py-2\">\n                  <div className=\"flex items-center space-x-2 text-sm\">\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                    <span className=\"text-gray-600\">Sincronizado</span>\n                  </div>\n                </div>\n\n                {/* Actions */}\n                <div className=\"flex space-x-2\">\n                  <Link href={`/unidade/${unidade.id}`} className=\"flex-1\">\n                    <Button variant=\"outline\" size=\"sm\" className=\"w-full\">\n                      <Eye className=\"h-4 w-4 mr-2\" />\n                      Visualizar\n                    </Button>\n                  </Link>\n                  <Link href={`/unidade/${unidade.id}/sistema`} className=\"flex-1\">\n                    <Button size=\"sm\" className=\"w-full\">\n                      <Settings className=\"h-4 w-4 mr-2\" />\n                      Gerenciar\n                    </Button>\n                  </Link>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        {filteredUnidades.length === 0 && (\n          <Card className=\"p-12 text-center\">\n            <Building2 className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n              Nenhuma unidade encontrada\n            </h3>\n            <p className=\"text-gray-600\">\n              {searchTerm ? \"Tente ajustar os filtros de busca.\" : \"Cadastre a primeira unidade para começar.\"}\n            </p>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":11129},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/pages/GestaoTurmas.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { \n  Users, \n  Search, \n  Edit, \n  Trash2, \n  UserPlus, \n  ClipboardList,\n  Calendar,\n  Clock,\n  MapPin,\n  User\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { \n  TurmaWithProfessor, \n  AlunoWithFilial, \n  Matricula, \n  Presenca,\n  InsertMatricula,\n  InsertPresenca\n} from \"@shared/schema\";\n\nexport default function GestaoTurmas() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedTurma, setSelectedTurma] = useState<TurmaWithProfessor | null>(null);\n  const [isVinculacaoDialogOpen, setIsVinculacaoDialogOpen] = useState(false);\n  const [isChamadaDialogOpen, setIsChamadaDialogOpen] = useState(false);\n  const [dataChamada, setDataChamada] = useState(new Date().toISOString().split('T')[0]);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: turmas, isLoading: loadingTurmas } = useQuery<TurmaWithProfessor[]>({\n    queryKey: [\"/api/turmas\"],\n  });\n\n  const { data: alunos, isLoading: loadingAlunos } = useQuery<AlunoWithFilial[]>({\n    queryKey: [\"/api/alunos\"],\n  });\n\n  const { data: matriculas } = useQuery<Matricula[]>({\n    queryKey: [\"/api/matriculas\"],\n  });\n\n  const { data: presencasData } = useQuery<Presenca[]>({\n    queryKey: [\"/api/presencas\", selectedTurma?.id, dataChamada],\n    enabled: !!selectedTurma && isChamadaDialogOpen,\n  });\n\n  const matricularAlunoMutation = useMutation({\n    mutationFn: async (data: InsertMatricula) => {\n      await apiRequest(\"POST\", \"/api/matriculas\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/matriculas\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Aluno vinculado à turma com sucesso.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao vincular aluno à turma.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const registrarPresencaMutation = useMutation({\n    mutationFn: async (data: InsertPresenca[]) => {\n      await apiRequest(\"POST\", \"/api/presencas/lote\", { presencas: data });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/presencas\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Lista de chamada registrada com sucesso.\",\n      });\n      setIsChamadaDialogOpen(false);\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao registrar lista de chamada.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredTurmas = turmas?.filter((turma) =>\n    turma.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    turma.categoria.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    turma.professor?.nome.toLowerCase().includes(searchTerm.toLowerCase())\n  ) || [];\n\n  const getAlunosDaTurma = (turmaId: number) => {\n    if (!matriculas || !alunos) return [];\n    const matriculasDaTurma = matriculas.filter(m => m.turmaId === turmaId && m.ativo);\n    return matriculasDaTurma.map(matricula => \n      alunos.find(aluno => aluno.id === matricula.alunoId)\n    ).filter(Boolean) as AlunoWithFilial[];\n  };\n\n  const getAlunosDisponiveis = (turmaId: number) => {\n    if (!matriculas || !alunos) return [];\n    const alunosJaMatriculados = getAlunosDaTurma(turmaId).map(a => a.id);\n    return alunos.filter(aluno => \n      aluno.ativo && !alunosJaMatriculados.includes(aluno.id)\n    );\n  };\n\n  const handleVincularAluno = (alunoId: number) => {\n    if (!selectedTurma) return;\n    \n    matricularAlunoMutation.mutate({\n      alunoId,\n      turmaId: selectedTurma.id,\n      ativo: true,\n    });\n  };\n\n  const handleChamada = (turma: TurmaWithProfessor) => {\n    setSelectedTurma(turma);\n    setIsChamadaDialogOpen(true);\n  };\n\n  const ListaChamada = () => {\n    if (!selectedTurma) return null;\n    \n    const alunosDaTurma = getAlunosDaTurma(selectedTurma.id);\n    const [presencas, setPresencas] = useState<Record<number, { presente: boolean; observacoes: string }>>({});\n\n    const handlePresencaChange = (alunoId: number, presente: boolean) => {\n      setPresencas(prev => ({\n        ...prev,\n        [alunoId]: {\n          ...prev[alunoId],\n          presente\n        }\n      }));\n    };\n\n    const handleObservacaoChange = (alunoId: number, observacoes: string) => {\n      setPresencas(prev => ({\n        ...prev,\n        [alunoId]: {\n          ...prev[alunoId],\n          observacoes\n        }\n      }));\n    };\n\n    const handleSalvarChamada = () => {\n      const presencasParaSalvar: InsertPresenca[] = alunosDaTurma.map(aluno => ({\n        alunoId: aluno.id,\n        turmaId: selectedTurma.id,\n        data: dataChamada,\n        presente: presencas[aluno.id]?.presente || false,\n        observacoes: presencas[aluno.id]?.observacoes || null,\n        registradoPor: null, // Será preenchido no backend com o professor logado\n      }));\n\n      registrarPresencaMutation.mutate(presencasParaSalvar);\n    };\n\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h3 className=\"text-lg font-medium\">Lista de Chamada</h3>\n            <p className=\"text-sm text-neutral-500\">\n              Turma: {selectedTurma.nome} - {selectedTurma.categoria}\n            </p>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <Label htmlFor=\"data-chamada\">Data:</Label>\n            <Input\n              id=\"data-chamada\"\n              type=\"date\"\n              value={dataChamada}\n              onChange={(e) => setDataChamada(e.target.value)}\n              className=\"w-auto\"\n            />\n          </div>\n        </div>\n\n        <Separator />\n\n        <div className=\"space-y-3 max-h-96 overflow-y-auto\">\n          {alunosDaTurma.map((aluno) => (\n            <div key={aluno.id} className=\"border rounded-lg p-3 space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center space-x-3\">\n                  <Checkbox\n                    checked={presencas[aluno.id]?.presente || false}\n                    onCheckedChange={(checked) => \n                      handlePresencaChange(aluno.id, checked as boolean)\n                    }\n                  />\n                  <div>\n                    <p className=\"font-medium\">{aluno.nome}</p>\n                    <p className=\"text-sm text-neutral-500\">ID: {aluno.id}</p>\n                  </div>\n                </div>\n                <Badge variant={presencas[aluno.id]?.presente ? \"default\" : \"secondary\"}>\n                  {presencas[aluno.id]?.presente ? \"Presente\" : \"Ausente\"}\n                </Badge>\n              </div>\n              <Textarea\n                placeholder=\"Observações (opcional)\"\n                value={presencas[aluno.id]?.observacoes || \"\"}\n                onChange={(e) => handleObservacaoChange(aluno.id, e.target.value)}\n                className=\"text-sm\"\n                rows={2}\n              />\n            </div>\n          ))}\n        </div>\n\n        <div className=\"flex justify-end space-x-2 pt-4\">\n          <Button variant=\"outline\" onClick={() => setIsChamadaDialogOpen(false)}>\n            Cancelar\n          </Button>\n          <Button \n            onClick={handleSalvarChamada}\n            disabled={registrarPresencaMutation.isPending}\n          >\n            {registrarPresencaMutation.isPending ? \"Salvando...\" : \"Salvar Chamada\"}\n          </Button>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-3xl font-bold text-neutral-800\">Gestão de Turmas</h2>\n          <p className=\"text-neutral-600\">Vincule alunos às turmas e faça a lista de chamada</p>\n        </div>\n      </div>\n\n      {/* Search and Summary */}\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400 w-4 h-4\" />\n              <Input\n                placeholder=\"Buscar turmas...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n            <div className=\"flex items-center space-x-6 text-sm\">\n              <div className=\"text-center\">\n                <p className=\"font-semibold text-lg\">{filteredTurmas.length}</p>\n                <p className=\"text-neutral-500\">Total</p>\n              </div>\n              <div className=\"text-center\">\n                <p className=\"font-semibold text-lg text-green-600\">\n                  {filteredTurmas.filter(t => t.ativo).length}\n                </p>\n                <p className=\"text-neutral-500\">Ativas</p>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Turmas Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Lista de Turmas</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {loadingTurmas ? (\n            <div className=\"space-y-3\">\n              {[...Array(5)].map((_, i) => (\n                <div key={i} className=\"flex items-center space-x-4\">\n                  <Skeleton className=\"h-12 w-12 rounded-full\" />\n                  <div className=\"space-y-2 flex-1\">\n                    <Skeleton className=\"h-4 w-48\" />\n                    <Skeleton className=\"h-3 w-32\" />\n                  </div>\n                  <Skeleton className=\"h-8 w-20\" />\n                  <Skeleton className=\"h-8 w-8\" />\n                </div>\n              ))}\n            </div>\n          ) : filteredTurmas.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <Users className=\"w-12 h-12 text-neutral-400 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-neutral-800 mb-2\">\n                {searchTerm ? \"Nenhuma turma encontrada\" : \"Nenhuma turma cadastrada\"}\n              </h3>\n              <p className=\"text-neutral-500 mb-4\">\n                {searchTerm \n                  ? \"Tente buscar com outros termos.\" \n                  : \"Cadastre turmas primeiro para gerenciar alunos.\"\n                }\n              </p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Turma</TableHead>\n                    <TableHead>Professor</TableHead>\n                    <TableHead>Unidade</TableHead>\n                    <TableHead>Alunos</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Ações</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredTurmas.map((turma) => {\n                    const alunosDaTurma = getAlunosDaTurma(turma.id);\n                    return (\n                      <TableRow key={turma.id}>\n                        <TableCell>\n                          <div>\n                            <p className=\"font-medium\">{turma.nome}</p>\n                            <div className=\"flex items-center space-x-4 text-sm text-neutral-500\">\n                              <span className=\"flex items-center\">\n                                <Users className=\"w-3 h-3 mr-1\" />\n                                {turma.categoria}\n                              </span>\n                              {turma.horario && (\n                                <span className=\"flex items-center\">\n                                  <Clock className=\"w-3 h-3 mr-1\" />\n                                  {turma.horario}\n                                </span>\n                              )}\n                              {turma.diasSemana && (\n                                <span className=\"flex items-center\">\n                                  <Calendar className=\"w-3 h-3 mr-1\" />\n                                  {turma.diasSemana}\n                                </span>\n                              )}\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          {turma.professor ? (\n                            <div className=\"flex items-center\">\n                              <User className=\"w-3 h-3 mr-1 text-neutral-400\" />\n                              {turma.professor.nome}\n                            </div>\n                          ) : (\n                            <span className=\"text-neutral-400\">-</span>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          {turma.filial ? (\n                            <div className=\"flex items-center\">\n                              <MapPin className=\"w-3 h-3 mr-1 text-neutral-400\" />\n                              <Badge variant=\"secondary\">{turma.filial.nome}</Badge>\n                            </div>\n                          ) : (\n                            <span className=\"text-neutral-400\">-</span>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center\">\n                            <Users className=\"w-3 h-3 mr-1 text-neutral-400\" />\n                            <span className=\"font-medium\">{alunosDaTurma.length}</span>\n                            <span className=\"text-neutral-400 ml-1\">\n                              / {turma.capacidadeMaxima || '∞'}\n                            </span>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={turma.ativo ? \"default\" : \"secondary\"}>\n                            {turma.ativo ? \"Ativa\" : \"Inativa\"}\n                          </Badge>\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <div className=\"flex items-center justify-end space-x-2\">\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => {\n                                setSelectedTurma(turma);\n                                setIsVinculacaoDialogOpen(true);\n                              }}\n                            >\n                              <UserPlus className=\"w-4 h-4\" />\n                            </Button>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => handleChamada(turma)}\n                            >\n                              <ClipboardList className=\"w-4 h-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Dialog de Vinculação de Alunos */}\n      <Dialog open={isVinculacaoDialogOpen} onOpenChange={setIsVinculacaoDialogOpen}>\n        <DialogContent className=\"max-w-4xl\">\n          <DialogHeader>\n            <DialogTitle>\n              Vincular Alunos à Turma: {selectedTurma?.nome}\n            </DialogTitle>\n          </DialogHeader>\n          \n          {selectedTurma && (\n            <div className=\"grid grid-cols-2 gap-6\">\n              {/* Alunos Vinculados */}\n              <div>\n                <h3 className=\"text-lg font-medium mb-3\">Alunos Vinculados</h3>\n                <div className=\"border rounded-lg p-4 max-h-96 overflow-y-auto\">\n                  {getAlunosDaTurma(selectedTurma.id).map((aluno) => (\n                    <div key={aluno.id} className=\"flex items-center justify-between py-2 border-b last:border-b-0\">\n                      <div>\n                        <p className=\"font-medium\">{aluno.nome}</p>\n                        <p className=\"text-sm text-neutral-500\">ID: {aluno.id}</p>\n                      </div>\n                      <Badge variant=\"default\">Vinculado</Badge>\n                    </div>\n                  ))}\n                  {getAlunosDaTurma(selectedTurma.id).length === 0 && (\n                    <p className=\"text-neutral-500 text-center py-4\">\n                      Nenhum aluno vinculado\n                    </p>\n                  )}\n                </div>\n              </div>\n\n              {/* Alunos Disponíveis */}\n              <div>\n                <h3 className=\"text-lg font-medium mb-3\">Alunos Disponíveis</h3>\n                <div className=\"border rounded-lg p-4 max-h-96 overflow-y-auto\">\n                  {getAlunosDisponiveis(selectedTurma.id).map((aluno) => (\n                    <div key={aluno.id} className=\"flex items-center justify-between py-2 border-b last:border-b-0\">\n                      <div>\n                        <p className=\"font-medium\">{aluno.nome}</p>\n                        <p className=\"text-sm text-neutral-500\">\n                          ID: {aluno.id} - {aluno.filial?.nome}\n                        </p>\n                      </div>\n                      <Button\n                        size=\"sm\"\n                        onClick={() => handleVincularAluno(aluno.id)}\n                        disabled={matricularAlunoMutation.isPending}\n                      >\n                        <UserPlus className=\"w-3 h-3 mr-1\" />\n                        Vincular\n                      </Button>\n                    </div>\n                  ))}\n                  {getAlunosDisponiveis(selectedTurma.id).length === 0 && (\n                    <p className=\"text-neutral-500 text-center py-4\">\n                      Nenhum aluno disponível\n                    </p>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog de Lista de Chamada */}\n      <Dialog open={isChamadaDialogOpen} onOpenChange={setIsChamadaDialogOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Lista de Chamada</DialogTitle>\n          </DialogHeader>\n          <ListaChamada />\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":19412},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on port 5000\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = 5000;\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":1921},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/pages/DashboardUnidade.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Users, BookOpen, GraduationCap, DollarSign, Calendar, FileText, Plus, Edit, Trash2 } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Filial, AlunoWithFilial, Professor, TurmaWithProfessor } from \"@shared/schema\";\n\ninterface DashboardUnidadeProps {\n  filialId: number;\n}\n\nexport default function DashboardUnidade({ filialId }: DashboardUnidadeProps) {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const { data: filial, isLoading: loadingFilial } = useQuery<Filial>({\n    queryKey: [`/api/filiais/${filialId}`],\n  });\n\n  const { data: alunos, isLoading: loadingAlunos } = useQuery<AlunoWithFilial[]>({\n    queryKey: [`/api/alunos?filialId=${filialId}`],\n  });\n\n  const { data: professores, isLoading: loadingProfessores } = useQuery<Professor[]>({\n    queryKey: [`/api/professores?filialId=${filialId}`],\n  });\n\n  const { data: turmas, isLoading: loadingTurmas } = useQuery<TurmaWithProfessor[]>({\n    queryKey: [`/api/turmas?filialId=${filialId}`],\n  });\n\n  if (loadingFilial) {\n    return (\n      <div className=\"flex items-center justify-center h-96\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  if (!filial) {\n    return (\n      <div className=\"text-center py-12\">\n        <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">Unidade não encontrada</h2>\n        <Button onClick={() => setLocation(\"/gestao-unidades\")}>\n          Voltar para Gestão de Unidades\n        </Button>\n      </div>\n    );\n  }\n\n  const totalAlunos = alunos?.length || 0;\n  const totalProfessores = professores?.length || 0;\n  const totalTurmas = turmas?.length || 0;\n\n  // Calcular receita mensal (simulação baseada em número de alunos)\n  const receitaMensal = totalAlunos * 150; // R$ 150 por aluno\n\n  const metrics = [\n    {\n      title: \"Total de Alunos\",\n      value: totalAlunos.toString(),\n      icon: Users,\n      color: \"text-blue-600\",\n      bgColor: \"bg-blue-50\",\n    },\n    {\n      title: \"Professores\",\n      value: totalProfessores.toString(),\n      icon: GraduationCap,\n      color: \"text-green-600\",\n      bgColor: \"bg-green-50\",\n    },\n    {\n      title: \"Turmas Ativas\",\n      value: totalTurmas.toString(),\n      icon: BookOpen,\n      color: \"text-purple-600\",\n      bgColor: \"bg-purple-50\",\n    },\n    {\n      title: \"Receita Mensal\",\n      value: `R$ ${receitaMensal.toLocaleString(\"pt-BR\")}`,\n      icon: DollarSign,\n      color: \"text-emerald-600\",\n      bgColor: \"bg-emerald-50\",\n    },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">{filial.nome}</h1>\n          <p className=\"text-gray-600 mt-1\">{filial.endereco}</p>\n          <div className=\"flex items-center gap-2 mt-2\">\n            <Badge variant={filial.ativa ? \"default\" : \"secondary\"}>\n              {filial.ativa ? \"Ativa\" : \"Inativa\"}\n            </Badge>\n            <span className=\"text-sm text-gray-500\">\n              Telefone: {filial.telefone}\n            </span>\n          </div>\n        </div>\n        <Button onClick={() => setLocation(\"/gestao-unidades\")} variant=\"outline\">\n          Voltar para Gestão\n        </Button>\n      </div>\n\n      {/* Métricas */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        {metrics.map((metric) => (\n          <Card key={metric.title}>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center\">\n                <div className={`p-2 rounded-lg ${metric.bgColor}`}>\n                  <metric.icon className={`h-6 w-6 ${metric.color}`} />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-sm font-medium text-gray-600\">{metric.title}</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{metric.value}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Tabs de Gestão */}\n      <Tabs defaultValue=\"alunos\" className=\"space-y-4\">\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"alunos\">Alunos</TabsTrigger>\n          <TabsTrigger value=\"professores\">Professores</TabsTrigger>\n          <TabsTrigger value=\"turmas\">Turmas</TabsTrigger>\n          <TabsTrigger value=\"relatorios\">Relatórios</TabsTrigger>\n        </TabsList>\n\n        {/* Tab Alunos */}\n        <TabsContent value=\"alunos\" className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-xl font-semibold\">Gestão de Alunos</h2>\n            <Button onClick={() => setLocation(\"/alunos\")}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Novo Aluno\n            </Button>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Alunos Matriculados</CardTitle>\n              <CardDescription>\n                Lista de todos os alunos matriculados nesta unidade\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {loadingAlunos ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"animate-spin w-6 h-6 border-4 border-primary border-t-transparent rounded-full\" />\n                </div>\n              ) : alunos && alunos.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {alunos.map((aluno) => (\n                    <div\n                      key={aluno.id}\n                      className=\"flex items-center justify-between p-4 border rounded-lg\"\n                    >\n                      <div>\n                        <h3 className=\"font-medium\">{aluno.nome}</h3>\n                        <p className=\"text-sm text-gray-600\">{aluno.email}</p>\n                        {aluno.cpf && (\n                          <p className=\"text-sm text-gray-500\">CPF: {aluno.cpf}</p>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant={aluno.statusPagamento?.emDia ? \"default\" : \"destructive\"}>\n                          {aluno.statusPagamento?.emDia ? \"Em dia\" : \"Pendente\"}\n                        </Badge>\n                        <Button size=\"sm\" variant=\"ghost\">\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <Users className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                  <p className=\"text-gray-600\">Nenhum aluno matriculado nesta unidade</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Tab Professores */}\n        <TabsContent value=\"professores\" className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-xl font-semibold\">Gestão de Professores</h2>\n            <Button onClick={() => setLocation(\"/professores\")}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Novo Professor\n            </Button>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Professores Ativos</CardTitle>\n              <CardDescription>\n                Lista de todos os professores desta unidade\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {loadingProfessores ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"animate-spin w-6 h-6 border-4 border-primary border-t-transparent rounded-full\" />\n                </div>\n              ) : professores && professores.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {professores.map((professor) => (\n                    <div\n                      key={professor.id}\n                      className=\"flex items-center justify-between p-4 border rounded-lg\"\n                    >\n                      <div>\n                        <h3 className=\"font-medium\">{professor.nome}</h3>\n                        <p className=\"text-sm text-gray-600\">{professor.email}</p>\n                        <p className=\"text-sm text-gray-500\">\n                          Especialidade: {professor.especialidade}\n                        </p>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant={professor.ativo ? \"default\" : \"secondary\"}>\n                          {professor.ativo ? \"Ativo\" : \"Inativo\"}\n                        </Badge>\n                        <Button size=\"sm\" variant=\"ghost\">\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <GraduationCap className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                  <p className=\"text-gray-600\">Nenhum professor cadastrado nesta unidade</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Tab Turmas */}\n        <TabsContent value=\"turmas\" className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-xl font-semibold\">Gestão de Turmas</h2>\n            <Button onClick={() => setLocation(\"/turmas\")}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Nova Turma\n            </Button>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Turmas Ativas</CardTitle>\n              <CardDescription>\n                Lista de todas as turmas desta unidade\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {loadingTurmas ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"animate-spin w-6 h-6 border-4 border-primary border-t-transparent rounded-full\" />\n                </div>\n              ) : turmas && turmas.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {turmas.map((turma) => (\n                    <div\n                      key={turma.id}\n                      className=\"flex items-center justify-between p-4 border rounded-lg\"\n                    >\n                      <div>\n                        <h3 className=\"font-medium\">{turma.nome}</h3>\n                        <p className=\"text-sm text-gray-600\">\n                          Categoria: {turma.categoria}\n                        </p>\n                        <p className=\"text-sm text-gray-500\">\n                          Professor: {turma.professor?.nome || \"Não definido\"}\n                        </p>\n                        <p className=\"text-sm text-gray-500\">\n                          Horário: {turma.horario}\n                        </p>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant=\"default\">\n                          {turma._count?.matriculas || 0} alunos\n                        </Badge>\n                        <Button size=\"sm\" variant=\"ghost\">\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <BookOpen className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                  <p className=\"text-gray-600\">Nenhuma turma criada nesta unidade</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Tab Relatórios */}\n        <TabsContent value=\"relatorios\" className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-xl font-semibold\">Relatórios da Unidade</h2>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            <Card className=\"cursor-pointer hover:shadow-md transition-shadow\" \n                  onClick={() => setLocation(\"/relatorio-presencas\")}>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center\">\n                  <Calendar className=\"h-8 w-8 text-blue-600\" />\n                  <div className=\"ml-4\">\n                    <h3 className=\"font-medium\">Relatório de Presenças</h3>\n                    <p className=\"text-sm text-gray-600\">\n                      Controle de frequência dos alunos\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"cursor-pointer hover:shadow-md transition-shadow\"\n                  onClick={() => setLocation(\"/financeiro\")}>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center\">\n                  <DollarSign className=\"h-8 w-8 text-green-600\" />\n                  <div className=\"ml-4\">\n                    <h3 className=\"font-medium\">Relatório Financeiro</h3>\n                    <p className=\"text-sm text-gray-600\">\n                      Controle de pagamentos e receitas\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"cursor-pointer hover:shadow-md transition-shadow\"\n                  onClick={() => setLocation(\"/relatorios\")}>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center\">\n                  <FileText className=\"h-8 w-8 text-purple-600\" />\n                  <div className=\"ml-4\">\n                    <h3 className=\"font-medium\">Relatórios Gerais</h3>\n                    <p className=\"text-sm text-gray-600\">\n                      Todos os relatórios da unidade\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":14933},"client/src/components/unidade/ProfessoresTab.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { UserPlus, Search, Edit, Trash2, Phone, Mail, GraduationCap } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useUnidadeAuth } from \"@/contexts/UnidadeContext\";\nimport type { Professor } from \"@shared/schema\";\n\nexport default function ProfessoresTab() {\n  const { filialId } = useUnidadeAuth();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingProfessor, setEditingProfessor] = useState<Professor | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: professores, isLoading } = useQuery({\n    queryKey: [\"/api/professores\"],\n    enabled: !!filialId,\n  });\n\n  const deleteProfessorMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await apiRequest(\"DELETE\", `/api/professores/${id}`);\n      if (!response.ok) {\n        throw new Error(\"Failed to delete professor\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/professores\"] });\n      toast({\n        title: \"Professor excluído\",\n        description: \"O professor foi excluído com sucesso.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível excluir o professor.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDeleteProfessor = (id: number) => {\n    if (confirm(\"Tem certeza de que deseja excluir este professor?\")) {\n      deleteProfessorMutation.mutate(id);\n    }\n  };\n\n  const handleEditProfessor = (professor: Professor) => {\n    setEditingProfessor(professor);\n    setIsDialogOpen(true);\n  };\n\n  const handleCloseDialog = () => {\n    setIsDialogOpen(false);\n    setEditingProfessor(null);\n  };\n\n  const professoresArray = Array.isArray(professores) ? professores : [];\n\n  const filteredProfessores = professoresArray.filter((professor) => {\n    return professor.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n           professor.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n           professor.telefone?.includes(searchTerm);\n  });\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Professores da Unidade</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <Skeleton className=\"h-10 w-full\" />\n            <Skeleton className=\"h-10 w-full\" />\n            <Skeleton className=\"h-10 w-full\" />\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900\">Professores da Unidade</h2>\n          <p className=\"text-gray-600\">Gerencie os professores da sua unidade</p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button className=\"flex items-center gap-2\">\n              <UserPlus className=\"w-4 h-4\" />\n              Novo Professor\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingProfessor ? \"Editar Professor\" : \"Cadastrar Novo Professor\"}\n              </DialogTitle>\n            </DialogHeader>\n            <div className=\"p-4\">\n              <p className=\"text-center text-gray-600\">\n                Formulário de professor será implementado em breve.\n              </p>\n              <div className=\"flex justify-end gap-2 mt-4\">\n                <Button variant=\"outline\" onClick={handleCloseDialog}>\n                  Cancelar\n                </Button>\n                <Button onClick={handleCloseDialog}>\n                  Salvar\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex-1\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n              <Input\n                placeholder=\"Buscar por nome, email ou telefone...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {filteredProfessores.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <GraduationCap className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n                {professoresArray.length === 0 ? \"Nenhum professor cadastrado\" : \"Nenhum professor encontrado\"}\n              </h3>\n              <p className=\"text-gray-600 mb-4\">\n                {professoresArray.length === 0 \n                  ? \"Comece cadastrando o primeiro professor da sua unidade.\"\n                  : \"Tente buscar por outros termos.\"\n                }\n              </p>\n              {professoresArray.length === 0 && (\n                <Button onClick={() => setIsDialogOpen(true)}>\n                  <UserPlus className=\"w-4 h-4 mr-2\" />\n                  Cadastrar Primeiro Professor\n                </Button>\n              )}\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Nome</TableHead>\n                    <TableHead>Contato</TableHead>\n                    <TableHead>Especialidade</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Ações</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredProfessores.map((professor) => (\n                    <TableRow key={professor.id}>\n                      <TableCell>\n                        <div className=\"font-medium\">{professor.nome}</div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"space-y-1\">\n                          {professor.email && (\n                            <div className=\"flex items-center gap-1 text-sm\">\n                              <Mail className=\"w-3 h-3\" />\n                              {professor.email}\n                            </div>\n                          )}\n                          {professor.telefone && (\n                            <div className=\"flex items-center gap-1 text-sm\">\n                              <Phone className=\"w-3 h-3\" />\n                              {professor.telefone}\n                            </div>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        {professor.especialidade || \"Não informado\"}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={professor.ativo ? \"default\" : \"secondary\"}>\n                          {professor.ativo ? \"Ativo\" : \"Inativo\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end gap-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleEditProfessor(professor)}\n                          >\n                            <Edit className=\"w-3 h-3\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleDeleteProfessor(professor.id)}\n                            className=\"text-red-600 hover:text-red-700\"\n                          >\n                            <Trash2 className=\"w-3 h-3\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":9114},"client/src/contexts/UnidadeContext.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { useLocation } from 'wouter';\nimport { apiRequest } from '@/lib/queryClient';\n\ninterface UnidadeContextType {\n  isAuthenticated: boolean;\n  gestorId: number | null;\n  filialId: number | null;\n  nomeGestor: string | null;\n  nomeFilial: string | null;\n  isLoading: boolean;\n  login: (email: string, senha: string) => Promise<boolean>;\n  logout: () => void;\n}\n\nconst UnidadeContext = createContext<UnidadeContextType | undefined>(undefined);\n\nexport function UnidadeProvider({ children }: { children: ReactNode }) {\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [gestorId, setGestorId] = useState<number | null>(null);\n  const [filialId, setFilialId] = useState<number | null>(null);\n  const [nomeGestor, setNomeGestor] = useState<string | null>(null);\n  const [nomeFilial, setNomeFilial] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [, setLocation] = useLocation();\n\n  // Verificar autenticação ao carregar\n  useEffect(() => {\n    checkAuth();\n  }, []);\n\n  const checkAuth = async () => {\n    try {\n      const response = await apiRequest('GET', '/api/unidade/me');\n      if (response.ok) {\n        const data = await response.json();\n        setIsAuthenticated(true);\n        setGestorId(data.gestor.id);\n        setFilialId(data.gestor.filialId);\n        setNomeGestor(data.gestor.nome);\n        setNomeFilial(data.filial.nome);\n      } else {\n        setIsAuthenticated(false);\n        clearSession();\n      }\n    } catch (error) {\n      setIsAuthenticated(false);\n      clearSession();\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const login = async (email: string, senha: string): Promise<boolean> => {\n    try {\n      const response = await apiRequest('POST', '/api/unidade/login', { email, senha });\n      const data = await response.json();\n      \n      if (response.ok) {\n        setIsAuthenticated(true);\n        setGestorId(data.gestor.id);\n        setFilialId(data.gestor.filialId);\n        setNomeGestor(data.gestor.nome);\n        setNomeFilial(data.filial.nome);\n        return true;\n      }\n      return false;\n    } catch (error) {\n      return false;\n    }\n  };\n\n  const logout = async () => {\n    try {\n      await apiRequest('POST', '/api/unidade/logout');\n    } catch (error) {\n      // Continue with logout even if request fails\n    }\n    \n    clearSession();\n    setLocation('/portal-unidade');\n  };\n\n  const clearSession = () => {\n    setIsAuthenticated(false);\n    setGestorId(null);\n    setFilialId(null);\n    setNomeGestor(null);\n    setNomeFilial(null);\n  };\n\n  return (\n    <UnidadeContext.Provider value={{\n      isAuthenticated,\n      gestorId,\n      filialId,\n      nomeGestor,\n      nomeFilial,\n      isLoading,\n      login,\n      logout\n    }}>\n      {children}\n    </UnidadeContext.Provider>\n  );\n}\n\nexport function useUnidadeAuth() {\n  const context = useContext(UnidadeContext);\n  if (context === undefined) {\n    throw new Error('useUnidadeAuth must be used within a UnidadeProvider');\n  }\n  return context;\n}","size_bytes":3125},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1))\",\n          \"2\": \"hsl(var(--chart-2))\",\n          \"3\": \"hsl(var(--chart-3))\",\n          \"4\": \"hsl(var(--chart-4))\",\n          \"5\": \"hsl(var(--chart-5))\",\n        },\n        sidebar: {\n          DEFAULT: \"hsl(var(--sidebar-background))\",\n          foreground: \"hsl(var(--sidebar-foreground))\",\n          primary: \"hsl(var(--sidebar-primary))\",\n          \"primary-foreground\": \"hsl(var(--sidebar-primary-foreground))\",\n          accent: \"hsl(var(--sidebar-accent))\",\n          \"accent-foreground\": \"hsl(var(--sidebar-accent-foreground))\",\n          border: \"hsl(var(--sidebar-border))\",\n          ring: \"hsl(var(--sidebar-ring))\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2787},"client/src/pages/Login.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { LogIn, Eye, EyeOff, User } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function Login() {\n  const [email, setEmail] = useState(\"\");\n  const [senha, setSenha] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    try {\n      const response = await apiRequest(\"POST\", \"/api/auth/login\", {\n        email,\n        senha\n      });\n      \n      const data = await response.json();\n      \n      if (response.ok) {\n        toast({\n          title: \"Login realizado com sucesso!\",\n          description: \"Bem-vindo ao sistema de gestão\",\n        });\n        \n        // Redirect to dashboard\n        window.location.href = \"/\";\n      } else {\n        toast({\n          title: \"Erro no login\",\n          description: data.message || \"Email ou senha incorretos\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      toast({\n        title: \"Erro de conexão\",\n        description: \"Não foi possível conectar ao servidor\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md\">\n        <Card className=\"shadow-2xl border-0\">\n          <CardHeader className=\"text-center pb-2\">\n            <div className=\"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <User className=\"w-8 h-8 text-white\" />\n            </div>\n            <CardTitle className=\"text-2xl font-bold text-gray-900\">\n              Sistema de Gestão\n            </CardTitle>\n            <p className=\"text-gray-600 text-sm\">\n              Entre com suas credenciais para acessar o sistema\n            </p>\n          </CardHeader>\n          \n          <CardContent>\n            <form onSubmit={handleLogin} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\" className=\"text-sm font-medium text-gray-700\">\n                  Email\n                </Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  placeholder=\"seu@email.com\"\n                  required\n                  className=\"h-11\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"senha\" className=\"text-sm font-medium text-gray-700\">\n                  Senha\n                </Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"senha\"\n                    type={showPassword ? \"text\" : \"password\"}\n                    value={senha}\n                    onChange={(e) => setSenha(e.target.value)}\n                    placeholder=\"Digite sua senha\"\n                    required\n                    className=\"h-11 pr-10\"\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"absolute right-0 top-0 h-full px-3 hover:bg-transparent\"\n                    onClick={() => setShowPassword(!showPassword)}\n                  >\n                    {showPassword ? (\n                      <EyeOff className=\"h-4 w-4 text-gray-400\" />\n                    ) : (\n                      <Eye className=\"h-4 w-4 text-gray-400\" />\n                    )}\n                  </Button>\n                </div>\n              </div>\n              \n              <Button \n                type=\"submit\" \n                className=\"w-full h-11 bg-blue-600 hover:bg-blue-700 text-white font-medium\"\n                disabled={isLoading}\n              >\n                {isLoading ? (\n                  <div className=\"flex items-center space-x-2\">\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                    <span>Entrando...</span>\n                  </div>\n                ) : (\n                  <>\n                    <LogIn className=\"w-4 h-4 mr-2\" />\n                    Entrar\n                  </>\n                )}\n              </Button>\n            </form>\n            \n            <div className=\"mt-6 pt-6 border-t border-gray-200 text-center\">\n              <div className=\"space-y-2\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setLocation(\"/portal-unidade\")}\n                  className=\"text-blue-600 hover:text-blue-700\"\n                >\n                  Portal das Unidades\n                </Button>\n                <br />\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setLocation(\"/responsavel\")}\n                  className=\"text-blue-600 hover:text-blue-700\"\n                >\n                  Portal dos Responsáveis\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":5815},"client/src/pages/ResponsavelEntrada.tsx":{"content":"import { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Users, UserPlus, LogIn, Shield, Bell, CreditCard, Calendar } from \"lucide-react\";\nimport { InterLogo } from \"@/components/InterLogo\";\n\nexport default function ResponsavelEntrada() {\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-green-100\">\n      {/* Header */}\n      <div className=\"bg-white shadow-sm\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center p-1\">\n                <InterLogo size={32} />\n              </div>\n              <div>\n                <h1 className=\"text-xl font-bold text-gray-900\">Portal dos Responsáveis</h1>\n                <p className=\"text-sm text-gray-600\">Escola de Futebol</p>\n              </div>\n            </div>\n            <Link href=\"/\">\n              <Button variant=\"outline\" size=\"sm\">\n                Site Principal\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n        {/* Hero Section */}\n        <div className=\"text-center mb-12\">\n          <h2 className=\"text-3xl font-bold text-gray-900 mb-4\">\n            Acompanhe o desenvolvimento do seu filho\n          </h2>\n          <p className=\"text-lg text-gray-600 max-w-2xl mx-auto\">\n            Acesse informações sobre pagamentos, eventos, uniformes e muito mais através do nosso portal exclusivo para responsáveis.\n          </p>\n        </div>\n\n        {/* Features Grid */}\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12\">\n          <Card className=\"text-center\">\n            <CardHeader>\n              <CreditCard className=\"w-8 h-8 text-green-600 mx-auto mb-2\" />\n              <CardTitle className=\"text-lg\">Pagamentos</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-gray-600\">\n                Visualize o status dos pagamentos e histórico de mensalidades\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"text-center\">\n            <CardHeader>\n              <Bell className=\"w-8 h-8 text-green-600 mx-auto mb-2\" />\n              <CardTitle className=\"text-lg\">Notificações</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-gray-600\">\n                Receba lembretes de vencimentos e comunicados importantes\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"text-center\">\n            <CardHeader>\n              <Calendar className=\"w-8 h-8 text-green-600 mx-auto mb-2\" />\n              <CardTitle className=\"text-lg\">Eventos</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-gray-600\">\n                Inscreva-se em jogos, campeonatos e atividades especiais\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"text-center\">\n            <CardHeader>\n              <Shield className=\"w-8 h-8 text-green-600 mx-auto mb-2\" />\n              <CardTitle className=\"text-lg\">Uniformes</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-gray-600\">\n                Compre uniformes e equipamentos diretamente pelo portal\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Action Cards */}\n        <div className=\"grid md:grid-cols-2 gap-8 max-w-4xl mx-auto\">\n          {/* Login Card */}\n          <Card className=\"h-full\">\n            <CardHeader className=\"text-center\">\n              <LogIn className=\"w-12 h-12 text-green-600 mx-auto mb-4\" />\n              <CardTitle className=\"text-2xl\">Já tem uma conta?</CardTitle>\n              <CardDescription className=\"text-base\">\n                Faça login para acessar o portal e acompanhar seus filhos\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"text-center\">\n              <Link href=\"/responsavel/login\">\n                <Button size=\"lg\" className=\"w-full bg-green-600 hover:bg-green-700\">\n                  <LogIn className=\"w-5 h-5 mr-2\" />\n                  Fazer Login\n                </Button>\n              </Link>\n              <p className=\"text-sm text-gray-500 mt-4\">\n                Use seu email e senha cadastrados\n              </p>\n            </CardContent>\n          </Card>\n\n          {/* Register Card */}\n          <Card className=\"h-full\">\n            <CardHeader className=\"text-center\">\n              <UserPlus className=\"w-12 h-12 text-blue-600 mx-auto mb-4\" />\n              <CardTitle className=\"text-2xl\">Primeira vez aqui?</CardTitle>\n              <CardDescription className=\"text-base\">\n                Crie sua conta para começar a acompanhar seus filhos\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"text-center\">\n              <Link href=\"/responsavel/cadastro\">\n                <Button size=\"lg\" variant=\"outline\" className=\"w-full border-blue-600 text-blue-600 hover:bg-blue-50\">\n                  <UserPlus className=\"w-5 h-5 mr-2\" />\n                  Criar Conta\n                </Button>\n              </Link>\n              <p className=\"text-sm text-gray-500 mt-4\">\n                Cadastro rápido e gratuito\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Help Section */}\n        <div className=\"text-center mt-12 p-6 bg-white rounded-lg shadow-sm\">\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n            Precisa de ajuda?\n          </h3>\n          <p className=\"text-gray-600 mb-4\">\n            Entre em contato conosco se tiver dúvidas sobre o cadastro ou acesso ao portal.\n          </p>\n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n            <div className=\"text-sm\">\n              <strong>Telefone:</strong> (11) 9999-9999\n            </div>\n            <div className=\"text-sm\">\n              <strong>Email:</strong> contato@escolafutebol.com\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":6536},"client/src/pages/DashboardPortalUnidade.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { \n  Users, \n  GraduationCap, \n  DollarSign, \n  Calendar,\n  LogOut,\n  Settings,\n  FileText,\n  UserCheck,\n  TrendingUp,\n  Building2,\n  Menu,\n  X\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface UnidadeSession {\n  gestorId: number;\n  filialId: number;\n  nomeGestor: string;\n  nomeFilial: string;\n  loginTime: string;\n}\n\nexport default function DashboardPortalUnidade() {\n  const [match, params] = useRoute(\"/unidade/:filialId/dashboard\");\n  const [, setLocation] = useLocation();\n  const [session, setSession] = useState<UnidadeSession | null>(null);\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    const checkAuthentication = async () => {\n      try {\n        // First check localStorage for session data\n        const sessionData = localStorage.getItem('unidadeSession');\n        if (!sessionData) {\n          setLocation(\"/portal-unidade\");\n          return;\n        }\n\n        const parsedSession = JSON.parse(sessionData);\n        \n        // Verify session with server\n        const response = await apiRequest(\"GET\", \"/api/unidade/auth/check\");\n        const authData = await response.json();\n        \n        if (authData.authenticated) {\n          setSession(parsedSession);\n          \n          // Verify filialId matches URL parameter\n          if (params?.filialId && parseInt(params.filialId) !== parsedSession.filialId) {\n            toast({\n              title: \"Acesso negado\",\n              description: \"Você não tem permissão para acessar esta unidade\",\n              variant: \"destructive\",\n            });\n            setLocation(\"/portal-unidade\");\n            return;\n          }\n        } else {\n          // Server session expired, clear localStorage and redirect\n          localStorage.removeItem('unidadeSession');\n          setLocation(\"/portal-unidade\");\n        }\n      } catch (error) {\n        console.error(\"Authentication check failed:\", error);\n        localStorage.removeItem('unidadeSession');\n        setLocation(\"/portal-unidade\");\n      }\n    };\n\n    checkAuthentication();\n  }, [params, setLocation, toast]);\n\n  const { data: metrics, isLoading } = useQuery<{\n    totalAlunos: number;\n    totalProfessores: number;\n    totalTurmas: number;\n    receitaMensal: number;\n  }>({\n    queryKey: [\"/api/unidade/dashboard/metrics\", session?.filialId],\n    enabled: !!session?.filialId,\n  });\n\n  const { data: unidadeInfo } = useQuery({\n    queryKey: [\"/api/filiais\", session?.filialId],\n    enabled: !!session?.filialId,\n  });\n\n  const handleLogout = () => {\n    localStorage.removeItem('unidadeSession');\n    toast({\n      title: \"Logout realizado\",\n      description: \"Sessão encerrada com sucesso\",\n    });\n    setLocation(\"/portal-unidade\");\n  };\n\n  const menuItems = [\n    { \n      label: \"Dashboard\", \n      icon: TrendingUp, \n      path: `/unidade/${session?.filialId}/dashboard`,\n      active: true\n    },\n    { \n      label: \"Alunos\", \n      icon: Users, \n      path: `/unidade/${session?.filialId}/alunos`\n    },\n    { \n      label: \"Professores\", \n      icon: GraduationCap, \n      path: `/unidade/${session?.filialId}/professores`\n    },\n    { \n      label: \"Turmas\", \n      icon: Calendar, \n      path: `/unidade/${session?.filialId}/turmas`\n    },\n    { \n      label: \"Financeiro\", \n      icon: DollarSign, \n      path: `/unidade/${session?.filialId}/financeiro`\n    },\n    { \n      label: \"Presenças\", \n      icon: UserCheck, \n      path: `/unidade/${session?.filialId}/presencas`\n    },\n    { \n      label: \"Relatórios\", \n      icon: FileText, \n      path: `/unidade/${session?.filialId}/relatorios`\n    }\n  ];\n\n  if (!session) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow-sm border-b border-gray-200\">\n        <div className=\"flex items-center justify-between px-4 py-3\">\n          <div className=\"flex items-center space-x-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"lg:hidden\"\n              onClick={() => setSidebarOpen(!sidebarOpen)}\n            >\n              {sidebarOpen ? <X className=\"w-5 h-5\" /> : <Menu className=\"w-5 h-5\" />}\n            </Button>\n            \n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center\">\n                <Building2 className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <h1 className=\"font-semibold text-gray-900\">{session.nomeFilial}</h1>\n                <p className=\"text-sm text-gray-600\">Portal da Unidade</p>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center space-x-3\">\n            <div className=\"text-right hidden sm:block\">\n              <p className=\"text-sm font-medium text-gray-900\">{session.nomeGestor}</p>\n              <p className=\"text-xs text-gray-600\">Gestor da Unidade</p>\n            </div>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={handleLogout}\n              className=\"text-red-600 border-red-200 hover:bg-red-50\"\n            >\n              <LogOut className=\"w-4 h-4 mr-2\" />\n              Sair\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"flex\">\n        {/* Sidebar */}\n        <aside className={`${\n          sidebarOpen ? 'translate-x-0' : '-translate-x-full'\n        } lg:translate-x-0 fixed lg:static inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transition-transform duration-300 ease-in-out lg:shadow-none lg:border-r border-gray-200`}>\n          <div className=\"p-4 border-b border-gray-200 lg:hidden\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"font-semibold text-gray-900\">Menu</span>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setSidebarOpen(false)}\n              >\n                <X className=\"w-5 h-5\" />\n              </Button>\n            </div>\n          </div>\n          \n          <nav className=\"p-4 space-y-2\">\n            {menuItems.map((item) => (\n              <Button\n                key={item.path}\n                variant={item.active ? \"default\" : \"ghost\"}\n                className={`w-full justify-start ${\n                  item.active ? \"bg-blue-600 text-white\" : \"text-gray-700 hover:bg-gray-100\"\n                }`}\n                onClick={() => {\n                  setLocation(item.path);\n                  setSidebarOpen(false);\n                }}\n              >\n                <item.icon className=\"w-4 h-4 mr-3\" />\n                {item.label}\n              </Button>\n            ))}\n          </nav>\n        </aside>\n\n        {/* Main Content */}\n        <main className=\"flex-1 p-6\">\n          <div className=\"mb-6\">\n            <h2 className=\"text-2xl font-bold text-gray-900\">Dashboard da Unidade</h2>\n            <p className=\"text-gray-600\">Visão geral das atividades da {session.nomeFilial}</p>\n          </div>\n\n          {/* Metrics Cards */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium text-gray-600\">\n                  Total de Alunos\n                </CardTitle>\n                <Users className=\"h-4 w-4 text-blue-600\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold text-gray-900\">\n                  {isLoading ? (\n                    <div className=\"animate-pulse bg-gray-200 h-8 w-16 rounded\" />\n                  ) : (\n                    metrics?.totalAlunos || 0\n                  )}\n                </div>\n                <p className=\"text-xs text-gray-600 mt-1\">\n                  +2 novos esta semana\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium text-gray-600\">\n                  Professores\n                </CardTitle>\n                <GraduationCap className=\"h-4 w-4 text-green-600\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold text-gray-900\">\n                  {isLoading ? (\n                    <div className=\"animate-pulse bg-gray-200 h-8 w-16 rounded\" />\n                  ) : (\n                    metrics?.totalProfessores || 0\n                  )}\n                </div>\n                <p className=\"text-xs text-gray-600 mt-1\">\n                  Ativos na unidade\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium text-gray-600\">\n                  Turmas Ativas\n                </CardTitle>\n                <Calendar className=\"h-4 w-4 text-purple-600\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold text-gray-900\">\n                  {isLoading ? (\n                    <div className=\"animate-pulse bg-gray-200 h-8 w-16 rounded\" />\n                  ) : (\n                    metrics?.totalTurmas || 0\n                  )}\n                </div>\n                <p className=\"text-xs text-gray-600 mt-1\">\n                  Em funcionamento\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium text-gray-600\">\n                  Receita Mensal\n                </CardTitle>\n                <DollarSign className=\"h-4 w-4 text-yellow-600\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold text-gray-900\">\n                  {isLoading ? (\n                    <div className=\"animate-pulse bg-gray-200 h-8 w-16 rounded\" />\n                  ) : (\n                    `R$ ${(metrics?.receitaMensal || 0).toLocaleString('pt-BR', {\n                      minimumFractionDigits: 2,\n                      maximumFractionDigits: 2\n                    })}`\n                  )}\n                </div>\n                <p className=\"text-xs text-gray-600 mt-1\">\n                  Mês atual\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Quick Actions */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg font-semibold text-gray-900\">\n                  Ações Rápidas\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <Button\n                  variant=\"outline\"\n                  className=\"w-full justify-start\"\n                  onClick={() => setLocation(`/unidade/${session.filialId}/alunos/novo`)}\n                >\n                  <Users className=\"w-4 h-4 mr-2\" />\n                  Cadastrar Novo Aluno\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  className=\"w-full justify-start\"\n                  onClick={() => setLocation(`/unidade/${session.filialId}/presencas`)}\n                >\n                  <UserCheck className=\"w-4 h-4 mr-2\" />\n                  Registrar Presenças\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  className=\"w-full justify-start\"\n                  onClick={() => setLocation(`/unidade/${session.filialId}/financeiro`)}\n                >\n                  <DollarSign className=\"w-4 h-4 mr-2\" />\n                  Gerenciar Pagamentos\n                </Button>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg font-semibold text-gray-900\">\n                  Status da Sincronização\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-600\">Última sincronização:</span>\n                    <Badge variant=\"outline\" className=\"text-green-600 border-green-200\">\n                      Há 2 minutos\n                    </Badge>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-600\">Status:</span>\n                    <Badge className=\"bg-green-100 text-green-800\">\n                      Sincronizado\n                    </Badge>\n                  </div>\n                  <div className=\"text-xs text-gray-500 mt-2\">\n                    Todos os dados são automaticamente enviados para a matriz em tempo real.\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </main>\n      </div>\n\n      {/* Sidebar Overlay */}\n      {sidebarOpen && (\n        <div\n          className=\"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden\"\n          onClick={() => setSidebarOpen(false)}\n        />\n      )}\n    </div>\n  );\n}","size_bytes":14268},"client/src/pages/DashboardUnidadeWrapper.tsx":{"content":"import { useRoute } from \"wouter\";\nimport DashboardUnidade from \"./DashboardUnidade\";\n\nexport default function DashboardUnidadeWrapper() {\n  const [match, params] = useRoute(\"/unidade/:filialId\");\n  const filialId = parseInt(params?.filialId || \"0\");\n\n  if (!match || !filialId || isNaN(filialId)) {\n    return (\n      <div className=\"text-center py-12\">\n        <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">ID da unidade inválido</h2>\n      </div>\n    );\n  }\n\n  return <DashboardUnidade filialId={filialId} />;\n}","size_bytes":523},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/pages/CadastroGestorUnidadePortal.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Building2, ArrowLeft, UserPlus, Eye, EyeOff } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertGestorUnidadeSchema, type InsertGestorUnidade, type Filial } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\n\nexport default function CadastroGestorUnidadePortal() {\n  const [, setLocation] = useLocation();\n  const [showPassword, setShowPassword] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: filiais, isLoading: filiaisLoading } = useQuery<Filial[]>({\n    queryKey: [\"/api/filiais\"],\n  });\n\n  const form = useForm<InsertGestorUnidade>({\n    resolver: zodResolver(insertGestorUnidadeSchema),\n    defaultValues: {\n      nome: \"\",\n      email: \"\",\n      senha: \"\",\n      telefone: \"\",\n      papel: \"gestor\",\n      ativo: true,\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertGestorUnidade) => {\n      const response = await apiRequest(\"POST\", \"/api/gestores-unidade\", data);\n      if (!response.ok) {\n        throw new Error(\"Erro ao cadastrar gestor\");\n      }\n      return response.json();\n    },\n    onSuccess: (gestor) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/gestores-unidade\"] });\n      toast({\n        title: \"Gestor cadastrado com sucesso!\",\n        description: `${gestor.nome} foi cadastrado e pode acessar o portal da unidade.`,\n      });\n      \n      // Redirecionar para a página de login da unidade\n      setLocation(\"/portal-unidade\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro ao cadastrar gestor\",\n        description: error.message || \"Ocorreu um erro interno\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertGestorUnidade) => {\n    createMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 p-4\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <Button\n          variant=\"ghost\"\n          onClick={() => setLocation(\"/\")}\n          className=\"text-gray-600 hover:text-gray-900 mb-4\"\n        >\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\n          Voltar ao Sistema\n        </Button>\n      </div>\n\n      <div className=\"max-w-2xl mx-auto\">\n        <Card className=\"shadow-xl border-0\">\n          <CardHeader className=\"text-center pb-6\">\n            <div className=\"mx-auto mb-4 w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center\">\n              <Building2 className=\"w-8 h-8 text-white\" />\n            </div>\n            <CardTitle className=\"text-2xl font-bold text-gray-800\">\n              Cadastro de Gestor de Unidade\n            </CardTitle>\n            <p className=\"text-gray-600 mt-2\">\n              Registre um novo gestor para administrar uma unidade específica\n            </p>\n          </CardHeader>\n          \n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                {/* Dados Pessoais */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 border-b pb-2\">\n                    Dados Pessoais\n                  </h3>\n                  \n                  <FormField\n                    control={form.control}\n                    name=\"nome\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Nome Completo</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Nome completo do gestor\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"email\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Email</FormLabel>\n                          <FormControl>\n                            <Input \n                              type=\"email\" \n                              placeholder=\"gestor@unidade.com\" \n                              {...field} \n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"telefone\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Telefone</FormLabel>\n                          <FormControl>\n                            <Input \n                              placeholder=\"(11) 99999-9999\" \n                              {...field} \n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"senha\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Senha</FormLabel>\n                        <FormControl>\n                          <div className=\"relative\">\n                            <Input\n                              type={showPassword ? \"text\" : \"password\"}\n                              placeholder=\"Senha de acesso\"\n                              {...field}\n                              className=\"pr-10\"\n                            />\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              className=\"absolute right-0 top-0 h-full px-3 hover:bg-transparent\"\n                              onClick={() => setShowPassword(!showPassword)}\n                            >\n                              {showPassword ? (\n                                <EyeOff className=\"w-4 h-4 text-gray-400\" />\n                              ) : (\n                                <Eye className=\"w-4 h-4 text-gray-400\" />\n                              )}\n                            </Button>\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                {/* Configurações da Unidade */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 border-b pb-2\">\n                    Configurações da Unidade\n                  </h3>\n\n                  <FormField\n                    control={form.control}\n                    name=\"filialId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Unidade Responsável</FormLabel>\n                        <FormControl>\n                          <Select onValueChange={(value) => field.onChange(parseInt(value))} value={field.value?.toString()}>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Selecione a unidade\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {filiaisLoading ? (\n                                <SelectItem value=\"loading\" disabled>\n                                  Carregando unidades...\n                                </SelectItem>\n                              ) : (\n                                filiais?.map((filial) => (\n                                  <SelectItem key={filial.id} value={filial.id.toString()}>\n                                    {filial.nome}\n                                  </SelectItem>\n                                ))\n                              )}\n                            </SelectContent>\n                          </Select>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"papel\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Papel</FormLabel>\n                        <FormControl>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Selecione o papel\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"gestor\">Gestor</SelectItem>\n                              <SelectItem value=\"supervisor\">Supervisor</SelectItem>\n                              <SelectItem value=\"admin_unidade\">Administrador da Unidade</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                {/* Actions */}\n                <div className=\"flex space-x-4 pt-6\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setLocation(\"/\")}\n                    className=\"flex-1\"\n                  >\n                    Cancelar\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={createMutation.isPending}\n                    className=\"flex-1 bg-blue-600 hover:bg-blue-700\"\n                  >\n                    {createMutation.isPending ? (\n                      <div className=\"flex items-center\">\n                        <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2\" />\n                        Cadastrando...\n                      </div>\n                    ) : (\n                      <>\n                        <UserPlus className=\"w-4 h-4 mr-2\" />\n                        Cadastrar Gestor\n                      </>\n                    )}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n\n        {/* Informações Adicionais */}\n        <div className=\"mt-6 text-center\">\n          <Card className=\"p-4 bg-blue-50 border-blue-200\">\n            <p className=\"text-sm text-blue-800 mb-2 font-medium\">\n              📋 Após o cadastro:\n            </p>\n            <ul className=\"text-sm text-blue-700 space-y-1\">\n              <li>• O gestor poderá acessar o portal da unidade em /portal-unidade</li>\n              <li>• Terá controle total sobre alunos, professores e turmas da unidade</li>\n              <li>• Todos os dados serão sincronizados automaticamente com a matriz</li>\n            </ul>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":12062},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/pages/FinanceiroUnidade.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { ArrowLeft, Plus, Search, DollarSign, TrendingUp, TrendingDown, Calendar } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertPagamentoSchema } from \"@shared/schema\";\nimport type { Pagamento, AlunoWithFilial, Filial } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { useUnidadeAuth } from \"@/contexts/UnidadeContext\";\n\nconst pagamentoFormSchema = insertPagamentoSchema.extend({\n  valor: z.string().min(1, \"Valor é obrigatório\"),\n});\n\ntype PagamentoFormData = z.infer<typeof pagamentoFormSchema>;\n\nexport default function FinanceiroUnidade() {\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filterStatus, setFilterStatus] = useState<string>(\"todos\");\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const { gestorId, filialId, nomeGestor, nomeFilial, logout } = useUnidadeAuth();\n\n  if (!gestorId || !filialId) {\n    setLocation(\"/login-unidade\");\n    return null;\n  }\n\n  const { data: filial } = useQuery<Filial>({\n    queryKey: [`/api/filiais/${filialId}`],\n  });\n\n  const { data: alunos = [] } = useQuery<AlunoWithFilial[]>({\n    queryKey: [`/api/filiais/${filialId}/alunos`],\n  });\n\n  const { data: pagamentos = [], isLoading } = useQuery<Pagamento[]>({\n    queryKey: [\"/api/pagamentos\"],\n  });\n\n  const form = useForm<PagamentoFormData>({\n    resolver: zodResolver(pagamentoFormSchema),\n    defaultValues: {\n      valor: 0,\n      dataVencimento: new Date().toISOString().split('T')[0],\n      dataPagamento: \"\",\n      status: \"pendente\",\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: PagamentoFormData) => {\n      return await apiRequest(\"POST\", \"/api/pagamentos\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/pagamentos\"] });\n      queryClient.invalidateQueries({ queryKey: [`/api/filiais/${filialId}/alunos`] });\n      setDialogOpen(false);\n      form.reset();\n      toast({\n        title: \"Sucesso\",\n        description: \"Pagamento registrado com sucesso!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao registrar pagamento: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Filtrar pagamentos da unidade\n  const pagamentosUnidade = pagamentos.filter(pagamento => {\n    const aluno = alunos.find(a => a.id === pagamento.alunoId);\n    return aluno && aluno.filialId === filialId;\n  });\n\n  const filteredPagamentos = pagamentosUnidade.filter(pagamento => {\n    const aluno = alunos.find(a => a.id === pagamento.alunoId);\n    if (!aluno) return false;\n\n    const matchesSearch = aluno.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         pagamento.descricao?.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    const matchesStatus = filterStatus === \"todos\" || pagamento.status === filterStatus;\n\n    return matchesSearch && matchesStatus;\n  });\n\n  const onSubmit = (data: PagamentoFormData) => {\n    createMutation.mutate(data);\n  };\n\n  // Calcular métricas financeiras\n  const totalReceita = pagamentosUnidade\n    .filter(p => p.status === \"pago\")\n    .reduce((sum, p) => sum + p.valor, 0);\n\n  const totalPendente = pagamentosUnidade\n    .filter(p => p.status === \"pendente\")\n    .reduce((sum, p) => sum + p.valor, 0);\n\n  const totalAtrasado = pagamentosUnidade\n    .filter(p => p.status === \"atrasado\")\n    .reduce((sum, p) => sum + p.valor, 0);\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"pago\":\n        return <Badge variant=\"default\" className=\"bg-green-500\">Pago</Badge>;\n      case \"pendente\":\n        return <Badge variant=\"secondary\">Pendente</Badge>;\n      case \"atrasado\":\n        return <Badge variant=\"destructive\">Atrasado</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setLocation(\"/sistema-unidade\")}\n            className=\"flex items-center gap-2\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n            Voltar ao Painel\n          </Button>\n          <div>\n            <h1 className=\"text-3xl font-bold\">Gestão Financeira</h1>\n            <p className=\"text-muted-foreground\">\n              {filial?.nome} - Controle de pagamentos e receitas\n            </p>\n          </div>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button className=\"flex items-center gap-2\">\n              <Plus className=\"w-4 h-4\" />\n              Registrar Pagamento\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-md\">\n            <DialogHeader>\n              <DialogTitle>Registrar Pagamento</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"alunoId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Aluno</FormLabel>\n                      <Select onValueChange={(value) => field.onChange(parseInt(value))} value={field.value?.toString()}>\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Selecione o aluno\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {alunos.map((aluno) => (\n                            <SelectItem key={aluno.id} value={aluno.id.toString()}>\n                              {aluno.nome}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"valor\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Valor (R$)</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          placeholder=\"0,00\"\n                          {...field}\n                          onChange={(e) => field.onChange(parseFloat(e.target.value) || 0)}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"descricao\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Descrição</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Mensalidade Janeiro 2024\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"dataVencimento\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Data de Vencimento</FormLabel>\n                      <FormControl>\n                        <Input type=\"date\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"status\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Status</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"pendente\">Pendente</SelectItem>\n                          <SelectItem value=\"pago\">Pago</SelectItem>\n                          <SelectItem value=\"atrasado\">Atrasado</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex gap-2 pt-4\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setDialogOpen(false)}\n                    className=\"flex-1\"\n                  >\n                    Cancelar\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={createMutation.isPending}\n                    className=\"flex-1\"\n                  >\n                    {createMutation.isPending ? \"Salvando...\" : \"Salvar\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Métricas */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Receita Total</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-green-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              R$ {totalReceita.toFixed(2)}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Pagamentos recebidos\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Valores Pendentes</CardTitle>\n            <DollarSign className=\"h-4 w-4 text-yellow-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-yellow-600\">\n              R$ {totalPendente.toFixed(2)}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Aguardando pagamento\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Valores em Atraso</CardTitle>\n            <TrendingDown className=\"h-4 w-4 text-red-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-600\">\n              R$ {totalAtrasado.toFixed(2)}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Pagamentos atrasados\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filtros */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4\" />\n          <Input\n            placeholder=\"Buscar por aluno ou descrição...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n        <Select value={filterStatus} onValueChange={setFilterStatus}>\n          <SelectTrigger className=\"w-40\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"todos\">Todos</SelectItem>\n            <SelectItem value=\"pago\">Pago</SelectItem>\n            <SelectItem value=\"pendente\">Pendente</SelectItem>\n            <SelectItem value=\"atrasado\">Atrasado</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      {/* Lista de Pagamentos */}\n      {isLoading ? (\n        <div className=\"space-y-4\">\n          {[...Array(5)].map((_, i) => (\n            <Card key={i} className=\"animate-pulse\">\n              <CardContent className=\"p-4\">\n                <div className=\"space-y-2\">\n                  <div className=\"h-4 bg-muted rounded w-1/4\"></div>\n                  <div className=\"h-3 bg-muted rounded w-1/2\"></div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : filteredPagamentos.length === 0 ? (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <DollarSign className=\"w-12 h-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">\n              {searchTerm ? \"Nenhum pagamento encontrado\" : \"Nenhum pagamento registrado\"}\n            </h3>\n            <p className=\"text-muted-foreground text-center mb-6\">\n              {searchTerm \n                ? \"Tente ajustar os termos de busca\" \n                : \"Comece registrando o primeiro pagamento da unidade\"\n              }\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"space-y-4\">\n          {filteredPagamentos.map((pagamento) => {\n            const aluno = alunos.find(a => a.id === pagamento.alunoId);\n            return (\n              <Card key={pagamento.id}>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-3 mb-2\">\n                        <h3 className=\"font-semibold\">{aluno?.nome}</h3>\n                        {getStatusBadge(pagamento.status)}\n                      </div>\n                      <p className=\"text-sm text-muted-foreground\">{pagamento.descricao}</p>\n                      <div className=\"flex items-center gap-4 mt-2 text-sm text-muted-foreground\">\n                        <div className=\"flex items-center gap-1\">\n                          <Calendar className=\"w-4 h-4\" />\n                          Vencimento: {new Date(pagamento.dataVencimento).toLocaleDateString('pt-BR')}\n                        </div>\n                        {pagamento.dataPagamento && (\n                          <div className=\"flex items-center gap-1\">\n                            <Calendar className=\"w-4 h-4\" />\n                            Pagamento: {new Date(pagamento.dataPagamento).toLocaleDateString('pt-BR')}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"text-2xl font-bold\">\n                        R$ {pagamento.valor.toFixed(2)}\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":16377},"client/src/pages/Relatorios.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  FileText, \n  Download, \n  TrendingUp, \n  Users, \n  DollarSign, \n  Calendar,\n  SquareUser,\n  Target,\n  BarChart3,\n  PieChart\n} from \"lucide-react\";\nimport { format, subMonths, startOfMonth, endOfMonth } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport type { Aluno, Professor, Turma, Pagamento } from \"@shared/schema\";\n\nexport default function Relatorios() {\n  const [selectedPeriod, setSelectedPeriod] = useState(\"current-month\");\n  const [selectedReport, setSelectedReport] = useState(\"general\");\n\n  const { data: alunos, isLoading: loadingAlunos } = useQuery<Aluno[]>({\n    queryKey: [\"/api/alunos\"],\n  });\n\n  const { data: professores, isLoading: loadingProfessores } = useQuery<Professor[]>({\n    queryKey: [\"/api/professores\"],\n  });\n\n  const { data: turmas, isLoading: loadingTurmas } = useQuery<Turma[]>({\n    queryKey: [\"/api/turmas\"],\n  });\n\n  const { data: pagamentos, isLoading: loadingPagamentos } = useQuery<Pagamento[]>({\n    queryKey: [\"/api/pagamentos\"],\n  });\n\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(value);\n  };\n\n  const calculateAge = (birthDate: string | null) => {\n    if (!birthDate) return 0;\n    const today = new Date();\n    const birth = new Date(birthDate);\n    const age = today.getFullYear() - birth.getFullYear();\n    const monthDiff = today.getMonth() - birth.getMonth();\n    \n    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\n      return age - 1;\n    }\n    return age;\n  };\n\n  const getFilteredData = () => {\n    const now = new Date();\n    let startDate: Date;\n    let endDate: Date;\n\n    switch (selectedPeriod) {\n      case \"current-month\":\n        startDate = startOfMonth(now);\n        endDate = endOfMonth(now);\n        break;\n      case \"last-month\":\n        const lastMonth = subMonths(now, 1);\n        startDate = startOfMonth(lastMonth);\n        endDate = endOfMonth(lastMonth);\n        break;\n      case \"last-3-months\":\n        startDate = startOfMonth(subMonths(now, 2));\n        endDate = endOfMonth(now);\n        break;\n      case \"last-6-months\":\n        startDate = startOfMonth(subMonths(now, 5));\n        endDate = endOfMonth(now);\n        break;\n      default:\n        startDate = startOfMonth(now);\n        endDate = endOfMonth(now);\n    }\n\n    const filteredPagamentos = pagamentos?.filter(p => {\n      const paymentDate = new Date(p.dataPagamento);\n      return paymentDate >= startDate && paymentDate <= endDate;\n    }) || [];\n\n    return { filteredPagamentos, startDate, endDate };\n  };\n\n  const generateGeneralReport = () => {\n    const { filteredPagamentos } = getFilteredData();\n    \n    const totalAlunos = alunos?.filter(a => a.ativo).length || 0;\n    const totalProfessores = professores?.filter(p => p.ativo).length || 0;\n    const totalTurmas = turmas?.filter(t => t.ativo).length || 0;\n    \n    const totalReceita = filteredPagamentos.reduce((sum, p) => sum + Number(p.valor), 0);\n    const totalPagamentos = filteredPagamentos.length;\n    const ticketMedio = totalPagamentos > 0 ? totalReceita / totalPagamentos : 0;\n\n    // Age distribution\n    const ageGroups = {\n      \"5-10\": 0,\n      \"11-15\": 0,\n      \"16-20\": 0,\n      \"21+\": 0,\n    };\n\n    alunos?.forEach(aluno => {\n      const age = calculateAge(aluno.dataNascimento);\n      if (age >= 5 && age <= 10) ageGroups[\"5-10\"]++;\n      else if (age >= 11 && age <= 15) ageGroups[\"11-15\"]++;\n      else if (age >= 16 && age <= 20) ageGroups[\"16-20\"]++;\n      else if (age >= 21) ageGroups[\"21+\"]++;\n    });\n\n    // Payment methods distribution\n    const paymentMethods: Record<string, number> = {};\n    filteredPagamentos.forEach(p => {\n      paymentMethods[p.formaPagamento] = (paymentMethods[p.formaPagamento] || 0) + 1;\n    });\n\n    return {\n      overview: {\n        totalAlunos,\n        totalProfessores,\n        totalTurmas,\n        totalReceita,\n        totalPagamentos,\n        ticketMedio,\n      },\n      ageGroups,\n      paymentMethods,\n    };\n  };\n\n  const generateFinancialReport = () => {\n    const { filteredPagamentos } = getFilteredData();\n    \n    const monthlyRevenue: Record<string, number> = {};\n    const dailyRevenue: Record<string, number> = {};\n\n    filteredPagamentos.forEach(p => {\n      const month = p.mesReferencia;\n      const day = format(new Date(p.dataPagamento), \"yyyy-MM-dd\");\n      \n      monthlyRevenue[month] = (monthlyRevenue[month] || 0) + Number(p.valor);\n      dailyRevenue[day] = (dailyRevenue[day] || 0) + Number(p.valor);\n    });\n\n    return {\n      monthlyRevenue,\n      dailyRevenue,\n      totalRevenue: Object.values(monthlyRevenue).reduce((sum, val) => sum + val, 0),\n    };\n  };\n\n  const handleExportReport = () => {\n    const reportData = selectedReport === \"financial\" ? generateFinancialReport() : generateGeneralReport();\n    \n    // Create CSV content\n    let csvContent = \"data:text/csv;charset=utf-8,\";\n    \n    if (selectedReport === \"general\") {\n      const data = reportData as ReturnType<typeof generateGeneralReport>;\n      csvContent += \"Relatório Geral\\n\\n\";\n      csvContent += \"Métrica,Valor\\n\";\n      csvContent += `Total de Alunos,${data.overview.totalAlunos}\\n`;\n      csvContent += `Total de Professores,${data.overview.totalProfessores}\\n`;\n      csvContent += `Total de Turmas,${data.overview.totalTurmas}\\n`;\n      csvContent += `Receita Total,${formatCurrency(data.overview.totalReceita)}\\n`;\n      csvContent += `Total de Pagamentos,${data.overview.totalPagamentos}\\n`;\n      csvContent += `Ticket Médio,${formatCurrency(data.overview.ticketMedio)}\\n\\n`;\n      \n      csvContent += \"Distribuição por Idade\\n\";\n      csvContent += \"Faixa Etária,Quantidade\\n\";\n      Object.entries(data.ageGroups).forEach(([age, count]) => {\n        csvContent += `${age} anos,${count}\\n`;\n      });\n    } else {\n      const data = reportData as ReturnType<typeof generateFinancialReport>;\n      csvContent += \"Relatório Financeiro\\n\\n\";\n      csvContent += \"Mês,Receita\\n\";\n      Object.entries(data.monthlyRevenue).forEach(([month, revenue]) => {\n        csvContent += `${month},${formatCurrency(revenue)}\\n`;\n      });\n    }\n    \n    const encodedUri = encodeURI(csvContent);\n    const link = document.createElement(\"a\");\n    link.setAttribute(\"href\", encodedUri);\n    link.setAttribute(\"download\", `relatorio-${selectedReport}-${format(new Date(), \"yyyy-MM-dd\")}.csv`);\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  const isLoading = loadingAlunos || loadingProfessores || loadingTurmas || loadingPagamentos;\n\n  const generalReport = generateGeneralReport();\n  const financialReport = generateFinancialReport();\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-3xl font-bold text-neutral-800\">Relatórios e Análises</h2>\n          <p className=\"text-neutral-600\">Analise o desempenho e métricas da escola</p>\n        </div>\n        <Button onClick={handleExportReport} className=\"bg-primary hover:bg-primary/90\">\n          <Download className=\"w-4 h-4 mr-2\" />\n          Exportar Relatório\n        </Button>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center space-x-4\">\n            <div className=\"flex-1 max-w-xs\">\n              <label className=\"text-sm font-medium mb-2 block\">Tipo de Relatório</label>\n              <Select value={selectedReport} onValueChange={setSelectedReport}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Selecione o tipo\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"general\">Relatório Geral</SelectItem>\n                  <SelectItem value=\"financial\">Relatório Financeiro</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"flex-1 max-w-xs\">\n              <label className=\"text-sm font-medium mb-2 block\">Período</label>\n              <Select value={selectedPeriod} onValueChange={setSelectedPeriod}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Selecione o período\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"current-month\">Mês Atual</SelectItem>\n                  <SelectItem value=\"last-month\">Mês Passado</SelectItem>\n                  <SelectItem value=\"last-3-months\">Últimos 3 Meses</SelectItem>\n                  <SelectItem value=\"last-6-months\">Últimos 6 Meses</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {[...Array(4)].map((_, i) => (\n            <Card key={i}>\n              <CardContent className=\"p-6\">\n                <Skeleton className=\"h-4 w-24 mb-2\" />\n                <Skeleton className=\"h-8 w-16 mb-4\" />\n                <Skeleton className=\"h-4 w-32\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <>\n          {selectedReport === \"general\" && (\n            <>\n              {/* Overview Cards */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                <Card>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-neutral-600\">Total de Alunos</p>\n                        <p className=\"text-2xl font-bold text-neutral-800\">\n                          {generalReport.overview.totalAlunos}\n                        </p>\n                      </div>\n                      <div className=\"w-12 h-12 bg-blue-500/10 rounded-lg flex items-center justify-center\">\n                        <Users className=\"w-6 h-6 text-blue-500\" />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-neutral-600\">Total de Professores</p>\n                        <p className=\"text-2xl font-bold text-neutral-800\">\n                          {generalReport.overview.totalProfessores}\n                        </p>\n                      </div>\n                      <div className=\"w-12 h-12 bg-green-500/10 rounded-lg flex items-center justify-center\">\n                        <SquareUser className=\"w-6 h-6 text-green-500\" />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-neutral-600\">Total de Turmas</p>\n                        <p className=\"text-2xl font-bold text-neutral-800\">\n                          {generalReport.overview.totalTurmas}\n                        </p>\n                      </div>\n                      <div className=\"w-12 h-12 bg-purple-500/10 rounded-lg flex items-center justify-center\">\n                        <Target className=\"w-6 h-6 text-purple-500\" />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Age Distribution */}\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center\">\n                      <PieChart className=\"w-5 h-5 mr-2\" />\n                      Distribuição por Idade\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-4\">\n                      {Object.entries(generalReport.ageGroups).map(([age, count]) => (\n                        <div key={age} className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"w-3 h-3 bg-primary rounded-full\"></div>\n                            <span className=\"font-medium\">{age} anos</span>\n                          </div>\n                          <Badge variant=\"secondary\">{count} alunos</Badge>\n                        </div>\n                      ))}\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center\">\n                      <BarChart3 className=\"w-5 h-5 mr-2\" />\n                      Formas de Pagamento\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-4\">\n                      {Object.entries(generalReport.paymentMethods).map(([method, count]) => (\n                        <div key={method} className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"w-3 h-3 bg-accent rounded-full\"></div>\n                            <span className=\"font-medium\">{method}</span>\n                          </div>\n                          <Badge variant=\"secondary\">{count} pagamentos</Badge>\n                        </div>\n                      ))}\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            </>\n          )}\n\n          {selectedReport === \"financial\" && (\n            <>\n              {/* Financial Overview */}\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                <Card>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-neutral-600\">Receita Total</p>\n                        <p className=\"text-2xl font-bold text-neutral-800\">\n                          {formatCurrency(financialReport.totalRevenue)}\n                        </p>\n                      </div>\n                      <div className=\"w-12 h-12 bg-green-500/10 rounded-lg flex items-center justify-center\">\n                        <DollarSign className=\"w-6 h-6 text-green-500\" />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-neutral-600\">Total de Pagamentos</p>\n                        <p className=\"text-2xl font-bold text-neutral-800\">\n                          {generalReport.overview.totalPagamentos}\n                        </p>\n                      </div>\n                      <div className=\"w-12 h-12 bg-blue-500/10 rounded-lg flex items-center justify-center\">\n                        <FileText className=\"w-6 h-6 text-blue-500\" />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-neutral-600\">Ticket Médio</p>\n                        <p className=\"text-2xl font-bold text-neutral-800\">\n                          {formatCurrency(generalReport.overview.ticketMedio)}\n                        </p>\n                      </div>\n                      <div className=\"w-12 h-12 bg-purple-500/10 rounded-lg flex items-center justify-center\">\n                        <TrendingUp className=\"w-6 h-6 text-purple-500\" />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Monthly Revenue */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center\">\n                    <BarChart3 className=\"w-5 h-5 mr-2\" />\n                    Receita por Mês\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    {Object.entries(financialReport.monthlyRevenue).map(([month, revenue]) => (\n                      <div key={month} className=\"flex items-center justify-between p-3 bg-neutral-50 rounded-lg\">\n                        <div className=\"flex items-center space-x-3\">\n                          <Calendar className=\"w-4 h-4 text-neutral-400\" />\n                          <span className=\"font-medium\">\n                            {format(new Date(month + \"-01\"), \"MMMM yyyy\", { locale: ptBR })}\n                          </span>\n                        </div>\n                        <span className=\"font-bold text-green-600\">\n                          {formatCurrency(revenue)}\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            </>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n","size_bytes":18228},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated } from \"./replitAuth\";\nimport {\n  insertAlunoSchema,\n  insertProfessorSchema,\n  insertTurmaSchema,\n  insertMatriculaSchema,\n  insertPagamentoSchema,\n  insertFilialSchema,\n} from \"@shared/schema\";\nimport { z } from \"zod\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Auth middleware\n  await setupAuth(app);\n\n  // Auth routes\n  app.get(\"/api/auth/user\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // Dashboard routes\n  app.get(\"/api/dashboard/metrics\", isAuthenticated, async (req, res) => {\n    try {\n      const metrics = await storage.getDashboardMetrics();\n      res.json(metrics);\n    } catch (error) {\n      console.error(\"Error fetching dashboard metrics:\", error);\n      res.status(500).json({ message: \"Failed to fetch dashboard metrics\" });\n    }\n  });\n\n  // Alunos routes\n  app.get(\"/api/alunos\", isAuthenticated, async (req, res) => {\n    try {\n      const alunos = await storage.getAlunos();\n      res.json(alunos);\n    } catch (error) {\n      console.error(\"Error fetching alunos:\", error);\n      res.status(500).json({ message: \"Failed to fetch alunos\" });\n    }\n  });\n\n  app.get(\"/api/alunos/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const aluno = await storage.getAluno(id);\n      if (!aluno) {\n        return res.status(404).json({ message: \"Aluno not found\" });\n      }\n      res.json(aluno);\n    } catch (error) {\n      console.error(\"Error fetching aluno:\", error);\n      res.status(500).json({ message: \"Failed to fetch aluno\" });\n    }\n  });\n\n  app.post(\"/api/alunos\", isAuthenticated, async (req, res) => {\n    try {\n      const validatedData = insertAlunoSchema.parse(req.body);\n      const aluno = await storage.createAluno(validatedData);\n      res.status(201).json(aluno);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating aluno:\", error);\n      res.status(500).json({ message: \"Failed to create aluno\" });\n    }\n  });\n\n  app.put(\"/api/alunos/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertAlunoSchema.partial().parse(req.body);\n      const aluno = await storage.updateAluno(id, validatedData);\n      res.json(aluno);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating aluno:\", error);\n      res.status(500).json({ message: \"Failed to update aluno\" });\n    }\n  });\n\n  app.delete(\"/api/alunos/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteAluno(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting aluno:\", error);\n      res.status(500).json({ message: \"Failed to delete aluno\" });\n    }\n  });\n\n  // Professores routes\n  app.get(\"/api/professores\", isAuthenticated, async (req, res) => {\n    try {\n      const professores = await storage.getProfessores();\n      res.json(professores);\n    } catch (error) {\n      console.error(\"Error fetching professores:\", error);\n      res.status(500).json({ message: \"Failed to fetch professores\" });\n    }\n  });\n\n  app.get(\"/api/professores/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const professor = await storage.getProfessor(id);\n      if (!professor) {\n        return res.status(404).json({ message: \"Professor not found\" });\n      }\n      res.json(professor);\n    } catch (error) {\n      console.error(\"Error fetching professor:\", error);\n      res.status(500).json({ message: \"Failed to fetch professor\" });\n    }\n  });\n\n  app.post(\"/api/professores\", isAuthenticated, async (req, res) => {\n    try {\n      const validatedData = insertProfessorSchema.parse(req.body);\n      const professor = await storage.createProfessor(validatedData);\n      res.status(201).json(professor);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating professor:\", error);\n      res.status(500).json({ message: \"Failed to create professor\" });\n    }\n  });\n\n  app.put(\"/api/professores/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertProfessorSchema.partial().parse(req.body);\n      const professor = await storage.updateProfessor(id, validatedData);\n      res.json(professor);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating professor:\", error);\n      res.status(500).json({ message: \"Failed to update professor\" });\n    }\n  });\n\n  app.delete(\"/api/professores/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteProfessor(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting professor:\", error);\n      res.status(500).json({ message: \"Failed to delete professor\" });\n    }\n  });\n\n  // Turmas routes\n  app.get(\"/api/turmas\", isAuthenticated, async (req, res) => {\n    try {\n      const turmas = await storage.getTurmas();\n      res.json(turmas);\n    } catch (error) {\n      console.error(\"Error fetching turmas:\", error);\n      res.status(500).json({ message: \"Failed to fetch turmas\" });\n    }\n  });\n\n  app.get(\"/api/turmas/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const turma = await storage.getTurma(id);\n      if (!turma) {\n        return res.status(404).json({ message: \"Turma not found\" });\n      }\n      res.json(turma);\n    } catch (error) {\n      console.error(\"Error fetching turma:\", error);\n      res.status(500).json({ message: \"Failed to fetch turma\" });\n    }\n  });\n\n  app.post(\"/api/turmas\", isAuthenticated, async (req, res) => {\n    try {\n      const validatedData = insertTurmaSchema.parse(req.body);\n      const turma = await storage.createTurma(validatedData);\n      res.status(201).json(turma);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating turma:\", error);\n      res.status(500).json({ message: \"Failed to create turma\" });\n    }\n  });\n\n  app.put(\"/api/turmas/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertTurmaSchema.partial().parse(req.body);\n      const turma = await storage.updateTurma(id, validatedData);\n      res.json(turma);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating turma:\", error);\n      res.status(500).json({ message: \"Failed to update turma\" });\n    }\n  });\n\n  app.delete(\"/api/turmas/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteTurma(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting turma:\", error);\n      res.status(500).json({ message: \"Failed to delete turma\" });\n    }\n  });\n\n  // Matriculas routes\n  app.get(\"/api/matriculas\", isAuthenticated, async (req, res) => {\n    try {\n      const matriculas = await storage.getMatriculas();\n      res.json(matriculas);\n    } catch (error) {\n      console.error(\"Error fetching matriculas:\", error);\n      res.status(500).json({ message: \"Failed to fetch matriculas\" });\n    }\n  });\n\n  app.post(\"/api/matriculas\", isAuthenticated, async (req, res) => {\n    try {\n      const validatedData = insertMatriculaSchema.parse(req.body);\n      const matricula = await storage.createMatricula(validatedData);\n      res.status(201).json(matricula);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating matricula:\", error);\n      res.status(500).json({ message: \"Failed to create matricula\" });\n    }\n  });\n\n  app.delete(\"/api/matriculas/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteMatricula(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting matricula:\", error);\n      res.status(500).json({ message: \"Failed to delete matricula\" });\n    }\n  });\n\n  // Pagamentos routes\n  app.get(\"/api/pagamentos\", isAuthenticated, async (req, res) => {\n    try {\n      const pagamentos = await storage.getPagamentos();\n      res.json(pagamentos);\n    } catch (error) {\n      console.error(\"Error fetching pagamentos:\", error);\n      res.status(500).json({ message: \"Failed to fetch pagamentos\" });\n    }\n  });\n\n  app.get(\"/api/pagamentos/aluno/:alunoId\", isAuthenticated, async (req, res) => {\n    try {\n      const alunoId = parseInt(req.params.alunoId);\n      const pagamentos = await storage.getPagamentosByAluno(alunoId);\n      res.json(pagamentos);\n    } catch (error) {\n      console.error(\"Error fetching pagamentos by aluno:\", error);\n      res.status(500).json({ message: \"Failed to fetch pagamentos by aluno\" });\n    }\n  });\n\n  app.post(\"/api/pagamentos\", isAuthenticated, async (req, res) => {\n    try {\n      const validatedData = insertPagamentoSchema.parse(req.body);\n      const pagamento = await storage.createPagamento(validatedData);\n      res.status(201).json(pagamento);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating pagamento:\", error);\n      res.status(500).json({ message: \"Failed to create pagamento\" });\n    }\n  });\n\n  app.delete(\"/api/pagamentos/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deletePagamento(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting pagamento:\", error);\n      res.status(500).json({ message: \"Failed to delete pagamento\" });\n    }\n  });\n\n  // Filiais routes\n  app.get(\"/api/filiais\", isAuthenticated, async (req, res) => {\n    try {\n      const filiais = await storage.getFiliais();\n      res.json(filiais);\n    } catch (error) {\n      console.error(\"Error fetching filiais:\", error);\n      res.status(500).json({ message: \"Failed to fetch filiais\" });\n    }\n  });\n\n  app.get(\"/api/filiais/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const filial = await storage.getFilial(id);\n      if (!filial) {\n        return res.status(404).json({ message: \"Filial not found\" });\n      }\n      res.json(filial);\n    } catch (error) {\n      console.error(\"Error fetching filial:\", error);\n      res.status(500).json({ message: \"Failed to fetch filial\" });\n    }\n  });\n\n  app.post(\"/api/filiais\", isAuthenticated, async (req, res) => {\n    try {\n      const validatedData = insertFilialSchema.parse(req.body);\n      const filial = await storage.createFilial(validatedData);\n      res.status(201).json(filial);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating filial:\", error);\n      res.status(500).json({ message: \"Failed to create filial\" });\n    }\n  });\n\n  app.put(\"/api/filiais/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertFilialSchema.partial().parse(req.body);\n      const filial = await storage.updateFilial(id, validatedData);\n      res.json(filial);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating filial:\", error);\n      res.status(500).json({ message: \"Failed to update filial\" });\n    }\n  });\n\n  app.delete(\"/api/filiais/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteFilial(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting filial:\", error);\n      res.status(500).json({ message: \"Failed to delete filial\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":13265},"client/src/pages/ResponsavelCadastro.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertResponsavelSchema } from \"@shared/schema\";\nimport { UserPlus, LogIn, Users } from \"lucide-react\";\nimport { InterLogo } from \"@/components/InterLogo\";\n\nconst cadastroSchema = insertResponsavelSchema.extend({\n  confirmarSenha: z.string().min(6, \"Confirmação de senha deve ter pelo menos 6 caracteres\"),\n}).refine((data) => data.senha === data.confirmarSenha, {\n  message: \"Senhas não coincidem\",\n  path: [\"confirmarSenha\"],\n});\n\ntype CadastroFormData = z.infer<typeof cadastroSchema>;\n\nexport default function ResponsavelCadastro() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const form = useForm<CadastroFormData>({\n    resolver: zodResolver(cadastroSchema),\n    defaultValues: {\n      nome: \"\",\n      email: \"\",\n      telefone: \"\",\n      senha: \"\",\n      confirmarSenha: \"\",\n    },\n  });\n\n  const cadastroMutation = useMutation({\n    mutationFn: async (data: Omit<CadastroFormData, \"confirmarSenha\">) => {\n      return await apiRequest(\"POST\", \"/api/responsaveis/cadastro\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Cadastro realizado com sucesso!\",\n        description: \"Você pode fazer login agora.\",\n      });\n      setLocation(\"/responsavel/login\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro no cadastro\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: CadastroFormData) => {\n    const { confirmarSenha, ...dadosCadastro } = data;\n    cadastroMutation.mutate(dadosCadastro);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-green-100 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md space-y-6\">\n        {/* Logo/Header */}\n        <div className=\"text-center\">\n          <div className=\"mx-auto w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mb-4 p-2\">\n            <InterLogo size={48} />\n          </div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">Portal dos Responsáveis</h1>\n          <p className=\"text-gray-600 mt-2\">Cadastre-se para acompanhar seus filhos</p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <UserPlus className=\"w-5 h-5\" />\n              Criar Conta\n            </CardTitle>\n            <CardDescription>\n              Preencha seus dados para criar uma conta\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"nome\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Nome Completo</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Seu nome completo\"\n                          {...field}\n                          value={field.value || \"\"}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"email\"\n                          placeholder=\"seu@email.com\"\n                          {...field}\n                          value={field.value || \"\"}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"telefone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Telefone</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"(11) 99999-9999\"\n                          {...field}\n                          value={field.value || \"\"}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"senha\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Senha</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"password\"\n                          placeholder=\"Mínimo 6 caracteres\"\n                          {...field}\n                          value={field.value || \"\"}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"confirmarSenha\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Confirmar Senha</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"password\"\n                          placeholder=\"Digite a senha novamente\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <Button \n                  type=\"submit\" \n                  className=\"w-full\"\n                  disabled={cadastroMutation.isPending}\n                >\n                  {cadastroMutation.isPending ? \"Cadastrando...\" : \"Criar Conta\"}\n                </Button>\n              </form>\n            </Form>\n\n            <div className=\"mt-6 text-center\">\n              <p className=\"text-sm text-gray-600\">\n                Já tem uma conta?{\" \"}\n                <Link href=\"/responsavel/login\" className=\"text-green-600 hover:text-green-700 font-medium\">\n                  Fazer Login\n                </Link>\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <div className=\"text-center\">\n          <Link href=\"/\" className=\"text-sm text-gray-500 hover:text-gray-700\">\n            ← Voltar para o site principal\n          </Link>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":7391},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/forms/AlunoFormResponsavel.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { AlunoWithFilial, InsertAluno, Filial } from \"@shared/schema\";\nimport { Camera, ImageIcon, Loader2 } from \"lucide-react\";\n\ninterface AlunoFormResponsavelProps {\n  aluno: AlunoWithFilial | null;\n  onSuccess: () => void;\n  filiais: Filial[];\n  responsavelId?: number;\n  createMutation: any;\n  updateMutation: any;\n}\n\nexport default function AlunoFormResponsavel({ \n  aluno, \n  onSuccess, \n  filiais, \n  responsavelId,\n  createMutation,\n  updateMutation \n}: AlunoFormResponsavelProps) {\n  const [formData, setFormData] = useState({\n    nome: aluno?.nome || '',\n    cpf: aluno?.cpf || '',\n    email: aluno?.email || '',\n    telefone: aluno?.telefone || '',\n    endereco: aluno?.endereco || '',\n    bairro: aluno?.bairro || '',\n    cep: aluno?.cep || '',\n    cidade: aluno?.cidade || '',\n    estado: aluno?.estado || '',\n    dataNascimento: aluno?.dataNascimento || '',\n    fotoUrl: aluno?.fotoUrl || '',\n    filialId: aluno?.filialId || '',\n    responsavelId: responsavelId || aluno?.responsavelId,\n    ativo: aluno?.ativo ?? true,\n    dataMatricula: aluno?.dataMatricula || new Date().toISOString().split('T')[0]\n  });\n\n  const [isCapturing, setIsCapturing] = useState(false);\n  const [stream, setStream] = useState<MediaStream | null>(null);\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n\n  // Função para formatar CPF\n  const formatCPF = (value: string) => {\n    const numbers = value.replace(/\\D/g, '');\n    return numbers.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, '$1.$2.$3-$4');\n  };\n\n  // Função para iniciar captura de foto\n  const startCapture = async () => {\n    try {\n      const mediaStream = await navigator.mediaDevices.getUserMedia({ video: true });\n      setStream(mediaStream);\n      setIsCapturing(true);\n      if (videoRef.current) {\n        videoRef.current.srcObject = mediaStream;\n      }\n    } catch (error) {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível acessar a câmera.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Função para capturar foto\n  const capturePhoto = () => {\n    if (videoRef.current && canvasRef.current) {\n      const canvas = canvasRef.current;\n      const video = videoRef.current;\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      const ctx = canvas.getContext('2d');\n      ctx?.drawImage(video, 0, 0);\n      const dataURL = canvas.toDataURL('image/jpeg', 0.8);\n      setFormData(prev => ({ ...prev, fotoUrl: dataURL }));\n      stopCapture();\n      toast({\n        title: \"Sucesso\",\n        description: \"Foto capturada com sucesso!\",\n      });\n    }\n  };\n\n  // Função para parar captura\n  const stopCapture = () => {\n    if (stream) {\n      stream.getTracks().forEach(track => track.stop());\n      setStream(null);\n    }\n    setIsCapturing(false);\n  };\n\n  // Função para processar arquivo de imagem\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      if (!file.type.startsWith('image/')) {\n        toast({\n          title: \"Erro\",\n          description: \"Por favor, selecione apenas arquivos de imagem.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      if (file.size > 5 * 1024 * 1024) {\n        toast({\n          title: \"Erro\",\n          description: \"A imagem deve ter no máximo 5MB.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const result = e.target?.result as string;\n        setFormData(prev => ({ ...prev, fotoUrl: result }));\n        toast({\n          title: \"Sucesso\",\n          description: \"Imagem anexada com sucesso!\",\n        });\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  // Função para abrir seletor de arquivos\n  const selectFile = () => {\n    fileInputRef.current?.click();\n  };\n\n  // Função para remover foto\n  const removePhoto = () => {\n    setFormData(prev => ({ ...prev, fotoUrl: '' }));\n  };\n\n  // Função para submeter formulário\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!formData.nome.trim()) {\n      toast({\n        title: \"Erro\",\n        description: \"Nome é obrigatório.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!formData.filialId) {\n      toast({\n        title: \"Erro\",\n        description: \"Selecione uma unidade.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      if (aluno) {\n        await updateMutation.mutateAsync({ id: aluno.id, data: formData });\n      } else {\n        await createMutation.mutateAsync(formData);\n      }\n      onSuccess();\n    } catch (error: any) {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao salvar aluno.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\n      {/* Campo Nome */}\n      <div>\n        <Label htmlFor=\"nome\">Nome Completo *</Label>\n        <Input\n          id=\"nome\"\n          value={formData.nome}\n          onChange={(e) => setFormData(prev => ({ ...prev, nome: e.target.value }))}\n          placeholder=\"Nome completo do aluno\"\n          required\n        />\n      </div>\n\n      {/* Campo CPF */}\n      <div>\n        <Label htmlFor=\"cpf\">CPF</Label>\n        <Input\n          id=\"cpf\"\n          value={formData.cpf}\n          onChange={(e) => {\n            const formatted = formatCPF(e.target.value);\n            if (formatted.length <= 14) {\n              setFormData(prev => ({ ...prev, cpf: formatted }));\n            }\n          }}\n          placeholder=\"000.000.000-00\"\n          maxLength={14}\n        />\n      </div>\n\n      {/* Campos Email e Telefone */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"email\">Email do Aluno</Label>\n          <Input\n            id=\"email\"\n            type=\"email\"\n            value={formData.email}\n            onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}\n            placeholder=\"email@exemplo.com\"\n          />\n        </div>\n        <div>\n          <Label htmlFor=\"telefone\">Telefone do Aluno</Label>\n          <Input\n            id=\"telefone\"\n            value={formData.telefone}\n            onChange={(e) => setFormData(prev => ({ ...prev, telefone: e.target.value }))}\n            placeholder=\"(11) 99999-9999\"\n          />\n        </div>\n      </div>\n\n      {/* Campo Endereço */}\n      <div>\n        <Label htmlFor=\"endereco\">Endereço</Label>\n        <Input\n          id=\"endereco\"\n          value={formData.endereco}\n          onChange={(e) => setFormData(prev => ({ ...prev, endereco: e.target.value }))}\n          placeholder=\"Endereço completo\"\n        />\n      </div>\n\n      {/* Campos de Endereço Detalhado */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <div>\n          <Label htmlFor=\"bairro\">Bairro</Label>\n          <Input\n            id=\"bairro\"\n            value={formData.bairro}\n            onChange={(e) => setFormData(prev => ({ ...prev, bairro: e.target.value }))}\n            placeholder=\"Digite o bairro\"\n          />\n        </div>\n        <div>\n          <Label htmlFor=\"cep\">CEP</Label>\n          <Input\n            id=\"cep\"\n            value={formData.cep}\n            onChange={(e) => setFormData(prev => ({ ...prev, cep: e.target.value }))}\n            placeholder=\"00000-000\"\n          />\n        </div>\n        <div>\n          <Label htmlFor=\"cidade\">Cidade</Label>\n          <Input\n            id=\"cidade\"\n            value={formData.cidade}\n            onChange={(e) => setFormData(prev => ({ ...prev, cidade: e.target.value }))}\n            placeholder=\"Digite a cidade\"\n          />\n        </div>\n        <div>\n          <Label htmlFor=\"estado\">Estado</Label>\n          <Input\n            id=\"estado\"\n            value={formData.estado}\n            onChange={(e) => setFormData(prev => ({ ...prev, estado: e.target.value }))}\n            placeholder=\"SP\"\n            maxLength={2}\n          />\n        </div>\n      </div>\n\n      {/* Campos Data de Nascimento e Unidade */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"dataNascimento\">Data de Nascimento</Label>\n          <Input\n            id=\"dataNascimento\"\n            type=\"date\"\n            value={formData.dataNascimento}\n            onChange={(e) => setFormData(prev => ({ ...prev, dataNascimento: e.target.value }))}\n          />\n        </div>\n        <div>\n          <Label htmlFor=\"filialId\">Unidade *</Label>\n          <Select value={formData.filialId.toString()} onValueChange={(value) => \n            setFormData(prev => ({ ...prev, filialId: parseInt(value) }))\n          }>\n            <SelectTrigger>\n              <SelectValue placeholder=\"Selecione uma unidade\" />\n            </SelectTrigger>\n            <SelectContent>\n              {filiais.map((filial) => (\n                <SelectItem key={filial.id} value={filial.id.toString()}>\n                  {filial.nome}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      {/* Campo Data de Matrícula */}\n      <div>\n        <Label htmlFor=\"dataMatricula\">Data de Matrícula</Label>\n        <Input\n          id=\"dataMatricula\"\n          type=\"date\"\n          value={formData.dataMatricula}\n          onChange={(e) => setFormData(prev => ({ ...prev, dataMatricula: e.target.value }))}\n        />\n      </div>\n\n      {/* Seção de Foto */}\n      <div>\n        <Label>Foto do Aluno</Label>\n        {isCapturing ? (\n          <div className=\"space-y-3\">\n            <video\n              ref={videoRef}\n              autoPlay\n              className=\"w-full max-w-md rounded-lg\"\n            />\n            <canvas ref={canvasRef} className=\"hidden\" />\n            <div className=\"flex gap-2\">\n              <Button type=\"button\" onClick={capturePhoto}>\n                Capturar Foto\n              </Button>\n              <Button type=\"button\" variant=\"outline\" onClick={stopCapture}>\n                Cancelar\n              </Button>\n            </div>\n          </div>\n        ) : (\n          <div className=\"space-y-3\">\n            <div className=\"flex flex-col sm:flex-row gap-3\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={selectFile}\n                className=\"flex items-center justify-center space-x-2 flex-1 h-12\"\n              >\n                <ImageIcon className=\"w-5 h-5\" />\n                <span>Anexar Imagem</span>\n              </Button>\n              \n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={startCapture}\n                className=\"flex items-center justify-center space-x-2 flex-1 h-12\"\n              >\n                <Camera className=\"w-5 h-5\" />\n                <span>Tirar Foto</span>\n              </Button>\n            </div>\n            \n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={handleFileSelect}\n              className=\"hidden\"\n            />\n          </div>\n        )}\n\n        {/* Preview da foto */}\n        {formData.fotoUrl && (\n          <div className=\"flex items-center space-x-3 p-3 border rounded-lg mt-3\">\n            <img \n              src={formData.fotoUrl} \n              alt=\"Preview\"\n              className=\"w-16 h-16 rounded-full object-cover\"\n              onError={(e) => {\n                e.currentTarget.style.display = 'none';\n              }}\n            />\n            <div className=\"flex-1\">\n              <p className=\"text-sm font-medium\">Foto do aluno</p>\n              <p className=\"text-xs text-gray-500\">\n                {formData.fotoUrl.includes('canvas') || formData.fotoUrl.includes('video')\n                  ? 'Foto capturada pela câmera'\n                  : 'Imagem anexada do dispositivo'\n                }\n              </p>\n            </div>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={removePhoto}\n            >\n              Remover\n            </Button>\n          </div>\n        )}\n      </div>\n\n      {/* Botões de ação */}\n      <div className=\"flex justify-end space-x-2 pt-4\">\n        <Button type=\"button\" variant=\"outline\" onClick={onSuccess}>\n          Cancelar\n        </Button>\n        <Button \n          type=\"submit\" \n          disabled={createMutation.isPending || updateMutation.isPending}\n        >\n          {createMutation.isPending || updateMutation.isPending ? (\n            <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\n          ) : null}\n          {aluno ? 'Atualizar' : 'Cadastrar'}\n        </Button>\n      </div>\n    </form>\n  );\n}","size_bytes":13396},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/forms/FilialForm.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertFilialSchema, type InsertFilial, type Filial } from \"@shared/schema\";\n\ntype FormData = typeof insertFilialSchema._type;\n\ninterface FilialFormProps {\n  filial?: Filial | null;\n  onSuccess: () => void;\n}\n\nexport default function FilialForm({ filial, onSuccess }: FilialFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(insertFilialSchema),\n    defaultValues: {\n      nome: filial?.nome || \"\",\n      endereco: filial?.endereco || \"\",\n      telefone: filial?.telefone || \"\",\n      responsavel: filial?.responsavel || \"\",\n      ativa: Boolean(filial?.ativa ?? true),\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertFilial) => {\n      const response = await apiRequest(\"POST\", \"/api/filiais\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/filiais\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Filial cadastrada com sucesso.\",\n      });\n      onSuccess();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao cadastrar filial. Verifique os dados e tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: InsertFilial) => {\n      const response = await apiRequest(\"PUT\", `/api/filiais/${filial!.id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/filiais\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Filial atualizada com sucesso.\",\n      });\n      onSuccess();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao atualizar filial. Verifique os dados e tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: FormData) => {\n    const submitData: InsertFilial = {\n      ...data,\n      telefone: data.telefone || null,\n      responsavel: data.responsavel || null,\n    };\n\n    if (filial) {\n      updateMutation.mutate(submitData);\n    } else {\n      createMutation.mutate(submitData);\n    }\n  };\n\n  const isLoading = createMutation.isPending || updateMutation.isPending;\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"nome\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Nome da Filial *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Ex: Unidade Centro\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"responsavel\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Responsável</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Nome do responsável\" {...field} value={field.value || \"\"} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"endereco\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Endereço Completo *</FormLabel>\n              <FormControl>\n                <Textarea \n                  placeholder=\"Digite o endereço completo da filial\"\n                  className=\"min-h-[80px]\"\n                  {...field}\n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"telefone\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Telefone</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"(11) 99999-9999\" {...field} value={field.value || \"\"} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"ativa\"\n            render={({ field }) => (\n              <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n                <div className=\"space-y-0.5\">\n                  <FormLabel className=\"text-base\">\n                    Filial Ativa\n                  </FormLabel>\n                  <div className=\"text-sm text-neutral-500\">\n                    Filial pode receber turmas e alunos\n                  </div>\n                </div>\n                <FormControl>\n                  <Switch\n                    checked={Boolean(field.value)}\n                    onCheckedChange={field.onChange}\n                  />\n                </FormControl>\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <div className=\"flex justify-end space-x-2 pt-4\">\n          <Button type=\"button\" variant=\"outline\" onClick={onSuccess}>\n            Cancelar\n          </Button>\n          <Button type=\"submit\" disabled={isLoading} className=\"bg-primary hover:bg-primary/90\">\n            {isLoading ? \"Salvando...\" : (filial ? \"Atualizar Filial\" : \"Cadastrar Filial\")}\n          </Button>\n        </div>\n      </form>\n    </Form>\n  );\n}","size_bytes":6227},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/Layout.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useEffect } from \"react\";\nimport Sidebar from \"./Sidebar\";\n\ninterface LayoutProps {\n  children: React.ReactNode;\n}\n\nexport default function Layout({ children }: LayoutProps) {\n  const { toast } = useToast();\n  const { isAuthenticated, isLoading } = useAuth();\n\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Não autorizado\",\n        description: \"Você foi desconectado. Fazendo login novamente...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <div className=\"text-center\">\n          <div className=\"relative w-16 h-16 mx-auto mb-6\">\n            <div className=\"absolute inset-0 border-4 border-primary/20 rounded-full\"></div>\n            <div className=\"absolute inset-0 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\n          </div>\n          <p className=\"text-lg font-medium text-foreground\">Carregando...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex min-h-screen bg-background\">\n      <Sidebar />\n      <main className=\"flex-1 overflow-hidden\">\n        <div className=\"p-8 h-full overflow-y-auto\">\n          {children}\n        </div>\n      </main>\n    </div>\n  );\n}\n","size_bytes":1602},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1376},"client/src/pages/CadastroAlunoUnidade.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, UserPlus, Building2 } from \"lucide-react\";\nimport { useUnidadeAuth } from \"@/contexts/UnidadeContext\";\nimport AlunoUnidadeForm from \"@/components/unidade/forms/AlunoUnidadeForm\";\n\nexport default function CadastroAlunoUnidade() {\n  const [, setLocation] = useLocation();\n  const { nomeFilial, isAuthenticated } = useUnidadeAuth();\n  const [editingAlunoId, setEditingAlunoId] = useState<number | null>(null);\n\n  // Get edit ID from URL parameters\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const editId = urlParams.get('edit');\n    if (editId) {\n      setEditingAlunoId(parseInt(editId));\n    }\n  }, []);\n\n  // Fetch student data if editing\n  const { data: alunoData, isLoading: isLoadingAluno } = useQuery({\n    queryKey: [\"/api/alunos\", editingAlunoId],\n    enabled: !!editingAlunoId,\n  });\n\n  const handleSuccess = () => {\n    setLocation('/unidade/sistema?tab=alunos');\n  };\n\n  const handleGoBack = () => {\n    setLocation('/unidade/sistema?tab=alunos');\n  };\n\n  if (!isAuthenticated || (editingAlunoId && isLoadingAluno)) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-blue-50\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white border-b border-gray-200 px-6 py-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button \n              variant=\"outline\" \n              size=\"sm\"\n              onClick={handleGoBack}\n              className=\"flex items-center gap-2\"\n            >\n              <ArrowLeft className=\"w-4 h-4\" />\n              Voltar\n            </Button>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center\">\n                <Building2 className=\"w-6 h-6 text-white\" />\n              </div>\n              <div>\n                <h1 className=\"text-xl font-bold text-gray-900\">\n                  Cadastro de Aluno\n                </h1>\n                <p className=\"text-sm text-gray-600\">\n                  {nomeFilial || 'Sistema da Unidade'}\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Content */}\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <Card className=\"shadow-lg\">\n          <CardHeader className=\"pb-8\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\n                <UserPlus className=\"w-6 h-6 text-blue-600\" />\n              </div>\n              <div>\n                <CardTitle className=\"text-2xl text-gray-900\">\n                  {editingAlunoId ? \"Editar Aluno\" : \"Novo Aluno\"}\n                </CardTitle>\n                <p className=\"text-gray-600 mt-1\">\n                  {editingAlunoId ? \"Edite os dados do aluno\" : \"Preencha os dados completos do aluno para realizar o cadastro\"}\n                </p>\n              </div>\n            </div>\n          </CardHeader>\n          \n          <CardContent className=\"pb-8\">\n            <AlunoUnidadeForm \n              initialData={alunoData as any}\n              onSuccess={handleSuccess}\n            />\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":3791},"client/src/pages/Filiais.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Building2, Search, Edit, Trash2, Phone, MapPin, User, Plus, CheckCircle2, XCircle } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Filial } from \"@shared/schema\";\nimport FilialForm from \"@/components/forms/FilialForm\";\n\nexport default function Filiais() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingFilial, setEditingFilial] = useState<Filial | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: filiais, isLoading } = useQuery<Filial[]>({\n    queryKey: [\"/api/filiais\"],\n  });\n\n  const deleteFilialMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/filiais/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/filiais\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Filial removida com sucesso.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao remover filial. Tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredFiliais = filiais?.filter((filial) =>\n    filial.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    filial.endereco?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    filial.responsavel?.toLowerCase().includes(searchTerm.toLowerCase())\n  ) || [];\n\n  const handleEdit = (filial: Filial) => {\n    setEditingFilial(filial);\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = (id: number) => {\n    if (confirm(\"Tem certeza que deseja remover esta filial?\")) {\n      deleteFilialMutation.mutate(id);\n    }\n  };\n\n  const handleDialogClose = () => {\n    setIsDialogOpen(false);\n    setEditingFilial(null);\n  };\n\n  const activeCount = filiais?.filter(f => f.ativa).length || 0;\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-4xl font-bold text-foreground mb-2\">Gestão de Filiais</h1>\n          <p className=\"text-muted-foreground text-lg\">Gerencie as unidades da escola de futebol</p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button \n              data-testid=\"button-nova-filial\"\n              className=\"bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-600/30\"\n            >\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Nova Filial\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingFilial ? \"Editar Filial\" : \"Cadastrar Nova Filial\"}\n              </DialogTitle>\n            </DialogHeader>\n            <FilialForm \n              filial={editingFilial} \n              onSuccess={handleDialogClose}\n            />\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground mb-1\">Total de Filiais</p>\n                <p className=\"text-3xl font-bold text-foreground\">{filiais?.length || 0}</p>\n              </div>\n              <div className=\"p-3 rounded-xl bg-blue-500/10\">\n                <Building2 className=\"w-6 h-6 text-blue-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground mb-1\">Filiais Ativas</p>\n                <p className=\"text-3xl font-bold text-green-600\">{activeCount}</p>\n              </div>\n              <div className=\"p-3 rounded-xl bg-green-500/10\">\n                <CheckCircle2 className=\"w-6 h-6 text-green-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground mb-1\">Filiais Inativas</p>\n                <p className=\"text-3xl font-bold text-red-600\">{(filiais?.length || 0) - activeCount}</p>\n              </div>\n              <div className=\"p-3 rounded-xl bg-red-500/10\">\n                <XCircle className=\"w-6 h-6 text-red-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <Card className=\"border-border bg-card\">\n        <CardContent className=\"p-6\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5\" />\n            <Input\n              placeholder=\"Buscar por nome, endereço ou responsável...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              data-testid=\"input-search-filiais\"\n              className=\"pl-11 h-11 bg-background border-border\"\n            />\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Filiais Table */}\n      <Card className=\"border-border bg-card\">\n        <CardContent className=\"p-6\">\n          {isLoading ? (\n            <div className=\"space-y-4\">\n              {[...Array(5)].map((_, i) => (\n                <div key={i} className=\"flex items-center space-x-4 p-4 border border-border rounded-lg\">\n                  <Skeleton className=\"h-12 w-12 rounded-lg\" />\n                  <div className=\"space-y-2 flex-1\">\n                    <Skeleton className=\"h-4 w-48\" />\n                    <Skeleton className=\"h-3 w-32\" />\n                  </div>\n                  <Skeleton className=\"h-8 w-20\" />\n                </div>\n              ))}\n            </div>\n          ) : filteredFiliais.length === 0 ? (\n            <div className=\"text-center py-16\">\n              <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-muted mb-4\">\n                <Building2 className=\"w-8 h-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"text-xl font-semibold text-foreground mb-2\">\n                {searchTerm ? \"Nenhuma filial encontrada\" : \"Nenhuma filial cadastrada\"}\n              </h3>\n              <p className=\"text-muted-foreground mb-6 max-w-md mx-auto\">\n                {searchTerm\n                  ? \"Tente ajustar os termos de busca.\" \n                  : \"Comece cadastrando a primeira filial da escola.\"}\n              </p>\n              {!searchTerm && (\n                <Button \n                  onClick={() => setIsDialogOpen(true)}\n                  className=\"bg-green-600 hover:bg-green-700\"\n                  data-testid=\"button-primeira-filial\"\n                >\n                  <Plus className=\"w-4 h-4 mr-2\" />\n                  Cadastrar Primeira Filial\n                </Button>\n              )}\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow className=\"border-border hover:bg-transparent\">\n                    <TableHead className=\"font-semibold\">Nome da Filial</TableHead>\n                    <TableHead className=\"font-semibold\">Endereço</TableHead>\n                    <TableHead className=\"font-semibold\">Responsável</TableHead>\n                    <TableHead className=\"font-semibold\">Telefone</TableHead>\n                    <TableHead className=\"font-semibold\">Status</TableHead>\n                    <TableHead className=\"text-right font-semibold\">Ações</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredFiliais.map((filial) => (\n                    <TableRow key={filial.id} className=\"border-border hover:bg-muted/50\" data-testid={`row-filial-${filial.id}`}>\n                      <TableCell>\n                        <div className=\"flex items-center\">\n                          <div className=\"w-11 h-11 bg-blue-500/10 rounded-xl flex items-center justify-center mr-3\">\n                            <Building2 className=\"w-5 h-5 text-blue-600\" />\n                          </div>\n                          <p className=\"font-semibold text-foreground\">{filial.nome}</p>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center text-muted-foreground\">\n                          <MapPin className=\"w-4 h-4 mr-2 flex-shrink-0\" />\n                          <span className=\"text-sm max-w-xs truncate\">{filial.endereco}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center\">\n                          <User className=\"w-4 h-4 mr-2 text-muted-foreground\" />\n                          <span className=\"text-sm font-medium\">{filial.responsavel || \"-\"}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center\">\n                          <Phone className=\"w-4 h-4 mr-2 text-muted-foreground\" />\n                          <span className=\"text-sm\">{filial.telefone || \"-\"}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge \n                          variant={filial.ativa ? \"default\" : \"secondary\"}\n                          className={filial.ativa ? \"bg-green-600 hover:bg-green-700\" : \"bg-muted\"}\n                        >\n                          {filial.ativa ? \"Ativa\" : \"Inativa\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end space-x-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleEdit(filial)}\n                            data-testid={`button-edit-${filial.id}`}\n                            className=\"hover:bg-blue-50 hover:text-blue-600 hover:border-blue-300\"\n                          >\n                            <Edit className=\"w-4 h-4\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleDelete(filial.id)}\n                            disabled={deleteFilialMutation.isPending}\n                            data-testid={`button-delete-${filial.id}`}\n                            className=\"hover:bg-red-50 hover:text-red-600 hover:border-red-300\"\n                          >\n                            <Trash2 className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":12317},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/pages/Dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { \n  Users, \n  UserSquare2, \n  Wallet, \n  UsersRound, \n  UserPlus, \n  TrendingUp, \n  TrendingDown,\n  DollarSign,\n  GraduationCap,\n  ChevronRight,\n  Clock,\n  Building2,\n  CheckCircle2,\n  AlertCircle\n} from \"lucide-react\";\nimport { Link } from \"wouter\";\n\ninterface DashboardMetrics {\n  totalAlunos: number;\n  totalProfessores: number;\n  totalTurmas: number;\n  receitaMensal: number;\n}\n\ninterface PaymentStats {\n  emDia: number;\n  atrasados: number;\n  total: number;\n}\n\nexport default function Dashboard() {\n  const { data: metrics, isLoading: isLoadingMetrics } = useQuery<DashboardMetrics>({\n    queryKey: [\"/api/dashboard/metrics\"],\n  });\n\n  const { data: paymentStats, isLoading: isLoadingPayments } = useQuery<PaymentStats>({\n    queryKey: [\"/api/alunos/payment-stats\"],\n  });\n\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(value);\n  };\n\n  const isLoading = isLoadingMetrics || isLoadingPayments;\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-8\">\n        <div>\n          <Skeleton className=\"h-10 w-64 mb-2\" />\n          <Skeleton className=\"h-5 w-96\" />\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {[...Array(4)].map((_, i) => (\n            <Card key={i} className=\"overflow-hidden\">\n              <CardContent className=\"p-6\">\n                <Skeleton className=\"h-5 w-28 mb-3\" />\n                <Skeleton className=\"h-10 w-20 mb-4\" />\n                <Skeleton className=\"h-4 w-32\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  const percentEmDia = paymentStats?.total \n    ? Math.round((paymentStats.emDia / paymentStats.total) * 100)\n    : 0;\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-4xl font-bold text-foreground mb-2\">Dashboard</h1>\n        <p className=\"text-muted-foreground text-lg\">Bem-vindo ao sistema de gestão da sua escola de futebol</p>\n      </div>\n\n      {/* Main Metrics */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        {/* Alunos */}\n        <Card className=\"overflow-hidden border-border bg-card hover-lift group\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-green-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\"></div>\n          <CardContent className=\"p-6 relative\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"p-3 rounded-xl bg-green-500/10 group-hover:bg-green-500/20 transition-colors\">\n                <Users className=\"w-6 h-6 text-green-600\" />\n              </div>\n              <div className=\"flex items-center text-green-600 text-sm font-medium\">\n                <TrendingUp className=\"w-4 h-4 mr-1\" />\n                <span>8%</span>\n              </div>\n            </div>\n            <div>\n              <p className=\"text-sm font-medium text-muted-foreground mb-1\">Total de Alunos</p>\n              <p className=\"text-3xl font-bold text-foreground\" data-testid=\"metric-total-alunos\">{metrics?.totalAlunos || 0}</p>\n            </div>\n            <Link href=\"/alunos\">\n              <button \n                data-testid=\"link-alunos\"\n                className=\"mt-4 text-sm text-green-600 hover:text-green-700 font-medium flex items-center group/link\"\n              >\n                Ver todos\n                <ChevronRight className=\"w-4 h-4 ml-1 group-hover/link:translate-x-1 transition-transform\" />\n              </button>\n            </Link>\n          </CardContent>\n        </Card>\n\n        {/* Professores */}\n        <Card className=\"overflow-hidden border-border bg-card hover-lift group\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\"></div>\n          <CardContent className=\"p-6 relative\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"p-3 rounded-xl bg-blue-500/10 group-hover:bg-blue-500/20 transition-colors\">\n                <UserSquare2 className=\"w-6 h-6 text-blue-600\" />\n              </div>\n              <div className=\"flex items-center text-blue-600 text-sm font-medium\">\n                <TrendingUp className=\"w-4 h-4 mr-1\" />\n                <span>2 novos</span>\n              </div>\n            </div>\n            <div>\n              <p className=\"text-sm font-medium text-muted-foreground mb-1\">Professores</p>\n              <p className=\"text-3xl font-bold text-foreground\" data-testid=\"metric-total-professores\">{metrics?.totalProfessores || 0}</p>\n            </div>\n            <Link href=\"/professores\">\n              <button \n                data-testid=\"link-professores\"\n                className=\"mt-4 text-sm text-blue-600 hover:text-blue-700 font-medium flex items-center group/link\"\n              >\n                Ver todos\n                <ChevronRight className=\"w-4 h-4 ml-1 group-hover/link:translate-x-1 transition-transform\" />\n              </button>\n            </Link>\n          </CardContent>\n        </Card>\n\n        {/* Receita */}\n        <Card className=\"overflow-hidden border-border bg-card hover-lift group\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-amber-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\"></div>\n          <CardContent className=\"p-6 relative\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"p-3 rounded-xl bg-amber-500/10 group-hover:bg-amber-500/20 transition-colors\">\n                <Wallet className=\"w-6 h-6 text-amber-600\" />\n              </div>\n              <div className=\"flex items-center text-green-600 text-sm font-medium\">\n                <TrendingUp className=\"w-4 h-4 mr-1\" />\n                <span>12%</span>\n              </div>\n            </div>\n            <div>\n              <p className=\"text-sm font-medium text-muted-foreground mb-1\">Receita Mensal</p>\n              <p className=\"text-3xl font-bold text-foreground\" data-testid=\"metric-receita-mensal\">{formatCurrency(metrics?.receitaMensal || 0)}</p>\n            </div>\n            <Link href=\"/financeiro\">\n              <button \n                data-testid=\"link-financeiro\"\n                className=\"mt-4 text-sm text-amber-600 hover:text-amber-700 font-medium flex items-center group/link\"\n              >\n                Ver detalhes\n                <ChevronRight className=\"w-4 h-4 ml-1 group-hover/link:translate-x-1 transition-transform\" />\n              </button>\n            </Link>\n          </CardContent>\n        </Card>\n\n        {/* Turmas */}\n        <Card className=\"overflow-hidden border-border bg-card hover-lift group\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-purple-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\"></div>\n          <CardContent className=\"p-6 relative\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"p-3 rounded-xl bg-purple-500/10 group-hover:bg-purple-500/20 transition-colors\">\n                <UsersRound className=\"w-6 h-6 text-purple-600\" />\n              </div>\n              <div className=\"flex items-center text-muted-foreground text-sm font-medium\">\n                <Clock className=\"w-4 h-4 mr-1\" />\n                <span>Ativas</span>\n              </div>\n            </div>\n            <div>\n              <p className=\"text-sm font-medium text-muted-foreground mb-1\">Turmas</p>\n              <p className=\"text-3xl font-bold text-foreground\" data-testid=\"metric-total-turmas\">{metrics?.totalTurmas || 0}</p>\n            </div>\n            <Link href=\"/turmas\">\n              <button \n                data-testid=\"link-turmas\"\n                className=\"mt-4 text-sm text-purple-600 hover:text-purple-700 font-medium flex items-center group/link\"\n              >\n                Ver todas\n                <ChevronRight className=\"w-4 h-4 ml-1 group-hover/link:translate-x-1 transition-transform\" />\n              </button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Payment Status Overview */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <Card className=\"lg:col-span-2 border-border bg-card\">\n          <CardHeader>\n            <CardTitle className=\"text-xl font-bold flex items-center\">\n              <DollarSign className=\"w-5 h-5 mr-2 text-green-600\" />\n              Status de Pagamentos\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-6\">\n              {/* Payment Progress */}\n              <div>\n                <div className=\"flex items-center justify-between mb-3\">\n                  <span className=\"text-sm font-medium text-muted-foreground\">\n                    Taxa de pagamento\n                  </span>\n                  <span className=\"text-2xl font-bold text-foreground\" data-testid=\"metric-percent-em-dia\">{percentEmDia}%</span>\n                </div>\n                <div className=\"h-4 bg-muted rounded-full overflow-hidden\">\n                  <div \n                    className=\"h-full bg-gradient-to-r from-green-500 to-green-600 transition-all duration-500 rounded-full\"\n                    style={{ width: `${percentEmDia}%` }}\n                  ></div>\n                </div>\n              </div>\n\n              {/* Payment Details */}\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div className=\"bg-muted/50 rounded-xl p-4\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <span className=\"text-sm font-medium text-muted-foreground\">Total</span>\n                    <Users className=\"w-4 h-4 text-muted-foreground\" />\n                  </div>\n                  <p className=\"text-2xl font-bold text-foreground\" data-testid=\"metric-payment-total\">{paymentStats?.total || 0}</p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">Alunos ativos</p>\n                </div>\n\n                <div className=\"bg-green-500/10 rounded-xl p-4 border border-green-500/20\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <span className=\"text-sm font-medium text-green-700\">Em Dia</span>\n                    <CheckCircle2 className=\"w-4 h-4 text-green-600\" />\n                  </div>\n                  <p className=\"text-2xl font-bold text-green-700\" data-testid=\"metric-payment-em-dia\">{paymentStats?.emDia || 0}</p>\n                  <p className=\"text-xs text-green-600 mt-1\">Pagamentos regulares</p>\n                </div>\n\n                <div className=\"bg-red-500/10 rounded-xl p-4 border border-red-500/20\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <span className=\"text-sm font-medium text-red-700\">Atrasados</span>\n                    <AlertCircle className=\"w-4 h-4 text-red-600\" />\n                  </div>\n                  <p className=\"text-2xl font-bold text-red-700\" data-testid=\"metric-payment-atrasados\">{paymentStats?.atrasados || 0}</p>\n                  <p className=\"text-xs text-red-600 mt-1\">Necessitam atenção</p>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Quick Actions */}\n        <Card className=\"border-border bg-card\">\n          <CardHeader>\n            <CardTitle className=\"text-xl font-bold\">Ações Rápidas</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <Link href=\"/alunos\">\n              <button \n                data-testid=\"button-novo-aluno\"\n                className=\"w-full flex items-center p-4 rounded-xl bg-green-500/10 hover:bg-green-500/20 border border-green-500/20 hover:border-green-500/30 transition-all group\"\n              >\n                <div className=\"p-2 rounded-lg bg-green-500/20 mr-3\">\n                  <UserPlus className=\"w-5 h-5 text-green-600\" />\n                </div>\n                <div className=\"flex-1 text-left\">\n                  <p className=\"font-semibold text-foreground\">Novo Aluno</p>\n                  <p className=\"text-sm text-muted-foreground\">Cadastrar estudante</p>\n                </div>\n                <ChevronRight className=\"w-5 h-5 text-green-600 group-hover:translate-x-1 transition-transform\" />\n              </button>\n            </Link>\n\n            <Link href=\"/turmas\">\n              <button \n                data-testid=\"button-nova-turma\"\n                className=\"w-full flex items-center p-4 rounded-xl bg-purple-500/10 hover:bg-purple-500/20 border border-purple-500/20 hover:border-purple-500/30 transition-all group\"\n              >\n                <div className=\"p-2 rounded-lg bg-purple-500/20 mr-3\">\n                  <GraduationCap className=\"w-5 h-5 text-purple-600\" />\n                </div>\n                <div className=\"flex-1 text-left\">\n                  <p className=\"font-semibold text-foreground\">Nova Turma</p>\n                  <p className=\"text-sm text-muted-foreground\">Criar turma</p>\n                </div>\n                <ChevronRight className=\"w-5 h-5 text-purple-600 group-hover:translate-x-1 transition-transform\" />\n              </button>\n            </Link>\n\n            <Link href=\"/filiais\">\n              <button \n                data-testid=\"button-filiais\"\n                className=\"w-full flex items-center p-4 rounded-xl bg-blue-500/10 hover:bg-blue-500/20 border border-blue-500/20 hover:border-blue-500/30 transition-all group\"\n              >\n                <div className=\"p-2 rounded-lg bg-blue-500/20 mr-3\">\n                  <Building2 className=\"w-5 h-5 text-blue-600\" />\n                </div>\n                <div className=\"flex-1 text-left\">\n                  <p className=\"font-semibold text-foreground\">Filiais</p>\n                  <p className=\"text-sm text-muted-foreground\">Gerenciar unidades</p>\n                </div>\n                <ChevronRight className=\"w-5 h-5 text-blue-600 group-hover:translate-x-1 transition-transform\" />\n              </button>\n            </Link>\n\n            <Link href=\"/financeiro\">\n              <button \n                data-testid=\"button-financeiro-quick\"\n                className=\"w-full flex items-center p-4 rounded-xl bg-amber-500/10 hover:bg-amber-500/20 border border-amber-500/20 hover:border-amber-500/30 transition-all group\"\n              >\n                <div className=\"p-2 rounded-lg bg-amber-500/20 mr-3\">\n                  <DollarSign className=\"w-5 h-5 text-amber-600\" />\n                </div>\n                <div className=\"flex-1 text-left\">\n                  <p className=\"font-semibold text-foreground\">Financeiro</p>\n                  <p className=\"text-sm text-muted-foreground\">Registrar pagamento</p>\n                </div>\n                <ChevronRight className=\"w-5 h-5 text-amber-600 group-hover:translate-x-1 transition-transform\" />\n              </button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":15472},"server/routes-old.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { adminLoginSchema } from \"@shared/schema\";\nimport { addToSync } from \"./sync\";\nimport { requireAdminAuth, requireGestorAuth, requireResponsavelAuth } from \"./auth\";\n\n// Extend session type for responsavel and gestor\ndeclare module \"express-session\" {\n  interface SessionData {\n    responsavelId?: number;\n    gestorUnidadeId?: number;\n    filialId?: number;\n    adminId?: number;\n    adminUser?: {\n      id: number;\n      nome: string;\n      email: string;\n      papel: string;\n    };\n  }\n}\nimport {\n  insertAlunoSchema,\n  insertProfessorSchema,\n  insertTurmaSchema,\n  insertMatriculaSchema,\n  insertPagamentoSchema,\n  insertFilialSchema,\n  insertResponsavelSchema,\n  insertEventoSchema,\n  insertUniformeSchema,\n  insertInscricaoEventoSchema,\n  insertCompraUniformeSchema,\n  insertNotificacaoSchema,\n  insertCategoriaTesteSchema,\n  insertTesteSchema,\n  insertAvaliacaoFisicaSchema,\n  insertResultadoTesteSchema,\n  insertMetaAlunoSchema,\n  insertGestorUnidadeSchema,\n  loginGestorSchema,\n} from \"@shared/schema\";\nimport { z } from \"zod\";\n\n// Middleware para verificar se usuário admin ou responsável está autenticado\nconst requireAdminAuthOrResponsavel = async (req: any, res: any, next: any) => {\n  // Verificar se é usuário administrativo autenticado\n  if (req.requireAdminAuth && req.requireAdminAuth()) {\n    return next();\n  }\n  \n  // Verificar se é responsável autenticado via sessão\n  if (req.session && req.session.responsavelId) {\n    return next();\n  }\n  \n  return res.status(401).json({ message: \"Unauthorized\" });\n};\n\n// Middleware para verificar se gestor de unidade está autenticado\nconst isGestorUnidadeAuthenticated = async (req: any, res: any, next: any) => {\n  if (req.session && req.session.gestorUnidadeId && req.session.filialId) {\n    return next();\n  }\n  \n  return res.status(401).json({ message: \"Unauthorized\" });\n};\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Setup session middleware for traditional authentication\n  const expressSession = (await import('express-session')).default;\n  const connectPgSimple = (await import('connect-pg-simple')).default;\n  const PostgresSessionStore = connectPgSimple(expressSession);\n  \n  const sessionStore = new PostgresSessionStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: true,\n    ttl: 7 * 24 * 60 * 60, // 7 days\n  });\n\n  app.use(expressSession({\n    secret: process.env.SESSION_SECRET || 'escola-futebol-secret-2024',\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: false, // Set to true in production with HTTPS\n      maxAge: 7 * 24 * 60 * 60 * 1000, // 7 days\n    },\n  }));\n\n  // Traditional admin authentication routes\n  app.post('/api/admin/login', async (req, res) => {\n    try {\n      const { email, senha } = adminLoginSchema.parse(req.body);\n      \n      const user = await storage.authenticateAdminUser(email, senha);\n      if (!user) {\n        return res.status(401).json({ message: \"Email ou senha inválidos\" });\n      }\n\n      // Store admin user in session\n      req.session.adminId = user.id;\n      req.session.adminUser = {\n        id: user.id,\n        nome: user.nome,\n        email: user.email,\n        papel: user.papel || 'admin'\n      };\n\n      res.json({\n        success: true,\n        user: {\n          id: user.id,\n          nome: user.nome,\n          email: user.email,\n          papel: user.papel\n        }\n      });\n    } catch (error) {\n      console.error(\"Admin login error:\", error);\n      res.status(400).json({ message: \"Dados de login inválidos\" });\n    }\n  });\n\n  app.post('/api/admin/logout', (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ message: \"Erro ao fazer logout\" });\n      }\n      res.json({ success: true });\n    });\n  });\n\n  app.get('/api/admin/user', (req, res) => {\n    if (!req.session || !req.session.adminId || !req.session.adminUser) {\n      return res.status(401).json({ message: \"Não autenticado\" });\n    }\n    \n    res.json(req.session.adminUser);\n  });\n\n  // Remove OAuth completely - using only traditional authentication\n\n  // Dashboard routes\n  app.get(\"/api/dashboard/metrics\", requireAdminAuth, async (req, res) => {\n    try {\n      const metrics = await storage.getDashboardMetrics();\n      res.json(metrics);\n    } catch (error) {\n      console.error(\"Error fetching dashboard metrics:\", error);\n      res.status(500).json({ message: \"Failed to fetch dashboard metrics\" });\n    }\n  });\n\n  // Alunos routes\n  app.get(\"/api/alunos\", requireAdminAuthOrResponsavel, async (req, res) => {\n    try {\n      const { filialId } = req.query;\n      if (filialId) {\n        const alunos = await storage.getAlunosByFilial(parseInt(filialId as string));\n        res.json(alunos);\n      } else {\n        const alunos = await storage.getAlunos();\n        res.json(alunos);\n      }\n    } catch (error) {\n      console.error(\"Error fetching alunos:\", error);\n      res.status(500).json({ message: \"Failed to fetch alunos\" });\n    }\n  });\n\n  app.get(\"/api/alunos/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const aluno = await storage.getAluno(id);\n      if (!aluno) {\n        return res.status(404).json({ message: \"Aluno not found\" });\n      }\n      res.json(aluno);\n    } catch (error) {\n      console.error(\"Error fetching aluno:\", error);\n      res.status(500).json({ message: \"Failed to fetch aluno\" });\n    }\n  });\n\n  app.post(\"/api/alunos\", requireAdminAuthOrResponsavel, async (req, res) => {\n    try {\n      const validatedData = insertAlunoSchema.parse(req.body);\n      const aluno = await storage.createAluno(validatedData);\n      \n      // Sincronização automática com sistema principal\n      if (validatedData.filialId) {\n        await addToSync(validatedData.filialId, 'aluno', 'create', aluno);\n      }\n      \n      res.status(201).json(aluno);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating aluno:\", error);\n      res.status(500).json({ message: \"Failed to create aluno\" });\n    }\n  });\n\n  // Rota para cadastro completo (aluno + responsável)\n  app.post(\"/api/alunos-completo\", requireAdminAuth, async (req, res) => {\n    try {\n      const { aluno: alunoData, responsavel: responsavelData } = req.body;\n      \n      // Primeiro, criar o responsável\n      const responsavel = await storage.createResponsavel(responsavelData);\n      \n      // Depois, criar o aluno vinculado ao responsável\n      const alunoCompleto = {\n        ...alunoData,\n        responsavelId: responsavel.id,\n      };\n      \n      const aluno = await storage.createAluno(alunoCompleto);\n      \n      // Sincronização automática com sistema principal\n      if (alunoData.filialId) {\n        await addToSync(alunoData.filialId, 'aluno', 'create', aluno);\n      }\n      \n      res.status(201).json({\n        aluno,\n        responsavel,\n        message: \"Aluno e responsável cadastrados com sucesso\"\n      });\n    } catch (error) {\n      console.error(\"Error creating aluno completo:\", error);\n      res.status(500).json({ message: \"Failed to create aluno and responsavel\" });\n    }\n  });\n\n  app.patch(\"/api/alunos/:id\", requireAdminAuthOrResponsavel, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertAlunoSchema.partial().parse(req.body);\n      const aluno = await storage.updateAluno(id, validatedData);\n      \n      // Sincronização automática com sistema principal\n      if (aluno.filialId) {\n        await addToSync(aluno.filialId, 'aluno', 'update', aluno);\n      }\n      \n      res.json(aluno);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating aluno:\", error);\n      res.status(500).json({ message: \"Failed to update aluno\" });\n    }\n  });\n\n  app.delete(\"/api/alunos/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      \n      // Buscar aluno antes de deletar para sincronização\n      const aluno = await storage.getAluno(id);\n      if (aluno && aluno.filialId) {\n        await addToSync(aluno.filialId, 'aluno', 'delete', { id });\n      }\n      \n      await storage.deleteAluno(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting aluno:\", error);\n      res.status(500).json({ message: \"Failed to delete aluno\" });\n    }\n  });\n\n  // Professores routes\n  app.get(\"/api/professores\", requireAdminAuth, async (req, res) => {\n    try {\n      const { filialId } = req.query;\n      if (filialId) {\n        const professores = await storage.getProfessoresByFilial(parseInt(filialId as string));\n        res.json(professores);\n      } else {\n        const professores = await storage.getProfessores();\n        res.json(professores);\n      }\n    } catch (error) {\n      console.error(\"Error fetching professores:\", error);\n      res.status(500).json({ message: \"Failed to fetch professores\" });\n    }\n  });\n\n  app.get(\"/api/professores/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const professor = await storage.getProfessor(id);\n      if (!professor) {\n        return res.status(404).json({ message: \"Professor not found\" });\n      }\n      res.json(professor);\n    } catch (error) {\n      console.error(\"Error fetching professor:\", error);\n      res.status(500).json({ message: \"Failed to fetch professor\" });\n    }\n  });\n\n  app.post(\"/api/professores\", requireAdminAuth, async (req, res) => {\n    try {\n      const validatedData = insertProfessorSchema.parse(req.body);\n      const professor = await storage.createProfessor(validatedData);\n      \n      // Sincronização automática com sistema principal\n      if (validatedData.filialId) {\n        await addToSync(validatedData.filialId, 'professor', 'create', professor);\n      }\n      \n      res.status(201).json(professor);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating professor:\", error);\n      res.status(500).json({ message: \"Failed to create professor\" });\n    }\n  });\n\n  app.put(\"/api/professores/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertProfessorSchema.partial().parse(req.body);\n      const professor = await storage.updateProfessor(id, validatedData);\n      \n      // Sincronização automática com sistema principal\n      if (professor.filialId) {\n        await addToSync(professor.filialId, 'professor', 'update', professor);\n      }\n      \n      res.json(professor);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating professor:\", error);\n      res.status(500).json({ message: \"Failed to update professor\" });\n    }\n  });\n\n  app.delete(\"/api/professores/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      \n      // Buscar professor antes de deletar para sincronização\n      const professor = await storage.getProfessor(id);\n      if (professor && professor.filialId) {\n        await addToSync(professor.filialId, 'professor', 'delete', { id });\n      }\n      \n      await storage.deleteProfessor(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting professor:\", error);\n      res.status(500).json({ message: \"Failed to delete professor\" });\n    }\n  });\n\n  // Turmas routes\n  app.get(\"/api/turmas\", requireAdminAuth, async (req, res) => {\n    try {\n      const { filialId } = req.query;\n      if (filialId) {\n        const turmas = await storage.getTurmasByFilial(parseInt(filialId as string));\n        res.json(turmas);\n      } else {\n        const turmas = await storage.getTurmas();\n        res.json(turmas);\n      }\n    } catch (error) {\n      console.error(\"Error fetching turmas:\", error);\n      res.status(500).json({ message: \"Failed to fetch turmas\" });\n    }\n  });\n\n  app.get(\"/api/turmas/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const turma = await storage.getTurma(id);\n      if (!turma) {\n        return res.status(404).json({ message: \"Turma not found\" });\n      }\n      res.json(turma);\n    } catch (error) {\n      console.error(\"Error fetching turma:\", error);\n      res.status(500).json({ message: \"Failed to fetch turma\" });\n    }\n  });\n\n  app.post(\"/api/turmas\", requireAdminAuth, async (req, res) => {\n    try {\n      const validatedData = insertTurmaSchema.parse(req.body);\n      const turma = await storage.createTurma(validatedData);\n      res.status(201).json(turma);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating turma:\", error);\n      res.status(500).json({ message: \"Failed to create turma\" });\n    }\n  });\n\n  app.put(\"/api/turmas/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertTurmaSchema.partial().parse(req.body);\n      const turma = await storage.updateTurma(id, validatedData);\n      res.json(turma);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating turma:\", error);\n      res.status(500).json({ message: \"Failed to update turma\" });\n    }\n  });\n\n  app.delete(\"/api/turmas/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteTurma(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting turma:\", error);\n      res.status(500).json({ message: \"Failed to delete turma\" });\n    }\n  });\n\n  // Matriculas routes\n  app.get(\"/api/matriculas\", requireAdminAuth, async (req, res) => {\n    try {\n      const matriculas = await storage.getMatriculas();\n      res.json(matriculas);\n    } catch (error) {\n      console.error(\"Error fetching matriculas:\", error);\n      res.status(500).json({ message: \"Failed to fetch matriculas\" });\n    }\n  });\n\n  app.post(\"/api/matriculas\", requireAdminAuth, async (req, res) => {\n    try {\n      const validatedData = insertMatriculaSchema.parse(req.body);\n      const matricula = await storage.createMatricula(validatedData);\n      res.status(201).json(matricula);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating matricula:\", error);\n      res.status(500).json({ message: \"Failed to create matricula\" });\n    }\n  });\n\n  app.delete(\"/api/matriculas/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteMatricula(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting matricula:\", error);\n      res.status(500).json({ message: \"Failed to delete matricula\" });\n    }\n  });\n\n  // Pagamentos routes\n  app.get(\"/api/pagamentos\", requireAdminAuth, async (req, res) => {\n    try {\n      const pagamentos = await storage.getPagamentos();\n      res.json(pagamentos);\n    } catch (error) {\n      console.error(\"Error fetching pagamentos:\", error);\n      res.status(500).json({ message: \"Failed to fetch pagamentos\" });\n    }\n  });\n\n  app.get(\"/api/pagamentos/aluno/:alunoId\", requireAdminAuth, async (req, res) => {\n    try {\n      const alunoId = parseInt(req.params.alunoId);\n      const pagamentos = await storage.getPagamentosByAluno(alunoId);\n      res.json(pagamentos);\n    } catch (error) {\n      console.error(\"Error fetching pagamentos by aluno:\", error);\n      res.status(500).json({ message: \"Failed to fetch pagamentos by aluno\" });\n    }\n  });\n\n  app.post(\"/api/pagamentos\", requireAdminAuth, async (req, res) => {\n    try {\n      const validatedData = insertPagamentoSchema.parse(req.body);\n      const pagamento = await storage.createPagamento(validatedData);\n      \n      // Sincronização automática com sistema principal - buscar aluno para obter filialId\n      if (validatedData.alunoId) {\n        const aluno = await storage.getAluno(validatedData.alunoId);\n        if (aluno && aluno.filialId) {\n          await addToSync(aluno.filialId, 'pagamento', 'create', pagamento);\n        }\n      }\n      \n      res.status(201).json(pagamento);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating pagamento:\", error);\n      res.status(500).json({ message: \"Failed to create pagamento\" });\n    }\n  });\n\n  app.delete(\"/api/pagamentos/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      \n      // Buscar pagamento antes de deletar para sincronização\n      const pagamentos = await storage.getPagamentos();\n      const pagamento = pagamentos.find(p => p.id === id);\n      if (pagamento && pagamento.alunoId) {\n        const aluno = await storage.getAluno(pagamento.alunoId);\n        if (aluno && aluno.filialId) {\n          await addToSync(aluno.filialId, 'pagamento', 'delete', { id });\n        }\n      }\n      \n      await storage.deletePagamento(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting pagamento:\", error);\n      res.status(500).json({ message: \"Failed to delete pagamento\" });\n    }\n  });\n\n  // Filiais routes\n  app.get(\"/api/filiais\", requireAdminAuthOrResponsavel, async (req, res) => {\n    try {\n      const filiais = await storage.getFiliais();\n      res.json(filiais);\n    } catch (error) {\n      console.error(\"Error fetching filiais:\", error);\n      res.status(500).json({ message: \"Failed to fetch filiais\" });\n    }\n  });\n\n  app.get(\"/api/filiais/detalhadas\", requireAdminAuth, async (req, res) => {\n    try {\n      const filiais = await storage.getFiliaisDetalhadas();\n      res.json(filiais);\n    } catch (error) {\n      console.error(\"Error fetching detailed filiais:\", error);\n      res.status(500).json({ message: \"Failed to fetch detailed filiais\" });\n    }\n  });\n\n  app.get(\"/api/filiais/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const filial = await storage.getFilial(id);\n      if (!filial) {\n        return res.status(404).json({ message: \"Filial not found\" });\n      }\n      res.json(filial);\n    } catch (error) {\n      console.error(\"Error fetching filial:\", error);\n      res.status(500).json({ message: \"Failed to fetch filial\" });\n    }\n  });\n\n  app.post(\"/api/filiais\", requireAdminAuth, async (req, res) => {\n    try {\n      const validatedData = insertFilialSchema.parse(req.body);\n      const filial = await storage.createFilial(validatedData);\n      res.status(201).json(filial);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating filial:\", error);\n      res.status(500).json({ message: \"Failed to create filial\" });\n    }\n  });\n\n  app.put(\"/api/filiais/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertFilialSchema.partial().parse(req.body);\n      const filial = await storage.updateFilial(id, validatedData);\n      res.json(filial);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating filial:\", error);\n      res.status(500).json({ message: \"Failed to update filial\" });\n    }\n  });\n\n  app.delete(\"/api/filiais/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteFilial(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting filial:\", error);\n      res.status(500).json({ message: \"Failed to delete filial\" });\n    }\n  });\n\n  // Portal de Responsáveis - Endpoints independentes\n  app.post(\"/api/responsaveis/cadastro\", async (req, res) => {\n    try {\n      const validatedData = insertResponsavelSchema.parse(req.body);\n      \n      // Verificar se email já existe\n      const existingResponsavel = await storage.getResponsavelByEmail(validatedData.email);\n      if (existingResponsavel) {\n        return res.status(400).json({ message: \"Email já está em uso\" });\n      }\n\n      const responsavel = await storage.createResponsavel(validatedData);\n      res.status(201).json({ id: responsavel.id, nome: responsavel.nome, email: responsavel.email });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Dados inválidos\", errors: error.errors });\n      }\n      console.error(\"Error creating responsavel:\", error);\n      res.status(500).json({ message: \"Erro ao criar conta\" });\n    }\n  });\n\n  app.post(\"/api/responsaveis/login\", async (req, res) => {\n    try {\n      const { email, senha } = req.body;\n      \n      if (!email || !senha) {\n        return res.status(400).json({ message: \"Email e senha são obrigatórios\" });\n      }\n\n      const responsavel = await storage.authenticateResponsavel(email, senha);\n      if (!responsavel) {\n        return res.status(401).json({ message: \"Email ou senha incorretos\" });\n      }\n\n      // Configurar sessão\n      req.session.responsavelId = responsavel.id;\n      res.json({ id: responsavel.id, nome: responsavel.nome, email: responsavel.email });\n    } catch (error) {\n      console.error(\"Error authenticating responsavel:\", error);\n      res.status(500).json({ message: \"Erro no login\" });\n    }\n  });\n\n  app.get(\"/api/responsaveis/me\", async (req, res) => {\n    try {\n      const responsavelId = req.session?.responsavelId;\n      if (!responsavelId) {\n        return res.status(401).json({ message: \"Não autenticado\" });\n      }\n\n      const responsavelComAlunos = await storage.getResponsavelWithAlunos(responsavelId);\n      if (!responsavelComAlunos) {\n        return res.status(404).json({ message: \"Responsável não encontrado\" });\n      }\n\n      res.json(responsavelComAlunos);\n    } catch (error) {\n      console.error(\"Error fetching responsavel:\", error);\n      res.status(500).json({ message: \"Erro ao buscar dados\" });\n    }\n  });\n\n  app.post(\"/api/responsaveis/logout\", async (req, res) => {\n    try {\n      req.session.destroy((err) => {\n        if (err) {\n          return res.status(500).json({ message: \"Erro ao fazer logout\" });\n        }\n        res.json({ message: \"Logout realizado com sucesso\" });\n      });\n    } catch (error) {\n      console.error(\"Error logging out responsavel:\", error);\n      res.status(500).json({ message: \"Erro ao fazer logout\" });\n    }\n  });\n\n  // Endpoints para eventos no portal\n  app.get(\"/api/portal/eventos\", async (req, res) => {\n    try {\n      const eventos = await storage.getEventos();\n      res.json(eventos);\n    } catch (error) {\n      console.error(\"Error fetching eventos:\", error);\n      res.status(500).json({ message: \"Erro ao buscar eventos\" });\n    }\n  });\n\n  app.post(\"/api/portal/eventos/:id/inscricao\", async (req, res) => {\n    try {\n      const responsavelId = req.session?.responsavelId;\n      if (!responsavelId) {\n        return res.status(401).json({ message: \"Não autenticado\" });\n      }\n\n      const eventoId = parseInt(req.params.id);\n      const { alunoId, observacoes } = req.body;\n\n      const inscricao = await storage.inscreveAlunoEvento({\n        eventoId,\n        alunoId,\n        observacoes,\n      });\n\n      res.status(201).json(inscricao);\n    } catch (error) {\n      console.error(\"Error creating inscricao:\", error);\n      res.status(500).json({ message: \"Erro ao inscrever no evento\" });\n    }\n  });\n\n  // Endpoints para uniformes no portal\n  app.get(\"/api/portal/uniformes\", async (req, res) => {\n    try {\n      const uniformes = await storage.getUniformes();\n      res.json(uniformes);\n    } catch (error) {\n      console.error(\"Error fetching uniformes:\", error);\n      res.status(500).json({ message: \"Erro ao buscar uniformes\" });\n    }\n  });\n\n  app.post(\"/api/portal/uniformes/:id/comprar\", async (req, res) => {\n    try {\n      const responsavelId = req.session?.responsavelId;\n      if (!responsavelId) {\n        return res.status(401).json({ message: \"Não autenticado\" });\n      }\n\n      const uniformeId = parseInt(req.params.id);\n      const { alunoId, tamanho, cor, quantidade, preco } = req.body;\n\n      const compra = await storage.comprarUniforme({\n        uniformeId,\n        alunoId,\n        tamanho,\n        cor,\n        quantidade,\n        preco,\n      });\n\n      res.status(201).json(compra);\n    } catch (error) {\n      console.error(\"Error creating compra uniforme:\", error);\n      res.status(500).json({ message: \"Erro ao comprar uniforme\" });\n    }\n  });\n\n  // Endpoints para notificações no portal\n  app.get(\"/api/portal/notificacoes\", async (req, res) => {\n    try {\n      const responsavelId = req.session?.responsavelId;\n      if (!responsavelId) {\n        return res.status(401).json({ message: \"Não autenticado\" });\n      }\n\n      const notificacoes = await storage.getNotificacoesByResponsavel(responsavelId);\n      res.json(notificacoes);\n    } catch (error) {\n      console.error(\"Error fetching notificacoes:\", error);\n      res.status(500).json({ message: \"Erro ao buscar notificações\" });\n    }\n  });\n\n  app.patch(\"/api/portal/notificacoes/:id/lida\", async (req, res) => {\n    try {\n      const responsavelId = req.session?.responsavelId;\n      if (!responsavelId) {\n        return res.status(401).json({ message: \"Não autenticado\" });\n      }\n\n      const notificacaoId = parseInt(req.params.id);\n      await storage.marcarNotificacaoLida(notificacaoId);\n      res.json({ message: \"Notificação marcada como lida\" });\n    } catch (error) {\n      console.error(\"Error marking notificacao as read:\", error);\n      res.status(500).json({ message: \"Erro ao marcar notificação como lida\" });\n    }\n  });\n\n  // Presenças routes\n  app.get(\"/api/presencas/:turmaId/:data\", requireAdminAuth, async (req, res) => {\n    try {\n      const turmaId = parseInt(req.params.turmaId);\n      const data = req.params.data;\n      const presencas = await storage.getPresencasByTurmaData(turmaId, data);\n      res.json(presencas);\n    } catch (error) {\n      console.error(\"Error fetching presenças:\", error);\n      res.status(500).json({ message: \"Failed to fetch presenças\" });\n    }\n  });\n\n  app.post(\"/api/presencas/lote\", requireAdminAuth, async (req, res) => {\n    try {\n      const { presencas } = req.body;\n      if (!Array.isArray(presencas)) {\n        return res.status(400).json({ message: \"Presencas must be an array\" });\n      }\n      const novasPresencas = await storage.registrarPresencas(presencas);\n      \n      // Sincronização automática com sistema principal - buscar turma para obter filialId\n      if (presencas.length > 0) {\n        const turmaId = presencas[0].turmaId;\n        const turmas = await storage.getTurmas();\n        const turma = turmas.find(t => t.id === turmaId);\n        if (turma && turma.filialId) {\n          await addToSync(turma.filialId, 'presenca', 'create', novasPresencas);\n        }\n      }\n      \n      res.status(201).json(novasPresencas);\n    } catch (error) {\n      console.error(\"Error registering presenças:\", error);\n      res.status(500).json({ message: \"Failed to register presenças\" });\n    }\n  });\n\n  app.get(\"/api/presencas/detalhadas\", requireAdminAuth, async (req, res) => {\n    try {\n      const presencas = await storage.getPresencasDetalhadas();\n      res.json(presencas);\n    } catch (error) {\n      console.error(\"Error fetching detailed presencas:\", error);\n      res.status(500).json({ message: \"Failed to fetch detailed presencas\" });\n    }\n  });\n\n  // Pacotes de treino routes\n  app.get(\"/api/pacotes-treino\", async (req, res) => {\n    try {\n      const pacotes = await storage.getPacotesTreino();\n      res.json(pacotes);\n    } catch (error) {\n      console.error(\"Error fetching pacotes treino:\", error);\n      res.status(500).json({ message: \"Failed to fetch pacotes treino\" });\n    }\n  });\n\n  app.post(\"/api/pacotes-treino\", requireAdminAuth, async (req, res) => {\n    try {\n      const pacote = await storage.createPacoteTreino(req.body);\n      res.json(pacote);\n    } catch (error) {\n      console.error(\"Error creating pacote treino:\", error);\n      res.status(500).json({ message: \"Failed to create pacote treino\" });\n    }\n  });\n\n  app.get(\"/api/assinaturas-pacotes\", async (req, res) => {\n    try {\n      const assinaturas = await storage.getAssinaturasPacotes();\n      res.json(assinaturas);\n    } catch (error) {\n      console.error(\"Error fetching assinaturas pacotes:\", error);\n      res.status(500).json({ message: \"Failed to fetch assinaturas pacotes\" });\n    }\n  });\n\n  app.post(\"/api/assinaturas-pacotes\", async (req, res) => {\n    try {\n      const assinatura = await storage.criarAssinaturaPacote(req.body);\n      res.json(assinatura);\n    } catch (error) {\n      console.error(\"Error creating assinatura pacote:\", error);\n      res.status(500).json({ message: \"Failed to create assinatura pacote\" });\n    }\n  });\n\n  // Physical Evaluation Routes - Categorias de Testes\n  app.get(\"/api/categorias-testes\", requireAdminAuth, async (req, res) => {\n    try {\n      const categorias = await storage.getCategoriasTestes();\n      res.json(categorias);\n    } catch (error) {\n      console.error(\"Error fetching categorias testes:\", error);\n      res.status(500).json({ message: \"Failed to fetch categorias testes\" });\n    }\n  });\n\n  app.post(\"/api/categorias-testes\", requireAdminAuth, async (req, res) => {\n    try {\n      const validatedData = insertCategoriaTesteSchema.parse(req.body);\n      const categoria = await storage.createCategoriaTeste(validatedData);\n      res.status(201).json(categoria);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating categoria teste:\", error);\n      res.status(500).json({ message: \"Failed to create categoria teste\" });\n    }\n  });\n\n  app.put(\"/api/categorias-testes/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertCategoriaTesteSchema.partial().parse(req.body);\n      const categoria = await storage.updateCategoriaTeste(id, validatedData);\n      res.json(categoria);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating categoria teste:\", error);\n      res.status(500).json({ message: \"Failed to update categoria teste\" });\n    }\n  });\n\n  app.delete(\"/api/categorias-testes/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteCategoriaTeste(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting categoria teste:\", error);\n      res.status(500).json({ message: \"Failed to delete categoria teste\" });\n    }\n  });\n\n  // Testes Routes\n  app.get(\"/api/testes\", requireAdminAuth, async (req, res) => {\n    try {\n      const testes = await storage.getTestes();\n      res.json(testes);\n    } catch (error) {\n      console.error(\"Error fetching testes:\", error);\n      res.status(500).json({ message: \"Failed to fetch testes\" });\n    }\n  });\n\n  app.get(\"/api/testes/categoria/:categoriaId\", requireAdminAuth, async (req, res) => {\n    try {\n      const categoriaId = parseInt(req.params.categoriaId);\n      const testes = await storage.getTestesByCategoria(categoriaId);\n      res.json(testes);\n    } catch (error) {\n      console.error(\"Error fetching testes by categoria:\", error);\n      res.status(500).json({ message: \"Failed to fetch testes by categoria\" });\n    }\n  });\n\n  app.post(\"/api/testes\", requireAdminAuth, async (req, res) => {\n    try {\n      const validatedData = insertTesteSchema.parse(req.body);\n      const teste = await storage.createTeste(validatedData);\n      res.status(201).json(teste);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating teste:\", error);\n      res.status(500).json({ message: \"Failed to create teste\" });\n    }\n  });\n\n  app.put(\"/api/testes/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertTesteSchema.partial().parse(req.body);\n      const teste = await storage.updateTeste(id, validatedData);\n      res.json(teste);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating teste:\", error);\n      res.status(500).json({ message: \"Failed to update teste\" });\n    }\n  });\n\n  app.delete(\"/api/testes/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteTeste(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting teste:\", error);\n      res.status(500).json({ message: \"Failed to delete teste\" });\n    }\n  });\n\n  // Avaliacoes Fisicas Routes\n  app.get(\"/api/avaliacoes-fisicas\", requireAdminAuth, async (req, res) => {\n    try {\n      const avaliacoes = await storage.getAvaliacoesFisicas();\n      res.json(avaliacoes);\n    } catch (error) {\n      console.error(\"Error fetching avaliacoes fisicas:\", error);\n      res.status(500).json({ message: \"Failed to fetch avaliacoes fisicas\" });\n    }\n  });\n\n  app.get(\"/api/avaliacoes-fisicas/aluno/:alunoId\", requireAdminAuth, async (req, res) => {\n    try {\n      const alunoId = parseInt(req.params.alunoId);\n      const avaliacoes = await storage.getAvaliacoesByAluno(alunoId);\n      res.json(avaliacoes);\n    } catch (error) {\n      console.error(\"Error fetching avaliacoes by aluno:\", error);\n      res.status(500).json({ message: \"Failed to fetch avaliacoes by aluno\" });\n    }\n  });\n\n  app.get(\"/api/avaliacoes-fisicas/filial/:filialId\", requireAdminAuth, async (req, res) => {\n    try {\n      const filialId = parseInt(req.params.filialId);\n      const avaliacoes = await storage.getAvaliacoesByFilial(filialId);\n      res.json(avaliacoes);\n    } catch (error) {\n      console.error(\"Error fetching avaliacoes by filial:\", error);\n      res.status(500).json({ message: \"Failed to fetch avaliacoes by filial\" });\n    }\n  });\n\n  app.post(\"/api/avaliacoes-fisicas\", requireAdminAuth, async (req, res) => {\n    try {\n      const validatedData = insertAvaliacaoFisicaSchema.parse(req.body);\n      const avaliacao = await storage.createAvaliacaoFisica(validatedData);\n      \n      // Sincronização automática com sistema principal\n      if (validatedData.alunoId) {\n        const aluno = await storage.getAluno(validatedData.alunoId);\n        if (aluno && aluno.filialId) {\n          await addToSync(aluno.filialId, 'avaliacao', 'create', avaliacao);\n        }\n      }\n      \n      res.status(201).json(avaliacao);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating avaliacao fisica:\", error);\n      res.status(500).json({ message: \"Failed to create avaliacao fisica\" });\n    }\n  });\n\n  app.put(\"/api/avaliacoes-fisicas/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertAvaliacaoFisicaSchema.partial().parse(req.body);\n      const avaliacao = await storage.updateAvaliacaoFisica(id, validatedData);\n      res.json(avaliacao);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating avaliacao fisica:\", error);\n      res.status(500).json({ message: \"Failed to update avaliacao fisica\" });\n    }\n  });\n\n  app.delete(\"/api/avaliacoes-fisicas/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteAvaliacaoFisica(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting avaliacao fisica:\", error);\n      res.status(500).json({ message: \"Failed to delete avaliacao fisica\" });\n    }\n  });\n\n  // Resultados Testes Routes\n  app.get(\"/api/resultados-testes\", requireAdminAuth, async (req, res) => {\n    try {\n      const resultados = await storage.getResultadosTestes();\n      res.json(resultados);\n    } catch (error) {\n      console.error(\"Error fetching resultados testes:\", error);\n      res.status(500).json({ message: \"Failed to fetch resultados testes\" });\n    }\n  });\n\n  app.get(\"/api/resultados-testes/avaliacao/:avaliacaoId\", requireAdminAuth, async (req, res) => {\n    try {\n      const avaliacaoId = parseInt(req.params.avaliacaoId);\n      const resultados = await storage.getResultadosByAvaliacao(avaliacaoId);\n      res.json(resultados);\n    } catch (error) {\n      console.error(\"Error fetching resultados by avaliacao:\", error);\n      res.status(500).json({ message: \"Failed to fetch resultados by avaliacao\" });\n    }\n  });\n\n  app.post(\"/api/resultados-testes\", requireAdminAuth, async (req, res) => {\n    try {\n      const validatedData = insertResultadoTesteSchema.parse(req.body);\n      const resultado = await storage.createResultadoTeste(validatedData);\n      res.status(201).json(resultado);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating resultado teste:\", error);\n      res.status(500).json({ message: \"Failed to create resultado teste\" });\n    }\n  });\n\n  app.put(\"/api/resultados-testes/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertResultadoTesteSchema.partial().parse(req.body);\n      const resultado = await storage.updateResultadoTeste(id, validatedData);\n      res.json(resultado);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating resultado teste:\", error);\n      res.status(500).json({ message: \"Failed to update resultado teste\" });\n    }\n  });\n\n  app.delete(\"/api/resultados-testes/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteResultadoTeste(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting resultado teste:\", error);\n      res.status(500).json({ message: \"Failed to delete resultado teste\" });\n    }\n  });\n\n  // Metas Alunos Routes\n  app.get(\"/api/metas-alunos\", requireAdminAuth, async (req, res) => {\n    try {\n      const metas = await storage.getMetasAlunos();\n      res.json(metas);\n    } catch (error) {\n      console.error(\"Error fetching metas alunos:\", error);\n      res.status(500).json({ message: \"Failed to fetch metas alunos\" });\n    }\n  });\n\n  app.get(\"/api/metas-alunos/aluno/:alunoId\", requireAdminAuth, async (req, res) => {\n    try {\n      const alunoId = parseInt(req.params.alunoId);\n      const metas = await storage.getMetasByAluno(alunoId);\n      res.json(metas);\n    } catch (error) {\n      console.error(\"Error fetching metas by aluno:\", error);\n      res.status(500).json({ message: \"Failed to fetch metas by aluno\" });\n    }\n  });\n\n  app.post(\"/api/metas-alunos\", requireAdminAuth, async (req, res) => {\n    try {\n      const validatedData = insertMetaAlunoSchema.parse(req.body);\n      const meta = await storage.createMetaAluno(validatedData);\n      res.status(201).json(meta);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating meta aluno:\", error);\n      res.status(500).json({ message: \"Failed to create meta aluno\" });\n    }\n  });\n\n  app.put(\"/api/metas-alunos/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertMetaAlunoSchema.partial().parse(req.body);\n      const meta = await storage.updateMetaAluno(id, validatedData);\n      res.json(meta);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating meta aluno:\", error);\n      res.status(500).json({ message: \"Failed to update meta aluno\" });\n    }\n  });\n\n  app.delete(\"/api/metas-alunos/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteMetaAluno(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting meta aluno:\", error);\n      res.status(500).json({ message: \"Failed to delete meta aluno\" });\n    }\n  });\n\n  // Combos de Aulas Routes\n  app.get(\"/api/combos-aulas\", requireAdminAuth, async (req, res) => {\n    try {\n      const combos = await storage.getCombosAulas();\n      res.json(combos);\n    } catch (error) {\n      console.error(\"Error fetching combos aulas:\", error);\n      res.status(500).json({ message: \"Failed to fetch combos aulas\" });\n    }\n  });\n\n  app.post(\"/api/combos-aulas\", requireAdminAuth, async (req, res) => {\n    try {\n      const combo = await storage.createComboAulas(req.body);\n      res.status(201).json(combo);\n    } catch (error) {\n      console.error(\"Error creating combo aulas:\", error);\n      res.status(500).json({ message: \"Failed to create combo aulas\" });\n    }\n  });\n\n  app.put(\"/api/combos-aulas/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const combo = await storage.updateComboAulas(id, req.body);\n      res.json(combo);\n    } catch (error) {\n      console.error(\"Error updating combo aulas:\", error);\n      res.status(500).json({ message: \"Failed to update combo aulas\" });\n    }\n  });\n\n  app.delete(\"/api/combos-aulas/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteComboAulas(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting combo aulas:\", error);\n      res.status(500).json({ message: \"Failed to delete combo aulas\" });\n    }\n  });\n\n  // Sync management routes\n  app.get(\"/api/sync/status\", requireAdminAuth, async (req, res) => {\n    try {\n      const { syncManager } = await import(\"./sync\");\n      const stats = syncManager.getSyncStats();\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error getting sync status:\", error);\n      res.status(500).json({ message: \"Failed to get sync status\" });\n    }\n  });\n\n  app.post(\"/api/sync/force\", requireAdminAuth, async (req, res) => {\n    try {\n      const { syncManager } = await import(\"./sync\");\n      await syncManager.forceSyncNow();\n      res.json({ message: \"Sync forced successfully\" });\n    } catch (error) {\n      console.error(\"Error forcing sync:\", error);\n      res.status(500).json({ message: \"Failed to force sync\" });\n    }\n  });\n\n  // Unit Manager Authentication Routes\n  app.post(\"/api/unidade/cadastro\", async (req, res) => {\n    try {\n      const validatedData = insertGestorUnidadeSchema.parse(req.body);\n      \n      // Check if email already exists\n      const existingGestor = await storage.getGestorUnidadeByEmail(validatedData.email);\n      if (existingGestor) {\n        return res.status(400).json({ message: \"Email já cadastrado\" });\n      }\n\n      const gestor = await storage.createGestorUnidade(validatedData);\n      res.status(201).json({ message: \"Cadastro realizado com sucesso! Aguarde aprovação do administrador.\" });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Dados inválidos\", errors: error.errors });\n      }\n      console.error(\"Error creating gestor unidade:\", error);\n      res.status(500).json({ message: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/unidade/login\", async (req, res) => {\n    try {\n      const validatedData = loginGestorSchema.parse(req.body);\n      \n      const gestor = await storage.authenticateGestorUnidade(validatedData.email, validatedData.senha);\n      if (!gestor) {\n        return res.status(401).json({ message: \"Credenciais inválidas ou conta inativa\" });\n      }\n\n      // Store in session\n      req.session.gestorUnidadeId = gestor.id;\n      req.session.filialId = gestor.filialId;\n      \n      res.json({ \n        message: \"Login realizado com sucesso\", \n        filialId: gestor.filialId,\n        gestorId: gestor.id \n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Dados inválidos\", errors: error.errors });\n      }\n      console.error(\"Error authenticating gestor unidade:\", error);\n      res.status(500).json({ message: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/unidade/logout\", (req, res) => {\n    req.session.gestorUnidadeId = undefined;\n    req.session.filialId = undefined;\n    res.json({ message: \"Logout realizado com sucesso\" });\n  });\n\n  // Complete Unit and Manager Registration\n  app.post(\"/api/unidade/cadastro-completo\", async (req, res) => {\n    try {\n      const { gestor, unidade } = req.body;\n      \n      // Validate gestor data\n      const validatedGestor = z.object({\n        nome: z.string().min(1),\n        email: z.string().email(),\n        senha: z.string().min(6),\n        telefone: z.string().optional(),\n      }).parse(gestor);\n      \n      // Validate unidade data  \n      const validatedUnidade = insertFilialSchema.parse(unidade);\n      \n      // Check if email already exists\n      const existingGestor = await storage.getGestorUnidadeByEmail(validatedGestor.email);\n      if (existingGestor) {\n        return res.status(400).json({ message: \"Email já cadastrado\" });\n      }\n\n      // Create the unit first\n      const novaUnidade = await storage.createFilial(validatedUnidade);\n      \n      // Create the manager with the new unit ID\n      const novoGestor = await storage.createGestorUnidade({\n        ...validatedGestor,\n        filialId: novaUnidade.id,\n        ativo: true,\n        papel: \"gestor\",\n      });\n      \n      res.status(201).json({ \n        message: \"Unidade e gestor cadastrados com sucesso!\",\n        unidadeId: novaUnidade.id,\n        gestorId: novoGestor.id\n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Dados inválidos\", errors: error.errors });\n      }\n      console.error(\"Error creating complete registration:\", error);\n      res.status(500).json({ message: \"Erro interno do servidor\" });\n    }\n  });\n\n  // ========== ROUTES DO PORTAL DA UNIDADE ==========\n  \n  // Login para gestores de unidade\n  app.post(\"/api/auth/unidade/login\", async (req, res) => {\n    try {\n      const { email, senha } = loginGestorSchema.parse(req.body);\n      \n      const gestor = await storage.authenticateGestorUnidade(email, senha);\n      if (!gestor) {\n        return res.status(401).json({ message: \"Email ou senha incorretos\" });\n      }\n\n      // Atualizar último login\n      await storage.updateGestorUltimoLogin(gestor.id);\n\n      // Armazenar na sessão\n      req.session.gestorUnidadeId = gestor.id;\n      req.session.filialId = gestor.filialId;\n\n      res.json({\n        gestor: {\n          id: gestor.id,\n          nome: gestor.nome,\n          email: gestor.email,\n          filialId: gestor.filialId,\n          papel: gestor.papel\n        },\n        filial: gestor.filial\n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Dados inválidos\", errors: error.errors });\n      }\n      console.error(\"Error in unidade login:\", error);\n      res.status(500).json({ message: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Logout para gestores de unidade\n  app.post(\"/api/auth/unidade/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ message: \"Erro ao fazer logout\" });\n      }\n      res.json({ message: \"Logout realizado com sucesso\" });\n    });\n  });\n\n  // Get gestor unidade by ID\n  app.get(\"/api/gestores-unidade/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const gestor = await storage.getGestorUnidade(id);\n      if (!gestor) {\n        return res.status(404).json({ message: \"Gestor not found\" });\n      }\n      res.json(gestor);\n    } catch (error) {\n      console.error(\"Error fetching gestor unidade:\", error);\n      res.status(500).json({ message: \"Failed to fetch gestor\" });\n    }\n  });\n\n  // Check unit authentication status\n  app.get(\"/api/unidade/auth/check\", async (req, res) => {\n    if (req.session && req.session.gestorUnidadeId && req.session.filialId) {\n      try {\n        const gestor = await storage.getGestorUnidade(req.session.gestorUnidadeId);\n        if (gestor) {\n          res.json({\n            authenticated: true,\n            gestor: {\n              id: gestor.id,\n              nome: gestor.nome,\n              email: gestor.email,\n              filialId: gestor.filialId\n            }\n          });\n        } else {\n          res.json({ authenticated: false });\n        }\n      } catch (error) {\n        res.json({ authenticated: false });\n      }\n    } else {\n      res.json({ authenticated: false });\n    }\n  });\n\n  // Dashboard metrics da unidade\n  app.get(\"/api/unidade/dashboard/metrics/:filialId\", isGestorUnidadeAuthenticated, async (req, res) => {\n    try {\n      const filialId = parseInt(req.params.filialId);\n      \n      // Verificar se o gestor tem acesso a esta filial\n      if (req.session.filialId !== filialId) {\n        return res.status(403).json({ message: \"Acesso negado a esta unidade\" });\n      }\n\n      const alunos = await storage.getAlunosByFilial(filialId);\n      const professores = await storage.getProfessoresByFilial(filialId);\n      const turmas = await storage.getTurmasByFilial(filialId);\n      \n      // Calcular receita mensal (pagamentos do mês atual dos alunos da filial)\n      const agora = new Date();\n      const mesAtual = agora.getFullYear() + \"-\" + String(agora.getMonth() + 1).padStart(2, '0');\n      \n      let receitaMensal = 0;\n      for (const aluno of alunos) {\n        const pagamentos = await storage.getPagamentosByAluno(aluno.id);\n        const pagamentosMes = pagamentos.filter(p => p.mesReferencia === mesAtual);\n        receitaMensal += pagamentosMes.reduce((sum, p) => sum + parseFloat(p.valor.toString()), 0);\n      }\n\n      const metrics = {\n        totalAlunos: alunos.length,\n        totalProfessores: professores.length,\n        totalTurmas: turmas.length,\n        receitaMensal\n      };\n\n      res.json(metrics);\n    } catch (error) {\n      console.error(\"Error fetching unidade dashboard metrics:\", error);\n      res.status(500).json({ message: \"Erro ao buscar métricas da unidade\" });\n    }\n  });\n\n  // Alunos por filial (para o portal da unidade)\n  app.get(\"/api/unidade/alunos/:filialId\", isGestorUnidadeAuthenticated, async (req, res) => {\n    try {\n      const filialId = parseInt(req.params.filialId);\n      \n      // Verificar se o gestor tem acesso a esta filial\n      if (req.session.filialId !== filialId) {\n        return res.status(403).json({ message: \"Acesso negado a esta unidade\" });\n      }\n\n      const alunos = await storage.getAlunosByFilial(filialId);\n      \n      // Adicionar informações de sincronização\n      const alunosComSync = alunos.map(aluno => ({\n        ...aluno,\n        sincronizado: true, // Por enquanto, assumir que todos estão sincronizados\n        ultimaSync: new Date().toISOString()\n      }));\n\n      res.json(alunosComSync);\n    } catch (error) {\n      console.error(\"Error fetching alunos by filial:\", error);\n      res.status(500).json({ message: \"Erro ao buscar alunos da unidade\" });\n    }\n  });\n\n  // Professores por filial (para o portal da unidade)\n  app.get(\"/api/unidade/professores/:filialId\", isGestorUnidadeAuthenticated, async (req, res) => {\n    try {\n      const filialId = parseInt(req.params.filialId);\n      \n      // Verificar se o gestor tem acesso a esta filial\n      if (req.session.filialId !== filialId) {\n        return res.status(403).json({ message: \"Acesso negado a esta unidade\" });\n      }\n\n      const professores = await storage.getProfessoresByFilial(filialId);\n      res.json(professores);\n    } catch (error) {\n      console.error(\"Error fetching professores by filial:\", error);\n      res.status(500).json({ message: \"Erro ao buscar professores da unidade\" });\n    }\n  });\n\n  // Turmas por filial (para o portal da unidade)\n  app.get(\"/api/unidade/turmas/:filialId\", isGestorUnidadeAuthenticated, async (req, res) => {\n    try {\n      const filialId = parseInt(req.params.filialId);\n      \n      // Verificar se o gestor tem acesso a esta filial\n      if (req.session.filialId !== filialId) {\n        return res.status(403).json({ message: \"Acesso negado a esta unidade\" });\n      }\n\n      const turmas = await storage.getTurmasByFilial(filialId);\n      res.json(turmas);\n    } catch (error) {\n      console.error(\"Error fetching turmas by filial:\", error);\n      res.status(500).json({ message: \"Erro ao buscar turmas da unidade\" });\n    }\n  });\n\n  // Criar aluno com sincronização automática\n  app.post(\"/api/unidade/alunos\", isGestorUnidadeAuthenticated, async (req, res) => {\n    try {\n      const validatedData = insertAlunoSchema.parse(req.body);\n      \n      // Garantir que o aluno seja criado na filial correta\n      const alunoData = {\n        ...validatedData,\n        filialId: req.session.filialId\n      };\n\n      const aluno = await storage.createAluno(alunoData);\n      \n      // Adicionar à fila de sincronização\n      await addToSync(\n        req.session.filialId!,\n        'aluno',\n        'create',\n        aluno\n      );\n\n      res.status(201).json(aluno);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating aluno in unidade:\", error);\n      res.status(500).json({ message: \"Failed to create aluno\" });\n    }\n  });\n\n  // Atualizar aluno com sincronização automática\n  app.put(\"/api/unidade/alunos/:id\", isGestorUnidadeAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      \n      // Verificar se o aluno pertence à filial do gestor\n      const alunoExistente = await storage.getAluno(id);\n      if (!alunoExistente || alunoExistente.filialId !== req.session.filialId) {\n        return res.status(403).json({ message: \"Acesso negado a este aluno\" });\n      }\n\n      const validatedData = insertAlunoSchema.partial().parse(req.body);\n      const aluno = await storage.updateAluno(id, validatedData);\n      \n      // Adicionar à fila de sincronização\n      await addToSync(\n        req.session.filialId!,\n        'aluno',\n        'update',\n        aluno\n      );\n\n      res.json(aluno);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating aluno in unidade:\", error);\n      res.status(500).json({ message: \"Failed to update aluno\" });\n    }\n  });\n\n  // Criar professor com sincronização automática\n  app.post(\"/api/unidade/professores\", isGestorUnidadeAuthenticated, async (req, res) => {\n    try {\n      const validatedData = insertProfessorSchema.parse(req.body);\n      \n      // Garantir que o professor seja criado na filial correta\n      const professorData = {\n        ...validatedData,\n        filialId: req.session.filialId\n      };\n\n      const professor = await storage.createProfessor(professorData);\n      \n      // Adicionar à fila de sincronização\n      await addToSync(\n        req.session.filialId!,\n        'professor',\n        'create',\n        professor\n      );\n\n      res.status(201).json(professor);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating professor in unidade:\", error);\n      res.status(500).json({ message: \"Failed to create professor\" });\n    }\n  });\n\n  // Registrar pagamento com sincronização automática\n  app.post(\"/api/unidade/pagamentos\", isGestorUnidadeAuthenticated, async (req, res) => {\n    try {\n      const validatedData = insertPagamentoSchema.parse(req.body);\n      \n      // Verificar se o aluno pertence à filial do gestor\n      if (!validatedData.alunoId) {\n        return res.status(400).json({ message: \"ID do aluno é obrigatório\" });\n      }\n      \n      const aluno = await storage.getAluno(validatedData.alunoId);\n      if (!aluno || aluno.filialId !== req.session.filialId) {\n        return res.status(403).json({ message: \"Acesso negado a este aluno\" });\n      }\n\n      const pagamento = await storage.createPagamento(validatedData);\n      \n      // Adicionar à fila de sincronização\n      await addToSync(\n        req.session.filialId!,\n        'pagamento',\n        'create',\n        pagamento\n      );\n\n      res.status(201).json(pagamento);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error creating pagamento in unidade:\", error);\n      res.status(500).json({ message: \"Failed to create pagamento\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":58986},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/pages/Turmas.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { UsersRound, Search, Edit, Trash2, Clock, DollarSign, UserSquare2, Building2, Plus, CheckCircle2, Users } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { TurmaWithProfessor } from \"@shared/schema\";\nimport TurmaForm from \"@/components/forms/TurmaForm\";\n\nexport default function Turmas() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingTurma, setEditingTurma] = useState<TurmaWithProfessor | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: turmas, isLoading } = useQuery<TurmaWithProfessor[]>({\n    queryKey: [\"/api/turmas\"],\n  });\n\n  const deleteTurmaMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/turmas/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/turmas\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Turma removida com sucesso.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao remover turma. Tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredTurmas = turmas?.filter((turma) =>\n    turma.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    turma.categoria.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    turma.professor?.nome.toLowerCase().includes(searchTerm.toLowerCase())\n  ) || [];\n\n  const handleEdit = (turma: TurmaWithProfessor) => {\n    setEditingTurma(turma);\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = (id: number) => {\n    if (confirm(\"Tem certeza que deseja remover esta turma?\")) {\n      deleteTurmaMutation.mutate(id);\n    }\n  };\n\n  const handleDialogClose = () => {\n    setIsDialogOpen(false);\n    setEditingTurma(null);\n  };\n\n  const formatCurrency = (value: string | null) => {\n    if (!value) return \"-\";\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(Number(value));\n  };\n\n  const getCategoryColor = (categoria: string) => {\n    const colors = {\n      \"Infantil\": \"bg-blue-500/10 text-blue-700 border-blue-500/20\",\n      \"Juvenil\": \"bg-green-500/10 text-green-700 border-green-500/20\",\n      \"Adulto\": \"bg-purple-500/10 text-purple-700 border-purple-500/20\",\n    };\n    return colors[categoria as keyof typeof colors] || \"bg-muted\";\n  };\n\n  const activeCount = turmas?.filter(t => t.ativo).length || 0;\n  const totalAlunos = turmas?.reduce((total, turma) => total + (turma._count?.matriculas || 0), 0) || 0;\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-4xl font-bold text-foreground mb-2\">Gestão de Turmas</h1>\n          <p className=\"text-muted-foreground text-lg\">Cadastre e gerencie as turmas da escola</p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button \n              data-testid=\"button-nova-turma\"\n              className=\"bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-600/30\"\n            >\n              <UsersRound className=\"w-4 h-4 mr-2\" />\n              Nova Turma\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingTurma ? \"Editar Turma\" : \"Cadastrar Nova Turma\"}\n              </DialogTitle>\n            </DialogHeader>\n            <TurmaForm \n              turma={editingTurma} \n              onSuccess={handleDialogClose}\n            />\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground mb-1\">Total de Turmas</p>\n                <p className=\"text-3xl font-bold text-foreground\">{turmas?.length || 0}</p>\n              </div>\n              <div className=\"p-3 rounded-xl bg-purple-500/10\">\n                <UsersRound className=\"w-6 h-6 text-purple-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground mb-1\">Turmas Ativas</p>\n                <p className=\"text-3xl font-bold text-green-600\">{activeCount}</p>\n              </div>\n              <div className=\"p-3 rounded-xl bg-green-500/10\">\n                <CheckCircle2 className=\"w-6 h-6 text-green-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground mb-1\">Total de Alunos</p>\n                <p className=\"text-3xl font-bold text-blue-600\">{totalAlunos}</p>\n              </div>\n              <div className=\"p-3 rounded-xl bg-blue-500/10\">\n                <Users className=\"w-6 h-6 text-blue-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <Card className=\"border-border bg-card\">\n        <CardContent className=\"p-6\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5\" />\n            <Input\n              placeholder=\"Buscar por nome, categoria ou professor...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              data-testid=\"input-search-turmas\"\n              className=\"pl-11 h-11 bg-background border-border\"\n            />\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Turmas Table */}\n      <Card className=\"border-border bg-card\">\n        <CardContent className=\"p-6\">\n          {isLoading ? (\n            <div className=\"space-y-4\">\n              {[...Array(5)].map((_, i) => (\n                <div key={i} className=\"flex items-center space-x-4 p-4 border border-border rounded-lg\">\n                  <Skeleton className=\"h-12 w-12 rounded-lg\" />\n                  <div className=\"space-y-2 flex-1\">\n                    <Skeleton className=\"h-4 w-48\" />\n                    <Skeleton className=\"h-3 w-32\" />\n                  </div>\n                  <Skeleton className=\"h-8 w-20\" />\n                </div>\n              ))}\n            </div>\n          ) : filteredTurmas.length === 0 ? (\n            <div className=\"text-center py-16\">\n              <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-muted mb-4\">\n                <UsersRound className=\"w-8 h-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"text-xl font-semibold text-foreground mb-2\">\n                {searchTerm ? \"Nenhuma turma encontrada\" : \"Nenhuma turma cadastrada\"}\n              </h3>\n              <p className=\"text-muted-foreground mb-6 max-w-md mx-auto\">\n                {searchTerm \n                  ? \"Tente buscar com outros termos.\" \n                  : \"Comece cadastrando a primeira turma da escola.\"}\n              </p>\n              {!searchTerm && (\n                <Button \n                  onClick={() => setIsDialogOpen(true)}\n                  className=\"bg-green-600 hover:bg-green-700\"\n                  data-testid=\"button-primeira-turma\"\n                >\n                  <UsersRound className=\"w-4 h-4 mr-2\" />\n                  Cadastrar Primeira Turma\n                </Button>\n              )}\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow className=\"border-border hover:bg-transparent\">\n                    <TableHead className=\"font-semibold\">Turma</TableHead>\n                    <TableHead className=\"font-semibold\">Professor</TableHead>\n                    <TableHead className=\"font-semibold\">Filial</TableHead>\n                    <TableHead className=\"font-semibold\">Alunos</TableHead>\n                    <TableHead className=\"font-semibold\">Horário</TableHead>\n                    <TableHead className=\"font-semibold\">Mensalidade</TableHead>\n                    <TableHead className=\"font-semibold\">Status</TableHead>\n                    <TableHead className=\"text-right font-semibold\">Ações</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredTurmas.map((turma) => (\n                    <TableRow key={turma.id} className=\"border-border hover:bg-muted/50\" data-testid={`row-turma-${turma.id}`}>\n                      <TableCell>\n                        <div className=\"space-y-1\">\n                          <p className=\"font-semibold text-foreground\">{turma.nome}</p>\n                          <Badge className={getCategoryColor(turma.categoria)}>\n                            {turma.categoria}\n                          </Badge>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        {turma.professor ? (\n                          <div className=\"flex items-center\">\n                            <UserSquare2 className=\"w-4 h-4 mr-2 text-muted-foreground\" />\n                            <span className=\"font-medium\">{turma.professor.nome}</span>\n                          </div>\n                        ) : (\n                          <span className=\"text-muted-foreground text-sm\">Sem professor</span>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        {turma.filial ? (\n                          <div className=\"flex items-center\">\n                            <Building2 className=\"w-4 h-4 mr-2 text-muted-foreground\" />\n                            <span>{turma.filial.nome}</span>\n                          </div>\n                        ) : (\n                          <span className=\"text-muted-foreground text-sm\">Sem filial</span>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center\">\n                          <Users className=\"w-4 h-4 mr-2 text-muted-foreground\" />\n                          <span className=\"font-medium\">\n                            {turma._count?.matriculas || 0} / {turma.capacidadeMaxima}\n                          </span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"space-y-1\">\n                          {turma.horario && (\n                            <div className=\"flex items-center text-sm\">\n                              <Clock className=\"w-3.5 h-3.5 mr-1.5 text-muted-foreground\" />\n                              {turma.horario}\n                            </div>\n                          )}\n                          {turma.diasSemana && (\n                            <p className=\"text-xs text-muted-foreground\">{turma.diasSemana}</p>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center font-semibold text-green-600\">\n                          <DollarSign className=\"w-4 h-4 mr-1\" />\n                          {formatCurrency(turma.valorMensalidade)}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge \n                          variant={turma.ativo ? \"default\" : \"secondary\"}\n                          className={turma.ativo ? \"bg-green-600 hover:bg-green-700\" : \"bg-muted\"}\n                        >\n                          {turma.ativo ? \"Ativa\" : \"Inativa\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end space-x-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleEdit(turma)}\n                            data-testid={`button-edit-${turma.id}`}\n                            className=\"hover:bg-blue-50 hover:text-blue-600 hover:border-blue-300\"\n                          >\n                            <Edit className=\"w-4 h-4\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleDelete(turma.id)}\n                            disabled={deleteTurmaMutation.isPending}\n                            data-testid={`button-delete-${turma.id}`}\n                            className=\"hover:bg-red-50 hover:text-red-600 hover:border-red-300\"\n                          >\n                            <Trash2 className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":14479},"client/src/pages/UnidadeProfessores.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { Plus, Search, Edit, Trash2, ArrowLeft, GraduationCap, Building2 } from \"lucide-react\";\nimport { InterLogo } from \"@/components/InterLogo\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport ProfessorForm from \"@/components/forms/ProfessorForm\";\nimport type { Professor, Filial, InsertProfessor } from \"@shared/schema\";\n\nexport default function UnidadeProfessores() {\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [editingProfessor, setEditingProfessor] = useState<Professor | null>(null);\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const { toast } = useToast();\n\n  // Recuperar unidade selecionada\n  const unidadeSelecionada = localStorage.getItem(\"unidade_selecionada\");\n  const filialId = unidadeSelecionada ? parseInt(unidadeSelecionada) : null;\n\n  if (!filialId) {\n    setLocation(\"/login-unidade\");\n    return null;\n  }\n\n  const { data: filial } = useQuery<Filial>({\n    queryKey: [`/api/filiais/${filialId}`],\n  });\n\n  const { data: professores = [], isLoading } = useQuery<Professor[]>({\n    queryKey: [`/api/filiais/${filialId}/professores`],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertProfessor) => {\n      return await apiRequest(\"POST\", \"/api/professores\", {\n        ...data,\n        filialId\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/filiais/${filialId}/professores`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/professores\"] });\n      setDialogOpen(false);\n      toast({\n        title: \"Sucesso\",\n        description: \"Professor cadastrado e sincronizado com a matriz!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao cadastrar professor: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: InsertProfessor) => {\n      if (!editingProfessor) return;\n      return await apiRequest(\"PUT\", `/api/professores/${editingProfessor.id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/filiais/${filialId}/professores`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/professores\"] });\n      setEditingProfessor(null);\n      setDialogOpen(false);\n      toast({\n        title: \"Sucesso\",\n        description: \"Professor atualizado e sincronizado com a matriz!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao atualizar professor: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return await apiRequest(\"DELETE\", `/api/professores/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/filiais/${filialId}/professores`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/professores\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Professor removido e sincronizado com a matriz!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao remover professor: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredProfessores = professores.filter(professor =>\n    professor.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    professor.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    professor.cpf?.includes(searchTerm) ||\n    professor.especialidade?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const handleSubmit = (data: InsertProfessor) => {\n    if (editingProfessor) {\n      updateMutation.mutate(data);\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const openEditDialog = (professor: Professor) => {\n    setEditingProfessor(professor);\n    setDialogOpen(true);\n  };\n\n  const openCreateDialog = () => {\n    setEditingProfessor(null);\n    setDialogOpen(true);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <div className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center gap-4\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setLocation(\"/unidade/sistema\")}\n                className=\"flex items-center gap-2\"\n              >\n                <ArrowLeft className=\"w-4 h-4\" />\n                Voltar ao Sistema\n              </Button>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-5 h-5 bg-blue-600 rounded flex items-center justify-center p-0.5\">\n                  <InterLogo size={14} />\n                </div>\n                <div>\n                  <h1 className=\"text-xl font-bold\">Gestão de Professores</h1>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {filial?.nome} - {professores.length} professores cadastrados\n                  </p>\n                </div>\n              </div>\n            </div>\n            <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n              <DialogTrigger asChild>\n                <Button onClick={openCreateDialog} className=\"flex items-center gap-2\">\n                  <Plus className=\"w-4 h-4\" />\n                  Novo Professor\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n                <DialogHeader>\n                  <DialogTitle>\n                    {editingProfessor ? \"Editar Professor\" : \"Novo Professor\"}\n                  </DialogTitle>\n                </DialogHeader>\n                <ProfessorForm\n                  initialData={editingProfessor || undefined}\n                  onSuccess={handleSubmit}\n                  isLoading={createMutation.isPending || updateMutation.isPending}\n                  filialId={filialId}\n                />\n              </DialogContent>\n            </Dialog>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Informações da Unidade */}\n        <div className=\"mb-6\">\n          <Card className=\"border-green-200 bg-green-50\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-2 rounded-lg bg-green-100\">\n                  <Building2 className=\"h-5 w-5 text-green-600\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold text-green-900\">\n                    Sistema Sincronizado com a Matriz\n                  </h3>\n                  <p className=\"text-green-800 text-sm\">\n                    Todos os professores cadastrados são automaticamente enviados para o sistema central.\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Search */}\n        <div className=\"flex items-center gap-4 mb-6\">\n          <div className=\"relative flex-1 max-w-md\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4\" />\n            <Input\n              placeholder=\"Buscar por nome, email, CPF ou especialidade...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-10\"\n            />\n          </div>\n        </div>\n\n        {/* Content */}\n        {isLoading ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {[...Array(6)].map((_, i) => (\n              <Card key={i} className=\"animate-pulse\">\n                <CardHeader>\n                  <div className=\"h-4 bg-muted rounded w-3/4\"></div>\n                  <div className=\"h-3 bg-muted rounded w-1/2\"></div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2\">\n                    <div className=\"h-3 bg-muted rounded\"></div>\n                    <div className=\"h-3 bg-muted rounded w-2/3\"></div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : filteredProfessores.length === 0 ? (\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-12\">\n              <GraduationCap className=\"w-12 h-12 text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">\n                {searchTerm ? \"Nenhum professor encontrado\" : \"Nenhum professor cadastrado\"}\n              </h3>\n              <p className=\"text-muted-foreground text-center mb-6\">\n                {searchTerm \n                  ? \"Tente ajustar os termos de busca\" \n                  : \"Comece cadastrando o primeiro professor da unidade\"\n                }\n              </p>\n              {!searchTerm && (\n                <Button onClick={openCreateDialog} className=\"flex items-center gap-2\">\n                  <Plus className=\"w-4 h-4\" />\n                  Cadastrar Primeiro Professor\n                </Button>\n              )}\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {filteredProfessores.map((professor) => (\n              <Card key={professor.id} className=\"hover:shadow-md transition-shadow\">\n                <CardHeader>\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <CardTitle className=\"text-lg\">{professor.nome}</CardTitle>\n                      <p className=\"text-sm text-muted-foreground\">{professor.email}</p>\n                    </div>\n                    {professor.ativo ? (\n                      <Badge variant=\"default\">Ativo</Badge>\n                    ) : (\n                      <Badge variant=\"secondary\">Inativo</Badge>\n                    )}\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">CPF:</span>\n                      <span>{professor.cpf || \"Não informado\"}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Telefone:</span>\n                      <span>{professor.telefone || \"Não informado\"}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Especialidade:</span>\n                      <span>{professor.especialidade || \"Não informado\"}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Data de Admissão:</span>\n                      <span>\n                        {professor.dataAdmissao \n                          ? new Date(professor.dataAdmissao).toLocaleDateString('pt-BR')\n                          : \"Não informado\"\n                        }\n                      </span>\n                    </div>\n                  </div>\n\n                  <Separator className=\"my-4\" />\n\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => openEditDialog(professor)}\n                      className=\"flex-1\"\n                    >\n                      <Edit className=\"w-4 h-4 mr-1\" />\n                      Editar\n                    </Button>\n                    <AlertDialog>\n                      <AlertDialogTrigger asChild>\n                        <Button variant=\"outline\" size=\"sm\">\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      </AlertDialogTrigger>\n                      <AlertDialogContent>\n                        <AlertDialogHeader>\n                          <AlertDialogTitle>Confirmar exclusão</AlertDialogTitle>\n                          <AlertDialogDescription>\n                            Tem certeza que deseja excluir o professor <strong>{professor.nome}</strong>? \n                            Esta ação será sincronizada com a matriz e não pode ser desfeita.\n                          </AlertDialogDescription>\n                        </AlertDialogHeader>\n                        <AlertDialogFooter>\n                          <AlertDialogCancel>Cancelar</AlertDialogCancel>\n                          <AlertDialogAction\n                            onClick={() => deleteMutation.mutate(professor.id)}\n                            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                          >\n                            Excluir\n                          </AlertDialogAction>\n                        </AlertDialogFooter>\n                      </AlertDialogContent>\n                    </AlertDialog>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":14317},"client/src/pages/SistemaUnidadeNovo.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { \n  Building2, \n  Users, \n  GraduationCap,\n  DollarSign, \n  Calendar,\n  FileText,\n  Settings,\n  BarChart3,\n  UserPlus,\n  BookOpen,\n  CreditCard,\n  Activity,\n  ArrowLeft,\n  LogOut\n} from \"lucide-react\";\nimport { useUnidadeAuth } from \"@/contexts/UnidadeContext\";\nimport AlunosTab from \"@/components/unidade/AlunosTab\";\nimport ProfessoresTab from \"@/components/unidade/ProfessoresTab\";\nimport TurmasTab from \"@/components/unidade/TurmasTab\";\nimport FinanceiroTab from \"@/components/unidade/FinanceiroTab\";\n\nexport default function SistemaUnidadeNovo() {\n  const [activeTab, setActiveTab] = useState(\"dashboard\");\n  const { gestorId, filialId, nomeGestor, nomeFilial, logout } = useUnidadeAuth();\n  const [location] = useLocation();\n\n  // Handle URL parameters for tab navigation\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const tab = urlParams.get('tab');\n    if (tab && ['dashboard', 'alunos', 'professores', 'turmas', 'financeiro'].includes(tab)) {\n      setActiveTab(tab);\n    }\n  }, [location]);\n\n  const { data: filial, isLoading } = useQuery({\n    queryKey: [\"/api/filiais\", filialId],\n    enabled: !!filialId,\n  });\n\n  const { data: alunos } = useQuery({\n    queryKey: [\"/api/alunos\"],\n    enabled: !!filialId,\n  });\n\n  const { data: professores } = useQuery({\n    queryKey: [\"/api/professores\"],\n    enabled: !!filialId,\n  });\n\n  const { data: turmas } = useQuery({\n    queryKey: [\"/api/turmas\"],\n    enabled: !!filialId,\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-blue-50\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  const alunosCount = Array.isArray(alunos) ? alunos.filter(a => a.filialId === filialId).length : 0;\n  const professoresCount = Array.isArray(professores) ? professores.filter(p => p.filialId === filialId).length : 0;\n  const turmasCount = Array.isArray(turmas) ? turmas.filter(t => t.filialId === filialId).length : 0;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white border-b border-gray-200 px-6 py-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center\">\n              <Building2 className=\"w-6 h-6 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-xl font-bold text-gray-900\">\n                {nomeFilial || 'Sistema da Unidade'}\n              </h1>\n              <p className=\"text-sm text-gray-600\">\n                Gestor: {nomeGestor || 'Não identificado'}\n              </p>\n            </div>\n          </div>\n          <Button variant=\"outline\" onClick={logout} className=\"flex items-center gap-2\">\n            <LogOut className=\"w-4 h-4\" />\n            Sair\n          </Button>\n        </div>\n      </header>\n\n      {/* Content */}\n      <div className=\"p-6\">\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-5\">\n            <TabsTrigger value=\"dashboard\" className=\"flex items-center gap-2\">\n              <BarChart3 className=\"w-4 h-4\" />\n              Dashboard\n            </TabsTrigger>\n            <TabsTrigger value=\"alunos\" className=\"flex items-center gap-2\">\n              <Users className=\"w-4 h-4\" />\n              Alunos\n            </TabsTrigger>\n            <TabsTrigger value=\"professores\" className=\"flex items-center gap-2\">\n              <GraduationCap className=\"w-4 h-4\" />\n              Professores\n            </TabsTrigger>\n            <TabsTrigger value=\"turmas\" className=\"flex items-center gap-2\">\n              <BookOpen className=\"w-4 h-4\" />\n              Turmas\n            </TabsTrigger>\n            <TabsTrigger value=\"financeiro\" className=\"flex items-center gap-2\">\n              <DollarSign className=\"w-4 h-4\" />\n              Financeiro\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"dashboard\" className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Total de Alunos</CardTitle>\n                  <Users className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{alunosCount}</div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Alunos matriculados na unidade\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Professores</CardTitle>\n                  <GraduationCap className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{professoresCount}</div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Professores ativos\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Turmas Ativas</CardTitle>\n                  <BookOpen className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{turmasCount}</div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Turmas em funcionamento\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Status</CardTitle>\n                  <Activity className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"flex items-center gap-2\">\n                    <Badge variant=\"secondary\" className=\"bg-green-100 text-green-800\">\n                      Ativo\n                    </Badge>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Unidade funcionando normalmente\n                  </p>\n                </CardContent>\n              </Card>\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Informações da Unidade</CardTitle>\n                  <CardDescription>\n                    Dados principais da filial\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm font-medium\">Nome:</span>\n                    <span className=\"text-sm\">{nomeFilial}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm font-medium\">ID:</span>\n                    <span className=\"text-sm\">#{filialId}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm font-medium\">Gestor:</span>\n                    <span className=\"text-sm\">{nomeGestor}</span>\n                  </div>\n                  <Separator />\n                  <div className=\"text-xs text-muted-foreground\">\n                    Sistema integrado de gestão escolar\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>Ações Rápidas</CardTitle>\n                  <CardDescription>\n                    Acesse rapidamente as principais funcionalidades\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-2\">\n                  <Button \n                    variant=\"outline\" \n                    className=\"w-full justify-start\"\n                    onClick={() => setActiveTab(\"alunos\")}\n                  >\n                    <UserPlus className=\"w-4 h-4 mr-2\" />\n                    Cadastrar Novo Aluno\n                  </Button>\n                  <Button \n                    variant=\"outline\" \n                    className=\"w-full justify-start\"\n                    onClick={() => setActiveTab(\"turmas\")}\n                  >\n                    <BookOpen className=\"w-4 h-4 mr-2\" />\n                    Gerenciar Turmas\n                  </Button>\n                  <Button \n                    variant=\"outline\" \n                    className=\"w-full justify-start\"\n                    onClick={() => setActiveTab(\"financeiro\")}\n                  >\n                    <CreditCard className=\"w-4 h-4 mr-2\" />\n                    Controle Financeiro\n                  </Button>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"alunos\">\n            <AlunosTab />\n          </TabsContent>\n\n          <TabsContent value=\"professores\">\n            <ProfessoresTab />\n          </TabsContent>\n\n          <TabsContent value=\"turmas\">\n            <TurmasTab />\n          </TabsContent>\n\n          <TabsContent value=\"financeiro\">\n            <FinanceiroTab />\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}","size_bytes":10425},"client/src/pages/Alunos.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { \n  UserPlus, \n  Search, \n  Edit, \n  Trash2, \n  Phone, \n  Mail, \n  Calendar, \n  Users, \n  Building2,\n  Filter,\n  Download,\n  CheckCircle2,\n  AlertCircle\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { AlunoWithFilial } from \"@shared/schema\";\nimport AlunoForm from \"@/components/forms/AlunoForm\";\nimport CadastroResponsavelForm from \"@/components/forms/CadastroResponsavelForm\";\n\nexport default function Alunos() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filterStatus, setFilterStatus] = useState<\"all\" | \"active\" | \"inactive\">(\"all\");\n  const [filterPayment, setFilterPayment] = useState<\"all\" | \"paid\" | \"late\">(\"all\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [isResponsavelDialogOpen, setIsResponsavelDialogOpen] = useState(false);\n  const [editingAluno, setEditingAluno] = useState<AlunoWithFilial | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: alunos, isLoading } = useQuery<AlunoWithFilial[]>({\n    queryKey: [\"/api/alunos\"],\n  });\n\n  const deleteAlunoMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/alunos/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/alunos\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Aluno removido com sucesso.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao remover aluno. Tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredAlunos = alunos?.filter((aluno) => {\n    const matchesSearch = \n      aluno.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      aluno.email?.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    const matchesStatus = \n      filterStatus === \"all\" || \n      (filterStatus === \"active\" && aluno.ativo) ||\n      (filterStatus === \"inactive\" && !aluno.ativo);\n    \n    const matchesPayment = \n      filterPayment === \"all\" ||\n      (filterPayment === \"paid\" && aluno.statusPagamento?.emDia) ||\n      (filterPayment === \"late\" && aluno.statusPagamento && !aluno.statusPagamento.emDia);\n    \n    return matchesSearch && matchesStatus && matchesPayment;\n  }) || [];\n\n  const handleEdit = (aluno: AlunoWithFilial) => {\n    setEditingAluno(aluno);\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = (id: number) => {\n    if (confirm(\"Tem certeza que deseja remover este aluno?\")) {\n      deleteAlunoMutation.mutate(id);\n    }\n  };\n\n  const handleDialogClose = () => {\n    setIsDialogOpen(false);\n    setEditingAluno(null);\n  };\n\n  const handleResponsavelSuccess = () => {\n    setIsResponsavelDialogOpen(false);\n  };\n\n  const calculateAge = (birthDate: string | null) => {\n    if (!birthDate) return \"-\";\n    const today = new Date();\n    const birth = new Date(birthDate);\n    const age = today.getFullYear() - birth.getFullYear();\n    const monthDiff = today.getMonth() - birth.getMonth();\n    \n    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\n      return age - 1;\n    }\n    return age;\n  };\n\n  const activeCount = alunos?.filter(a => a.ativo).length || 0;\n  const paidCount = alunos?.filter(a => a.statusPagamento?.emDia).length || 0;\n  const lateCount = alunos?.filter(a => a.statusPagamento && !a.statusPagamento.emDia).length || 0;\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-4xl font-bold text-foreground mb-2\">Gestão de Alunos</h1>\n          <p className=\"text-muted-foreground text-lg\">Cadastre e gerencie os alunos da escola</p>\n        </div>\n        <div className=\"flex space-x-3\">\n          <Dialog open={isResponsavelDialogOpen} onOpenChange={setIsResponsavelDialogOpen}>\n            <DialogTrigger asChild>\n              <Button \n                variant=\"outline\" \n                data-testid=\"button-cadastro-responsavel\"\n                className=\"border-border hover:bg-muted\"\n              >\n                <Users className=\"w-4 h-4 mr-2\" />\n                Cadastro por Responsável\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Cadastro de Alunos por Responsável</DialogTitle>\n              </DialogHeader>\n              <CadastroResponsavelForm onSuccess={handleResponsavelSuccess} />\n            </DialogContent>\n          </Dialog>\n          \n          <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n            <DialogTrigger asChild>\n              <Button \n                data-testid=\"button-novo-aluno\"\n                className=\"bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-600/30\"\n              >\n                <UserPlus className=\"w-4 h-4 mr-2\" />\n                Novo Aluno\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl\">\n              <DialogHeader>\n                <DialogTitle>\n                  {editingAluno ? \"Editar Aluno\" : \"Cadastrar Novo Aluno\"}\n                </DialogTitle>\n              </DialogHeader>\n              <AlunoForm \n                aluno={editingAluno} \n                onSuccess={handleDialogClose}\n              />\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground mb-1\">Total de Alunos</p>\n                <p className=\"text-3xl font-bold text-foreground\" data-testid=\"stat-total-alunos\">{alunos?.length || 0}</p>\n              </div>\n              <div className=\"p-3 rounded-xl bg-blue-500/10\">\n                <Users className=\"w-6 h-6 text-blue-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground mb-1\">Alunos Ativos</p>\n                <p className=\"text-3xl font-bold text-foreground\" data-testid=\"stat-alunos-ativos\">{activeCount}</p>\n              </div>\n              <div className=\"p-3 rounded-xl bg-green-500/10\">\n                <CheckCircle2 className=\"w-6 h-6 text-green-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground mb-1\">Em Dia</p>\n                <p className=\"text-3xl font-bold text-green-600\" data-testid=\"stat-alunos-em-dia\">{paidCount}</p>\n              </div>\n              <div className=\"p-3 rounded-xl bg-green-500/10\">\n                <CheckCircle2 className=\"w-6 h-6 text-green-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground mb-1\">Atrasados</p>\n                <p className=\"text-3xl font-bold text-red-600\" data-testid=\"stat-alunos-atrasados\">{lateCount}</p>\n              </div>\n              <div className=\"p-3 rounded-xl bg-red-500/10\">\n                <AlertCircle className=\"w-6 h-6 text-red-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search and Filters */}\n      <Card className=\"border-border bg-card\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex flex-col md:flex-row gap-4\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5\" />\n              <Input\n                placeholder=\"Buscar por nome ou email...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                data-testid=\"input-search\"\n                className=\"pl-11 h-11 bg-background border-border\"\n              />\n            </div>\n            \n            <div className=\"flex gap-3\">\n              <select\n                value={filterStatus}\n                onChange={(e) => setFilterStatus(e.target.value as any)}\n                data-testid=\"select-status-filter\"\n                className=\"h-11 px-4 rounded-lg border border-border bg-background text-foreground text-sm font-medium focus:outline-none focus:ring-2 focus:ring-green-500\"\n              >\n                <option value=\"all\">Todos os Status</option>\n                <option value=\"active\">Ativos</option>\n                <option value=\"inactive\">Inativos</option>\n              </select>\n\n              <select\n                value={filterPayment}\n                onChange={(e) => setFilterPayment(e.target.value as any)}\n                data-testid=\"select-payment-filter\"\n                className=\"h-11 px-4 rounded-lg border border-border bg-background text-foreground text-sm font-medium focus:outline-none focus:ring-2 focus:ring-green-500\"\n              >\n                <option value=\"all\">Todos Pagamentos</option>\n                <option value=\"paid\">Em Dia</option>\n                <option value=\"late\">Atrasados</option>\n              </select>\n\n              <Button\n                variant=\"outline\"\n                data-testid=\"button-export\"\n                className=\"h-11\"\n              >\n                <Download className=\"w-4 h-4 mr-2\" />\n                Exportar\n              </Button>\n            </div>\n          </div>\n\n          {(filterStatus !== \"all\" || filterPayment !== \"all\" || searchTerm) && (\n            <div className=\"mt-4 flex items-center gap-2 text-sm text-muted-foreground\">\n              <Filter className=\"w-4 h-4\" />\n              <span>\n                Mostrando {filteredAlunos.length} de {alunos?.length || 0} alunos\n              </span>\n              {(filterStatus !== \"all\" || filterPayment !== \"all\" || searchTerm) && (\n                <Button\n                  variant=\"link\"\n                  size=\"sm\"\n                  onClick={() => {\n                    setSearchTerm(\"\");\n                    setFilterStatus(\"all\");\n                    setFilterPayment(\"all\");\n                  }}\n                  className=\"h-auto p-0 text-green-600 hover:text-green-700\"\n                >\n                  Limpar filtros\n                </Button>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Students Table */}\n      <Card className=\"border-border bg-card\">\n        <CardContent className=\"p-6\">\n          {isLoading ? (\n            <div className=\"space-y-4\">\n              {[...Array(5)].map((_, i) => (\n                <div key={i} className=\"flex items-center space-x-4 p-4 border border-border rounded-lg\">\n                  <Skeleton className=\"h-12 w-12 rounded-full\" />\n                  <div className=\"space-y-2 flex-1\">\n                    <Skeleton className=\"h-4 w-48\" />\n                    <Skeleton className=\"h-3 w-32\" />\n                  </div>\n                  <Skeleton className=\"h-8 w-20\" />\n                  <Skeleton className=\"h-8 w-8\" />\n                </div>\n              ))}\n            </div>\n          ) : filteredAlunos.length === 0 ? (\n            <div className=\"text-center py-16\">\n              <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-muted mb-4\">\n                <UserPlus className=\"w-8 h-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"text-xl font-semibold text-foreground mb-2\">\n                {searchTerm || filterStatus !== \"all\" || filterPayment !== \"all\"\n                  ? \"Nenhum aluno encontrado\"\n                  : \"Nenhum aluno cadastrado\"}\n              </h3>\n              <p className=\"text-muted-foreground mb-6 max-w-md mx-auto\">\n                {searchTerm || filterStatus !== \"all\" || filterPayment !== \"all\"\n                  ? \"Tente ajustar os filtros ou buscar com outros termos.\"\n                  : \"Comece cadastrando o primeiro aluno da escola.\"}\n              </p>\n              {!searchTerm && filterStatus === \"all\" && filterPayment === \"all\" && (\n                <Button \n                  onClick={() => setIsDialogOpen(true)}\n                  className=\"bg-green-600 hover:bg-green-700\"\n                  data-testid=\"button-cadastrar-primeiro\"\n                >\n                  <UserPlus className=\"w-4 h-4 mr-2\" />\n                  Cadastrar Primeiro Aluno\n                </Button>\n              )}\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow className=\"border-border hover:bg-transparent\">\n                    <TableHead className=\"font-semibold\">Nome</TableHead>\n                    <TableHead className=\"font-semibold\">Contato</TableHead>\n                    <TableHead className=\"font-semibold\">Filial</TableHead>\n                    <TableHead className=\"font-semibold\">Idade</TableHead>\n                    <TableHead className=\"font-semibold\">Responsável</TableHead>\n                    <TableHead className=\"font-semibold\">Pagamento</TableHead>\n                    <TableHead className=\"font-semibold\">Status</TableHead>\n                    <TableHead className=\"text-right font-semibold\">Ações</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredAlunos.map((aluno) => (\n                    <TableRow key={aluno.id} className=\"border-border hover:bg-muted/50\" data-testid={`row-aluno-${aluno.id}`}>\n                      <TableCell>\n                        <div>\n                          <p className=\"font-semibold text-foreground\">{aluno.nome}</p>\n                          {aluno.dataNascimento && (\n                            <p className=\"text-sm text-muted-foreground flex items-center mt-0.5\">\n                              <Calendar className=\"w-3 h-3 mr-1\" />\n                              {format(new Date(aluno.dataNascimento), \"dd/MM/yyyy\", { locale: ptBR })}\n                            </p>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"space-y-1\">\n                          {aluno.email && (\n                            <div className=\"flex items-center text-sm text-muted-foreground\">\n                              <Mail className=\"w-3.5 h-3.5 mr-1.5\" />\n                              <span className=\"truncate max-w-[180px]\">{aluno.email}</span>\n                            </div>\n                          )}\n                          {aluno.telefone && (\n                            <div className=\"flex items-center text-sm text-muted-foreground\">\n                              <Phone className=\"w-3.5 h-3.5 mr-1.5\" />\n                              {aluno.telefone}\n                            </div>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        {aluno.filial ? (\n                          <div className=\"flex items-center\">\n                            <Building2 className=\"w-4 h-4 mr-2 text-muted-foreground\" />\n                            <span className=\"font-medium\">{aluno.filial.nome}</span>\n                          </div>\n                        ) : (\n                          <span className=\"text-muted-foreground text-sm\">Sem filial</span>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        <span className=\"font-semibold\">\n                          {calculateAge(aluno.dataNascimento)} anos\n                        </span>\n                      </TableCell>\n                      <TableCell>\n                        <div>\n                          {aluno.nomeResponsavel && (\n                            <p className=\"font-medium text-sm\">{aluno.nomeResponsavel}</p>\n                          )}\n                          {aluno.telefoneResponsavel && (\n                            <p className=\"text-xs text-muted-foreground\">{aluno.telefoneResponsavel}</p>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        {aluno.statusPagamento ? (\n                          <div className=\"space-y-1.5\">\n                            <Badge \n                              variant={aluno.statusPagamento.emDia ? \"default\" : \"destructive\"}\n                              className={aluno.statusPagamento.emDia \n                                ? \"bg-green-600 hover:bg-green-700 text-white\" \n                                : \"bg-red-600 hover:bg-red-700 text-white\"\n                              }\n                            >\n                              {aluno.statusPagamento.emDia ? \"Em Dia\" : \"Atrasado\"}\n                            </Badge>\n                            {!aluno.statusPagamento.emDia && (\n                              <div className=\"text-xs font-medium text-red-600\">\n                                {aluno.statusPagamento.diasAtraso !== undefined \n                                  ? `${aluno.statusPagamento.diasAtraso} dias`\n                                  : \"Sem pagamentos\"\n                                }\n                              </div>\n                            )}\n                            {aluno.statusPagamento.ultimoPagamento && (\n                              <div className=\"text-xs text-muted-foreground\">\n                                Último: {aluno.statusPagamento.ultimoPagamento}\n                              </div>\n                            )}\n                          </div>\n                        ) : (\n                          <Badge variant=\"secondary\" className=\"bg-muted\">\n                            Sem dados\n                          </Badge>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        <Badge \n                          variant={aluno.ativo ? \"default\" : \"secondary\"}\n                          className={aluno.ativo ? \"bg-green-600 hover:bg-green-700\" : \"bg-muted\"}\n                        >\n                          {aluno.ativo ? \"Ativo\" : \"Inativo\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end space-x-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleEdit(aluno)}\n                            data-testid={`button-edit-${aluno.id}`}\n                            className=\"hover:bg-blue-50 hover:text-blue-600 hover:border-blue-300\"\n                          >\n                            <Edit className=\"w-4 h-4\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleDelete(aluno.id)}\n                            disabled={deleteAlunoMutation.isPending}\n                            data-testid={`button-delete-${aluno.id}`}\n                            className=\"hover:bg-red-50 hover:text-red-600 hover:border-red-300\"\n                          >\n                            <Trash2 className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":21267},"client/src/components/unidade/AlunosTab.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { UserPlus, Search, Trash2, Phone, Mail, Calendar, Filter, Eye, Edit } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useUnidadeAuth } from \"@/contexts/UnidadeContext\";\nimport type { AlunoWithFilial } from \"@shared/schema\";\n\nexport default function AlunosTab() {\n  const { filialId } = useUnidadeAuth();\n  const [, setLocation] = useLocation();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"todos\");\n  const [pagamentoFilter, setPagamentoFilter] = useState<string>(\"todos\");\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: alunos, isLoading } = useQuery({\n    queryKey: [\"/api/alunos\"],\n    enabled: !!filialId,\n  });\n\n  const deleteAlunoMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await apiRequest(\"DELETE\", `/api/alunos/${id}`);\n      if (!response.ok) {\n        throw new Error(\"Failed to delete aluno\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/alunos\"] });\n      toast({\n        title: \"Aluno excluído\",\n        description: \"O aluno foi excluído com sucesso.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível excluir o aluno.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDeleteAluno = (id: number) => {\n    if (confirm(\"Tem certeza de que deseja excluir este aluno?\")) {\n      deleteAlunoMutation.mutate(id);\n    }\n  };\n\n\n\n  const alunosArray = Array.isArray(alunos) ? alunos : [];\n\n  const filteredAlunos = alunosArray.filter((aluno) => {\n    const matchesSearch = aluno.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         aluno.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         aluno.telefone?.includes(searchTerm);\n    \n    const matchesStatus = statusFilter === \"todos\" || \n                         (statusFilter === \"ativo\" && aluno.ativo) ||\n                         (statusFilter === \"inativo\" && !aluno.ativo);\n    \n    const matchesPagamento = pagamentoFilter === \"todos\" ||\n                           (pagamentoFilter === \"em_dia\" && aluno.statusPagamento === \"em_dia\") ||\n                           (pagamentoFilter === \"pendente\" && aluno.statusPagamento === \"pendente\") ||\n                           (pagamentoFilter === \"atrasado\" && aluno.statusPagamento === \"atrasado\");\n    \n    return matchesSearch && matchesStatus && matchesPagamento;\n  });\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Alunos da Unidade</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <Skeleton className=\"h-10 w-full\" />\n            <Skeleton className=\"h-10 w-full\" />\n            <Skeleton className=\"h-10 w-full\" />\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900\">Alunos da Unidade</h2>\n          <p className=\"text-gray-600\">Gerencie os alunos matriculados na sua unidade</p>\n        </div>\n        <Button \n          onClick={() => setLocation('/unidade/cadastro-aluno')}\n          className=\"flex items-center gap-2\"\n        >\n          <UserPlus className=\"w-4 h-4\" />\n          {alunosArray.length === 0 ? \"Cadastrar Primeiro Aluno\" : \"Novo Aluno\"}\n        </Button>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex flex-col sm:flex-row gap-4\">\n            <div className=\"flex-1\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                <Input\n                  placeholder=\"Buscar por nome, email ou telefone...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n            <div className=\"flex gap-2\">\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger className=\"w-[140px]\">\n                  <SelectValue placeholder=\"Status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"todos\">Todos</SelectItem>\n                  <SelectItem value=\"ativo\">Ativo</SelectItem>\n                  <SelectItem value=\"inativo\">Inativo</SelectItem>\n                </SelectContent>\n              </Select>\n              <Select value={pagamentoFilter} onValueChange={setPagamentoFilter}>\n                <SelectTrigger className=\"w-[140px]\">\n                  <SelectValue placeholder=\"Pagamento\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"todos\">Todos</SelectItem>\n                  <SelectItem value=\"em_dia\">Em dia</SelectItem>\n                  <SelectItem value=\"pendente\">Pendente</SelectItem>\n                  <SelectItem value=\"atrasado\">Atrasado</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {filteredAlunos.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <UserPlus className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n                {alunosArray.length === 0 ? \"Nenhum aluno cadastrado\" : \"Nenhum aluno encontrado\"}\n              </h3>\n              <p className=\"text-gray-600 mb-4\">\n                {alunosArray.length === 0 \n                  ? \"Comece cadastrando o primeiro aluno da sua unidade.\"\n                  : \"Tente ajustar os filtros ou buscar por outros termos.\"\n                }\n              </p>\n              {alunosArray.length === 0 && (\n                <Button onClick={() => setLocation('/unidade/cadastro-aluno')}>\n                  <UserPlus className=\"w-4 h-4 mr-2\" />\n                  Cadastrar Primeiro Aluno\n                </Button>\n              )}\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Nome</TableHead>\n                    <TableHead>Contato</TableHead>\n                    <TableHead>Data de Nascimento</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Pagamento</TableHead>\n                    <TableHead className=\"text-right\">Ações</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredAlunos.map((aluno) => (\n                    <TableRow key={aluno.id}>\n                      <TableCell>\n                        <div>\n                          <div className=\"font-medium\">{aluno.nome}</div>\n                          {aluno.nomeResponsavel && (\n                            <div className=\"text-sm text-gray-500\">\n                              Responsável: {aluno.nomeResponsavel}\n                            </div>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"space-y-1\">\n                          {aluno.email && (\n                            <div className=\"flex items-center gap-1 text-sm\">\n                              <Mail className=\"w-3 h-3\" />\n                              {aluno.email}\n                            </div>\n                          )}\n                          {aluno.telefone && (\n                            <div className=\"flex items-center gap-1 text-sm\">\n                              <Phone className=\"w-3 h-3\" />\n                              {aluno.telefone}\n                            </div>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        {aluno.dataNascimento && (\n                          <div className=\"flex items-center gap-1 text-sm\">\n                            <Calendar className=\"w-3 h-3\" />\n                            {format(new Date(aluno.dataNascimento), \"dd/MM/yyyy\", { locale: ptBR })}\n                          </div>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={aluno.ativo ? \"default\" : \"secondary\"}>\n                          {aluno.ativo ? \"Ativo\" : \"Inativo\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <Badge \n                          variant={\n                            aluno.statusPagamento === \"em_dia\" ? \"default\" :\n                            aluno.statusPagamento === \"pendente\" ? \"secondary\" :\n                            \"destructive\"\n                          }\n                        >\n                          {aluno.statusPagamento === \"em_dia\" ? \"Em dia\" :\n                           aluno.statusPagamento === \"pendente\" ? \"Pendente\" :\n                           \"Atrasado\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end gap-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setLocation(`/unidade/cadastro-aluno?edit=${aluno.id}`)}\n                            className=\"text-blue-600 hover:text-blue-700\"\n                          >\n                            <Eye className=\"w-3 h-3\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleDeleteAluno(aluno.id)}\n                            className=\"text-red-600 hover:text-red-700\"\n                          >\n                            <Trash2 className=\"w-3 h-3\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":11394},"client/src/hooks/useResponsavel.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { ResponsavelWithAlunos } from \"@shared/schema\";\n\nexport function useResponsavel() {\n  const { data: responsavel, isLoading, error } = useQuery<ResponsavelWithAlunos | null>({\n    queryKey: [\"/api/responsaveis/me\"],\n    retry: false,\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n\n  return {\n    responsavel,\n    isLoading,\n    isAuthenticated: !!responsavel && !error,\n    error,\n  };\n}\n\nexport async function logoutResponsavel() {\n  try {\n    await apiRequest(\"POST\", \"/api/responsavel/logout\");\n    // Force reload to clear any cached data\n    window.location.href = \"/responsavel/login\";\n  } catch (error) {\n    console.error(\"Logout error:\", error);\n    // Even if logout fails, redirect to login\n    window.location.href = \"/responsavel/login\";\n  }\n}","size_bytes":869},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/unidade/forms/AlunoUnidadeForm.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { useState, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertAlunoSchema, type AlunoWithFilial } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { useUnidadeAuth } from \"@/contexts/UnidadeContext\";\nimport { Camera, Upload, X, User } from \"lucide-react\";\n\nconst formSchema = z.object({\n  nome: z.string().min(1, \"Nome é obrigatório\"),\n  email: z.string().email(\"Email inválido\").optional().or(z.literal(\"\")),\n  telefone: z.string().optional(),\n  cpf: z.string().optional(),\n  rg: z.string().optional(),\n  dataNascimento: z.string().optional(),\n  dataMatricula: z.string().optional(),\n  endereco: z.string().optional(),\n  bairro: z.string().optional(),\n  cidade: z.string().optional(),\n  estado: z.string().optional(),\n  cep: z.string().optional(),\n  nomeResponsavel: z.string().optional(),\n  telefoneResponsavel: z.string().optional(),\n  observacoes: z.string().optional(),\n  ativo: z.boolean().default(true),\n  filialId: z.number(),\n  fotoUrl: z.string().optional(),\n  // Campos para portal do responsável\n  cpfResponsavel: z.string().min(1, \"CPF do responsável é obrigatório para acesso ao portal\"),\n  emailResponsavel: z.string().email(\"Email inválido\").min(1, \"Email é obrigatório para acesso ao portal\"),\n  senhaResponsavel: z.string().min(6, \"Senha deve ter pelo menos 6 caracteres\"),\n});\n\ntype FormData = z.infer<typeof formSchema>;\n\ninterface AlunoUnidadeFormProps {\n  initialData?: AlunoWithFilial | null;\n  onSuccess: () => void;\n}\n\nexport default function AlunoUnidadeForm({ initialData, onSuccess }: AlunoUnidadeFormProps) {\n  const { filialId } = useUnidadeAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [photoPreview, setPhotoPreview] = useState<string | null>(initialData?.fotoUrl || null);\n  const [isCapturing, setIsCapturing] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      nome: initialData?.nome || \"\",\n      email: initialData?.email || \"\",\n      telefone: initialData?.telefone || \"\",\n      cpf: initialData?.cpf || \"\",\n      rg: initialData?.rg || \"\",\n      dataNascimento: initialData?.dataNascimento ? new Date(initialData.dataNascimento).toISOString().split('T')[0] : \"\",\n      dataMatricula: initialData?.dataMatricula ? new Date(initialData.dataMatricula).toISOString().split('T')[0] : \"\",\n      endereco: initialData?.endereco || \"\",\n      bairro: initialData?.bairro || \"\",\n      cidade: initialData?.cidade || \"\",\n      estado: initialData?.estado || \"\",\n      cep: initialData?.cep || \"\",\n      nomeResponsavel: initialData?.nomeResponsavel || \"\",\n      telefoneResponsavel: initialData?.telefoneResponsavel || \"\",\n      observacoes: \"\",\n      ativo: initialData?.ativo ?? true,\n      filialId: filialId || 0,\n      fotoUrl: initialData?.fotoUrl || \"\",\n      cpfResponsavel: \"\",\n      emailResponsavel: \"\",\n      senhaResponsavel: \"\",\n    },\n  });\n\n  const createAlunoMutation = useMutation({\n    mutationFn: async (data: FormData) => {\n      const response = await apiRequest(\"POST\", \"/api/alunos\", data);\n      if (!response.ok) {\n        throw new Error(\"Failed to create aluno\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/alunos\"] });\n      toast({\n        title: \"Aluno cadastrado\",\n        description: \"O aluno foi cadastrado com sucesso.\",\n      });\n      onSuccess();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível cadastrar o aluno.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateAlunoMutation = useMutation({\n    mutationFn: async (data: FormData) => {\n      const response = await apiRequest(\"PUT\", `/api/alunos/${initialData?.id}`, data);\n      if (!response.ok) {\n        throw new Error(\"Failed to update aluno\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/alunos\"] });\n      toast({\n        title: \"Aluno atualizado\",\n        description: \"Os dados do aluno foram atualizados com sucesso.\",\n      });\n      onSuccess();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível atualizar o aluno.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Photo upload functions\n  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const result = e.target?.result as string;\n        setPhotoPreview(result);\n        form.setValue('fotoUrl', result);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const startCamera = async () => {\n    try {\n      setIsCapturing(true);\n      const stream = await navigator.mediaDevices.getUserMedia({ video: true });\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n      }\n    } catch (error) {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível acessar a câmera.\",\n        variant: \"destructive\",\n      });\n      setIsCapturing(false);\n    }\n  };\n\n  const capturePhoto = () => {\n    if (videoRef.current && canvasRef.current) {\n      const canvas = canvasRef.current;\n      const video = videoRef.current;\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      const ctx = canvas.getContext('2d');\n      ctx?.drawImage(video, 0, 0);\n      const photoData = canvas.toDataURL('image/jpeg', 0.8);\n      setPhotoPreview(photoData);\n      form.setValue('fotoUrl', photoData);\n      stopCamera();\n    }\n  };\n\n  const stopCamera = () => {\n    if (videoRef.current?.srcObject) {\n      const stream = videoRef.current.srcObject as MediaStream;\n      stream.getTracks().forEach(track => track.stop());\n      videoRef.current.srcObject = null;\n    }\n    setIsCapturing(false);\n  };\n\n  const removePhoto = () => {\n    setPhotoPreview(null);\n    form.setValue('fotoUrl', '');\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  const onSubmit = (data: FormData) => {\n    if (initialData) {\n      updateAlunoMutation.mutate(data);\n    } else {\n      createAlunoMutation.mutate(data);\n    }\n  };\n\n  const isLoading = createAlunoMutation.isPending || updateAlunoMutation.isPending;\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n        {/* Photo Upload Section */}\n        <div className=\"space-y-4\">\n          <h3 className=\"text-lg font-semibold\">Foto do Aluno</h3>\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex flex-col items-center space-y-4\">\n                {/* Photo Preview */}\n                <div className=\"w-32 h-32 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center overflow-hidden\">\n                  {photoPreview ? (\n                    <img\n                      src={photoPreview}\n                      alt=\"Preview\"\n                      className=\"w-full h-full object-cover\"\n                    />\n                  ) : (\n                    <User className=\"w-16 h-16 text-gray-400\" />\n                  )}\n                </div>\n\n                {/* Camera Feed */}\n                {isCapturing && (\n                  <div className=\"relative\">\n                    <video\n                      ref={videoRef}\n                      autoPlay\n                      muted\n                      className=\"w-64 h-48 bg-black rounded\"\n                    />\n                    <div className=\"flex gap-2 mt-2\">\n                      <Button\n                        type=\"button\"\n                        onClick={capturePhoto}\n                        className=\"flex items-center gap-2\"\n                      >\n                        <Camera className=\"w-4 h-4\" />\n                        Capturar\n                      </Button>\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        onClick={stopCamera}\n                      >\n                        Cancelar\n                      </Button>\n                    </div>\n                  </div>\n                )}\n\n                {/* Upload Buttons */}\n                {!isCapturing && (\n                  <div className=\"flex flex-col sm:flex-row gap-2\">\n                    <input\n                      ref={fileInputRef}\n                      type=\"file\"\n                      accept=\"image/*\"\n                      onChange={handleFileUpload}\n                      className=\"hidden\"\n                    />\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => fileInputRef.current?.click()}\n                      className=\"flex items-center gap-2\"\n                    >\n                      <Upload className=\"w-4 h-4\" />\n                      Selecionar Arquivo\n                    </Button>\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={startCamera}\n                      className=\"flex items-center gap-2\"\n                    >\n                      <Camera className=\"w-4 h-4\" />\n                      Tirar Foto\n                    </Button>\n                    {photoPreview && (\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        onClick={removePhoto}\n                        className=\"flex items-center gap-2 text-red-600 hover:text-red-700\"\n                      >\n                        <X className=\"w-4 h-4\" />\n                        Remover\n                      </Button>\n                    )}\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"nome\"\n            render={({ field }) => (\n              <FormItem className=\"md:col-span-2\">\n                <FormLabel>Nome Completo *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Nome completo do aluno\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"email\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Email</FormLabel>\n                <FormControl>\n                  <Input type=\"email\" placeholder=\"email@exemplo.com\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"telefone\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Telefone</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"(11) 99999-9999\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"cpf\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>CPF</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"000.000.000-00\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"rg\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>RG</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"00.000.000-0\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"dataNascimento\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Data de Nascimento</FormLabel>\n                <FormControl>\n                  <Input type=\"date\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"dataMatricula\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Data da Matrícula</FormLabel>\n                <FormControl>\n                  <Input type=\"date\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <div className=\"space-y-4\">\n          <h3 className=\"text-lg font-semibold\">Endereço</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <FormField\n              control={form.control}\n              name=\"endereco\"\n              render={({ field }) => (\n                <FormItem className=\"md:col-span-2\">\n                  <FormLabel>Endereço</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Rua, número, complemento\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"bairro\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Bairro</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Bairro\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"cep\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>CEP</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"00000-000\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"cidade\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Cidade</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Cidade\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"estado\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Estado</FormLabel>\n                  <FormControl>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Selecione o estado\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"AC\">Acre</SelectItem>\n                        <SelectItem value=\"AL\">Alagoas</SelectItem>\n                        <SelectItem value=\"AP\">Amapá</SelectItem>\n                        <SelectItem value=\"AM\">Amazonas</SelectItem>\n                        <SelectItem value=\"BA\">Bahia</SelectItem>\n                        <SelectItem value=\"CE\">Ceará</SelectItem>\n                        <SelectItem value=\"DF\">Distrito Federal</SelectItem>\n                        <SelectItem value=\"ES\">Espírito Santo</SelectItem>\n                        <SelectItem value=\"GO\">Goiás</SelectItem>\n                        <SelectItem value=\"MA\">Maranhão</SelectItem>\n                        <SelectItem value=\"MT\">Mato Grosso</SelectItem>\n                        <SelectItem value=\"MS\">Mato Grosso do Sul</SelectItem>\n                        <SelectItem value=\"MG\">Minas Gerais</SelectItem>\n                        <SelectItem value=\"PA\">Pará</SelectItem>\n                        <SelectItem value=\"PB\">Paraíba</SelectItem>\n                        <SelectItem value=\"PR\">Paraná</SelectItem>\n                        <SelectItem value=\"PE\">Pernambuco</SelectItem>\n                        <SelectItem value=\"PI\">Piauí</SelectItem>\n                        <SelectItem value=\"RJ\">Rio de Janeiro</SelectItem>\n                        <SelectItem value=\"RN\">Rio Grande do Norte</SelectItem>\n                        <SelectItem value=\"RS\">Rio Grande do Sul</SelectItem>\n                        <SelectItem value=\"RO\">Rondônia</SelectItem>\n                        <SelectItem value=\"RR\">Roraima</SelectItem>\n                        <SelectItem value=\"SC\">Santa Catarina</SelectItem>\n                        <SelectItem value=\"SP\">São Paulo</SelectItem>\n                        <SelectItem value=\"SE\">Sergipe</SelectItem>\n                        <SelectItem value=\"TO\">Tocantins</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n        </div>\n\n        <div className=\"space-y-4\">\n          <h3 className=\"text-lg font-semibold\">Responsável</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <FormField\n              control={form.control}\n              name=\"nomeResponsavel\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Nome do Responsável</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Nome completo\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"telefoneResponsavel\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Telefone do Responsável</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"(11) 99999-9999\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n        </div>\n\n        <div className=\"space-y-4\">\n          <h3 className=\"text-lg font-semibold\">Acesso ao Portal do Responsável</h3>\n          <p className=\"text-sm text-gray-600\">\n            Estes dados serão utilizados pelo responsável para acessar o portal e acompanhar o desenvolvimento do aluno.\n          </p>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <FormField\n              control={form.control}\n              name=\"cpfResponsavel\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>CPF do Responsável *</FormLabel>\n                  <FormControl>\n                    <Input \n                      placeholder=\"000.000.000-00\" \n                      {...field} \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"emailResponsavel\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Email para Acesso *</FormLabel>\n                  <FormControl>\n                    <Input \n                      type=\"email\" \n                      placeholder=\"email@exemplo.com\" \n                      {...field} \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"senhaResponsavel\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Senha para Acesso *</FormLabel>\n                  <FormControl>\n                    <Input \n                      type=\"password\" \n                      placeholder=\"Mínimo 6 caracteres\" \n                      {...field} \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"observacoes\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Observações</FormLabel>\n              <FormControl>\n                <Textarea \n                  placeholder=\"Observações adicionais sobre o aluno\"\n                  className=\"min-h-[100px]\"\n                  {...field} \n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"ativo\"\n          render={({ field }) => (\n            <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n              <div className=\"space-y-0.5\">\n                <FormLabel className=\"text-base\">Aluno Ativo</FormLabel>\n                <div className=\"text-sm text-muted-foreground\">\n                  Aluno pode participar das aulas e atividades\n                </div>\n              </div>\n              <FormControl>\n                <Switch\n                  checked={field.value}\n                  onCheckedChange={field.onChange}\n                />\n              </FormControl>\n            </FormItem>\n          )}\n        />\n\n        <div className=\"flex justify-end gap-2\">\n          <Button type=\"button\" variant=\"outline\" onClick={onSuccess}>\n            Cancelar\n          </Button>\n          <Button type=\"submit\" disabled={isLoading}>\n            {isLoading ? \"Salvando...\" : initialData ? \"Atualizar\" : \"Cadastrar\"}\n          </Button>\n        </div>\n\n        {/* Hidden canvas for photo capture */}\n        <canvas ref={canvasRef} style={{ display: 'none' }} />\n      </form>\n    </Form>\n  );\n}","size_bytes":23303},"client/src/components/UnidadeProtectedRoute.tsx":{"content":"import { useEffect } from 'react';\nimport { useLocation } from 'wouter';\nimport { useUnidadeAuth } from '@/contexts/UnidadeContext';\n\ninterface UnidadeProtectedRouteProps {\n  children: React.ReactNode;\n}\n\nexport default function UnidadeProtectedRoute({ children }: UnidadeProtectedRouteProps) {\n  const { isAuthenticated, isLoading } = useUnidadeAuth();\n  const [, setLocation] = useLocation();\n\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      setLocation('/portal-unidade');\n    }\n  }, [isAuthenticated, isLoading, setLocation]);\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-blue-50\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  return <>{children}</>;\n}","size_bytes":873},"client/src/pages/GestaoUnidades.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  Building2, \n  Search, \n  Edit, \n  Trash2, \n  Plus,\n  Users,\n  UserCheck,\n  DollarSign,\n  Calendar,\n  Settings,\n  Shield,\n  Eye\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { \n  Filial, \n  InsertFilial,\n  AlunoWithFilial,\n  Professor,\n  TurmaWithProfessor\n} from \"@shared/schema\";\n\ninterface FilialDetalhada extends Filial {\n  totalAlunos: number;\n  totalProfessores: number;\n  totalTurmas: number;\n  receitaMensal: number;\n}\n\nexport default function GestaoUnidades() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [, setLocation] = useLocation();\n  const [selectedFilial, setSelectedFilial] = useState<FilialDetalhada | null>(null);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [isViewingDetails, setIsViewingDetails] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: filiais, isLoading: loadingFiliais } = useQuery<FilialDetalhada[]>({\n    queryKey: [\"/api/filiais/detalhadas\"],\n  });\n\n  const { data: alunosPorFilial } = useQuery<AlunoWithFilial[]>({\n    queryKey: [\"/api/alunos\", { filialId: selectedFilial?.id }],\n    enabled: !!selectedFilial,\n  });\n\n  const { data: professoresPorFilial } = useQuery<Professor[]>({\n    queryKey: [\"/api/professores\", { filialId: selectedFilial?.id }],\n    enabled: !!selectedFilial,\n  });\n\n  const { data: turmasPorFilial } = useQuery<TurmaWithProfessor[]>({\n    queryKey: [\"/api/turmas\", { filialId: selectedFilial?.id }],\n    enabled: !!selectedFilial,\n  });\n\n  const createFilialMutation = useMutation({\n    mutationFn: async (data: InsertFilial) => {\n      return await apiRequest(\"POST\", \"/api/filiais\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/filiais\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/filiais/detalhadas\"] });\n      setIsDialogOpen(false);\n      toast({\n        title: \"Unidade criada\",\n        description: \"Nova unidade criada com sucesso\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao criar unidade\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateFilialMutation = useMutation({\n    mutationFn: async (data: { id: number; filial: Partial<InsertFilial> }) => {\n      return await apiRequest(\"PATCH\", `/api/filiais/${data.id}`, data.filial);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/filiais\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/filiais/detalhadas\"] });\n      setIsDialogOpen(false);\n      setSelectedFilial(null);\n      toast({\n        title: \"Unidade atualizada\",\n        description: \"Dados da unidade atualizados com sucesso\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao atualizar unidade\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteFilialMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return await apiRequest(\"DELETE\", `/api/filiais/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/filiais\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/filiais/detalhadas\"] });\n      toast({\n        title: \"Unidade excluída\",\n        description: \"Unidade excluída com sucesso\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao excluir unidade\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredFiliais = filiais?.filter(filial =>\n    filial.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    filial.endereco.toLowerCase().includes(searchTerm.toLowerCase())\n  ) || [];\n\n  const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    const formData = new FormData(e.currentTarget);\n    const data = {\n      nome: formData.get(\"nome\") as string,\n      endereco: formData.get(\"endereco\") as string,\n      telefone: formData.get(\"telefone\") as string,\n      responsavel: formData.get(\"responsavel\") as string,\n      ativa: true,\n    };\n\n    if (selectedFilial) {\n      updateFilialMutation.mutate({ id: selectedFilial.id, filial: data });\n    } else {\n      createFilialMutation.mutate(data);\n    }\n  };\n\n  const handleEdit = (filial: FilialDetalhada) => {\n    setSelectedFilial(filial);\n    setIsDialogOpen(true);\n  };\n\n  const handleViewDetails = (filial: FilialDetalhada) => {\n    setSelectedFilial(filial);\n    setIsViewingDetails(true);\n  };\n\n  const handleDelete = (id: number) => {\n    if (confirm(\"Tem certeza que deseja excluir esta unidade?\")) {\n      deleteFilialMutation.mutate(id);\n    }\n  };\n\n  const renderFilialForm = () => (\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\n      <div>\n        <label htmlFor=\"nome\" className=\"block text-sm font-medium mb-1\">\n          Nome da Unidade\n        </label>\n        <Input\n          id=\"nome\"\n          name=\"nome\"\n          defaultValue={selectedFilial?.nome}\n          required\n        />\n      </div>\n      <div>\n        <label htmlFor=\"endereco\" className=\"block text-sm font-medium mb-1\">\n          Endereço\n        </label>\n        <Input\n          id=\"endereco\"\n          name=\"endereco\"\n          defaultValue={selectedFilial?.endereco}\n          required\n        />\n      </div>\n      <div>\n        <label htmlFor=\"telefone\" className=\"block text-sm font-medium mb-1\">\n          Telefone\n        </label>\n        <Input\n          id=\"telefone\"\n          name=\"telefone\"\n          defaultValue={selectedFilial?.telefone || \"\"}\n        />\n      </div>\n      <div>\n        <label htmlFor=\"responsavel\" className=\"block text-sm font-medium mb-1\">\n          Responsável\n        </label>\n        <Input\n          id=\"responsavel\"\n          name=\"responsavel\"\n          defaultValue={selectedFilial?.responsavel || \"\"}\n        />\n      </div>\n      <div className=\"flex justify-end space-x-2\">\n        <Button type=\"button\" variant=\"outline\" onClick={() => {\n          setIsDialogOpen(false);\n          setSelectedFilial(null);\n        }}>\n          Cancelar\n        </Button>\n        <Button type=\"submit\" disabled={createFilialMutation.isPending || updateFilialMutation.isPending}>\n          {selectedFilial ? \"Atualizar\" : \"Criar\"}\n        </Button>\n      </div>\n    </form>\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-3xl font-bold text-neutral-800\">Gestão de Unidades</h2>\n          <p className=\"text-neutral-600\">Administre as unidades da rede</p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={() => setSelectedFilial(null)}>\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Nova Unidade\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>\n                {selectedFilial ? \"Editar Unidade\" : \"Nova Unidade\"}\n              </DialogTitle>\n            </DialogHeader>\n            {renderFilialForm()}\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Search and Summary */}\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400 w-4 h-4\" />\n              <Input\n                placeholder=\"Buscar unidades...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n            <div className=\"flex items-center space-x-6 text-sm\">\n              <div className=\"text-center\">\n                <p className=\"font-semibold text-lg\">{filteredFiliais.length}</p>\n                <p className=\"text-neutral-500\">Total</p>\n              </div>\n              <div className=\"text-center\">\n                <p className=\"font-semibold text-lg text-green-600\">\n                  {filteredFiliais.filter(f => f.ativa).length}\n                </p>\n                <p className=\"text-neutral-500\">Ativas</p>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Unidades Grid */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {loadingFiliais ? (\n          [...Array(6)].map((_, i) => (\n            <Card key={i}>\n              <CardContent className=\"p-6\">\n                <Skeleton className=\"h-32 w-full\" />\n              </CardContent>\n            </Card>\n          ))\n        ) : (\n          filteredFiliais.map((filial) => (\n            <Card key={filial.id} className=\"hover:shadow-lg transition-shadow\">\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center space-x-2\">\n                    <Building2 className=\"w-5 h-5 text-blue-600\" />\n                    <CardTitle className=\"text-lg\">{filial.nome}</CardTitle>\n                  </div>\n                  <Badge variant={filial.ativa ? \"default\" : \"secondary\"}>\n                    {filial.ativa ? \"Ativa\" : \"Inativa\"}\n                  </Badge>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"text-sm text-neutral-600\">\n                  <p>{filial.endereco}</p>\n                  {filial.telefone && <p>{filial.telefone}</p>}\n                  {filial.responsavel && <p>Responsável: {filial.responsavel}</p>}\n                </div>\n\n                {/* Métricas */}\n                <div className=\"grid grid-cols-2 gap-4 pt-4 border-t\">\n                  <div className=\"text-center\">\n                    <p className=\"text-sm text-neutral-500\">Alunos</p>\n                    <p className=\"font-semibold text-blue-600\">{filial.totalAlunos}</p>\n                  </div>\n                  <div className=\"text-center\">\n                    <p className=\"text-sm text-neutral-500\">Professores</p>\n                    <p className=\"font-semibold text-green-600\">{filial.totalProfessores}</p>\n                  </div>\n                  <div className=\"text-center\">\n                    <p className=\"text-sm text-neutral-500\">Turmas</p>\n                    <p className=\"font-semibold text-purple-600\">{filial.totalTurmas}</p>\n                  </div>\n                  <div className=\"text-center\">\n                    <p className=\"text-sm text-neutral-500\">Receita</p>\n                    <p className=\"font-semibold text-orange-600\">\n                      R$ {filial.receitaMensal?.toFixed(2)}\n                    </p>\n                  </div>\n                </div>\n\n                {/* Ações */}\n                <div className=\"flex items-center justify-between pt-4 border-t\">\n                  <div className=\"flex space-x-2\">\n                    <Button\n                      variant=\"default\"\n                      size=\"sm\"\n                      onClick={() => setLocation(`/unidade/${filial.id}`)}\n                    >\n                      <Building2 className=\"w-4 h-4 mr-1\" />\n                      Painel\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleViewDetails(filial)}\n                    >\n                      <Eye className=\"w-4 h-4 mr-1\" />\n                      Detalhes\n                    </Button>\n                  </div>\n                  <div className=\"flex space-x-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleEdit(filial)}\n                    >\n                      <Edit className=\"w-4 h-4\" />\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleDelete(filial.id)}\n                    >\n                      <Trash2 className=\"w-4 h-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))\n        )}\n      </div>\n\n      {/* Dialog de Detalhes da Unidade */}\n      <Dialog open={isViewingDetails} onOpenChange={setIsViewingDetails}>\n        <DialogContent className=\"max-w-4xl\">\n          <DialogHeader>\n            <DialogTitle>\n              Detalhes da Unidade: {selectedFilial?.nome}\n            </DialogTitle>\n          </DialogHeader>\n          \n          {selectedFilial && (\n            <Tabs defaultValue=\"overview\" className=\"w-full\">\n              <TabsList className=\"grid w-full grid-cols-4\">\n                <TabsTrigger value=\"overview\">Visão Geral</TabsTrigger>\n                <TabsTrigger value=\"students\">Alunos</TabsTrigger>\n                <TabsTrigger value=\"teachers\">Professores</TabsTrigger>\n                <TabsTrigger value=\"classes\">Turmas</TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"overview\" className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  <Card>\n                    <CardContent className=\"p-4 text-center\">\n                      <Users className=\"w-8 h-8 mx-auto mb-2 text-blue-600\" />\n                      <p className=\"text-2xl font-bold\">{selectedFilial.totalAlunos}</p>\n                      <p className=\"text-sm text-neutral-500\">Alunos</p>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"p-4 text-center\">\n                      <UserCheck className=\"w-8 h-8 mx-auto mb-2 text-green-600\" />\n                      <p className=\"text-2xl font-bold\">{selectedFilial.totalProfessores}</p>\n                      <p className=\"text-sm text-neutral-500\">Professores</p>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"p-4 text-center\">\n                      <Calendar className=\"w-8 h-8 mx-auto mb-2 text-purple-600\" />\n                      <p className=\"text-2xl font-bold\">{selectedFilial.totalTurmas}</p>\n                      <p className=\"text-sm text-neutral-500\">Turmas</p>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"p-4 text-center\">\n                      <DollarSign className=\"w-8 h-8 mx-auto mb-2 text-orange-600\" />\n                      <p className=\"text-2xl font-bold\">R$ {selectedFilial.receitaMensal?.toFixed(2)}</p>\n                      <p className=\"text-sm text-neutral-500\">Receita Mensal</p>\n                    </CardContent>\n                  </Card>\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"students\">\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold\">Alunos da Unidade</h3>\n                  {alunosPorFilial && alunosPorFilial.length > 0 ? (\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Nome</TableHead>\n                          <TableHead>Email</TableHead>\n                          <TableHead>Telefone</TableHead>\n                          <TableHead>Status</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {alunosPorFilial.map((aluno) => (\n                          <TableRow key={aluno.id}>\n                            <TableCell>{aluno.nome}</TableCell>\n                            <TableCell>{aluno.email || \"-\"}</TableCell>\n                            <TableCell>{aluno.telefone || \"-\"}</TableCell>\n                            <TableCell>\n                              <Badge variant={aluno.ativo ? \"default\" : \"secondary\"}>\n                                {aluno.ativo ? \"Ativo\" : \"Inativo\"}\n                              </Badge>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  ) : (\n                    <p className=\"text-neutral-500\">Nenhum aluno cadastrado nesta unidade</p>\n                  )}\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"teachers\">\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold\">Professores da Unidade</h3>\n                  {professoresPorFilial && professoresPorFilial.length > 0 ? (\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Nome</TableHead>\n                          <TableHead>Email</TableHead>\n                          <TableHead>Especialidade</TableHead>\n                          <TableHead>Status</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {professoresPorFilial.map((professor) => (\n                          <TableRow key={professor.id}>\n                            <TableCell>{professor.nome}</TableCell>\n                            <TableCell>{professor.email || \"-\"}</TableCell>\n                            <TableCell>{professor.especialidade || \"-\"}</TableCell>\n                            <TableCell>\n                              <Badge variant={professor.ativo ? \"default\" : \"secondary\"}>\n                                {professor.ativo ? \"Ativo\" : \"Inativo\"}\n                              </Badge>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  ) : (\n                    <p className=\"text-neutral-500\">Nenhum professor cadastrado nesta unidade</p>\n                  )}\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"classes\">\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold\">Turmas da Unidade</h3>\n                  {turmasPorFilial && turmasPorFilial.length > 0 ? (\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Nome</TableHead>\n                          <TableHead>Categoria</TableHead>\n                          <TableHead>Professor</TableHead>\n                          <TableHead>Horário</TableHead>\n                          <TableHead>Status</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {turmasPorFilial.map((turma) => (\n                          <TableRow key={turma.id}>\n                            <TableCell>{turma.nome}</TableCell>\n                            <TableCell>{turma.categoria}</TableCell>\n                            <TableCell>{turma.professor?.nome || \"-\"}</TableCell>\n                            <TableCell>{turma.horario || \"-\"}</TableCell>\n                            <TableCell>\n                              <Badge variant={turma.ativo ? \"default\" : \"secondary\"}>\n                                {turma.ativo ? \"Ativa\" : \"Inativa\"}\n                              </Badge>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  ) : (\n                    <p className=\"text-neutral-500\">Nenhuma turma cadastrada nesta unidade</p>\n                  )}\n                </div>\n              </TabsContent>\n            </Tabs>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":20876},"client/src/components/InterLogo.tsx":{"content":"import interLogoPath from \"@assets/Inter_1749349499208.webp\";\n\ninterface InterLogoProps {\n  size?: number;\n  className?: string;\n}\n\nexport function InterLogo({ size = 40, className = \"\" }: InterLogoProps) {\n  return (\n    <img \n      src={interLogoPath} \n      alt=\"Inter Milan Logo\" \n      width={size} \n      height={size}\n      className={`object-contain ${className}`}\n    />\n  );\n}","size_bytes":386},"client/src/pages/CadastroAluno.tsx":{"content":"import { ArrowLeft } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport AlunoForm from \"@/components/forms/AlunoForm\";\nimport { useLocation } from \"wouter\";\n\nexport default function CadastroAluno() {\n  const [, setLocation] = useLocation();\n\n  const handleSuccess = () => {\n    setLocation(\"/alunos\");\n  };\n\n  const handleBack = () => {\n    setLocation(\"/alunos\");\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6\">\n      <div className=\"max-w-4xl mx-auto\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-6\">\n          <div className=\"flex items-center space-x-4\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={handleBack}\n              className=\"flex items-center space-x-2\"\n            >\n              <ArrowLeft className=\"w-4 h-4\" />\n              <span>Voltar</span>\n            </Button>\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900\">Cadastro de Aluno</h1>\n              <p className=\"text-gray-600 mt-1\">Cadastre um novo aluno e responsável</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Form Card */}\n        <Card className=\"shadow-lg\">\n          <CardHeader className=\"bg-primary text-white\">\n            <CardTitle className=\"text-xl\">Informações do Aluno e Responsável</CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-8 max-h-[calc(100vh-200px)] overflow-y-auto\">\n            <AlunoForm onSuccess={handleSuccess} />\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":1730},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/unidade/TurmasTab.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { BookOpen, Search, Edit, Trash2, Clock, Users } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useUnidadeAuth } from \"@/contexts/UnidadeContext\";\nimport type { TurmaWithProfessor } from \"@shared/schema\";\n\nexport default function TurmasTab() {\n  const { filialId } = useUnidadeAuth();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingTurma, setEditingTurma] = useState<TurmaWithProfessor | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: turmas, isLoading } = useQuery({\n    queryKey: [\"/api/turmas\"],\n    enabled: !!filialId,\n  });\n\n  const deleteTurmaMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await apiRequest(\"DELETE\", `/api/turmas/${id}`);\n      if (!response.ok) {\n        throw new Error(\"Failed to delete turma\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/turmas\"] });\n      toast({\n        title: \"Turma excluída\",\n        description: \"A turma foi excluída com sucesso.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Não foi possível excluir a turma.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDeleteTurma = (id: number) => {\n    if (confirm(\"Tem certeza de que deseja excluir esta turma?\")) {\n      deleteTurmaMutation.mutate(id);\n    }\n  };\n\n  const handleEditTurma = (turma: TurmaWithProfessor) => {\n    setEditingTurma(turma);\n    setIsDialogOpen(true);\n  };\n\n  const handleCloseDialog = () => {\n    setIsDialogOpen(false);\n    setEditingTurma(null);\n  };\n\n  const turmasArray = Array.isArray(turmas) ? turmas : [];\n\n  const filteredTurmas = turmasArray.filter((turma) => {\n    return turma.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n           turma.modalidade?.toLowerCase().includes(searchTerm.toLowerCase());\n  });\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Turmas da Unidade</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <Skeleton className=\"h-10 w-full\" />\n            <Skeleton className=\"h-10 w-full\" />\n            <Skeleton className=\"h-10 w-full\" />\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900\">Turmas da Unidade</h2>\n          <p className=\"text-gray-600\">Gerencie as turmas da sua unidade</p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button className=\"flex items-center gap-2\">\n              <BookOpen className=\"w-4 h-4\" />\n              Nova Turma\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingTurma ? \"Editar Turma\" : \"Cadastrar Nova Turma\"}\n              </DialogTitle>\n            </DialogHeader>\n            <div className=\"p-4\">\n              <p className=\"text-center text-gray-600\">\n                Formulário de turma será implementado em breve.\n              </p>\n              <div className=\"flex justify-end gap-2 mt-4\">\n                <Button variant=\"outline\" onClick={handleCloseDialog}>\n                  Cancelar\n                </Button>\n                <Button onClick={handleCloseDialog}>\n                  Salvar\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex-1\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n              <Input\n                placeholder=\"Buscar por nome ou modalidade...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {filteredTurmas.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <BookOpen className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n                {turmasArray.length === 0 ? \"Nenhuma turma cadastrada\" : \"Nenhuma turma encontrada\"}\n              </h3>\n              <p className=\"text-gray-600 mb-4\">\n                {turmasArray.length === 0 \n                  ? \"Comece cadastrando a primeira turma da sua unidade.\"\n                  : \"Tente buscar por outros termos.\"\n                }\n              </p>\n              {turmasArray.length === 0 && (\n                <Button onClick={() => setIsDialogOpen(true)}>\n                  <BookOpen className=\"w-4 h-4 mr-2\" />\n                  Cadastrar Primeira Turma\n                </Button>\n              )}\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Nome</TableHead>\n                    <TableHead>Modalidade</TableHead>\n                    <TableHead>Professor</TableHead>\n                    <TableHead>Horário</TableHead>\n                    <TableHead>Capacidade</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Ações</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredTurmas.map((turma) => (\n                    <TableRow key={turma.id}>\n                      <TableCell>\n                        <div className=\"font-medium\">{turma.nome}</div>\n                      </TableCell>\n                      <TableCell>\n                        {turma.modalidade || \"Não informado\"}\n                      </TableCell>\n                      <TableCell>\n                        {turma.professor?.nome || \"Não atribuído\"}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-1 text-sm\">\n                          <Clock className=\"w-3 h-3\" />\n                          {turma.horario || \"Não definido\"}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-1 text-sm\">\n                          <Users className=\"w-3 h-3\" />\n                          {turma.capacidade || 0}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={turma.ativo ? \"default\" : \"secondary\"}>\n                          {turma.ativo ? \"Ativa\" : \"Inativa\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end gap-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleEditTurma(turma)}\n                          >\n                            <Edit className=\"w-3 h-3\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleDeleteTurma(turma.id)}\n                            className=\"text-red-600 hover:text-red-700\"\n                          >\n                            <Trash2 className=\"w-3 h-3\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":8889},"client/src/components/Sidebar.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { useLocation } from \"wouter\";\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  LayoutDashboard, \n  Users, \n  UserSquare2, \n  UsersRound, \n  DollarSign, \n  FileBarChart, \n  LogOut,\n  Building2,\n  CircleUser\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { User } from \"@shared/schema\";\n\nexport default function Sidebar() {\n  const { user } = useAuth();\n  const [location] = useLocation();\n  \n  const userData = user as User | undefined;\n\n  const navigationItems = [\n    {\n      name: \"Dashboard\",\n      href: \"/\",\n      icon: LayoutDashboard,\n      active: location === \"/\",\n    },\n    {\n      name: \"Alunos\",\n      href: \"/alunos\",\n      icon: Users,\n      active: location === \"/alunos\",\n    },\n    {\n      name: \"Professores\",\n      href: \"/professores\",\n      icon: UserSquare2,\n      active: location === \"/professores\",\n    },\n    {\n      name: \"Turmas\",\n      href: \"/turmas\",\n      icon: UsersRound,\n      active: location === \"/turmas\",\n    },\n    {\n      name: \"Filiais\",\n      href: \"/filiais\",\n      icon: Building2,\n      active: location === \"/filiais\",\n    },\n    {\n      name: \"Financeiro\",\n      href: \"/financeiro\",\n      icon: DollarSign,\n      active: location === \"/financeiro\",\n    },\n    {\n      name: \"Relatórios\",\n      href: \"/relatorios\",\n      icon: FileBarChart,\n      active: location === \"/relatorios\",\n    },\n  ];\n\n  const handleLogout = () => {\n    window.location.href = \"/api/logout\";\n  };\n\n  return (\n    <aside className=\"w-72 bg-[hsl(var(--sidebar-bg))] text-[hsl(var(--sidebar-foreground))] flex flex-col shadow-2xl border-r border-white/5\">\n      {/* Header */}\n      <div className=\"p-6 border-b border-white/10\">\n        <div className=\"flex items-center space-x-3\">\n          <div className=\"relative\">\n            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center shadow-lg shadow-green-500/30\">\n              <svg \n                xmlns=\"http://www.w3.org/2000/svg\" \n                viewBox=\"0 0 24 24\" \n                fill=\"none\" \n                stroke=\"currentColor\" \n                strokeWidth=\"2\" \n                strokeLinecap=\"round\" \n                strokeLinejoin=\"round\" \n                className=\"w-7 h-7 text-white\"\n              >\n                <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n                <path d=\"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2z\"/>\n                <path d=\"M8 12h8\"/>\n                <path d=\"M12 8v8\"/>\n              </svg>\n            </div>\n            <div className=\"absolute -bottom-1 -right-1 w-4 h-4 bg-green-400 rounded-full border-2 border-[hsl(var(--sidebar-bg))]\"></div>\n          </div>\n          <div>\n            <h1 className=\"text-xl font-bold text-white\">EscolaFut</h1>\n            <p className=\"text-xs text-white/60 mt-0.5\">Sistema de Gestão</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Navigation */}\n      <nav className=\"flex-1 p-4 space-y-1\">\n        {navigationItems.map((item) => {\n          const Icon = item.icon;\n          return (\n            <Link key={item.name} href={item.href}>\n              <button\n                data-testid={`nav-${item.name.toLowerCase()}`}\n                className={cn(\n                  \"w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200\",\n                  item.active\n                    ? \"bg-green-500/20 text-green-400 shadow-lg shadow-green-500/10\"\n                    : \"text-white/70 hover:text-white hover:bg-white/5\"\n                )}\n              >\n                <Icon className=\"h-5 w-5 flex-shrink-0\" />\n                <span>{item.name}</span>\n              </button>\n            </Link>\n          );\n        })}\n      </nav>\n\n      {/* User Profile */}\n      <div className=\"p-4 border-t border-white/10\">\n        <div className=\"bg-white/5 rounded-xl p-4\">\n          <div className=\"flex items-center space-x-3 mb-3\">\n            {userData?.profileImageUrl ? (\n              <img \n                src={userData.profileImageUrl} \n                alt=\"Perfil do usuário\"\n                data-testid=\"img-user-profile\"\n                className=\"w-11 h-11 rounded-full object-cover ring-2 ring-green-500/30\" \n              />\n            ) : (\n              <div \n                className=\"w-11 h-11 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center shadow-lg\"\n                data-testid=\"icon-user-avatar\"\n              >\n                <CircleUser className=\"w-6 h-6 text-white\" />\n              </div>\n            )}\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-semibold text-white truncate\" data-testid=\"text-user-name\">\n                {userData?.firstName || userData?.email || \"Usuário\"}\n              </p>\n              <p className=\"text-xs text-white/50 mt-0.5\" data-testid=\"text-user-role\">Administrador</p>\n            </div>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={handleLogout}\n            data-testid=\"button-logout\"\n            className=\"w-full justify-start text-white/70 hover:text-white hover:bg-white/5 h-9\"\n          >\n            <LogOut className=\"mr-2 h-4 w-4\" />\n            Sair\n          </Button>\n        </div>\n      </div>\n    </aside>\n  );\n}\n","size_bytes":5456},"client/src/pages/LoginUnidade.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { loginGestorSchema } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useLocation } from \"wouter\";\nimport { Building2, LogIn, Eye, EyeOff, ArrowLeft } from \"lucide-react\";\nimport { z } from \"zod\";\n\ntype LoginFormData = z.infer<typeof loginGestorSchema>;\n\nexport default function LoginUnidade() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [isLoading, setIsLoading] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n\n  const form = useForm<LoginFormData>({\n    resolver: zodResolver(loginGestorSchema),\n    defaultValues: {\n      email: \"\",\n      senha: \"\",\n    },\n  });\n\n  const onSubmit = async (data: LoginFormData) => {\n    setIsLoading(true);\n    try {\n      const response = await apiRequest(\"POST\", \"/api/unidade/login\", data);\n      const result = await response.json();\n      \n      if (response.ok) {\n        toast({\n          title: \"Login realizado com sucesso!\",\n          description: \"Redirecionando para o painel da unidade...\",\n        });\n        \n        // Redirect to unit dashboard\n        setLocation(`/unidade/${result.filialId}/sistema`);\n      } else {\n        toast({\n          title: \"Erro no login\",\n          description: result.message || \"Credenciais inválidas\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Erro de conexão\",\n        description: \"Não foi possível conectar ao servidor\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-blue-50 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md\">\n        <Card className=\"shadow-lg\">\n          <CardHeader className=\"text-center\">\n            <div className=\"flex justify-center mb-4\">\n              <Building2 className=\"h-12 w-12 text-blue-600\" />\n            </div>\n            <CardTitle className=\"text-2xl font-bold text-gray-900\">\n              Acesso da Unidade\n            </CardTitle>\n            <CardDescription>\n              Entre com suas credenciais para acessar o painel administrativo da sua unidade\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"email\"\n                          placeholder=\"seu.email@escola.com\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"senha\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Senha</FormLabel>\n                      <FormControl>\n                        <div className=\"relative\">\n                          <Input\n                            type={showPassword ? \"text\" : \"password\"}\n                            placeholder=\"Digite sua senha\"\n                            {...field}\n                          />\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                            onClick={() => setShowPassword(!showPassword)}\n                          >\n                            {showPassword ? (\n                              <EyeOff className=\"h-4 w-4 text-gray-400\" />\n                            ) : (\n                              <Eye className=\"h-4 w-4 text-gray-400\" />\n                            )}\n                          </Button>\n                        </div>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <Button\n                  type=\"submit\"\n                  className=\"w-full\"\n                  disabled={isLoading}\n                >\n                  {isLoading ? (\n                    <div className=\"flex items-center\">\n                      <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2\" />\n                      Entrando...\n                    </div>\n                  ) : (\n                    <div className=\"flex items-center\">\n                      <LogIn className=\"h-4 w-4 mr-2\" />\n                      Entrar\n                    </div>\n                  )}\n                </Button>\n              </form>\n            </Form>\n\n            <div className=\"mt-6 text-center\">\n              <p className=\"text-sm text-gray-600\">\n                Não possui acesso?{\" \"}\n                <Button\n                  variant=\"link\"\n                  className=\"p-0 h-auto font-medium text-blue-600\"\n                  onClick={() => setLocation(\"/unidade/cadastro\")}\n                >\n                  Solicitar cadastro\n                </Button>\n              </p>\n              \n              <Button\n                variant=\"ghost\"\n                onClick={() => window.location.href = \"/\"}\n                className=\"mt-4 text-sm text-gray-600 hover:text-gray-800\"\n              >\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Voltar para Página de Apresentação\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":6415},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/pages/DashboardUnidades.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { \n  Building2, \n  Users, \n  DollarSign, \n  TrendingUp, \n  ArrowLeft,\n  BarChart3,\n  Target,\n  Calendar\n} from \"lucide-react\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell } from \"recharts\";\nimport type { Filial, AlunoWithFilial } from \"@shared/schema\";\n\ninterface UnidadeMetrics {\n  unidadeId: number;\n  nomeUnidade: string;\n  totalAlunos: number;\n  alunosAtivos: number;\n  alunosEmDia: number;\n  alunosAtrasados: number;\n  receitaMensal: number;\n  percentualPagantes: number;\n}\n\nexport default function DashboardUnidades() {\n  const { data: unidades, isLoading: loadingUnidades } = useQuery<Filial[]>({\n    queryKey: [\"/api/filiais\"],\n  });\n\n  const { data: alunos, isLoading: loadingAlunos } = useQuery<AlunoWithFilial[]>({\n    queryKey: [\"/api/alunos\"],\n  });\n\n  const calcularMetricasUnidades = (): UnidadeMetrics[] => {\n    if (!unidades || !alunos) return [];\n\n    return unidades.map(unidade => {\n      const alunosUnidade = alunos.filter(aluno => aluno.filialId === unidade.id);\n      const alunosAtivos = alunosUnidade.filter(aluno => aluno.ativo);\n      const alunosEmDia = alunosUnidade.filter(aluno => aluno.statusPagamento?.emDia);\n      const alunosAtrasados = alunosUnidade.filter(aluno => aluno.statusPagamento && !aluno.statusPagamento.emDia);\n      \n      return {\n        unidadeId: unidade.id,\n        nomeUnidade: unidade.nome,\n        totalAlunos: alunosUnidade.length,\n        alunosAtivos: alunosAtivos.length,\n        alunosEmDia: alunosEmDia.length,\n        alunosAtrasados: alunosAtrasados.length,\n        receitaMensal: alunosEmDia.length * 150, // Assumindo mensalidade de R$ 150\n        percentualPagantes: alunosUnidade.length > 0 ? (alunosEmDia.length / alunosUnidade.length) * 100 : 0\n      };\n    });\n  };\n\n  const metricas = calcularMetricasUnidades();\n  const isLoading = loadingUnidades || loadingAlunos;\n\n  const dadosGraficoBarras = metricas.map(m => ({\n    nome: m.nomeUnidade,\n    alunos: m.totalAlunos,\n    ativos: m.alunosAtivos,\n    emDia: m.alunosEmDia,\n    atrasados: m.alunosAtrasados\n  }));\n\n  const dadosGraficoPizza = metricas.map(m => ({\n    name: m.nomeUnidade,\n    value: m.totalAlunos,\n    receita: m.receitaMensal\n  }));\n\n  const cores = ['#10B981', '#3B82F6', '#8B5CF6', '#F59E0B', '#EF4444'];\n\n  const totalGeral = {\n    alunos: metricas.reduce((acc, m) => acc + m.totalAlunos, 0),\n    ativos: metricas.reduce((acc, m) => acc + m.alunosAtivos, 0),\n    emDia: metricas.reduce((acc, m) => acc + m.alunosEmDia, 0),\n    receita: metricas.reduce((acc, m) => acc + m.receitaMensal, 0)\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-4\">\n          <Button variant=\"outline\" onClick={() => window.location.href = '/'}>\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Dashboard Principal\n          </Button>\n          <div>\n            <h2 className=\"text-3xl font-bold text-neutral-800\">Dashboard das Unidades</h2>\n            <p className=\"text-neutral-600\">Visão comparativa de todas as unidades</p>\n          </div>\n        </div>\n        <div className=\"flex items-center space-x-3\">\n          <Button variant=\"outline\" onClick={() => window.location.href = '/filiais'}>\n            <Building2 className=\"w-4 h-4 mr-2\" />\n            Gerenciar Unidades\n          </Button>\n        </div>\n      </div>\n\n      {/* Resumo Geral */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-neutral-500\">Total de Alunos</p>\n                <p className=\"text-2xl font-bold\">{totalGeral.alunos}</p>\n              </div>\n              <Users className=\"w-8 h-8 text-blue-600\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-neutral-500\">Alunos Ativos</p>\n                <p className=\"text-2xl font-bold text-green-600\">{totalGeral.ativos}</p>\n              </div>\n              <Target className=\"w-8 h-8 text-green-600\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-neutral-500\">Em Dia com Pagamentos</p>\n                <p className=\"text-2xl font-bold text-green-600\">{totalGeral.emDia}</p>\n              </div>\n              <Calendar className=\"w-8 h-8 text-green-600\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-neutral-500\">Receita Mensal Total</p>\n                <p className=\"text-2xl font-bold text-green-600\">\n                  R$ {totalGeral.receita.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\n                </p>\n              </div>\n              <DollarSign className=\"w-8 h-8 text-green-600\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Métricas por Unidade */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            <Building2 className=\"w-5 h-5 mr-2\" />\n            Métricas por Unidade\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {[...Array(6)].map((_, i) => (\n                <div key={i} className=\"p-4 border rounded-lg\">\n                  <Skeleton className=\"h-6 w-32 mb-2\" />\n                  <Skeleton className=\"h-4 w-20 mb-1\" />\n                  <Skeleton className=\"h-4 w-24 mb-1\" />\n                  <Skeleton className=\"h-4 w-28\" />\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {metricas.map((metrica, index) => (\n                <div key={metrica.unidadeId} className=\"p-4 border rounded-lg hover:shadow-md transition-shadow\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <h3 className=\"font-semibold text-lg\">{metrica.nomeUnidade}</h3>\n                    <div \n                      className=\"w-4 h-4 rounded-full\" \n                      style={{ backgroundColor: cores[index % cores.length] }}\n                    />\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-sm text-neutral-600\">Total de Alunos:</span>\n                      <Badge variant=\"outline\">{metrica.totalAlunos}</Badge>\n                    </div>\n                    \n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-sm text-neutral-600\">Ativos:</span>\n                      <Badge className=\"bg-green-100 text-green-800\">{metrica.alunosAtivos}</Badge>\n                    </div>\n                    \n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-sm text-neutral-600\">Em Dia:</span>\n                      <Badge className=\"bg-blue-100 text-blue-800\">{metrica.alunosEmDia}</Badge>\n                    </div>\n                    \n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-sm text-neutral-600\">Atrasados:</span>\n                      <Badge variant=\"destructive\">{metrica.alunosAtrasados}</Badge>\n                    </div>\n                    \n                    <div className=\"flex justify-between items-center pt-2 border-t\">\n                      <span className=\"text-sm font-medium\">Receita Mensal:</span>\n                      <span className=\"font-bold text-green-600\">\n                        R$ {metrica.receitaMensal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\n                      </span>\n                    </div>\n                    \n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-sm text-neutral-600\">% Pagantes:</span>\n                      <Badge \n                        className={metrica.percentualPagantes >= 80 ? \"bg-green-100 text-green-800\" : \n                                  metrica.percentualPagantes >= 60 ? \"bg-yellow-100 text-yellow-800\" : \n                                  \"bg-red-100 text-red-800\"}\n                      >\n                        {metrica.percentualPagantes.toFixed(1)}%\n                      </Badge>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Gráficos */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Gráfico de Barras */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <BarChart3 className=\"w-5 h-5 mr-2\" />\n              Comparativo de Alunos por Unidade\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-80\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <BarChart data={dadosGraficoBarras}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis dataKey=\"nome\" />\n                  <YAxis />\n                  <Tooltip />\n                  <Bar dataKey=\"ativos\" fill=\"#10B981\" name=\"Ativos\" />\n                  <Bar dataKey=\"emDia\" fill=\"#3B82F6\" name=\"Em Dia\" />\n                  <Bar dataKey=\"atrasados\" fill=\"#EF4444\" name=\"Atrasados\" />\n                </BarChart>\n              </ResponsiveContainer>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Gráfico de Pizza */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <TrendingUp className=\"w-5 h-5 mr-2\" />\n              Distribuição de Alunos por Unidade\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-80\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <PieChart>\n                  <Pie\n                    data={dadosGraficoPizza}\n                    cx=\"50%\"\n                    cy=\"50%\"\n                    labelLine={false}\n                    label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`}\n                    outerRadius={80}\n                    fill=\"#8884d8\"\n                    dataKey=\"value\"\n                  >\n                    {dadosGraficoPizza.map((entry, index) => (\n                      <Cell key={`cell-${index}`} fill={cores[index % cores.length]} />\n                    ))}\n                  </Pie>\n                  <Tooltip formatter={(value: number, name: string, props: any) => [\n                    `${value} alunos`,\n                    `Receita: R$ ${props.payload.receita.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`\n                  ]} />\n                </PieChart>\n              </ResponsiveContainer>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Ranking de Performance */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            <Target className=\"w-5 h-5 mr-2\" />\n            Ranking de Performance das Unidades\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {metricas\n              .sort((a, b) => b.percentualPagantes - a.percentualPagantes)\n              .map((metrica, index) => (\n                <div key={metrica.unidadeId} className=\"flex items-center justify-between p-4 bg-neutral-50 rounded-lg\">\n                  <div className=\"flex items-center space-x-4\">\n                    <div className=\"flex items-center justify-center w-8 h-8 bg-primary text-white rounded-full font-bold\">\n                      {index + 1}\n                    </div>\n                    <div>\n                      <h3 className=\"font-semibold\">{metrica.nomeUnidade}</h3>\n                      <p className=\"text-sm text-neutral-600\">\n                        {metrica.alunosEmDia} de {metrica.totalAlunos} alunos em dia\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <div className=\"text-lg font-bold text-green-600\">\n                      {metrica.percentualPagantes.toFixed(1)}%\n                    </div>\n                    <div className=\"text-sm text-neutral-600\">\n                      R$ {metrica.receitaMensal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\n                    </div>\n                  </div>\n                </div>\n              ))}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":13729},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/pages/TurmasUnidade.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { Plus, Search, Edit, Trash2, ArrowLeft, Users, Calendar, Clock } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport TurmaForm from \"@/components/forms/TurmaForm\";\nimport type { TurmaWithProfessor, Filial, InsertTurma } from \"@shared/schema\";\n\nexport default function TurmasUnidade() {\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [editingTurma, setEditingTurma] = useState<TurmaWithProfessor | null>(null);\n  const [dialogOpen, setDialogOpen] = useState(false);\n\n  // Recuperar unidade selecionada\n  const unidadeSelecionada = localStorage.getItem(\"unidade_selecionada\");\n  const filialId = unidadeSelecionada ? parseInt(unidadeSelecionada) : null;\n\n  if (!filialId) {\n    setLocation(\"/login-unidade\");\n    return null;\n  }\n\n  const { data: filial } = useQuery<Filial>({\n    queryKey: [`/api/filiais/${filialId}`],\n  });\n\n  const { data: turmas = [], isLoading } = useQuery<TurmaWithProfessor[]>({\n    queryKey: [`/api/filiais/${filialId}/turmas`],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertTurma) => {\n      return await apiRequest(\"POST\", \"/api/turmas\", {\n        ...data,\n        filialId\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/filiais/${filialId}/turmas`] });\n      setDialogOpen(false);\n      toast({\n        title: \"Sucesso\",\n        description: \"Turma criada com sucesso!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao criar turma: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: InsertTurma) => {\n      if (!editingTurma) return;\n      return await apiRequest(\"PUT\", `/api/turmas/${editingTurma.id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/filiais/${filialId}/turmas`] });\n      setEditingTurma(null);\n      setDialogOpen(false);\n      toast({\n        title: \"Sucesso\",\n        description: \"Turma atualizada com sucesso!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao atualizar turma: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return await apiRequest(\"DELETE\", `/api/turmas/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/filiais/${filialId}/turmas`] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Turma removida com sucesso!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao remover turma: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredTurmas = turmas.filter(turma =>\n    turma.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    turma.categoria?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    turma.professor?.nome.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const handleSubmit = (data: InsertTurma) => {\n    if (editingTurma) {\n      updateMutation.mutate(data);\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const openEditDialog = (turma: TurmaWithProfessor) => {\n    setEditingTurma(turma);\n    setDialogOpen(true);\n  };\n\n  const openCreateDialog = () => {\n    setEditingTurma(null);\n    setDialogOpen(true);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setLocation(\"/painel-unidade\")}\n            className=\"flex items-center gap-2\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n            Voltar ao Painel\n          </Button>\n          <div>\n            <h1 className=\"text-3xl font-bold\">Gestão de Turmas</h1>\n            <p className=\"text-muted-foreground\">\n              {filial?.nome} - {turmas.length} turmas ativas\n            </p>\n          </div>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={openCreateDialog} className=\"flex items-center gap-2\">\n              <Plus className=\"w-4 h-4\" />\n              Nova Turma\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingTurma ? \"Editar Turma\" : \"Nova Turma\"}\n              </DialogTitle>\n            </DialogHeader>\n            <TurmaForm\n              onSubmit={handleSubmit}\n              defaultValues={editingTurma || undefined}\n              isLoading={createMutation.isPending || updateMutation.isPending}\n              filialId={filialId}\n            />\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4\" />\n          <Input\n            placeholder=\"Buscar por nome, categoria ou professor...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n      </div>\n\n      {/* Content */}\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {[...Array(6)].map((_, i) => (\n            <Card key={i} className=\"animate-pulse\">\n              <CardHeader>\n                <div className=\"h-4 bg-muted rounded w-3/4\"></div>\n                <div className=\"h-3 bg-muted rounded w-1/2\"></div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <div className=\"h-3 bg-muted rounded\"></div>\n                  <div className=\"h-3 bg-muted rounded w-2/3\"></div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : filteredTurmas.length === 0 ? (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Users className=\"w-12 h-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">\n              {searchTerm ? \"Nenhuma turma encontrada\" : \"Nenhuma turma cadastrada\"}\n            </h3>\n            <p className=\"text-muted-foreground text-center mb-6\">\n              {searchTerm \n                ? \"Tente ajustar os termos de busca\" \n                : \"Comece criando a primeira turma da unidade\"\n              }\n            </p>\n            {!searchTerm && (\n              <Button onClick={openCreateDialog} className=\"flex items-center gap-2\">\n                <Plus className=\"w-4 h-4\" />\n                Criar Primeira Turma\n              </Button>\n            )}\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {filteredTurmas.map((turma) => (\n            <Card key={turma.id} className=\"hover:shadow-md transition-shadow\">\n              <CardHeader>\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <CardTitle className=\"text-lg\">{turma.nome}</CardTitle>\n                    <p className=\"text-sm text-muted-foreground\">{turma.categoria}</p>\n                  </div>\n                  <Badge variant={turma.ativo ? \"default\" : \"secondary\"}>\n                    {turma.ativo ? \"Ativa\" : \"Inativa\"}\n                  </Badge>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <Users className=\"w-4 h-4 text-muted-foreground\" />\n                    <span className=\"text-muted-foreground\">Professor:</span>\n                    <span>{turma.professor?.nome || \"Não atribuído\"}</span>\n                  </div>\n                  \n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <Calendar className=\"w-4 h-4 text-muted-foreground\" />\n                    <span className=\"text-muted-foreground\">Dias:</span>\n                    <span>{turma.diasSemana || \"Não definido\"}</span>\n                  </div>\n                  \n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <Clock className=\"w-4 h-4 text-muted-foreground\" />\n                    <span className=\"text-muted-foreground\">Horário:</span>\n                    <span>{turma.horario || \"Não definido\"}</span>\n                  </div>\n\n                  {turma.valor && (\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">Mensalidade:</span>\n                      <span className=\"font-medium text-green-600\">\n                        R$ {turma.valor.toFixed(2)}\n                      </span>\n                    </div>\n                  )}\n\n                  <div className=\"flex items-center justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">Vagas:</span>\n                    <span>\n                      {turma._count?.matriculas || 0} / {turma.limiteAlunos || \"∞\"}\n                    </span>\n                  </div>\n                </div>\n\n                <Separator className=\"my-4\" />\n\n                <div className=\"flex gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => openEditDialog(turma)}\n                    className=\"flex-1\"\n                  >\n                    <Edit className=\"w-4 h-4 mr-1\" />\n                    Editar\n                  </Button>\n                  <AlertDialog>\n                    <AlertDialogTrigger asChild>\n                      <Button variant=\"outline\" size=\"sm\">\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    </AlertDialogTrigger>\n                    <AlertDialogContent>\n                      <AlertDialogHeader>\n                        <AlertDialogTitle>Confirmar exclusão</AlertDialogTitle>\n                        <AlertDialogDescription>\n                          Tem certeza que deseja excluir a turma <strong>{turma.nome}</strong>? \n                          Esta ação não pode ser desfeita e afetará todos os alunos matriculados.\n                        </AlertDialogDescription>\n                      </AlertDialogHeader>\n                      <AlertDialogFooter>\n                        <AlertDialogCancel>Cancelar</AlertDialogCancel>\n                        <AlertDialogAction\n                          onClick={() => deleteMutation.mutate(turma.id)}\n                          className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                        >\n                          Excluir\n                        </AlertDialogAction>\n                      </AlertDialogFooter>\n                    </AlertDialogContent>\n                  </AlertDialog>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":12421},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/forms/PagamentoForm.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertPagamentoSchema, type InsertPagamento, type Aluno } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { format } from \"date-fns\";\n\nconst formSchema = insertPagamentoSchema.extend({\n  alunoId: z.number(),\n  dataPagamento: z.string(),\n});\n\ntype FormData = z.infer<typeof formSchema>;\n\ninterface PagamentoFormProps {\n  onSuccess: () => void;\n}\n\nconst formasPagamento = [\n  \"PIX\",\n  \"Dinheiro\", \n  \"Cartão\",\n  \"Transferência\",\n];\n\nexport default function PagamentoForm({ onSuccess }: PagamentoFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: alunos } = useQuery<Aluno[]>({\n    queryKey: [\"/api/alunos\"],\n  });\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      alunoId: undefined,\n      valor: \"\",\n      mesReferencia: format(new Date(), \"yyyy-MM\"),\n      dataPagamento: format(new Date(), \"yyyy-MM-dd\"),\n      formaPagamento: \"\",\n      observacoes: \"\",\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertPagamento) => {\n      const response = await apiRequest(\"POST\", \"/api/pagamentos\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/pagamentos\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/metrics\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Pagamento registrado com sucesso.\",\n      });\n      onSuccess();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao registrar pagamento. Verifique os dados e tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: FormData) => {\n    const submitData: InsertPagamento = {\n      ...data,\n      observacoes: data.observacoes || null,\n    };\n\n    createMutation.mutate(submitData);\n  };\n\n  const isLoading = createMutation.isPending;\n\n  // Generate month options\n  const getMonthOptions = () => {\n    const months = [];\n    const current = new Date();\n    const monthNames = [\"Janeiro\", \"Fevereiro\", \"Março\", \"Abril\", \"Maio\", \"Junho\",\n                       \"Julho\", \"Agosto\", \"Setembro\", \"Outubro\", \"Novembro\", \"Dezembro\"];\n    \n    for (let i = -2; i <= 3; i++) {\n      const date = new Date(current.getFullYear(), current.getMonth() + i, 1);\n      const value = format(date, \"yyyy-MM\");\n      const label = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;\n      months.push({ value, label });\n    }\n    return months;\n  };\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"alunoId\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Aluno *</FormLabel>\n                <Select \n                  onValueChange={(value) => field.onChange(parseInt(value))} \n                  defaultValue={field.value?.toString()}\n                >\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione um aluno\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {alunos?.filter(a => a.ativo).map((aluno) => (\n                      <SelectItem key={aluno.id} value={aluno.id.toString()}>\n                        {aluno.nome}\n                      </SelectItem>\n                    )) || []}\n                    {(!alunos || alunos.filter(a => a.ativo).length === 0) && (\n                      <SelectItem value=\"no-students\" disabled>\n                        Nenhum aluno ativo encontrado\n                      </SelectItem>\n                    )}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"valor\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Valor *</FormLabel>\n                <FormControl>\n                  <Input \n                    type=\"number\" \n                    step=\"0.01\"\n                    min=\"0\"\n                    placeholder=\"0.00\" \n                    {...field} \n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"mesReferencia\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Mês de Referência *</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione o mês\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {getMonthOptions().map((month) => (\n                      <SelectItem key={month.value} value={month.value}>\n                        {month.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"dataPagamento\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Data do Pagamento *</FormLabel>\n                <FormControl>\n                  <Input type=\"date\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <div className=\"md:col-span-2\">\n            <FormField\n              control={form.control}\n              name=\"formaPagamento\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Forma de Pagamento *</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Selecione a forma de pagamento\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {formasPagamento.map((forma) => (\n                        <SelectItem key={forma} value={forma}>\n                          {forma}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"observacoes\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Observações</FormLabel>\n              <FormControl>\n                <Textarea \n                  placeholder=\"Observações adicionais sobre o pagamento\"\n                  className=\"min-h-[80px]\"\n                  onChange={field.onChange}\n                  onBlur={field.onBlur}\n                  name={field.name}\n                  ref={field.ref}\n                  value={field.value || \"\"}\n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <div className=\"flex justify-end space-x-2 pt-4\">\n          <Button type=\"button\" variant=\"outline\" onClick={onSuccess}>\n            Cancelar\n          </Button>\n          <Button type=\"submit\" disabled={isLoading} className=\"bg-primary hover:bg-primary/90\">\n            {isLoading ? \"Registrando...\" : \"Registrar Pagamento\"}\n          </Button>\n        </div>\n      </form>\n    </Form>\n  );\n}\n","size_bytes":8604},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/UnidadeRedirect.tsx":{"content":"import { useEffect } from 'react';\nimport { useLocation, useParams } from 'wouter';\n\nexport default function UnidadeRedirect() {\n  const [, setLocation] = useLocation();\n  const { filialId } = useParams();\n\n  useEffect(() => {\n    // Se há um filialId válido, salva na sessão e redireciona\n    if (filialId && filialId !== 'undefined') {\n      // Salvar filialId no localStorage temporariamente para compatibilidade\n      localStorage.setItem('legacyFilialId', filialId);\n    }\n    \n    // Sempre redireciona para o novo sistema\n    setLocation('/portal-unidade');\n  }, [filialId, setLocation]);\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen bg-blue-50\">\n      <div className=\"text-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4\" />\n        <p className=\"text-gray-600\">Redirecionando para o portal da unidade...</p>\n      </div>\n    </div>\n  );\n}","size_bytes":961},"client/src/pages/AlunosUnidade.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { UserPlus, Search, Edit, Trash2, Phone, Mail, Calendar, ArrowLeft, Building2, Receipt, Filter } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { AlunoWithFilial } from \"@shared/schema\";\nimport AlunoForm from \"@/components/forms/AlunoForm\";\n\ninterface UnidadeSession {\n  gestorId: number;\n  filialId: number;\n  nomeGestor: string;\n  nomeFilial: string;\n  loginTime: string;\n}\n\nexport default function AlunosUnidade() {\n  const [match, params] = useRoute(\"/unidade/:filialId/alunos\");\n  const [, setLocation] = useLocation();\n  const [session, setSession] = useState<UnidadeSession | null>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"todos\");\n  const [pagamentoFilter, setPagamentoFilter] = useState<string>(\"todos\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingAluno, setEditingAluno] = useState<AlunoWithFilial | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  useEffect(() => {\n    const sessionData = localStorage.getItem('unidadeSession');\n    if (sessionData) {\n      const parsedSession = JSON.parse(sessionData);\n      setSession(parsedSession);\n      \n      if (params?.filialId && parseInt(params.filialId) !== parsedSession.filialId) {\n        toast({\n          title: \"Acesso negado\",\n          description: \"Você não tem permissão para acessar esta unidade\",\n          variant: \"destructive\",\n        });\n        setLocation(\"/portal-unidade\");\n        return;\n      }\n    } else {\n      setLocation(\"/portal-unidade\");\n    }\n  }, [params, setLocation, toast]);\n\n  const { data: alunos, isLoading } = useQuery<AlunoWithFilial[]>({\n    queryKey: [\"/api/unidade/alunos\", session?.filialId],\n    enabled: !!session?.filialId,\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await apiRequest(\"DELETE\", `/api/alunos/${id}`);\n      if (!response.ok) {\n        throw new Error(\"Erro ao deletar aluno\");\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/unidade/alunos\", session?.filialId] });\n      toast({\n        title: \"Aluno deletado\",\n        description: \"Aluno foi removido com sucesso\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao deletar aluno\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEditAluno = (aluno: AlunoWithFilial) => {\n    setEditingAluno(aluno);\n    setIsDialogOpen(true);\n  };\n\n  const handleDeleteAluno = (id: number) => {\n    if (window.confirm(\"Tem certeza que deseja deletar este aluno?\")) {\n      deleteMutation.mutate(id);\n    }\n  };\n\n  const handleDialogClose = () => {\n    setIsDialogOpen(false);\n    setEditingAluno(null);\n    queryClient.invalidateQueries({ queryKey: [\"/api/unidade/alunos\", session?.filialId] });\n  };\n\n  const calcularIdade = (dataNascimento: string) => {\n    const hoje = new Date();\n    const nascimento = new Date(dataNascimento);\n    let idade = hoje.getFullYear() - nascimento.getFullYear();\n    const mes = hoje.getMonth() - nascimento.getMonth();\n    if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {\n      idade--;\n    }\n    return idade;\n  };\n\n  const getStatusPagamento = (aluno: AlunoWithFilial) => {\n    // Implementar lógica de status de pagamento baseada nos pagamentos do aluno\n    const agora = new Date();\n    const mesAtual = agora.getFullYear() + \"-\" + String(agora.getMonth() + 1).padStart(2, '0');\n    \n    // Por enquanto, retornar um status simulado\n    return Math.random() > 0.3 ? \"em_dia\" : \"atrasado\";\n  };\n\n  const getStatusVariant = (status: string) => {\n    switch (status) {\n      case \"em_dia\":\n        return \"default\";\n      case \"atrasado\":\n        return \"destructive\";\n      default:\n        return \"secondary\";\n    }\n  };\n\n  // Filtrar alunos\n  const alunosFiltrados = alunos?.filter((aluno) => {\n    const matchesSearch = aluno.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         aluno.cpf?.includes(searchTerm) ||\n                         aluno.email?.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    const matchesStatus = statusFilter === \"todos\" || aluno.ativo === (statusFilter === \"ativo\");\n    \n    const statusPag = getStatusPagamento(aluno);\n    const matchesPagamento = pagamentoFilter === \"todos\" || statusPag === pagamentoFilter;\n    \n    return matchesSearch && matchesStatus && matchesPagamento;\n  }) || [];\n\n  if (!session) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow-sm border-b border-gray-200\">\n        <div className=\"flex items-center justify-between px-6 py-4\">\n          <div className=\"flex items-center space-x-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setLocation(`/unidade/${session.filialId}/dashboard`)}\n              className=\"text-gray-600 hover:text-gray-900\"\n            >\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Voltar ao Dashboard\n            </Button>\n            \n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center\">\n                <Building2 className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <h1 className=\"text-xl font-semibold text-gray-900\">Gestão de Alunos</h1>\n                <p className=\"text-sm text-gray-600\">{session.nomeFilial}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"p-6\">\n        {/* Actions Bar */}\n        <div className=\"flex justify-between items-center mb-6\">\n          <div>\n            <h2 className=\"text-2xl font-bold text-gray-900\">Alunos da Unidade</h2>\n            <p className=\"text-gray-600\">\n              {alunosFiltrados.length} {alunosFiltrados.length === 1 ? 'aluno encontrado' : 'alunos encontrados'}\n            </p>\n          </div>\n          \n          <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n            <DialogTrigger asChild>\n              <Button className=\"bg-blue-600 hover:bg-blue-700\">\n                <UserPlus className=\"w-4 h-4 mr-2\" />\n                Novo Aluno\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>\n                  {editingAluno ? \"Editar Aluno\" : \"Cadastrar Novo Aluno\"}\n                </DialogTitle>\n              </DialogHeader>\n              <AlunoForm \n                aluno={editingAluno} \n                onSuccess={handleDialogClose}\n              />\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        {/* Search and Filters */}\n        <Card className=\"mb-6\">\n          <CardContent className=\"p-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n              <div className=\"md:col-span-2\">\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n                  <Input\n                    placeholder=\"Buscar por nome, CPF ou email...\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"pl-10\"\n                  />\n                </div>\n              </div>\n              \n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"todos\">Todos os Status</SelectItem>\n                  <SelectItem value=\"ativo\">Ativo</SelectItem>\n                  <SelectItem value=\"inativo\">Inativo</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <Select value={pagamentoFilter} onValueChange={setPagamentoFilter}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Pagamento\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"todos\">Todos os Pagamentos</SelectItem>\n                  <SelectItem value=\"em_dia\">Em Dia</SelectItem>\n                  <SelectItem value=\"atrasado\">Atrasado</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Students Table */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <Filter className=\"w-5 h-5 mr-2\" />\n              Lista de Alunos\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"space-y-4\">\n                {[...Array(5)].map((_, i) => (\n                  <div key={i} className=\"flex items-center space-x-4\">\n                    <Skeleton className=\"w-10 h-10 rounded-full\" />\n                    <div className=\"space-y-2\">\n                      <Skeleton className=\"h-4 w-48\" />\n                      <Skeleton className=\"h-3 w-32\" />\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : alunosFiltrados.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <div className=\"w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center\">\n                  <UserPlus className=\"w-12 h-12 text-gray-400\" />\n                </div>\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n                  Nenhum aluno encontrado\n                </h3>\n                <p className=\"text-gray-600 mb-4\">\n                  {searchTerm || statusFilter !== \"todos\" || pagamentoFilter !== \"todos\"\n                    ? \"Tente ajustar os filtros de busca.\"\n                    : \"Cadastre o primeiro aluno da sua unidade.\"}\n                </p>\n                <Button onClick={() => setIsDialogOpen(true)}>\n                  <UserPlus className=\"w-4 h-4 mr-2\" />\n                  Cadastrar Primeiro Aluno\n                </Button>\n              </div>\n            ) : (\n              <div className=\"overflow-x-auto\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Aluno</TableHead>\n                      <TableHead>Idade</TableHead>\n                      <TableHead>Contato</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead>Pagamento</TableHead>\n                      <TableHead>Matrícula</TableHead>\n                      <TableHead className=\"text-right\">Ações</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {alunosFiltrados.map((aluno) => (\n                      <TableRow key={aluno.id}>\n                        <TableCell>\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center\">\n                              <span className=\"text-sm font-medium text-blue-600\">\n                                {aluno.nome.charAt(0).toUpperCase()}\n                              </span>\n                            </div>\n                            <div>\n                              <div className=\"font-medium text-gray-900\">{aluno.nome}</div>\n                              <div className=\"text-sm text-gray-600\">{aluno.cpf}</div>\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          {aluno.dataNascimento ? (\n                            <span className=\"text-sm text-gray-900\">\n                              {calcularIdade(aluno.dataNascimento)} anos\n                            </span>\n                          ) : (\n                            <span className=\"text-sm text-gray-400\">-</span>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"space-y-1\">\n                            {aluno.telefone && (\n                              <div className=\"flex items-center text-sm text-gray-600\">\n                                <Phone className=\"w-3 h-3 mr-1\" />\n                                {aluno.telefone}\n                              </div>\n                            )}\n                            {aluno.email && (\n                              <div className=\"flex items-center text-sm text-gray-600\">\n                                <Mail className=\"w-3 h-3 mr-1\" />\n                                {aluno.email}\n                              </div>\n                            )}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={aluno.ativo ? \"default\" : \"secondary\"}>\n                            {aluno.ativo ? \"Ativo\" : \"Inativo\"}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={getStatusVariant(getStatusPagamento(aluno))}>\n                            {getStatusPagamento(aluno) === \"em_dia\" ? \"Em Dia\" : \"Atrasado\"}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          {aluno.dataMatricula && (\n                            <div className=\"flex items-center text-sm text-gray-600\">\n                              <Calendar className=\"w-3 h-3 mr-1\" />\n                              {format(new Date(aluno.dataMatricula), \"dd/MM/yyyy\", { locale: ptBR })}\n                            </div>\n                          )}\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <div className=\"flex justify-end space-x-2\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => handleEditAluno(aluno)}\n                            >\n                              <Edit className=\"w-4 h-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => handleDeleteAluno(aluno.id)}\n                              className=\"text-red-600 hover:text-red-700\"\n                            >\n                              <Trash2 className=\"w-4 h-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":16380},"server/sync.ts":{"content":"import { storage } from \"./storage\";\n\ninterface SyncData {\n  unidadeId: number;\n  tipo: 'aluno' | 'professor' | 'pagamento' | 'presenca' | 'avaliacao';\n  acao: 'create' | 'update' | 'delete';\n  dados: any;\n  timestamp: Date;\n}\n\nclass SyncManager {\n  private pendingSyncs: SyncData[] = [];\n  private syncInterval: NodeJS.Timeout | null = null;\n\n  constructor() {\n    this.startSyncScheduler();\n  }\n\n  // Adiciona operação para sincronização\n  async addToSync(syncData: SyncData) {\n    this.pendingSyncs.push(syncData);\n    console.log(`[SYNC] Adicionado para sincronização: ${syncData.tipo} - ${syncData.acao} - Unidade ${syncData.unidadeId}`);\n    \n    // Sincronização imediata para operações críticas\n    if (syncData.tipo === 'pagamento') {\n      await this.processSyncBatch();\n    }\n  }\n\n  // Processa todas as sincronizações pendentes\n  async processSyncBatch() {\n    if (this.pendingSyncs.length === 0) return;\n\n    console.log(`[SYNC] Processando ${this.pendingSyncs.length} sincronizações pendentes`);\n\n    const syncsToProcess = [...this.pendingSyncs];\n    this.pendingSyncs = [];\n\n    for (const sync of syncsToProcess) {\n      try {\n        await this.processSync(sync);\n        console.log(`[SYNC] Sucesso: ${sync.tipo} - ${sync.acao} - Unidade ${sync.unidadeId}`);\n      } catch (error) {\n        console.error(`[SYNC] Erro ao sincronizar: ${sync.tipo} - ${sync.acao}`, error);\n        // Re-adiciona à fila em caso de erro\n        this.pendingSyncs.push(sync);\n      }\n    }\n  }\n\n  // Processa uma sincronização individual\n  private async processSync(sync: SyncData) {\n    const { unidadeId, tipo, acao, dados } = sync;\n\n    switch (tipo) {\n      case 'aluno':\n        await this.syncAluno(acao, dados, unidadeId);\n        break;\n      case 'professor':\n        await this.syncProfessor(acao, dados, unidadeId);\n        break;\n      case 'pagamento':\n        await this.syncPagamento(acao, dados, unidadeId);\n        break;\n      case 'presenca':\n        await this.syncPresenca(acao, dados, unidadeId);\n        break;\n      case 'avaliacao':\n        await this.syncAvaliacao(acao, dados, unidadeId);\n        break;\n    }\n  }\n\n  private async syncAluno(acao: string, dados: any, unidadeId: number) {\n    // Garantir que o aluno pertence à unidade correta\n    const alunoData = { ...dados, filialId: unidadeId };\n    \n    switch (acao) {\n      case 'create':\n        await storage.createAluno(alunoData);\n        break;\n      case 'update':\n        await storage.updateAluno(dados.id, alunoData);\n        break;\n      case 'delete':\n        await storage.deleteAluno(dados.id);\n        break;\n    }\n  }\n\n  private async syncProfessor(acao: string, dados: any, unidadeId: number) {\n    const professorData = { ...dados, filialId: unidadeId };\n    \n    switch (acao) {\n      case 'create':\n        await storage.createProfessor(professorData);\n        break;\n      case 'update':\n        await storage.updateProfessor(dados.id, professorData);\n        break;\n      case 'delete':\n        await storage.deleteProfessor(dados.id);\n        break;\n    }\n  }\n\n  private async syncPagamento(acao: string, dados: any, unidadeId: number) {\n    switch (acao) {\n      case 'create':\n        await storage.createPagamento(dados);\n        break;\n      case 'delete':\n        await storage.deletePagamento(dados.id);\n        break;\n    }\n  }\n\n  private async syncPresenca(acao: string, dados: any, unidadeId: number) {\n    switch (acao) {\n      case 'create':\n        // Registra presenças em lote\n        await storage.registrarPresencas(Array.isArray(dados) ? dados : [dados]);\n        break;\n    }\n  }\n\n  private async syncAvaliacao(acao: string, dados: any, unidadeId: number) {\n    switch (acao) {\n      case 'create':\n        await storage.createAvaliacaoFisica(dados);\n        break;\n      case 'update':\n        await storage.updateAvaliacaoFisica(dados.id, dados);\n        break;\n      case 'delete':\n        await storage.deleteAvaliacaoFisica(dados.id);\n        break;\n    }\n  }\n\n  // Inicia o agendador de sincronização\n  private startSyncScheduler() {\n    // Sincronização a cada 30 segundos\n    this.syncInterval = setInterval(async () => {\n      await this.processSyncBatch();\n    }, 30000);\n  }\n\n  // Para o agendador\n  stopSyncScheduler() {\n    if (this.syncInterval) {\n      clearInterval(this.syncInterval);\n      this.syncInterval = null;\n    }\n  }\n\n  // Obtém estatísticas de sincronização\n  getSyncStats() {\n    return {\n      pendingSyncs: this.pendingSyncs.length,\n      isActive: this.syncInterval !== null\n    };\n  }\n\n  // Força sincronização imediata\n  async forceSyncNow() {\n    await this.processSyncBatch();\n  }\n}\n\nexport const syncManager = new SyncManager();\n\n// Função helper para adicionar sincronização\nexport async function addToSync(\n  unidadeId: number,\n  tipo: 'aluno' | 'professor' | 'pagamento' | 'presenca' | 'avaliacao',\n  acao: 'create' | 'update' | 'delete',\n  dados: any\n) {\n  await syncManager.addToSync({\n    unidadeId,\n    tipo,\n    acao,\n    dados,\n    timestamp: new Date()\n  });\n}","size_bytes":5065},"client/src/pages/AvaliacaoFisica.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Plus, Target, Activity, TrendingUp, Users, FileText, Calendar, Calculator } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  insertCategoriaTesteSchema, \n  insertTesteSchema, \n  insertAvaliacaoFisicaSchema,\n  insertResultadoTesteSchema,\n  insertMetaAlunoSchema,\n  type CategoriaTeste,\n  type TesteWithCategoria,\n  type AvaliacaoFisicaComplete,\n  type Aluno,\n  type Professor\n} from \"@shared/schema\";\n\nexport default function AvaliacaoFisica() {\n  const [activeTab, setActiveTab] = useState(\"categorias\");\n  const [selectedCategoria, setSelectedCategoria] = useState<number | null>(null);\n  const [selectedAluno, setSelectedAluno] = useState<number | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Queries\n  const { data: categorias = [] } = useQuery({\n    queryKey: [\"/api/categorias-testes\"],\n  });\n\n  const { data: testes = [] } = useQuery({\n    queryKey: [\"/api/testes\"],\n  });\n\n  const { data: avaliacoes = [] } = useQuery({\n    queryKey: [\"/api/avaliacoes-fisicas\"],\n  });\n\n  const { data: alunos = [] } = useQuery({\n    queryKey: [\"/api/alunos\"],\n  });\n\n  const { data: professores = [] } = useQuery({\n    queryKey: [\"/api/professores\"],\n  });\n\n  // Forms\n  const categoriaForm = useForm({\n    resolver: zodResolver(insertCategoriaTesteSchema),\n    defaultValues: {\n      nome: \"\",\n      descricao: \"\",\n      unidadeMedida: \"\",\n      tipoTeste: \"fisico\",\n      ativo: true,\n    },\n  });\n\n  const testeForm = useForm({\n    resolver: zodResolver(insertTesteSchema),\n    defaultValues: {\n      categoriaId: 0,\n      nome: \"\",\n      descricao: \"\",\n      instrucoes: \"\",\n      unidadeMedida: \"\",\n      valorMinimo: 0,\n      valorMaximo: 100,\n      ativo: true,\n    },\n  });\n\n  const avaliacaoForm = useForm({\n    resolver: zodResolver(insertAvaliacaoFisicaSchema),\n    defaultValues: {\n      alunoId: 0,\n      professorId: 0,\n      dataAvaliacao: new Date().toISOString().split('T')[0],\n      pesoKg: 0,\n      alturaM: 0,\n      imc: 0,\n      observacoesGerais: \"\",\n      recomendacoes: \"\",\n      proximaAvaliacao: \"\",\n      filialId: 1,\n    },\n  });\n\n  // Mutations\n  const createCategoriaMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest(\"POST\", \"/api/categorias-testes\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/categorias-testes\"] });\n      categoriaForm.reset();\n      toast({\n        title: \"Categoria criada\",\n        description: \"A categoria de teste foi criada com sucesso.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao criar categoria: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createTesteMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest(\"POST\", \"/api/testes\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/testes\"] });\n      testeForm.reset();\n      toast({\n        title: \"Teste criado\",\n        description: \"O teste foi criado com sucesso.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao criar teste: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createAvaliacaoMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest(\"POST\", \"/api/avaliacoes-fisicas\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/avaliacoes-fisicas\"] });\n      avaliacaoForm.reset();\n      toast({\n        title: \"Avaliação criada\",\n        description: \"A avaliação física foi criada com sucesso.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao criar avaliação: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmitCategoria = (data: any) => {\n    createCategoriaMutation.mutate(data);\n  };\n\n  const onSubmitTeste = (data: any) => {\n    createTesteMutation.mutate(data);\n  };\n\n  const onSubmitAvaliacao = (data: any) => {\n    // Calculate IMC automatically\n    if (data.pesoKg && data.alturaM) {\n      data.imc = (data.pesoKg / (data.alturaM * data.alturaM)).toFixed(2);\n    }\n    createAvaliacaoMutation.mutate(data);\n  };\n\n  const testesFiltrados = selectedCategoria \n    ? testes.filter((teste: any) => teste.categoriaId === selectedCategoria)\n    : testes;\n\n  return (\n    <div className=\"container mx-auto px-4 py-6 space-y-6\">\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-[#0847ad]\">Sistema de Avaliação Física</h1>\n          <p className=\"text-gray-600\">Gestão completa de avaliações físicas dos alunos</p>\n        </div>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"categorias\" className=\"flex items-center gap-2\">\n            <Activity className=\"h-4 w-4\" />\n            <span className=\"hidden sm:inline\">Categorias</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"testes\" className=\"flex items-center gap-2\">\n            <Target className=\"h-4 w-4\" />\n            <span className=\"hidden sm:inline\">Testes</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"avaliacoes\" className=\"flex items-center gap-2\">\n            <FileText className=\"h-4 w-4\" />\n            <span className=\"hidden sm:inline\">Avaliações</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"relatorios\" className=\"flex items-center gap-2\">\n            <TrendingUp className=\"h-4 w-4\" />\n            <span className=\"hidden sm:inline\">Relatórios</span>\n          </TabsTrigger>\n        </TabsList>\n\n        {/* Categorias Tab */}\n        <TabsContent value=\"categorias\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Plus className=\"h-5 w-5\" />\n                  Nova Categoria de Teste\n                </CardTitle>\n                <CardDescription>\n                  Crie categorias para organizar os diferentes tipos de testes físicos\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <Form {...categoriaForm}>\n                  <form onSubmit={categoriaForm.handleSubmit(onSubmitCategoria)} className=\"space-y-4\">\n                    <FormField\n                      control={categoriaForm.control}\n                      name=\"nome\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Nome da Categoria</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Ex: Resistência, Velocidade, Força\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={categoriaForm.control}\n                      name=\"descricao\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Descrição</FormLabel>\n                          <FormControl>\n                            <Textarea placeholder=\"Descreva o objetivo desta categoria\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <FormField\n                        control={categoriaForm.control}\n                        name=\"unidadeMedida\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Unidade de Medida</FormLabel>\n                            <FormControl>\n                              <Input placeholder=\"Ex: segundos, metros\" {...field} />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={categoriaForm.control}\n                        name=\"tipoTeste\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Tipo de Teste</FormLabel>\n                            <Select onValueChange={field.onChange} defaultValue={field.value}>\n                              <FormControl>\n                                <SelectTrigger>\n                                  <SelectValue placeholder=\"Selecione o tipo\" />\n                                </SelectTrigger>\n                              </FormControl>\n                              <SelectContent>\n                                <SelectItem value=\"fisico\">Físico</SelectItem>\n                                <SelectItem value=\"tecnico\">Técnico</SelectItem>\n                                <SelectItem value=\"antropometrico\">Antropométrico</SelectItem>\n                              </SelectContent>\n                            </Select>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full bg-[#0847ad] hover:bg-[#0847ad]/90\"\n                      disabled={createCategoriaMutation.isPending}\n                    >\n                      {createCategoriaMutation.isPending ? \"Criando...\" : \"Criar Categoria\"}\n                    </Button>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Categorias Existentes</CardTitle>\n                <CardDescription>\n                  {categorias.length} categoria(s) cadastrada(s)\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {categorias.map((categoria: any) => (\n                    <div key={categoria.id} className=\"p-3 border rounded-lg\">\n                      <div className=\"flex justify-between items-start\">\n                        <div>\n                          <h4 className=\"font-medium text-[#0847ad]\">{categoria.nome}</h4>\n                          <p className=\"text-sm text-gray-600 mt-1\">{categoria.descricao}</p>\n                          <div className=\"flex gap-2 mt-2\">\n                            <Badge variant=\"outline\">{categoria.tipoTeste}</Badge>\n                            {categoria.unidadeMedida && (\n                              <Badge variant=\"secondary\">{categoria.unidadeMedida}</Badge>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Testes Tab */}\n        <TabsContent value=\"testes\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Target className=\"h-5 w-5\" />\n                  Novo Teste\n                </CardTitle>\n                <CardDescription>\n                  Crie testes específicos dentro de cada categoria\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <Form {...testeForm}>\n                  <form onSubmit={testeForm.handleSubmit(onSubmitTeste)} className=\"space-y-4\">\n                    <FormField\n                      control={testeForm.control}\n                      name=\"categoriaId\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Categoria</FormLabel>\n                          <Select onValueChange={(value) => field.onChange(parseInt(value))}>\n                            <FormControl>\n                              <SelectTrigger>\n                                <SelectValue placeholder=\"Selecione uma categoria\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {categorias.map((categoria: any) => (\n                                <SelectItem key={categoria.id} value={categoria.id.toString()}>\n                                  {categoria.nome}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={testeForm.control}\n                      name=\"nome\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Nome do Teste</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Ex: Corrida de 20 metros, Flexão de braço\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={testeForm.control}\n                      name=\"instrucoes\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Instruções</FormLabel>\n                          <FormControl>\n                            <Textarea placeholder=\"Como executar este teste...\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"grid grid-cols-3 gap-4\">\n                      <FormField\n                        control={testeForm.control}\n                        name=\"unidadeMedida\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Unidade</FormLabel>\n                            <FormControl>\n                              <Input placeholder=\"Ex: seg, rep\" {...field} />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={testeForm.control}\n                        name=\"valorMinimo\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Valor Mín.</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                step=\"0.01\"\n                                {...field}\n                                onChange={(e) => field.onChange(parseFloat(e.target.value))}\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={testeForm.control}\n                        name=\"valorMaximo\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Valor Máx.</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                step=\"0.01\"\n                                {...field}\n                                onChange={(e) => field.onChange(parseFloat(e.target.value))}\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full bg-[#0847ad] hover:bg-[#0847ad]/90\"\n                      disabled={createTesteMutation.isPending}\n                    >\n                      {createTesteMutation.isPending ? \"Criando...\" : \"Criar Teste\"}\n                    </Button>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Testes por Categoria</CardTitle>\n                <CardDescription>\n                  Filtrar por categoria para visualizar testes específicos\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <Select onValueChange={(value) => setSelectedCategoria(value ? parseInt(value) : null)}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Filtrar por categoria\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"\">Todas as categorias</SelectItem>\n                      {categorias.map((categoria: any) => (\n                        <SelectItem key={categoria.id} value={categoria.id.toString()}>\n                          {categoria.nome}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n\n                  <div className=\"space-y-3 max-h-96 overflow-y-auto\">\n                    {testesFiltrados.map((teste: any) => (\n                      <div key={teste.id} className=\"p-3 border rounded-lg\">\n                        <h4 className=\"font-medium text-[#0847ad]\">{teste.nome}</h4>\n                        <p className=\"text-sm text-gray-600 mt-1\">{teste.instrucoes}</p>\n                        <div className=\"flex gap-2 mt-2\">\n                          <Badge variant=\"outline\">{teste.unidadeMedida}</Badge>\n                          <Badge variant=\"secondary\">\n                            {teste.valorMinimo} - {teste.valorMaximo}\n                          </Badge>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Avaliações Tab */}\n        <TabsContent value=\"avaliacoes\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <FileText className=\"h-5 w-5\" />\n                  Nova Avaliação Física\n                </CardTitle>\n                <CardDescription>\n                  Registre uma nova avaliação física para um aluno\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <Form {...avaliacaoForm}>\n                  <form onSubmit={avaliacaoForm.handleSubmit(onSubmitAvaliacao)} className=\"space-y-4\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <FormField\n                        control={avaliacaoForm.control}\n                        name=\"alunoId\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Aluno</FormLabel>\n                            <Select onValueChange={(value) => field.onChange(parseInt(value))}>\n                              <FormControl>\n                                <SelectTrigger>\n                                  <SelectValue placeholder=\"Selecione o aluno\" />\n                                </SelectTrigger>\n                              </FormControl>\n                              <SelectContent>\n                                {alunos.map((aluno: any) => (\n                                  <SelectItem key={aluno.id} value={aluno.id.toString()}>\n                                    {aluno.nome}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={avaliacaoForm.control}\n                        name=\"professorId\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Professor</FormLabel>\n                            <Select onValueChange={(value) => field.onChange(parseInt(value))}>\n                              <FormControl>\n                                <SelectTrigger>\n                                  <SelectValue placeholder=\"Selecione o professor\" />\n                                </SelectTrigger>\n                              </FormControl>\n                              <SelectContent>\n                                {professores.map((professor: any) => (\n                                  <SelectItem key={professor.id} value={professor.id.toString()}>\n                                    {professor.nome}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <FormField\n                      control={avaliacaoForm.control}\n                      name=\"dataAvaliacao\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Data da Avaliação</FormLabel>\n                          <FormControl>\n                            <Input type=\"date\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"grid grid-cols-3 gap-4\">\n                      <FormField\n                        control={avaliacaoForm.control}\n                        name=\"pesoKg\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Peso (kg)</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                step=\"0.1\"\n                                placeholder=\"Ex: 70.5\"\n                                {...field}\n                                onChange={(e) => field.onChange(parseFloat(e.target.value))}\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={avaliacaoForm.control}\n                        name=\"alturaM\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Altura (m)</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                step=\"0.01\"\n                                placeholder=\"Ex: 1.75\"\n                                {...field}\n                                onChange={(e) => field.onChange(parseFloat(e.target.value))}\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={avaliacaoForm.control}\n                        name=\"imc\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>IMC</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                step=\"0.01\"\n                                placeholder=\"Calculado automaticamente\"\n                                {...field}\n                                readOnly\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <FormField\n                      control={avaliacaoForm.control}\n                      name=\"observacoesGerais\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Observações Gerais</FormLabel>\n                          <FormControl>\n                            <Textarea placeholder=\"Observações sobre a avaliação...\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={avaliacaoForm.control}\n                      name=\"recomendacoes\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Recomendações</FormLabel>\n                          <FormControl>\n                            <Textarea placeholder=\"Recomendações para o aluno...\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={avaliacaoForm.control}\n                      name=\"proximaAvaliacao\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Próxima Avaliação</FormLabel>\n                          <FormControl>\n                            <Input type=\"date\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full bg-[#0847ad] hover:bg-[#0847ad]/90\"\n                      disabled={createAvaliacaoMutation.isPending}\n                    >\n                      {createAvaliacaoMutation.isPending ? \"Criando...\" : \"Criar Avaliação\"}\n                    </Button>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Avaliações Recentes</CardTitle>\n                <CardDescription>\n                  {avaliacoes.length} avaliação(ões) registrada(s)\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3 max-h-96 overflow-y-auto\">\n                  {avaliacoes.map((avaliacao: any) => (\n                    <div key={avaliacao.id} className=\"p-3 border rounded-lg\">\n                      <div className=\"flex justify-between items-start\">\n                        <div>\n                          <h4 className=\"font-medium text-[#0847ad]\">\n                            {avaliacao.aluno?.nome || \"Aluno não encontrado\"}\n                          </h4>\n                          <p className=\"text-sm text-gray-600\">\n                            Professor: {avaliacao.professor?.nome || \"Professor não encontrado\"}\n                          </p>\n                          <p className=\"text-sm text-gray-600\">\n                            Data: {new Date(avaliacao.dataAvaliacao).toLocaleDateString()}\n                          </p>\n                          <div className=\"flex gap-2 mt-2\">\n                            <Badge variant=\"outline\">\n                              Peso: {avaliacao.pesoKg}kg\n                            </Badge>\n                            <Badge variant=\"secondary\">\n                              IMC: {avaliacao.imc}\n                            </Badge>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Relatórios Tab */}\n        <TabsContent value=\"relatorios\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-gray-600\">Categorias</p>\n                    <p className=\"text-2xl font-bold text-[#0847ad]\">{categorias.length}</p>\n                  </div>\n                  <Activity className=\"h-8 w-8 text-[#0847ad]\" />\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-gray-600\">Testes</p>\n                    <p className=\"text-2xl font-bold text-[#0847ad]\">{testes.length}</p>\n                  </div>\n                  <Target className=\"h-8 w-8 text-[#0847ad]\" />\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-gray-600\">Avaliações</p>\n                    <p className=\"text-2xl font-bold text-[#0847ad]\">{avaliacoes.length}</p>\n                  </div>\n                  <FileText className=\"h-8 w-8 text-[#0847ad]\" />\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-gray-600\">Alunos Avaliados</p>\n                    <p className=\"text-2xl font-bold text-[#0847ad]\">\n                      {new Set(avaliacoes.map((a: any) => a.alunoId)).size}\n                    </p>\n                  </div>\n                  <Users className=\"h-8 w-8 text-[#0847ad]\" />\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Progresso dos Alunos</CardTitle>\n              <CardDescription>\n                Acompanhe o desenvolvimento físico dos alunos ao longo do tempo\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-center py-8 text-gray-500\">\n                <TrendingUp className=\"h-12 w-12 mx-auto mb-4\" />\n                <p>Funcionalidade de relatórios em desenvolvimento</p>\n                <p className=\"text-sm\">Em breve você poderá visualizar gráficos e estatísticas detalhadas</p>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":33439},"client/src/pages/CadastroGestorUnidade.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { insertGestorUnidadeSchema, insertFilialSchema } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useLocation } from \"wouter\";\nimport { Building2, UserPlus, Eye, EyeOff, ArrowLeft } from \"lucide-react\";\nimport { z } from \"zod\";\n\nconst cadastroSchema = z.object({\n  // Dados do gestor\n  nome: z.string().min(1, \"Nome é obrigatório\"),\n  email: z.string().email(\"Email inválido\"),\n  senha: z.string().min(6, \"Senha deve ter pelo menos 6 caracteres\"),\n  confirmarSenha: z.string().min(6, \"Confirmação de senha é obrigatória\"),\n  telefone: z.string().optional(),\n  \n  // Dados da unidade\n  nomeUnidade: z.string().min(1, \"Nome da unidade é obrigatório\"),\n  enderecoUnidade: z.string().min(1, \"Endereço da unidade é obrigatório\"),\n  telefoneUnidade: z.string().optional(),\n  responsavelUnidade: z.string().optional(),\n}).refine((data) => data.senha === data.confirmarSenha, {\n  message: \"As senhas não coincidem\",\n  path: [\"confirmarSenha\"],\n});\n\ntype CadastroFormData = z.infer<typeof cadastroSchema>;\n\nexport default function CadastroGestorUnidade() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [isLoading, setIsLoading] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n\n  const form = useForm<CadastroFormData>({\n    resolver: zodResolver(cadastroSchema),\n    defaultValues: {\n      nome: \"\",\n      email: \"\",\n      senha: \"\",\n      confirmarSenha: \"\",\n      telefone: \"\",\n      nomeUnidade: \"\",\n      enderecoUnidade: \"\",\n      telefoneUnidade: \"\",\n      responsavelUnidade: \"\",\n    },\n  });\n\n  const onSubmit = async (data: CadastroFormData) => {\n    setIsLoading(true);\n    try {\n      const { confirmarSenha, nomeUnidade, enderecoUnidade, telefoneUnidade, responsavelUnidade, ...gestorData } = data;\n      \n      const cadastroCompleto = {\n        gestor: gestorData,\n        unidade: {\n          nome: nomeUnidade,\n          endereco: enderecoUnidade,\n          telefone: telefoneUnidade || \"\",\n          responsavel: responsavelUnidade || gestorData.nome,\n          ativa: true,\n        }\n      };\n      \n      const response = await apiRequest(\"POST\", \"/api/unidade/cadastro-completo\", cadastroCompleto);\n      const result = await response.json();\n      \n      if (response.ok) {\n        toast({\n          title: \"Cadastro realizado com sucesso!\",\n          description: \"Sua unidade e acesso foram criados. Você já pode fazer login.\",\n        });\n        \n        setLocation(\"/unidade/login\");\n      } else {\n        toast({\n          title: \"Erro no cadastro\",\n          description: result.message || \"Não foi possível completar o cadastro\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Erro de conexão\",\n        description: \"Não foi possível conectar ao servidor\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-blue-50 p-4\">\n      <div className=\"max-w-2xl mx-auto\">\n        <div className=\"mb-6\">\n          <Button\n            variant=\"outline\"\n            onClick={() => setLocation(\"/unidade/login\")}\n            className=\"mb-4\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Voltar ao Login\n          </Button>\n        </div>\n\n        <Card className=\"shadow-lg\">\n          <CardHeader className=\"text-center\">\n            <div className=\"flex justify-center mb-4\">\n              <Building2 className=\"h-12 w-12 text-blue-600\" />\n            </div>\n            <CardTitle className=\"text-2xl font-bold text-gray-900\">\n              Cadastro de Gestor de Unidade\n            </CardTitle>\n            <CardDescription>\n              Preencha os dados para solicitar acesso ao sistema de gestão da sua unidade\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"nome\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Nome Completo</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"Seu nome completo\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"email\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Email</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"email\"\n                            placeholder=\"seu.email@escola.com\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"telefone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Telefone</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"(11) 99999-9999\"\n                          {...field}\n                          value={field.value || \"\"}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Seção da Unidade */}\n                <div className=\"border-t pt-6 mt-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Dados da Unidade</h3>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"nomeUnidade\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Nome da Unidade</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder=\"Ex: Escola de Futebol Vila Nova\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"telefoneUnidade\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Telefone da Unidade</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder=\"(11) 3333-4444\"\n                              {...field}\n                              value={field.value || \"\"}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"enderecoUnidade\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Endereço da Unidade</FormLabel>\n                        <FormControl>\n                          <Textarea\n                            placeholder=\"Rua, número, bairro, cidade - CEP\"\n                            {...field}\n                            rows={3}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"responsavelUnidade\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Responsável pela Unidade (opcional)</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"Deixe vazio para usar seu nome\"\n                            {...field}\n                            value={field.value || \"\"}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"senha\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Senha</FormLabel>\n                        <FormControl>\n                          <div className=\"relative\">\n                            <Input\n                              type={showPassword ? \"text\" : \"password\"}\n                              placeholder=\"Digite sua senha\"\n                              {...field}\n                            />\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                              onClick={() => setShowPassword(!showPassword)}\n                            >\n                              {showPassword ? (\n                                <EyeOff className=\"h-4 w-4 text-gray-400\" />\n                              ) : (\n                                <Eye className=\"h-4 w-4 text-gray-400\" />\n                              )}\n                            </Button>\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"confirmarSenha\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Confirmar Senha</FormLabel>\n                        <FormControl>\n                          <div className=\"relative\">\n                            <Input\n                              type={showConfirmPassword ? \"text\" : \"password\"}\n                              placeholder=\"Confirme sua senha\"\n                              {...field}\n                            />\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                              onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                            >\n                              {showConfirmPassword ? (\n                                <EyeOff className=\"h-4 w-4 text-gray-400\" />\n                              ) : (\n                                <Eye className=\"h-4 w-4 text-gray-400\" />\n                              )}\n                            </Button>\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"bg-blue-50 p-4 rounded-lg\">\n                  <p className=\"text-sm text-gray-700\">\n                    <strong>Observação:</strong> Após o cadastro, sua unidade será criada e você poderá fazer login imediatamente. \n                    Todos os dados da unidade poderão ser editados posteriormente no painel administrativo.\n                  </p>\n                </div>\n\n                <Button\n                  type=\"submit\"\n                  className=\"w-full\"\n                  disabled={isLoading}\n                >\n                  {isLoading ? (\n                    <div className=\"flex items-center\">\n                      <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2\" />\n                      Cadastrando...\n                    </div>\n                  ) : (\n                    <div className=\"flex items-center\">\n                      <UserPlus className=\"h-4 w-4 mr-2\" />\n                      Solicitar Cadastro\n                    </div>\n                  )}\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":13876},"client/src/pages/Financeiro.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { DollarSign, Search, Plus, Trash2, Calendar, CreditCard, TrendingUp, Wallet } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Pagamento, Aluno } from \"@shared/schema\";\nimport PagamentoForm from \"@/components/forms/PagamentoForm\";\n\nexport default function Financeiro() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filterMonth, setFilterMonth] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: pagamentos, isLoading: loadingPagamentos } = useQuery<Pagamento[]>({\n    queryKey: [\"/api/pagamentos\"],\n  });\n\n  const { data: alunos } = useQuery<Aluno[]>({\n    queryKey: [\"/api/alunos\"],\n  });\n\n  const deletePagamentoMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/pagamentos/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/pagamentos\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/metrics\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Pagamento removido com sucesso.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao remover pagamento. Tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredPagamentos = pagamentos?.filter((pagamento) => {\n    const aluno = alunos?.find(a => a.id === pagamento.alunoId);\n    const matchesSearch = aluno?.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         pagamento.formaPagamento.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesMonth = !filterMonth || filterMonth === \"all\" || pagamento.mesReferencia === filterMonth;\n    return matchesSearch && matchesMonth;\n  }) || [];\n\n  const handleDelete = (id: number) => {\n    if (confirm(\"Tem certeza que deseja remover este pagamento?\")) {\n      deletePagamentoMutation.mutate(id);\n    }\n  };\n\n  const handleDialogClose = () => {\n    setIsDialogOpen(false);\n  };\n\n  const formatCurrency = (value: string | number) => {\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(Number(value));\n  };\n\n  const getAlunoNome = (alunoId: number) => {\n    const aluno = alunos?.find(a => a.id === alunoId);\n    return aluno?.nome || \"Aluno não encontrado\";\n  };\n\n  const getPaymentMethodColor = (method: string) => {\n    const colors = {\n      \"PIX\": \"bg-green-500/10 text-green-700 border-green-500/20\",\n      \"Dinheiro\": \"bg-blue-500/10 text-blue-700 border-blue-500/20\",\n      \"Cartão\": \"bg-purple-500/10 text-purple-700 border-purple-500/20\",\n      \"Transferência\": \"bg-amber-500/10 text-amber-700 border-amber-500/20\",\n    };\n    return colors[method as keyof typeof colors] || \"bg-muted\";\n  };\n\n  const calculateTotals = () => {\n    const total = filteredPagamentos.reduce((sum, p) => sum + Number(p.valor), 0);\n    const currentMonth = new Date().toISOString().slice(0, 7);\n    const monthlyTotal = filteredPagamentos\n      .filter(p => p.mesReferencia === currentMonth)\n      .reduce((sum, p) => sum + Number(p.valor), 0);\n    \n    return { total, monthlyTotal };\n  };\n\n  const { total, monthlyTotal } = calculateTotals();\n\n  const getMonthOptions = () => {\n    const months = [];\n    const current = new Date();\n    for (let i = 0; i < 12; i++) {\n      const date = new Date(current.getFullYear(), current.getMonth() - i, 1);\n      const value = date.toISOString().slice(0, 7);\n      const label = format(date, \"MMMM yyyy\", { locale: ptBR });\n      months.push({ value, label });\n    }\n    return months;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-4xl font-bold text-foreground mb-2\">Controle Financeiro</h1>\n          <p className=\"text-muted-foreground text-lg\">Gerencie pagamentos e mensalidades</p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button \n              data-testid=\"button-registrar-pagamento\"\n              className=\"bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-600/30\"\n            >\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Registrar Pagamento\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>Registrar Novo Pagamento</DialogTitle>\n            </DialogHeader>\n            <PagamentoForm onSuccess={handleDialogClose} />\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Financial Summary */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"p-3 rounded-xl bg-green-500/10\">\n                <TrendingUp className=\"w-6 h-6 text-green-600\" />\n              </div>\n              <span className=\"text-sm font-medium text-green-600\">{filteredPagamentos.length} pagamentos</span>\n            </div>\n            <div>\n              <p className=\"text-sm font-medium text-muted-foreground mb-1\">Total Arrecadado</p>\n              <p className=\"text-3xl font-bold text-foreground\">{formatCurrency(total)}</p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"p-3 rounded-xl bg-blue-500/10\">\n                <Calendar className=\"w-6 h-6 text-blue-600\" />\n              </div>\n              <span className=\"text-sm font-medium text-muted-foreground\">Mês atual</span>\n            </div>\n            <div>\n              <p className=\"text-sm font-medium text-muted-foreground mb-1\">Receita Mensal</p>\n              <p className=\"text-3xl font-bold text-foreground\">{formatCurrency(monthlyTotal)}</p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"p-3 rounded-xl bg-purple-500/10\">\n                <Wallet className=\"w-6 h-6 text-purple-600\" />\n              </div>\n              <span className=\"text-sm font-medium text-muted-foreground\">Por pagamento</span>\n            </div>\n            <div>\n              <p className=\"text-sm font-medium text-muted-foreground mb-1\">Ticket Médio</p>\n              <p className=\"text-3xl font-bold text-foreground\">\n                {formatCurrency(filteredPagamentos.length > 0 ? total / filteredPagamentos.length : 0)}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filters */}\n      <Card className=\"border-border bg-card\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex flex-col md:flex-row gap-4\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5\" />\n              <Input\n                placeholder=\"Buscar por aluno ou forma de pagamento...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                data-testid=\"input-search-pagamentos\"\n                className=\"pl-11 h-11 bg-background border-border\"\n              />\n            </div>\n            <Select value={filterMonth} onValueChange={setFilterMonth}>\n              <SelectTrigger className=\"w-full md:w-56 h-11 bg-background border-border\" data-testid=\"select-month-filter\">\n                <SelectValue placeholder=\"Filtrar por mês\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">Todos os meses</SelectItem>\n                {getMonthOptions().map((month) => (\n                  <SelectItem key={month.value} value={month.value}>\n                    {month.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Payments Table */}\n      <Card className=\"border-border bg-card\">\n        <CardContent className=\"p-6\">\n          {loadingPagamentos ? (\n            <div className=\"space-y-4\">\n              {[...Array(5)].map((_, i) => (\n                <div key={i} className=\"flex items-center space-x-4 p-4 border border-border rounded-lg\">\n                  <Skeleton className=\"h-12 w-12 rounded-lg\" />\n                  <div className=\"space-y-2 flex-1\">\n                    <Skeleton className=\"h-4 w-48\" />\n                    <Skeleton className=\"h-3 w-32\" />\n                  </div>\n                  <Skeleton className=\"h-8 w-20\" />\n                </div>\n              ))}\n            </div>\n          ) : filteredPagamentos.length === 0 ? (\n            <div className=\"text-center py-16\">\n              <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-muted mb-4\">\n                <DollarSign className=\"w-8 h-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"text-xl font-semibold text-foreground mb-2\">\n                {searchTerm || filterMonth ? \"Nenhum pagamento encontrado\" : \"Nenhum pagamento registrado\"}\n              </h3>\n              <p className=\"text-muted-foreground mb-6 max-w-md mx-auto\">\n                {searchTerm || filterMonth\n                  ? \"Tente ajustar os filtros de busca.\" \n                  : \"Comece registrando o primeiro pagamento.\"}\n              </p>\n              {!searchTerm && !filterMonth && (\n                <Button \n                  onClick={() => setIsDialogOpen(true)}\n                  className=\"bg-green-600 hover:bg-green-700\"\n                  data-testid=\"button-primeiro-pagamento\"\n                >\n                  <Plus className=\"w-4 h-4 mr-2\" />\n                  Registrar Primeiro Pagamento\n                </Button>\n              )}\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow className=\"border-border hover:bg-transparent\">\n                    <TableHead className=\"font-semibold\">Aluno</TableHead>\n                    <TableHead className=\"font-semibold\">Valor</TableHead>\n                    <TableHead className=\"font-semibold\">Mês Referência</TableHead>\n                    <TableHead className=\"font-semibold\">Data Pagamento</TableHead>\n                    <TableHead className=\"font-semibold\">Forma de Pagamento</TableHead>\n                    <TableHead className=\"font-semibold\">Observações</TableHead>\n                    <TableHead className=\"text-right font-semibold\">Ações</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredPagamentos.map((pagamento) => (\n                    <TableRow key={pagamento.id} className=\"border-border hover:bg-muted/50\" data-testid={`row-pagamento-${pagamento.id}`}>\n                      <TableCell>\n                        <p className=\"font-semibold text-foreground\">{getAlunoNome(pagamento.alunoId!)}</p>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center font-semibold text-green-600\">\n                          <DollarSign className=\"w-4 h-4 mr-1\" />\n                          {formatCurrency(pagamento.valor)}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center text-muted-foreground\">\n                          <Calendar className=\"w-4 h-4 mr-2\" />\n                          <span className=\"capitalize\">\n                            {format(new Date(pagamento.mesReferencia + \"-01\"), \"MMMM yyyy\", { locale: ptBR })}\n                          </span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <span className=\"font-medium\">\n                          {format(new Date(pagamento.dataPagamento), \"dd/MM/yyyy\", { locale: ptBR })}\n                        </span>\n                      </TableCell>\n                      <TableCell>\n                        <Badge className={getPaymentMethodColor(pagamento.formaPagamento)}>\n                          <CreditCard className=\"w-3 h-3 mr-1.5\" />\n                          {pagamento.formaPagamento}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <p className=\"text-sm text-muted-foreground max-w-40 truncate\">\n                          {pagamento.observacoes || \"-\"}\n                        </p>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleDelete(pagamento.id)}\n                          disabled={deletePagamentoMutation.isPending}\n                          data-testid={`button-delete-${pagamento.id}`}\n                          className=\"hover:bg-red-50 hover:text-red-600 hover:border-red-300\"\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":14770},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2254},"shared/schema.ts":{"content":"import {\n  pgTable,\n  text,\n  varchar,\n  timestamp,\n  jsonb,\n  index,\n  serial,\n  integer,\n  decimal,\n  boolean,\n  date,\n} from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table (mandatory for Replit Auth)\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// User storage table (mandatory for Replit Auth)\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().notNull(),\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Alunos table\nexport const alunos = pgTable(\"alunos\", {\n  id: serial(\"id\").primaryKey(),\n  nome: varchar(\"nome\", { length: 255 }).notNull(),\n  email: varchar(\"email\", { length: 255 }),\n  telefone: varchar(\"telefone\", { length: 20 }),\n  dataNascimento: date(\"data_nascimento\"),\n  endereco: text(\"endereco\"),\n  nomeResponsavel: varchar(\"nome_responsavel\", { length: 255 }),\n  telefoneResponsavel: varchar(\"telefone_responsavel\", { length: 20 }),\n  filialId: integer(\"filial_id\").references(() => filiais.id),\n  ativo: boolean(\"ativo\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Professores table\nexport const professores = pgTable(\"professores\", {\n  id: serial(\"id\").primaryKey(),\n  nome: varchar(\"nome\", { length: 255 }).notNull(),\n  email: varchar(\"email\", { length: 255 }).unique(),\n  telefone: varchar(\"telefone\", { length: 20 }),\n  especialidade: varchar(\"especialidade\", { length: 100 }),\n  salario: decimal(\"salario\", { precision: 10, scale: 2 }),\n  ativo: boolean(\"ativo\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Filiais table\nexport const filiais = pgTable(\"filiais\", {\n  id: serial(\"id\").primaryKey(),\n  nome: varchar(\"nome\", { length: 100 }).notNull(),\n  endereco: text(\"endereco\").notNull(),\n  telefone: varchar(\"telefone\", { length: 20 }),\n  responsavel: varchar(\"responsavel\", { length: 100 }),\n  ativa: boolean(\"ativa\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Turmas table\nexport const turmas = pgTable(\"turmas\", {\n  id: serial(\"id\").primaryKey(),\n  nome: varchar(\"nome\", { length: 255 }).notNull(),\n  categoria: varchar(\"categoria\", { length: 100 }).notNull(), // Infantil, Juvenil, Adulto\n  professorId: integer(\"professor_id\").references(() => professores.id),\n  filialId: integer(\"filial_id\").references(() => filiais.id),\n  horario: varchar(\"horario\", { length: 100 }),\n  diasSemana: varchar(\"dias_semana\", { length: 50 }), // \"Segunda,Quarta,Sexta\"\n  capacidadeMaxima: integer(\"capacidade_maxima\").default(20),\n  valorMensalidade: decimal(\"valor_mensalidade\", { precision: 10, scale: 2 }),\n  ativo: boolean(\"ativo\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Matrículas table (relaciona alunos com turmas)\nexport const matriculas = pgTable(\"matriculas\", {\n  id: serial(\"id\").primaryKey(),\n  alunoId: integer(\"aluno_id\").references(() => alunos.id),\n  turmaId: integer(\"turma_id\").references(() => turmas.id),\n  dataMatricula: date(\"data_matricula\").defaultNow(),\n  ativo: boolean(\"ativo\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Pagamentos table\nexport const pagamentos = pgTable(\"pagamentos\", {\n  id: serial(\"id\").primaryKey(),\n  alunoId: integer(\"aluno_id\").references(() => alunos.id),\n  valor: decimal(\"valor\", { precision: 10, scale: 2 }).notNull(),\n  mesReferencia: varchar(\"mes_referencia\", { length: 7 }).notNull(), // \"2024-01\"\n  dataPagamento: date(\"data_pagamento\").notNull(),\n  formaPagamento: varchar(\"forma_pagamento\", { length: 50 }).notNull(), // Dinheiro, PIX, Cartão\n  observacoes: text(\"observacoes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Relations\nexport const alunosRelations = relations(alunos, ({ one, many }) => ({\n  filial: one(filiais, {\n    fields: [alunos.filialId],\n    references: [filiais.id],\n  }),\n  matriculas: many(matriculas),\n  pagamentos: many(pagamentos),\n}));\n\nexport const professoresRelations = relations(professores, ({ many }) => ({\n  turmas: many(turmas),\n}));\n\nexport const filiaisRelations = relations(filiais, ({ many }) => ({\n  turmas: many(turmas),\n  alunos: many(alunos),\n}));\n\nexport const turmasRelations = relations(turmas, ({ one, many }) => ({\n  professor: one(professores, {\n    fields: [turmas.professorId],\n    references: [professores.id],\n  }),\n  filial: one(filiais, {\n    fields: [turmas.filialId],\n    references: [filiais.id],\n  }),\n  matriculas: many(matriculas),\n}));\n\nexport const matriculasRelations = relations(matriculas, ({ one }) => ({\n  aluno: one(alunos, {\n    fields: [matriculas.alunoId],\n    references: [alunos.id],\n  }),\n  turma: one(turmas, {\n    fields: [matriculas.turmaId],\n    references: [turmas.id],\n  }),\n}));\n\nexport const pagamentosRelations = relations(pagamentos, ({ one }) => ({\n  aluno: one(alunos, {\n    fields: [pagamentos.alunoId],\n    references: [alunos.id],\n  }),\n}));\n\n// Insert schemas\nexport const insertAlunoSchema = createInsertSchema(alunos).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertProfessorSchema = createInsertSchema(professores).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertTurmaSchema = createInsertSchema(turmas).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertMatriculaSchema = createInsertSchema(matriculas).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPagamentoSchema = createInsertSchema(pagamentos).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertFilialSchema = createInsertSchema(filiais).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Types\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\n\nexport type InsertAluno = z.infer<typeof insertAlunoSchema>;\nexport type Aluno = typeof alunos.$inferSelect;\nexport type AlunoWithFilial = Aluno & {\n  filial: Filial | null;\n  statusPagamento?: {\n    emDia: boolean;\n    ultimoPagamento?: string; // mes/ano do último pagamento\n    diasAtraso?: number;\n  };\n};\n\nexport type InsertProfessor = z.infer<typeof insertProfessorSchema>;\nexport type Professor = typeof professores.$inferSelect;\n\nexport type InsertTurma = z.infer<typeof insertTurmaSchema>;\nexport type Turma = typeof turmas.$inferSelect;\n\nexport type InsertMatricula = z.infer<typeof insertMatriculaSchema>;\nexport type Matricula = typeof matriculas.$inferSelect;\n\nexport type InsertPagamento = z.infer<typeof insertPagamentoSchema>;\nexport type Pagamento = typeof pagamentos.$inferSelect;\n\nexport type InsertFilial = z.infer<typeof insertFilialSchema>;\nexport type Filial = typeof filiais.$inferSelect;\n\n// Combined types for API responses\nexport type TurmaWithProfessor = Turma & {\n  professor: Professor | null;\n  filial: Filial | null;\n  _count?: {\n    matriculas: number;\n  };\n};\n\nexport type AlunoWithTurmas = Aluno & {\n  matriculas: (Matricula & {\n    turma: Turma & {\n      professor: Professor | null;\n    };\n  })[];\n};\n\nexport type MatriculaComplete = Matricula & {\n  aluno: Aluno;\n  turma: TurmaWithProfessor;\n};\n","size_bytes":7858},"client/src/components/forms/AlunoForm.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertAlunoSchema, type Aluno, type InsertAluno, type Filial } from \"@shared/schema\";\nimport { z } from \"zod\";\n\nconst formSchema = insertAlunoSchema.extend({\n  dataNascimento: z.string().optional(),\n  filialId: z.number().optional(),\n});\n\ntype FormData = z.infer<typeof formSchema>;\n\ninterface AlunoFormProps {\n  aluno?: Aluno | null;\n  onSuccess: () => void;\n}\n\nexport default function AlunoForm({ aluno, onSuccess }: AlunoFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: filiais } = useQuery<Filial[]>({\n    queryKey: [\"/api/filiais\"],\n  });\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      nome: aluno?.nome || \"\",\n      email: aluno?.email || \"\",\n      telefone: aluno?.telefone || \"\",\n      dataNascimento: aluno?.dataNascimento || \"\",\n      endereco: aluno?.endereco || \"\",\n      nomeResponsavel: aluno?.nomeResponsavel || \"\",\n      telefoneResponsavel: aluno?.telefoneResponsavel || \"\",\n      filialId: aluno?.filialId || undefined,\n      ativo: Boolean(aluno?.ativo ?? true),\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertAluno) => {\n      const response = await apiRequest(\"POST\", \"/api/alunos\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/alunos\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/metrics\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Aluno cadastrado com sucesso.\",\n      });\n      onSuccess();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao cadastrar aluno. Verifique os dados e tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: Partial<InsertAluno>) => {\n      const response = await apiRequest(\"PUT\", `/api/alunos/${aluno!.id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/alunos\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Aluno atualizado com sucesso.\",\n      });\n      onSuccess();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao atualizar aluno. Verifique os dados e tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: FormData) => {\n    const submitData: InsertAluno = {\n      ...data,\n      dataNascimento: data.dataNascimento || null,\n      email: data.email || null,\n      telefone: data.telefone || null,\n      endereco: data.endereco || null,\n      nomeResponsavel: data.nomeResponsavel || null,\n      telefoneResponsavel: data.telefoneResponsavel || null,\n    };\n\n    if (aluno) {\n      updateMutation.mutate(submitData);\n    } else {\n      createMutation.mutate(submitData);\n    }\n  };\n\n  const isLoading = createMutation.isPending || updateMutation.isPending;\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"nome\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Nome Completo *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Digite o nome completo\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"dataNascimento\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Data de Nascimento</FormLabel>\n                <FormControl>\n                  <Input type=\"date\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"filialId\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Filial</FormLabel>\n                <Select \n                  onValueChange={(value) => field.onChange(value ? parseInt(value) : undefined)} \n                  defaultValue={field.value?.toString()}\n                >\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione uma filial\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {filiais?.filter(f => f.ativa).map((filial) => (\n                      <SelectItem key={filial.id} value={filial.id.toString()}>\n                        {filial.nome}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"email\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>E-mail</FormLabel>\n                <FormControl>\n                  <Input type=\"email\" placeholder=\"email@exemplo.com\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"telefone\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Telefone</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"(11) 99999-9999\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"nomeResponsavel\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Nome do Responsável</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Digite o nome do responsável\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"telefoneResponsavel\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Telefone do Responsável</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"(11) 99999-9999\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"endereco\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Endereço</FormLabel>\n              <FormControl>\n                <Textarea \n                  placeholder=\"Digite o endereço completo\"\n                  className=\"min-h-[80px]\"\n                  {...field} \n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"ativo\"\n          render={({ field }) => (\n            <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n              <div className=\"space-y-0.5\">\n                <FormLabel className=\"text-base\">Status Ativo</FormLabel>\n                <div className=\"text-sm text-muted-foreground\">\n                  Determina se o aluno está ativo no sistema\n                </div>\n              </div>\n              <FormControl>\n                <Switch\n                  checked={field.value}\n                  onCheckedChange={field.onChange}\n                />\n              </FormControl>\n            </FormItem>\n          )}\n        />\n\n        <div className=\"flex justify-end space-x-2 pt-4\">\n          <Button type=\"button\" variant=\"outline\" onClick={onSuccess}>\n            Cancelar\n          </Button>\n          <Button type=\"submit\" disabled={isLoading} className=\"bg-primary hover:bg-primary/90\">\n            {isLoading ? \"Salvando...\" : aluno ? \"Atualizar\" : \"Cadastrar\"}\n          </Button>\n        </div>\n      </form>\n    </Form>\n  );\n}\n","size_bytes":9112},"client/src/components/unidade/FinanceiroTab.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Plus, Search, DollarSign, Calendar, CreditCard } from \"lucide-react\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertPagamentoSchema } from \"@shared/schema\";\nimport type { Pagamento, AlunoWithFilial } from \"@shared/schema\";\nimport { useUnidadeAuth } from \"@/contexts/UnidadeContext\";\n\ntype PagamentoFormData = {\n  alunoId: number;\n  valor: string;\n  mesReferencia: string;\n  dataPagamento: string;\n  formaPagamento: string;\n  observacoes?: string;\n};\n\nexport default function FinanceiroTab() {\n  const queryClient = useQueryClient();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const { filialId } = useUnidadeAuth();\n\n  const { data: alunos = [] } = useQuery<AlunoWithFilial[]>({\n    queryKey: [\"/api/alunos\"],\n  });\n\n  const { data: pagamentos = [], isLoading } = useQuery<Pagamento[]>({\n    queryKey: [\"/api/pagamentos\"],\n  });\n\n  const form = useForm<PagamentoFormData>({\n    defaultValues: {\n      valor: \"\",\n      mesReferencia: new Date().toISOString().slice(0, 7), // \"2024-01\"\n      dataPagamento: new Date().toISOString().split('T')[0],\n      formaPagamento: \"PIX\",\n      observacoes: \"\",\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: PagamentoFormData) => {\n      return await apiRequest(\"POST\", \"/api/pagamentos\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/pagamentos\"] });\n      setDialogOpen(false);\n      form.reset();\n      toast({\n        title: \"Sucesso\",\n        description: \"Pagamento registrado com sucesso!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao registrar pagamento: \" + error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Filtrar pagamentos da unidade\n  const alunosUnidade = alunos.filter(aluno => aluno.filialId === filialId);\n  const alunosUnidadeIds = alunosUnidade.map(a => a.id);\n  const pagamentosUnidade = pagamentos.filter(pagamento => \n    pagamento.alunoId && alunosUnidadeIds.includes(pagamento.alunoId)\n  );\n\n  const filteredPagamentos = pagamentosUnidade.filter(pagamento => {\n    const aluno = alunos.find(a => a.id === pagamento.alunoId);\n    if (!aluno) return false;\n    return aluno.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n           (pagamento.observacoes && pagamento.observacoes.toLowerCase().includes(searchTerm.toLowerCase()));\n  });\n\n  const onSubmit = (data: PagamentoFormData) => {\n    createMutation.mutate(data);\n  };\n\n  // Calcular total\n  const totalReceita = pagamentosUnidade.reduce((sum, p) => sum + parseFloat(p.valor || \"0\"), 0);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">Gestão Financeira</h2>\n          <p className=\"text-muted-foreground\">Controle de pagamentos da unidade</p>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button className=\"flex items-center gap-2\">\n              <Plus className=\"w-4 h-4\" />\n              Registrar Pagamento\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-md\">\n            <DialogHeader>\n              <DialogTitle>Registrar Pagamento</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"alunoId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Aluno</FormLabel>\n                      <Select onValueChange={(value) => field.onChange(parseInt(value))} value={field.value?.toString()}>\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Selecione o aluno\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {alunosUnidade.map((aluno) => (\n                            <SelectItem key={aluno.id} value={aluno.id.toString()}>\n                              {aluno.nome}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"valor\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Valor (R$)</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          placeholder=\"0,00\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"mesReferencia\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Mês Referência</FormLabel>\n                      <FormControl>\n                        <Input type=\"month\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"dataPagamento\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Data do Pagamento</FormLabel>\n                      <FormControl>\n                        <Input type=\"date\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"formaPagamento\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Forma de Pagamento</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"PIX\">PIX</SelectItem>\n                          <SelectItem value=\"Dinheiro\">Dinheiro</SelectItem>\n                          <SelectItem value=\"Cartão\">Cartão</SelectItem>\n                          <SelectItem value=\"Transferência\">Transferência</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"observacoes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Observações</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Observações opcionais\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex gap-2 pt-4\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setDialogOpen(false)}\n                    className=\"flex-1\"\n                  >\n                    Cancelar\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={createMutation.isPending}\n                    className=\"flex-1\"\n                  >\n                    {createMutation.isPending ? \"Salvando...\" : \"Salvar\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Métricas */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total de Pagamentos</CardTitle>\n            <DollarSign className=\"h-4 w-4 text-green-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              R$ {totalReceita.toFixed(2)}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              {pagamentosUnidade.length} pagamentos registrados\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Alunos Ativos</CardTitle>\n            <CreditCard className=\"h-4 w-4 text-blue-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-blue-600\">\n              {alunosUnidade.length}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Alunos matriculados na unidade\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Ticket Médio</CardTitle>\n            <Calendar className=\"h-4 w-4 text-purple-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-purple-600\">\n              R$ {pagamentosUnidade.length > 0 ? (totalReceita / pagamentosUnidade.length).toFixed(2) : \"0,00\"}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Valor médio por pagamento\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filtros */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4\" />\n          <Input\n            placeholder=\"Buscar por aluno ou observação...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n      </div>\n\n      {/* Lista de Pagamentos */}\n      {isLoading ? (\n        <div className=\"space-y-4\">\n          {[...Array(5)].map((_, i) => (\n            <Card key={i} className=\"animate-pulse\">\n              <CardContent className=\"p-4\">\n                <div className=\"space-y-2\">\n                  <div className=\"h-4 bg-muted rounded w-1/4\"></div>\n                  <div className=\"h-3 bg-muted rounded w-1/2\"></div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : filteredPagamentos.length === 0 ? (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <DollarSign className=\"w-12 h-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">\n              {searchTerm ? \"Nenhum pagamento encontrado\" : \"Nenhum pagamento registrado\"}\n            </h3>\n            <p className=\"text-muted-foreground text-center mb-6\">\n              {searchTerm \n                ? \"Tente ajustar os termos de busca\" \n                : \"Comece registrando o primeiro pagamento da unidade\"\n              }\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"space-y-4\">\n          {filteredPagamentos.map((pagamento) => {\n            const aluno = alunos.find(a => a.id === pagamento.alunoId);\n            return (\n              <Card key={pagamento.id}>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-3 mb-2\">\n                        <h3 className=\"font-semibold\">{aluno?.nome}</h3>\n                        <Badge variant=\"secondary\">{pagamento.formaPagamento}</Badge>\n                      </div>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {pagamento.observacoes || \"Sem observações\"}\n                      </p>\n                      <div className=\"flex items-center gap-4 mt-2 text-sm text-muted-foreground\">\n                        <div className=\"flex items-center gap-1\">\n                          <Calendar className=\"w-4 h-4\" />\n                          {pagamento.mesReferencia} - Pago em {new Date(pagamento.dataPagamento).toLocaleDateString('pt-BR')}\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"text-lg font-bold text-green-600\">\n                        R$ {parseFloat(pagamento.valor || \"0\").toFixed(2)}\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":14541},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: 210 17% 98%; /* #F8F9FB */\n  --foreground: 222 47% 11%; /* #0F172A */\n  --muted: 210 17% 95%; /* #F1F3F5 */\n  --muted-foreground: 215 16% 47%; /* #64748B */\n  --popover: 0 0% 100%; /* #FFFFFF */\n  --popover-foreground: 222 47% 11%; /* #0F172A */\n  --card: 0 0% 100%; /* #FFFFFF */\n  --card-foreground: 222 47% 11%; /* #0F172A */\n  --border: 214 32% 91%; /* #E2E8F0 */\n  --input: 214 32% 91%; /* #E2E8F0 */\n  --primary: 142 76% 36%; /* #16A34A */\n  --primary-foreground: 0 0% 100%; /* #FFFFFF */\n  --secondary: 210 17% 95%; /* #F1F3F5 */\n  --secondary-foreground: 222 47% 11%; /* #0F172A */\n  --accent: 142 76% 36%; /* #16A34A */\n  --accent-foreground: 0 0% 100%; /* #FFFFFF */\n  --destructive: 0 72% 51%; /* #EF4444 */\n  --destructive-foreground: 0 0% 100%; /* #FFFFFF */\n  --success: 142 76% 36%; /* #16A34A */\n  --warning: 38 92% 50%; /* #F59E0B */\n  --info: 217 91% 60%; /* #3B82F6 */\n  --ring: 142 76% 36%; /* #16A34A */\n  --radius: 0.75rem;\n  \n  /* Custom theme colors */\n  --sidebar-bg: 222 47% 11%; /* #0F172A */\n  --sidebar-foreground: 210 40% 98%; /* #F8FAFC */\n  --sidebar-accent: 142 76% 36%; /* #16A34A */\n  --sidebar-accent-foreground: 0 0% 100%; /* #FFFFFF */\n}\n\n.dark {\n  --background: 222 47% 11%; /* #0F172A */\n  --foreground: 210 40% 98%; /* #F8FAFC */\n  --muted: 217 33% 17%; /* #1E293B */\n  --muted-foreground: 215 20% 65%; /* #94A3B8 */\n  --popover: 217 33% 17%; /* #1E293B */\n  --popover-foreground: 210 40% 98%; /* #F8FAFC */\n  --card: 217 33% 17%; /* #1E293B */\n  --card-foreground: 210 40% 98%; /* #F8FAFC */\n  --border: 217 33% 24%; /* #334155 */\n  --input: 217 33% 24%; /* #334155 */\n  --primary: 142 76% 36%; /* #16A34A */\n  --primary-foreground: 0 0% 100%; /* #FFFFFF */\n  --secondary: 217 33% 17%; /* #1E293B */\n  --secondary-foreground: 210 40% 98%; /* #F8FAFC */\n  --accent: 142 76% 36%; /* #16A34A */\n  --accent-foreground: 0 0% 100%; /* #FFFFFF */\n  --destructive: 0 63% 31%; /* #991B1B */\n  --destructive-foreground: 210 40% 98%; /* #F8FAFC */\n  --success: 142 76% 36%; /* #16A34A */\n  --warning: 38 92% 50%; /* #F59E0B */\n  --info: 217 91% 60%; /* #3B82F6 */\n  --ring: 142 76% 36%; /* #16A34A */\n  \n  /* Custom theme colors */\n  --sidebar-bg: 222 47% 8%; /* #0B1120 */\n  --sidebar-foreground: 210 40% 98%; /* #F8FAFC */\n  --sidebar-accent: 142 76% 36%; /* #16A34A */\n  --sidebar-accent-foreground: 0 0% 100%; /* #FFFFFF */\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n  }\n\n  h1, h2, h3, h4, h5, h6 {\n    @apply font-semibold;\n  }\n}\n\n@layer utilities {\n  .bg-success {\n    background-color: hsl(var(--success));\n  }\n  \n  .text-success {\n    color: hsl(var(--success));\n  }\n  \n  .bg-warning {\n    background-color: hsl(var(--warning));\n  }\n  \n  .text-warning {\n    color: hsl(var(--warning));\n  }\n  \n  .bg-info {\n    background-color: hsl(var(--info));\n  }\n  \n  .text-info {\n    color: hsl(var(--info));\n  }\n  \n  .gradient-primary {\n    background: linear-gradient(135deg, hsl(var(--primary)) 0%, hsl(142 76% 28%) 100%);\n  }\n  \n  .glass-effect {\n    background: rgba(255, 255, 255, 0.7);\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(255, 255, 255, 0.3);\n  }\n  \n  .dark .glass-effect {\n    background: rgba(30, 41, 59, 0.7);\n    border: 1px solid rgba(51, 65, 85, 0.5);\n  }\n}\n\n/* Custom scrollbar */\n::-webkit-scrollbar {\n  width: 10px;\n  height: 10px;\n}\n\n::-webkit-scrollbar-track {\n  background: hsl(var(--muted));\n}\n\n::-webkit-scrollbar-thumb {\n  background: hsl(var(--muted-foreground) / 0.5);\n  border-radius: 5px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: hsl(var(--muted-foreground));\n}\n\n/* Smooth transitions */\n* {\n  transition-property: color, background-color, border-color;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 150ms;\n}\n\n/* Card hover effects */\n.hover-lift {\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n}\n\n.hover-lift:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);\n}\n","size_bytes":4314},"client/src/components/ExtratoAluno.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Calendar, CreditCard, Receipt, ArrowLeft, Download, DollarSign } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport type { Pagamento, AlunoWithFilial } from \"@shared/schema\";\n\ninterface ExtratoAlunoProps {\n  aluno: AlunoWithFilial;\n  onBack: () => void;\n}\n\nexport default function ExtratoAluno({ aluno, onBack }: ExtratoAlunoProps) {\n  const { data: pagamentos, isLoading } = useQuery<Pagamento[]>({\n    queryKey: [`/api/pagamentos/aluno/${aluno.id}`],\n  });\n\n  const calcularTotal = () => {\n    return pagamentos?.reduce((total, pagamento) => total + parseFloat(pagamento.valor), 0) || 0;\n  };\n\n  const formatarMesReferencia = (mesRef: string) => {\n    const [ano, mes] = mesRef.split('-');\n    const meses = [\n      'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',\n      'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'\n    ];\n    return `${meses[parseInt(mes) - 1]} ${ano}`;\n  };\n\n  const getFormaPagamentoBadge = (forma: string) => {\n    const cores: Record<string, string> = {\n      'PIX': 'bg-green-100 text-green-800',\n      'Dinheiro': 'bg-blue-100 text-blue-800',\n      'Cartão': 'bg-purple-100 text-purple-800',\n      'Débito': 'bg-orange-100 text-orange-800',\n      'Transferência': 'bg-teal-100 text-teal-800'\n    };\n    \n    return cores[forma] || 'bg-gray-100 text-gray-800';\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-4\">\n          <Button variant=\"outline\" onClick={onBack}>\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Voltar\n          </Button>\n          <div>\n            <h2 className=\"text-2xl font-bold text-neutral-800\">Extrato de Pagamentos</h2>\n            <p className=\"text-neutral-600\">{aluno.nome}</p>\n          </div>\n        </div>\n        <div className=\"flex space-x-3\">\n          <Button variant=\"outline\" onClick={() => window.location.href = '/financeiro'}>\n            <DollarSign className=\"w-4 h-4 mr-2\" />\n            Ir para Financeiro\n          </Button>\n          <Button variant=\"outline\">\n            <Download className=\"w-4 h-4 mr-2\" />\n            Exportar PDF\n          </Button>\n        </div>\n      </div>\n\n      {/* Informações do Aluno */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            <Receipt className=\"w-5 h-5 mr-2\" />\n            Dados do Aluno\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div>\n              <p className=\"text-sm text-neutral-500\">Nome Completo</p>\n              <p className=\"font-medium\">{aluno.nome}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-neutral-500\">Unidade</p>\n              <p className=\"font-medium\">{aluno.filial?.nome || 'Não informado'}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-neutral-500\">Status de Pagamento</p>\n              <Badge \n                variant={aluno.statusPagamento?.emDia ? \"default\" : \"destructive\"}\n                className={aluno.statusPagamento?.emDia ? \"bg-green-600 hover:bg-green-700\" : \"\"}\n              >\n                {aluno.statusPagamento?.emDia ? \"Em Dia\" : \"Atrasado\"}\n              </Badge>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Resumo Financeiro */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"text-center\">\n              <p className=\"text-2xl font-bold text-green-600\">\n                R$ {calcularTotal().toFixed(2).replace('.', ',')}\n              </p>\n              <p className=\"text-sm text-neutral-500\">Total Pago</p>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"text-center\">\n              <p className=\"text-2xl font-bold text-blue-600\">\n                {pagamentos?.length || 0}\n              </p>\n              <p className=\"text-sm text-neutral-500\">Pagamentos</p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"text-center\">\n              <p className=\"text-2xl font-bold text-purple-600\">\n                {aluno.statusPagamento?.ultimoPagamento \n                  ? formatarMesReferencia(aluno.statusPagamento.ultimoPagamento)\n                  : \"Nenhum\"\n                }\n              </p>\n              <p className=\"text-sm text-neutral-500\">Último Mês</p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"text-center\">\n              <p className=\"text-2xl font-bold text-orange-600\">\n                R$ 150,00\n              </p>\n              <p className=\"text-sm text-neutral-500\">Mensalidade</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Histórico de Pagamentos */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            <Calendar className=\"w-5 h-5 mr-2\" />\n            Histórico de Pagamentos\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"space-y-3\">\n              {[...Array(5)].map((_, i) => (\n                <div key={i} className=\"flex items-center space-x-4\">\n                  <Skeleton className=\"h-4 w-24\" />\n                  <Skeleton className=\"h-4 w-32\" />\n                  <Skeleton className=\"h-4 w-20\" />\n                  <Skeleton className=\"h-4 w-16\" />\n                </div>\n              ))}\n            </div>\n          ) : !pagamentos || pagamentos.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <CreditCard className=\"w-12 h-12 text-neutral-400 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-neutral-800 mb-2\">\n                Nenhum pagamento registrado\n              </h3>\n              <p className=\"text-neutral-500\">\n                O histórico de pagamentos aparecerá aqui quando houver registros.\n              </p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Mês Referência</TableHead>\n                    <TableHead>Data Pagamento</TableHead>\n                    <TableHead>Valor</TableHead>\n                    <TableHead>Forma</TableHead>\n                    <TableHead>Observações</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {pagamentos\n                    .sort((a, b) => b.mesReferencia.localeCompare(a.mesReferencia))\n                    .map((pagamento) => (\n                    <TableRow key={pagamento.id}>\n                      <TableCell>\n                        <div className=\"font-medium\">\n                          {formatarMesReferencia(pagamento.mesReferencia)}\n                        </div>\n                        <div className=\"text-sm text-neutral-500\">\n                          {pagamento.mesReferencia}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center\">\n                          <Calendar className=\"w-4 h-4 mr-2 text-neutral-400\" />\n                          {format(new Date(pagamento.dataPagamento), \"dd/MM/yyyy\", { locale: ptBR })}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <span className=\"font-medium text-green-600\">\n                          R$ {parseFloat(pagamento.valor).toFixed(2).replace('.', ',')}\n                        </span>\n                      </TableCell>\n                      <TableCell>\n                        <Badge \n                          variant=\"outline\" \n                          className={getFormaPagamentoBadge(pagamento.formaPagamento)}\n                        >\n                          {pagamento.formaPagamento}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {pagamento.observacoes || (\n                          <span className=\"text-neutral-400\">-</span>\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":9200},"client/src/pages/RelatorioPresencas.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { \n  Calendar,\n  Search, \n  Download,\n  Filter,\n  Users,\n  ClipboardList,\n  CheckCircle,\n  XCircle,\n  FileText\n} from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport jsPDF from \"jspdf\";\nimport autoTable from \"jspdf-autotable\";\nimport type { \n  TurmaWithProfessor, \n  AlunoWithFilial, \n  Presenca\n} from \"@shared/schema\";\n\ninterface PresencaDetalhada extends Presenca {\n  aluno: AlunoWithFilial;\n  turma: TurmaWithProfessor;\n}\n\nexport default function RelatorioPresencas() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [turmaFiltro, setTurmaFiltro] = useState<string>(\"todas\");\n  const [dataInicio, setDataInicio] = useState(\"\");\n  const [dataFim, setDataFim] = useState(\"\");\n  const [statusFiltro, setStatusFiltro] = useState<string>(\"todos\");\n\n  const { data: turmas } = useQuery<TurmaWithProfessor[]>({\n    queryKey: [\"/api/turmas\"],\n  });\n\n  const { data: presencas, isLoading: loadingPresencas } = useQuery<PresencaDetalhada[]>({\n    queryKey: [\"/api/presencas/detalhadas\"],\n  });\n\n  const presencasFiltradas = presencas?.filter(presenca => {\n    const matchesSearch = presenca.aluno.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         presenca.turma.nome.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    const matchesTurma = turmaFiltro === \"todas\" || presenca.turmaId.toString() === turmaFiltro;\n    \n    const matchesStatus = statusFiltro === \"todos\" || \n                         (statusFiltro === \"presente\" && presenca.presente) ||\n                         (statusFiltro === \"ausente\" && !presenca.presente);\n\n    const matchesDataInicio = !dataInicio || presenca.data >= dataInicio;\n    const matchesDataFim = !dataFim || presenca.data <= dataFim;\n\n    return matchesSearch && matchesTurma && matchesStatus && matchesDataInicio && matchesDataFim;\n  }) || [];\n\n  const estatisticas = presencas ? {\n    totalRegistros: presencas.length,\n    totalPresentes: presencas.filter(p => p.presente).length,\n    totalAusentes: presencas.filter(p => !p.presente).length,\n    percentualPresenca: presencas.length > 0 \n      ? Math.round((presencas.filter(p => p.presente).length / presencas.length) * 100)\n      : 0\n  } : null;\n\n  const handleExportarCSV = () => {\n    const csvData = presencasFiltradas.map(presenca => ({\n      Data: format(new Date(presenca.data), \"dd/MM/yyyy\"),\n      Aluno: presenca.aluno.nome,\n      Turma: presenca.turma.nome,\n      Professor: presenca.turma.professor?.nome || \"N/A\",\n      Status: presenca.presente ? \"Presente\" : \"Ausente\",\n      Observacoes: presenca.observacoes || \"\"\n    }));\n\n    const csvContent = [\n      Object.keys(csvData[0] || {}).join(\",\"),\n      ...csvData.map(row => Object.values(row).join(\",\"))\n    ].join(\"\\n\");\n\n    const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8;\" });\n    const link = document.createElement(\"a\");\n    const url = URL.createObjectURL(blob);\n    link.setAttribute(\"href\", url);\n    link.setAttribute(\"download\", `relatorio_presencas_${format(new Date(), \"yyyy-MM-dd\")}.csv`);\n    link.style.visibility = \"hidden\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  const handleExportarPDF = () => {\n    const doc = new jsPDF();\n    \n    // Título do documento\n    doc.setFontSize(20);\n    doc.text(\"Relatório de Presenças\", 20, 20);\n    \n    // Informações gerais\n    doc.setFontSize(12);\n    doc.text(`Gerado em: ${format(new Date(), \"dd/MM/yyyy 'às' HH:mm\", { locale: ptBR })}`, 20, 35);\n    \n    // Estatísticas\n    if (estatisticas) {\n      doc.text(`Total de Registros: ${estatisticas.totalRegistros}`, 20, 45);\n      doc.text(`Presenças: ${estatisticas.totalPresentes}`, 20, 55);\n      doc.text(`Ausências: ${estatisticas.totalAusentes}`, 20, 65);\n      doc.text(`Percentual de Presença: ${estatisticas.percentualPresenca}%`, 20, 75);\n    }\n\n    // Tabela de dados\n    const tableData = presencasFiltradas.map(presenca => [\n      format(new Date(presenca.data), \"dd/MM/yyyy\"),\n      presenca.aluno.nome,\n      presenca.turma.nome,\n      presenca.turma.professor?.nome || \"N/A\",\n      presenca.presente ? \"Presente\" : \"Ausente\",\n      presenca.observacoes || \"\"\n    ]);\n\n    autoTable(doc, {\n      head: [[\"Data\", \"Aluno\", \"Turma\", \"Professor\", \"Status\", \"Observações\"]],\n      body: tableData,\n      startY: 90,\n      styles: {\n        fontSize: 8,\n        cellPadding: 3,\n      },\n      headStyles: {\n        fillColor: [41, 128, 185],\n        textColor: 255,\n        fontStyle: 'bold',\n      },\n      alternateRowStyles: {\n        fillColor: [245, 245, 245],\n      },\n      columnStyles: {\n        0: { cellWidth: 25 }, // Data\n        1: { cellWidth: 40 }, // Aluno\n        2: { cellWidth: 30 }, // Turma\n        3: { cellWidth: 35 }, // Professor\n        4: { cellWidth: 25 }, // Status\n        5: { cellWidth: 35 }, // Observações\n      },\n    });\n\n    // Salvar o PDF\n    doc.save(`relatorio_presencas_${format(new Date(), \"yyyy-MM-dd\")}.pdf`);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-3xl font-bold text-neutral-800\">Relatório de Presenças</h2>\n          <p className=\"text-neutral-600\">Acompanhe a frequência dos alunos nas turmas</p>\n        </div>\n        <div className=\"flex items-center space-x-3\">\n          <Button \n            variant=\"outline\" \n            onClick={handleExportarCSV} \n            disabled={presencasFiltradas.length === 0}\n          >\n            <Download className=\"w-4 h-4 mr-2\" />\n            Exportar CSV\n          </Button>\n          <Button \n            onClick={handleExportarPDF} \n            disabled={presencasFiltradas.length === 0}\n          >\n            <FileText className=\"w-4 h-4 mr-2\" />\n            Exportar PDF\n          </Button>\n        </div>\n      </div>\n\n      {/* Estatísticas */}\n      {estatisticas && (\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"p-2 bg-blue-100 rounded-lg\">\n                  <ClipboardList className=\"w-5 h-5 text-blue-600\" />\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-neutral-500\">Total de Registros</p>\n                  <p className=\"text-2xl font-bold text-neutral-900\">{estatisticas.totalRegistros}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"p-2 bg-green-100 rounded-lg\">\n                  <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-neutral-500\">Presenças</p>\n                  <p className=\"text-2xl font-bold text-green-600\">{estatisticas.totalPresentes}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"p-2 bg-red-100 rounded-lg\">\n                  <XCircle className=\"w-5 h-5 text-red-600\" />\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-neutral-500\">Ausências</p>\n                  <p className=\"text-2xl font-bold text-red-600\">{estatisticas.totalAusentes}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"p-2 bg-purple-100 rounded-lg\">\n                  <Users className=\"w-5 h-5 text-purple-600\" />\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-neutral-500\">% Presença</p>\n                  <p className=\"text-2xl font-bold text-purple-600\">{estatisticas.percentualPresenca}%</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Filtros */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            <Filter className=\"w-5 h-5 mr-2\" />\n            Filtros\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-6 gap-4\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400 w-4 h-4\" />\n              <Input\n                placeholder=\"Buscar aluno ou turma...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n\n            <Select value={turmaFiltro} onValueChange={setTurmaFiltro}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"Filtrar por turma\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"todas\">Todas as turmas</SelectItem>\n                {turmas?.map((turma) => (\n                  <SelectItem key={turma.id} value={turma.id.toString()}>\n                    {turma.nome}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n\n            <Select value={statusFiltro} onValueChange={setStatusFiltro}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"Status\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"todos\">Todos</SelectItem>\n                <SelectItem value=\"presente\">Presente</SelectItem>\n                <SelectItem value=\"ausente\">Ausente</SelectItem>\n              </SelectContent>\n            </Select>\n\n            <Input\n              type=\"date\"\n              placeholder=\"Data início\"\n              value={dataInicio}\n              onChange={(e) => setDataInicio(e.target.value)}\n            />\n\n            <Input\n              type=\"date\"\n              placeholder=\"Data fim\"\n              value={dataFim}\n              onChange={(e) => setDataFim(e.target.value)}\n            />\n\n            <Button \n              variant=\"outline\" \n              onClick={() => {\n                setSearchTerm(\"\");\n                setTurmaFiltro(\"todas\");\n                setStatusFiltro(\"todos\");\n                setDataInicio(\"\");\n                setDataFim(\"\");\n              }}\n            >\n              Limpar\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Tabela de Presenças */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Registros de Presença</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {loadingPresencas ? (\n            <div className=\"space-y-3\">\n              {[...Array(5)].map((_, i) => (\n                <div key={i} className=\"flex items-center space-x-4\">\n                  <Skeleton className=\"h-12 w-full\" />\n                </div>\n              ))}\n            </div>\n          ) : presencasFiltradas.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <FileText className=\"w-12 h-12 text-neutral-400 mx-auto mb-4\" />\n              <p className=\"text-neutral-500\">Nenhum registro de presença encontrado</p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Data</TableHead>\n                    <TableHead>Aluno</TableHead>\n                    <TableHead>Turma</TableHead>\n                    <TableHead>Professor</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Observações</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {presencasFiltradas.map((presenca) => (\n                    <TableRow key={`${presenca.id}-${presenca.alunoId}-${presenca.data}`}>\n                      <TableCell>\n                        <div className=\"flex items-center\">\n                          <Calendar className=\"w-4 h-4 mr-2 text-neutral-400\" />\n                          {format(new Date(presenca.data), \"dd/MM/yyyy\", { locale: ptBR })}\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"font-medium\">\n                        {presenca.aluno.nome}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\">\n                          {presenca.turma.nome}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {presenca.turma.professor?.nome || \"N/A\"}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={presenca.presente ? \"default\" : \"destructive\"}>\n                          {presenca.presente ? \"Presente\" : \"Ausente\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"max-w-xs truncate\">\n                        {presenca.observacoes || \"-\"}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":14306},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"replit.md":{"content":"# Football School Management System\n\n## Overview\n\nThis is a comprehensive management system for a football school (Escola de Futebol) built with a modern full-stack architecture. The system manages students (alunos), teachers (professores), classes (turmas), payments (pagamentos), and multiple branch locations (filiais). It provides centralized administration with features for enrollment management, payment tracking, class scheduling, and reporting.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Framework & Build System**\n- React 18 with TypeScript for type-safe component development\n- Vite as the build tool and development server for fast HMR (Hot Module Replacement)\n- Wouter for lightweight client-side routing instead of React Router\n- TanStack Query (React Query) for server state management and data fetching\n\n**UI Component Library**\n- Shadcn UI components based on Radix UI primitives\n- Tailwind CSS for utility-first styling with custom design tokens\n- CSS variables for theming with light/dark mode support\n- \"New York\" style variant from Shadcn configured in components.json\n\n**State Management Strategy**\n- Server state managed through TanStack Query with persistent caching\n- Form state handled by React Hook Form with Zod validation\n- Local UI state managed with React hooks\n- Authentication state derived from user query endpoint\n\n**Form Handling**\n- React Hook Form for performant form management\n- Zod schemas for runtime validation (shared between client and server)\n- @hookform/resolvers for seamless integration\n- Drizzle-zod for auto-generating validation schemas from database schema\n\n### Backend Architecture\n\n**Server Framework**\n- Express.js server with TypeScript\n- Custom middleware for request logging and error handling\n- Separation between development (Vite middleware) and production (static files)\n- RESTful API design with `/api` prefix for all endpoints\n\n**Database Layer**\n- PostgreSQL database via Neon serverless driver\n- Drizzle ORM for type-safe database operations\n- Schema-first approach with shared TypeScript types\n- WebSocket connection support for serverless PostgreSQL\n\n**Data Access Pattern**\n- Storage abstraction layer (IStorage interface) for database operations\n- Centralized data access through storage.ts module\n- Type-safe queries using Drizzle ORM query builder\n- Relations defined in schema for efficient joins\n\n**Database Schema Design**\n- **Users**: Stores authentication data (id, email, name, profile image)\n- **Alunos** (Students): Core student information with references to filiais and responsáveis (guardians)\n- **Professores** (Teachers): Teacher profiles with specialization and salary information\n- **Turmas** (Classes): Class schedules with professor assignments, capacity limits, and pricing\n- **Matriculas** (Enrollments): Junction table linking students to classes\n- **Pagamentos** (Payments): Payment records with reference month and payment methods\n- **Filiais** (Branches): Multiple location support with individual branch data\n- **Sessions**: Server-side session storage for authentication\n\n### Authentication & Authorization\n\n**Replit Auth Integration**\n- OpenID Connect (OIDC) authentication flow\n- Passport.js strategy for user authentication\n- Express session middleware with PostgreSQL session store\n- Mandatory `isAuthenticated` middleware on protected routes\n\n**Session Management**\n- Server-side sessions stored in PostgreSQL via connect-pg-simple\n- 7-day session TTL with httpOnly, secure cookies\n- Session secret from environment variables\n- User profile synchronized with authentication claims\n\n### API Architecture\n\n**Route Organization**\n- Auth routes: `/api/auth/*` for login/logout and user info\n- Resource routes: `/api/alunos`, `/api/professores`, `/api/turmas`, `/api/filiais`, `/api/pagamentos`\n- Dashboard metrics: `/api/dashboard/metrics` for aggregated statistics\n- All routes protected with `isAuthenticated` middleware\n\n**Data Flow Pattern**\n1. Client makes request via TanStack Query\n2. Request intercepted by auth middleware\n3. Storage layer executes database operations\n4. Results serialized and returned as JSON\n5. Client cache updated automatically\n\n**Error Handling**\n- Global error handler middleware\n- Structured error responses with status codes\n- Client-side error toasts via Shadcn toast component\n- Validation errors caught at form level with Zod\n\n### External Dependencies\n\n**Database**\n- Neon Serverless PostgreSQL (via @neondatabase/serverless)\n- DATABASE_URL environment variable required for connection\n- WebSocket support via 'ws' package for serverless compatibility\n- Drizzle Kit for schema migrations\n\n**Authentication Services**\n- Replit Authentication (OpenID Connect)\n- ISSUER_URL: Defaults to https://replit.com/oidc\n- REPL_ID and SESSION_SECRET required environment variables\n- REPLIT_DOMAINS for allowed host validation\n\n**Development Tools**\n- Replit-specific plugins for development environment integration\n- @replit/vite-plugin-runtime-error-modal for error overlays\n- @replit/vite-plugin-cartographer for code navigation (dev only)\n\n**Third-Party Libraries**\n- date-fns for date manipulation and formatting (pt-BR locale)\n- nanoid for unique ID generation\n- memoizee for caching OIDC configuration\n- Radix UI primitives for accessible UI components","size_bytes":5374},"client/src/components/forms/ProfessorForm.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertProfessorSchema, type Professor, type InsertProfessor } from \"@shared/schema\";\nimport { z } from \"zod\";\n\nconst formSchema = insertProfessorSchema.extend({\n  salario: z.string().optional(),\n});\n\ntype FormData = z.infer<typeof formSchema>;\n\ninterface ProfessorFormProps {\n  professor?: Professor | null;\n  onSuccess: () => void;\n}\n\nconst especialidades = [\n  \"Futebol de Campo\",\n  \"Futsal\",\n  \"Futebol Infantil\",\n  \"Preparação Física\",\n  \"Técnica Individual\",\n  \"Tática\",\n  \"Goleiro\",\n];\n\nexport default function ProfessorForm({ professor, onSuccess }: ProfessorFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      nome: professor?.nome || \"\",\n      email: professor?.email || \"\",\n      telefone: professor?.telefone || \"\",\n      especialidade: professor?.especialidade || \"\",\n      salario: professor?.salario || \"\",\n      ativo: professor?.ativo ?? true,\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertProfessor) => {\n      const response = await apiRequest(\"POST\", \"/api/professores\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/professores\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/metrics\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Professor cadastrado com sucesso.\",\n      });\n      onSuccess();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao cadastrar professor. Verifique os dados e tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: Partial<InsertProfessor>) => {\n      const response = await apiRequest(\"PUT\", `/api/professores/${professor!.id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/professores\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Professor atualizado com sucesso.\",\n      });\n      onSuccess();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao atualizar professor. Verifique os dados e tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: FormData) => {\n    const submitData: InsertProfessor = {\n      ...data,\n      email: data.email || null,\n      telefone: data.telefone || null,\n      especialidade: data.especialidade || null,\n      salario: data.salario || null,\n    };\n\n    if (professor) {\n      updateMutation.mutate(submitData);\n    } else {\n      createMutation.mutate(submitData);\n    }\n  };\n\n  const isLoading = createMutation.isPending || updateMutation.isPending;\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"nome\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Nome Completo *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Digite o nome completo\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"email\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>E-mail</FormLabel>\n                <FormControl>\n                  <Input type=\"email\" placeholder=\"email@exemplo.com\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"telefone\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Telefone</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"(11) 99999-9999\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"especialidade\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Especialidade</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione a especialidade\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {especialidades.map((especialidade) => (\n                      <SelectItem key={especialidade} value={especialidade}>\n                        {especialidade}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <div className=\"md:col-span-2\">\n            <FormField\n              control={form.control}\n              name=\"salario\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Salário</FormLabel>\n                  <FormControl>\n                    <Input \n                      type=\"number\" \n                      step=\"0.01\"\n                      placeholder=\"0.00\" \n                      {...field} \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"ativo\"\n          render={({ field }) => (\n            <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n              <div className=\"space-y-0.5\">\n                <FormLabel className=\"text-base\">Status Ativo</FormLabel>\n                <div className=\"text-sm text-muted-foreground\">\n                  Determina se o professor está ativo no sistema\n                </div>\n              </div>\n              <FormControl>\n                <Switch\n                  checked={field.value}\n                  onCheckedChange={field.onChange}\n                />\n              </FormControl>\n            </FormItem>\n          )}\n        />\n\n        <div className=\"flex justify-end space-x-2 pt-4\">\n          <Button type=\"button\" variant=\"outline\" onClick={onSuccess}>\n            Cancelar\n          </Button>\n          <Button type=\"submit\" disabled={isLoading} className=\"bg-primary hover:bg-primary/90\">\n            {isLoading ? \"Salvando...\" : professor ? \"Atualizar\" : \"Cadastrar\"}\n          </Button>\n        </div>\n      </form>\n    </Form>\n  );\n}\n","size_bytes":7631},"client/src/components/forms/TurmaForm.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertTurmaSchema, type TurmaWithProfessor, type InsertTurma, type Professor, type Filial } from \"@shared/schema\";\nimport { z } from \"zod\";\n\nconst formSchema = insertTurmaSchema.extend({\n  professorId: z.number().optional(),\n  filialId: z.number().optional(),\n  valorMensalidade: z.string().optional(),\n  capacidadeMaxima: z.number().optional(),\n});\n\ntype FormData = z.infer<typeof formSchema>;\n\ninterface TurmaFormProps {\n  turma?: TurmaWithProfessor | null;\n  onSuccess: () => void;\n}\n\nconst categorias = [\"Infantil\", \"Juvenil\", \"Adulto\"];\nconst diasSemana = [\n  { id: \"Segunda\", label: \"Segunda-feira\" },\n  { id: \"Terça\", label: \"Terça-feira\" },\n  { id: \"Quarta\", label: \"Quarta-feira\" },\n  { id: \"Quinta\", label: \"Quinta-feira\" },\n  { id: \"Sexta\", label: \"Sexta-feira\" },\n  { id: \"Sábado\", label: \"Sábado\" },\n  { id: \"Domingo\", label: \"Domingo\" },\n];\n\nexport default function TurmaForm({ turma, onSuccess }: TurmaFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: professores } = useQuery<Professor[]>({\n    queryKey: [\"/api/professores\"],\n  });\n\n  const { data: filiais } = useQuery<Filial[]>({\n    queryKey: [\"/api/filiais\"],\n  });\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      nome: turma?.nome || \"\",\n      categoria: turma?.categoria || \"\",\n      professorId: turma?.professorId || undefined,\n      filialId: turma?.filialId || undefined,\n      horario: turma?.horario || \"\",\n      diasSemana: turma?.diasSemana || \"\",\n      capacidadeMaxima: turma?.capacidadeMaxima || 20,\n      valorMensalidade: turma?.valorMensalidade || \"\",\n      ativo: Boolean(turma?.ativo ?? true),\n    },\n  });\n\n  const selectedDias = form.watch(\"diasSemana\")?.split(\",\").filter(Boolean) || [];\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertTurma) => {\n      const response = await apiRequest(\"POST\", \"/api/turmas\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/turmas\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/metrics\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Turma cadastrada com sucesso.\",\n      });\n      onSuccess();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao cadastrar turma. Verifique os dados e tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: Partial<InsertTurma>) => {\n      const response = await apiRequest(\"PUT\", `/api/turmas/${turma!.id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/turmas\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Turma atualizada com sucesso.\",\n      });\n      onSuccess();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao atualizar turma. Verifique os dados e tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDiaChange = (diaId: string, checked: boolean) => {\n    const currentDias = form.getValues(\"diasSemana\")?.split(\",\").filter(Boolean) || [];\n    let newDias;\n    \n    if (checked) {\n      newDias = [...currentDias, diaId];\n    } else {\n      newDias = currentDias.filter(d => d !== diaId);\n    }\n    \n    form.setValue(\"diasSemana\", newDias.join(\",\"));\n  };\n\n  const onSubmit = (data: FormData) => {\n    const submitData: InsertTurma = {\n      ...data,\n      professorId: data.professorId || null,\n      horario: data.horario || null,\n      diasSemana: data.diasSemana || null,\n      valorMensalidade: data.valorMensalidade || null,\n    };\n\n    if (turma) {\n      updateMutation.mutate(submitData);\n    } else {\n      createMutation.mutate(submitData);\n    }\n  };\n\n  const isLoading = createMutation.isPending || updateMutation.isPending;\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"nome\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Nome da Turma *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Ex: Infantil A\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"categoria\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Categoria *</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione a categoria\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {categorias.map((categoria) => (\n                      <SelectItem key={categoria} value={categoria}>\n                        {categoria}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"professorId\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Professor Responsável</FormLabel>\n                <Select \n                  onValueChange={(value) => field.onChange(value ? parseInt(value) : undefined)} \n                  defaultValue={field.value?.toString()}\n                >\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione um professor\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {professores?.filter(p => p.ativo).map((professor) => (\n                      <SelectItem key={professor.id} value={professor.id.toString()}>\n                        {professor.nome}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"filialId\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Filial</FormLabel>\n                <Select \n                  onValueChange={(value) => field.onChange(value ? parseInt(value) : undefined)} \n                  defaultValue={field.value?.toString()}\n                >\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione uma filial\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {filiais?.filter(f => f.ativa).map((filial) => (\n                      <SelectItem key={filial.id} value={filial.id.toString()}>\n                        {filial.nome}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"horario\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Horário</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Ex: 14:00 - 15:30\" onChange={field.onChange} onBlur={field.onBlur} name={field.name} ref={field.ref} value={field.value || \"\"} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"capacidadeMaxima\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Capacidade Máxima</FormLabel>\n                <FormControl>\n                  <Input \n                    type=\"number\" \n                    min=\"1\"\n                    placeholder=\"20\" \n                    value={field.value || \"\"}\n                    onChange={(e) => field.onChange(e.target.value ? parseInt(e.target.value) : undefined)}\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"valorMensalidade\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Valor da Mensalidade</FormLabel>\n                <FormControl>\n                  <Input \n                    type=\"number\" \n                    step=\"0.01\"\n                    placeholder=\"0.00\" \n                    {...field} \n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"diasSemana\"\n          render={() => (\n            <FormItem>\n              <FormLabel>Dias da Semana</FormLabel>\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                {diasSemana.map((dia) => (\n                  <div key={dia.id} className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id={dia.id}\n                      checked={selectedDias.includes(dia.id)}\n                      onCheckedChange={(checked) => handleDiaChange(dia.id, checked as boolean)}\n                    />\n                    <label\n                      htmlFor={dia.id}\n                      className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n                    >\n                      {dia.label}\n                    </label>\n                  </div>\n                ))}\n              </div>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"ativo\"\n          render={({ field }) => (\n            <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n              <div className=\"space-y-0.5\">\n                <FormLabel className=\"text-base\">Status Ativo</FormLabel>\n                <div className=\"text-sm text-muted-foreground\">\n                  Determina se a turma está ativa no sistema\n                </div>\n              </div>\n              <FormControl>\n                <Switch\n                  checked={Boolean(field.value)}\n                  onCheckedChange={field.onChange}\n                />\n              </FormControl>\n            </FormItem>\n          )}\n        />\n\n        <div className=\"flex justify-end space-x-2 pt-4\">\n          <Button type=\"button\" variant=\"outline\" onClick={onSuccess}>\n            Cancelar\n          </Button>\n          <Button type=\"submit\" disabled={isLoading} className=\"bg-primary hover:bg-primary/90\">\n            {isLoading ? \"Salvando...\" : turma ? \"Atualizar\" : \"Cadastrar\"}\n          </Button>\n        </div>\n      </form>\n    </Form>\n  );\n}\n","size_bytes":12171},"client/src/pages/ResponsavelPortalSimples.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { useResponsavel, logoutResponsavel } from \"@/hooks/useResponsavel\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { AlunoWithFilial, InsertAluno, Filial } from \"@shared/schema\";\nimport AlunoFormResponsavel from \"@/components/forms/AlunoFormResponsavel\";\nimport { \n  Bell, \n  User, \n  CreditCard, \n  Calendar, \n  ShoppingBag, \n  LogOut,\n  AlertTriangle,\n  CheckCircle,\n  Clock,\n  Users,\n  DollarSign,\n  Gift,\n  Loader2,\n  Plus,\n  Edit,\n  Download,\n  Camera,\n  ImageIcon\n} from \"lucide-react\";\nimport { InterLogo } from \"@/components/InterLogo\";\n\nexport default function ResponsavelPortal() {\n  const [activeTab, setActiveTab] = useState(\"dashboard\");\n  const [showAlunoForm, setShowAlunoForm] = useState(false);\n  const [editingAluno, setEditingAluno] = useState<AlunoWithFilial | null>(null);\n  const { responsavel, isLoading, isAuthenticated } = useResponsavel();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Queries\n  const { data: filiais } = useQuery<Filial[]>({\n    queryKey: [\"/api/filiais\"],\n  });\n\n  const { data: alunos, isLoading: alunosLoading } = useQuery<AlunoWithFilial[]>({\n    queryKey: [\"/api/alunos\"],\n  });\n\n  const { data: pacotesTreino = [] } = useQuery({\n    queryKey: [\"/api/pacotes-treino\"],\n  });\n\n  const { data: assinaturasPacotes = [] } = useQuery({\n    queryKey: [\"/api/assinaturas-pacotes\"],\n  });\n\n  // Mutations\n  const contratarPacoteMutation = useMutation({\n    mutationFn: async (data: { alunoId: number; pacoteId: number; formaPagamento: string; observacoes?: string }) => {\n      const response = await apiRequest(\"POST\", \"/api/assinaturas-pacotes\", {\n        alunoId: data.alunoId,\n        pacoteId: data.pacoteId,\n        status: \"ativo\",\n        dataInicio: new Date().toISOString().split('T')[0],\n        dataFim: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 30 dias\n        valorPago: \"0.00\",\n        formaPagamento: data.formaPagamento,\n        observacoes: data.observacoes\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Sucesso!\",\n        description: \"Pacote contratado com sucesso!\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/assinaturas-pacotes\"] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao contratar pacote. Tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createAlunoMutation = useMutation({\n    mutationFn: async (data: InsertAluno) => {\n      return await apiRequest(\"POST\", \"/api/alunos\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/alunos\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/responsaveis/me\"] });\n      setShowAlunoForm(false);\n      setEditingAluno(null);\n      toast({\n        title: \"Sucesso\",\n        description: \"Aluno cadastrado com sucesso!\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao cadastrar aluno\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateAlunoMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: Partial<InsertAluno> }) => {\n      return await apiRequest(\"PATCH\", `/api/alunos/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/alunos\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/responsaveis/me\"] });\n      setShowAlunoForm(false);\n      setEditingAluno(null);\n      toast({\n        title: \"Sucesso\",\n        description: \"Aluno atualizado com sucesso!\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao atualizar aluno\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Redirect to login if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Acesso restrito\",\n        description: \"Você precisa fazer login para acessar o portal.\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/responsavel/login\";\n      }, 1000);\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <Loader2 className=\"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600\" />\n          <p className=\"text-gray-600\">Carregando portal...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated || !responsavel) {\n    return null; // Will redirect to login\n  }\n\n  const handleLogout = async () => {\n    await logoutResponsavel();\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-blue-100\">\n      {/* Header */}\n      <div className=\"bg-blue-50 shadow-sm border-b border-blue-200\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center py-4 gap-3\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-8 h-8 sm:w-10 sm:h-10 bg-blue-600 rounded-full flex items-center justify-center p-1\">\n                <InterLogo size={24} />\n              </div>\n              <div>\n                <h1 className=\"text-lg sm:text-xl font-bold text-gray-900\">Portal dos Responsáveis</h1>\n                <p className=\"text-xs sm:text-sm text-gray-600\">Bem-vindo, {responsavel.nome}</p>\n              </div>\n            </div>\n            <Button onClick={handleLogout} variant=\"outline\" size=\"sm\" className=\"text-xs sm:text-sm\">\n              <LogOut className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2\" />\n              <span className=\"hidden sm:inline\">Sair</span>\n              <span className=\"sm:hidden\">🚪</span>\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <Tabs value={activeTab} onValueChange={setActiveTab}>\n          <TabsList className=\"grid w-full grid-cols-3 sm:grid-cols-6 gap-1\">\n            <TabsTrigger value=\"dashboard\" className=\"text-xs sm:text-sm\">📊 Dashboard</TabsTrigger>\n            <TabsTrigger value=\"alunos\" className=\"text-xs sm:text-sm\">👨‍👩‍👧‍👦 Filhos</TabsTrigger>\n            <TabsTrigger value=\"pagamentos\" className=\"text-xs sm:text-sm\">💳 Pagamentos</TabsTrigger>\n            <TabsTrigger value=\"pacotes\" className=\"text-xs sm:text-sm\">🏃‍♂️ Pacotes</TabsTrigger>\n            <TabsTrigger value=\"eventos\" className=\"text-xs sm:text-sm\">📅 Eventos</TabsTrigger>\n            <TabsTrigger value=\"uniformes\" className=\"text-xs sm:text-sm\">👕 Uniformes</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"dashboard\" className=\"space-y-6\">\n            <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-4\">\n              <Card className=\"bg-blue-50 border-blue-200\">\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Filhos Matriculados</CardTitle>\n                  <Users className=\"h-4 w-4 text-blue-600\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold text-blue-600\">{responsavel.alunos?.length || 0}</div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-blue-50 border-blue-200\">\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Pagamentos em Dia</CardTitle>\n                  <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold text-green-600\">\n                    {responsavel.alunos?.filter(aluno => aluno.statusPagamento?.emDia).length || 0}\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-blue-50 border-blue-200\">\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Pagamentos Atrasados</CardTitle>\n                  <AlertTriangle className=\"h-4 w-4 text-red-600\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold text-red-600\">\n                    {responsavel.alunos?.filter(aluno => !aluno.statusPagamento?.emDia).length || 0}\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-blue-50 border-blue-200\">\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Notificações</CardTitle>\n                  <Bell className=\"h-4 w-4 text-blue-600\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold text-blue-600\">3</div>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Filhos Cards */}\n            <div className=\"space-y-4\">\n              <h3 className=\"text-lg font-semibold\">Seus Filhos</h3>\n              <div className=\"grid gap-4 md:grid-cols-2\">\n                {responsavel.alunos?.map((aluno: any) => (\n                  <Card key={aluno.id} className=\"bg-blue-50 border-blue-200\">\n                    <CardHeader>\n                      <div className=\"flex justify-between items-start\">\n                        <div className=\"flex items-center space-x-3\">\n                          {aluno.fotoUrl ? (\n                            <div className=\"relative group\">\n                              <img \n                                src={aluno.fotoUrl} \n                                alt={aluno.nome}\n                                className=\"w-12 h-12 rounded-full object-cover cursor-pointer\"\n                                onError={(e) => {\n                                  e.currentTarget.style.display = 'none';\n                                }}\n                                onClick={() => {\n                                  const link = document.createElement('a');\n                                  link.href = aluno.fotoUrl!;\n                                  link.download = `foto-${aluno.nome.replace(/\\s+/g, '-').toLowerCase()}.jpg`;\n                                  link.target = '_blank';\n                                  document.body.appendChild(link);\n                                  link.click();\n                                  document.body.removeChild(link);\n                                }}\n                              />\n                              <div className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 rounded-full transition-all duration-200 flex items-center justify-center\">\n                                <span className=\"text-white text-xs opacity-0 group-hover:opacity-100\">⬇</span>\n                              </div>\n                            </div>\n                          ) : (\n                            <div className=\"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center\">\n                              <span className=\"text-gray-400 text-xs\">Foto</span>\n                            </div>\n                          )}\n                          <div>\n                            <CardTitle className=\"text-base\">{aluno.nome}</CardTitle>\n                            <p className=\"text-sm text-gray-600\">\n                              {aluno.filial?.nome || \"Unidade não informada\"}\n                            </p>\n                            {aluno.cpf && (\n                              <p className=\"text-xs text-gray-500 font-mono\">\n                                CPF: {aluno.cpf}\n                              </p>\n                            )}\n                          </div>\n                        </div>\n                        <Badge \n                          variant={aluno.statusPagamento?.emDia ? \"default\" : \"destructive\"}\n                        >\n                          {aluno.statusPagamento?.emDia ? \"Em dia\" : \"Atrasado\"}\n                        </Badge>\n                      </div>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-2\">\n                        <div className=\"flex justify-between text-sm\">\n                          <span>Status:</span>\n                          <span className={aluno.ativo ? \"text-green-600\" : \"text-red-600\"}>\n                            {aluno.ativo ? \"Ativo\" : \"Inativo\"}\n                          </span>\n                        </div>\n                        {aluno.dataMatricula && (\n                          <div className=\"flex justify-between text-sm\">\n                            <span>Data de matrícula:</span>\n                            <span>{new Date(aluno.dataMatricula).toLocaleDateString('pt-BR')}</span>\n                          </div>\n                        )}\n                        {aluno.statusPagamento?.ultimoPagamento && (\n                          <div className=\"flex justify-between text-sm\">\n                            <span>Último pagamento:</span>\n                            <span>{aluno.statusPagamento.ultimoPagamento}</span>\n                          </div>\n                        )}\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"alunos\" className=\"space-y-6\">\n            <div className=\"flex justify-between items-center\">\n              <h2 className=\"text-2xl font-bold\">Meus Filhos</h2>\n              <Dialog open={showAlunoForm} onOpenChange={setShowAlunoForm}>\n                <DialogTrigger asChild>\n                  <Button onClick={() => {\n                    setEditingAluno(null);\n                    setShowAlunoForm(true);\n                  }}>\n                    <Plus className=\"w-4 h-4 mr-2\" />\n                    Cadastrar Filho\n                  </Button>\n                </DialogTrigger>\n                <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n                  <DialogHeader>\n                    <DialogTitle>\n                      {editingAluno ? 'Editar Aluno' : 'Cadastrar Novo Filho'}\n                    </DialogTitle>\n                  </DialogHeader>\n                  <AlunoFormResponsavel \n                    aluno={editingAluno} \n                    onSuccess={() => {\n                      setShowAlunoForm(false);\n                      setEditingAluno(null);\n                    }}\n                    filiais={filiais || []}\n                    responsavelId={responsavel?.id}\n                    createMutation={createAlunoMutation}\n                    updateMutation={updateAlunoMutation}\n                  />\n                </DialogContent>\n              </Dialog>\n            </div>\n\n            {alunosLoading ? (\n              <div className=\"flex justify-center py-8\">\n                <Loader2 className=\"w-8 h-8 animate-spin\" />\n              </div>\n            ) : (\n              <div className=\"border rounded-lg\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Foto</TableHead>\n                      <TableHead>Nome</TableHead>\n                      <TableHead>CPF</TableHead>\n                      <TableHead>Email</TableHead>\n                      <TableHead>Telefone</TableHead>\n                      <TableHead>Unidade</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead>Data Matrícula</TableHead>\n                      <TableHead>Ações</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {alunos?.filter(aluno => aluno.responsavelId === responsavel?.id).map((aluno) => (\n                      <TableRow key={aluno.id}>\n                        <TableCell>\n                          {aluno.fotoUrl ? (\n                            <div className=\"relative group\">\n                              <img \n                                src={aluno.fotoUrl} \n                                alt={aluno.nome}\n                                className=\"w-10 h-10 rounded-full object-cover cursor-pointer\"\n                                onError={(e) => {\n                                  e.currentTarget.style.display = 'none';\n                                }}\n                                onClick={() => {\n                                  const link = document.createElement('a');\n                                  link.href = aluno.fotoUrl!;\n                                  link.download = `foto-${aluno.nome.replace(/\\s+/g, '-').toLowerCase()}.jpg`;\n                                  link.target = '_blank';\n                                  document.body.appendChild(link);\n                                  link.click();\n                                  document.body.removeChild(link);\n                                }}\n                              />\n                              <div className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 rounded-full transition-all duration-200 flex items-center justify-center\">\n                                <Download className=\"w-3 h-3 text-white opacity-0 group-hover:opacity-100\" />\n                              </div>\n                            </div>\n                          ) : (\n                            <div className=\"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center\">\n                              <User className=\"w-4 h-4 text-gray-400\" />\n                            </div>\n                          )}\n                        </TableCell>\n                        <TableCell className=\"font-medium\">{aluno.nome}</TableCell>\n                        <TableCell>\n                          {aluno.cpf ? (\n                            <span className=\"font-mono text-sm\">{aluno.cpf}</span>\n                          ) : (\n                            <span className=\"text-gray-400 text-sm\">Não informado</span>\n                          )}\n                        </TableCell>\n                        <TableCell>{aluno.email || '-'}</TableCell>\n                        <TableCell>{aluno.telefone || '-'}</TableCell>\n                        <TableCell>{aluno.filial?.nome || '-'}</TableCell>\n                        <TableCell>\n                          <Badge variant={aluno.ativo ? \"default\" : \"secondary\"}>\n                            {aluno.ativo ? \"Ativo\" : \"Inativo\"}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          {aluno.dataMatricula \n                            ? new Date(aluno.dataMatricula).toLocaleDateString('pt-BR')\n                            : '-'\n                          }\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex gap-2\">\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => {\n                                setEditingAluno(aluno);\n                                setShowAlunoForm(true);\n                              }}\n                            >\n                              <Edit className=\"w-4 h-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n                \n                {alunos?.filter(aluno => aluno.responsavelId === responsavel?.id).length === 0 && (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <Users className=\"w-12 h-12 mx-auto mb-4 text-gray-300\" />\n                    <h3 className=\"text-lg font-medium mb-2\">Nenhum filho cadastrado</h3>\n                    <p className=\"text-sm\">Clique em \"Cadastrar Filho\" para adicionar um novo aluno.</p>\n                  </div>\n                )}\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"pagamentos\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <CreditCard className=\"w-5 h-5\" />\n                  Situação dos Pagamentos\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  {responsavel.alunos?.map((aluno: any) => (\n                    <div key={aluno.id} className=\"border rounded-lg p-4\">\n                      <div className=\"flex justify-between items-center\">\n                        <div>\n                          <h4 className=\"font-medium\">{aluno.nome}</h4>\n                          <p className=\"text-sm text-gray-600\">{aluno.filial?.nome}</p>\n                        </div>\n                        <Badge \n                          variant={aluno.statusPagamento?.emDia ? \"default\" : \"destructive\"}\n                        >\n                          {aluno.statusPagamento?.emDia ? \"Em dia\" : \"Atrasado\"}\n                        </Badge>\n                      </div>\n                      {!aluno.statusPagamento?.emDia && (\n                        <Alert className=\"mt-3\">\n                          <AlertTriangle className=\"h-4 w-4\" />\n                          <AlertDescription>\n                            Mensalidade em atraso há {aluno.statusPagamento?.diasAtraso || 0} dias\n                          </AlertDescription>\n                        </Alert>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"pacotes\">\n            <div className=\"space-y-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Gift className=\"w-5 h-5\" />\n                    Pacotes de Treino Disponíveis\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid gap-4 md:grid-cols-3\">\n                    {pacotesTreino.map((pacote: any) => (\n                      <Card key={pacote.id} className=\"border-2 hover:shadow-lg transition-shadow\">\n                        <CardHeader>\n                          <CardTitle className=\"text-lg\">{pacote.nome}</CardTitle>\n                          <p className=\"text-2xl font-bold text-green-600\">\n                            R$ {parseFloat(pacote.valor).toFixed(2)}\n                          </p>\n                        </CardHeader>\n                        <CardContent className=\"space-y-4\">\n                          <p className=\"text-gray-600\">{pacote.descricao}</p>\n                          <div className=\"text-sm text-gray-500\">\n                            <p><strong>Duração:</strong> {pacote.duracao}</p>\n                            <p><strong>Frequência:</strong> {\n                              pacote.nome.includes('3x') ? '3 vezes por semana' :\n                              pacote.nome.includes('2x') ? '2 vezes por semana' :\n                              '1 vez por semana'\n                            }</p>\n                          </div>\n                          \n                          {/* Seletor de aluno */}\n                          <div className=\"space-y-3\">\n                            <label className=\"text-sm font-medium\">Selecione o filho:</label>\n                            <select \n                              className=\"w-full p-2 border rounded-md\"\n                              onChange={(e) => {\n                                const alunoId = parseInt(e.target.value);\n                                if (alunoId) {\n                                  contratarPacoteMutation.mutate({\n                                    alunoId,\n                                    pacoteId: pacote.id,\n                                    formaPagamento: \"pendente\",\n                                    observacoes: `Contratação do pacote ${pacote.nome}`\n                                  });\n                                }\n                                e.target.value = \"\";\n                              }}\n                              disabled={contratarPacoteMutation.isPending}\n                            >\n                              <option value=\"\">Escolha um filho</option>\n                              {alunos?.filter(aluno => aluno.responsavelId === responsavel?.id).map(aluno => (\n                                <option key={aluno.id} value={aluno.id}>\n                                  {aluno.nome}\n                                </option>\n                              ))}\n                            </select>\n                            {contratarPacoteMutation.isPending && (\n                              <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                                <Loader2 className=\"w-4 h-4 animate-spin\" />\n                                Contratando pacote...\n                              </div>\n                            )}\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Pacotes Contratados */}\n              {assinaturasPacotes.length > 0 && (\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Pacotes Contratados</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-4\">\n                      {assinaturasPacotes.map((assinatura: any) => {\n                        const aluno = alunos?.find(a => a.id === assinatura.alunoId);\n                        const pacote = pacotesTreino.find((p: any) => p.id === assinatura.pacoteId);\n                        \n                        return (\n                          <div key={assinatura.id} className=\"border rounded-lg p-4\">\n                            <div className=\"flex justify-between items-start\">\n                              <div>\n                                <h4 className=\"font-medium\">{aluno?.nome}</h4>\n                                <p className=\"text-sm text-gray-600\">{pacote?.nome}</p>\n                                <p className=\"text-sm text-gray-500\">\n                                  Período: {new Date(assinatura.dataInicio).toLocaleDateString()} - {new Date(assinatura.dataFim).toLocaleDateString()}\n                                </p>\n                              </div>\n                              <div className=\"text-right\">\n                                <p className=\"font-bold text-green-600\">R$ {pacote?.valor}</p>\n                                <Badge \n                                  variant={assinatura.status === \"ativo\" ? \"default\" : \"secondary\"}\n                                >\n                                  {assinatura.status}\n                                </Badge>\n                              </div>\n                            </div>\n                            {assinatura.observacoes && (\n                              <p className=\"text-sm text-gray-600 mt-2\">\n                                {assinatura.observacoes}\n                              </p>\n                            )}\n                          </div>\n                        );\n                      })}\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"eventos\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-5 h-5\" />\n                  Eventos Disponíveis\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-gray-600\">\n                  Em breve você poderá visualizar e se inscrever em eventos e competições.\n                </p>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"uniformes\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <ShoppingBag className=\"w-5 h-5\" />\n                  Loja de Uniformes\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-gray-600\">\n                  Em breve você poderá comprar uniformes e equipamentos diretamente pelo portal.\n                </p>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}","size_bytes":30123},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/pages/PainelUnidade.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { \n  Users, \n  BookOpen, \n  GraduationCap, \n  DollarSign, \n  Calendar, \n  FileText, \n  Plus, \n  Edit, \n  Search,\n  Building2,\n  BarChart3,\n  Settings,\n  LogOut\n} from \"lucide-react\";\nimport { InterLogo } from \"@/components/InterLogo\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Filial, AlunoWithFilial, Professor, TurmaWithProfessor } from \"@shared/schema\";\n\nexport default function PainelUnidade() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n\n  // Recuperar unidade selecionada do localStorage\n  const unidadeSelecionada = localStorage.getItem(\"unidade_selecionada\");\n  const filialId = unidadeSelecionada ? parseInt(unidadeSelecionada) : null;\n\n  // Se não há unidade selecionada, redirecionar para seleção\n  if (!filialId) {\n    setLocation(\"/login-unidade\");\n    return null;\n  }\n\n  const { data: filial, isLoading: loadingFilial } = useQuery<Filial>({\n    queryKey: [`/api/filiais/${filialId}`],\n  });\n\n  const { data: alunos, isLoading: loadingAlunos } = useQuery<AlunoWithFilial[]>({\n    queryKey: [`/api/alunos?filialId=${filialId}`],\n  });\n\n  const { data: professores, isLoading: loadingProfessores } = useQuery<Professor[]>({\n    queryKey: [`/api/professores?filialId=${filialId}`],\n  });\n\n  const { data: turmas, isLoading: loadingTurmas } = useQuery<TurmaWithProfessor[]>({\n    queryKey: [`/api/turmas?filialId=${filialId}`],\n  });\n\n  if (loadingFilial) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  if (!filial) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">Unidade não encontrada</h2>\n          <Button onClick={() => setLocation(\"/\")}>\n            Voltar ao Dashboard\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  const totalAlunos = alunos?.length || 0;\n  const totalProfessores = professores?.length || 0;\n  const totalTurmas = turmas?.length || 0;\n  const receitaMensal = totalAlunos * 150; // Simulação baseada em mensalidade média\n\n  const filteredAlunos = alunos?.filter(aluno =>\n    aluno.nome.toLowerCase().includes(searchTerm.toLowerCase())\n  ) || [];\n\n  const metrics = [\n    {\n      title: \"Total de Alunos\",\n      value: totalAlunos.toString(),\n      icon: Users,\n      color: \"text-blue-600\",\n      bgColor: \"bg-blue-50\",\n      change: \"+12%\",\n      changeType: \"positive\" as const,\n    },\n    {\n      title: \"Professores Ativos\",\n      value: totalProfessores.toString(),\n      icon: GraduationCap,\n      color: \"text-green-600\",\n      bgColor: \"bg-green-50\",\n      change: \"+2\",\n      changeType: \"positive\" as const,\n    },\n    {\n      title: \"Turmas em Andamento\",\n      value: totalTurmas.toString(),\n      icon: BookOpen,\n      color: \"text-purple-600\",\n      bgColor: \"bg-purple-50\",\n      change: \"0\",\n      changeType: \"neutral\" as const,\n    },\n    {\n      title: \"Receita Mensal\",\n      value: `R$ ${receitaMensal.toLocaleString(\"pt-BR\")}`,\n      icon: DollarSign,\n      color: \"text-emerald-600\",\n      bgColor: \"bg-emerald-50\",\n      change: \"+8%\",\n      changeType: \"positive\" as const,\n    },\n  ];\n\n  const handleLogout = () => {\n    window.location.href = \"/api/logout\";\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header da Unidade */}\n      <div className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center\">\n              <div className=\"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center p-1 mr-3\">\n                <InterLogo size={32} />\n              </div>\n              <div>\n                <h1 className=\"text-xl font-bold text-gray-900\">{filial.nome}</h1>\n                <p className=\"text-sm text-gray-600\">Painel Administrativo</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-4\">\n              <Badge variant={filial.ativa ? \"default\" : \"secondary\"}>\n                {filial.ativa ? \"Ativa\" : \"Inativa\"}\n              </Badge>\n              <Button variant=\"outline\" size=\"sm\" onClick={handleLogout}>\n                <LogOut className=\"h-4 w-4 mr-2\" />\n                Sair\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Informações da Unidade */}\n        <div className=\"mb-8\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <div className=\"w-5 h-5 bg-blue-600 rounded flex items-center justify-center p-0.5\">\n                  <InterLogo size={14} />\n                </div>\n                Informações da Unidade\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div>\n                  <p className=\"text-sm text-gray-600\">Endereço</p>\n                  <p className=\"font-medium\">{filial.endereco}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-gray-600\">Telefone</p>\n                  <p className=\"font-medium\">{filial.telefone || \"Não informado\"}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-gray-600\">Responsável</p>\n                  <p className=\"font-medium\">{filial.responsavel || \"Não informado\"}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Métricas */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n          {metrics.map((metric) => (\n            <Card key={metric.title}>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center\">\n                  <div className={`p-3 rounded-lg ${metric.bgColor}`}>\n                    <metric.icon className={`h-6 w-6 ${metric.color}`} />\n                  </div>\n                  <div className=\"ml-4 flex-1\">\n                    <p className=\"text-sm font-medium text-gray-600\">{metric.title}</p>\n                    <div className=\"flex items-center\">\n                      <p className=\"text-2xl font-bold text-gray-900\">{metric.value}</p>\n                      {metric.changeType !== \"neutral\" && (\n                        <span className={`ml-2 text-sm ${\n                          metric.changeType === \"positive\" ? \"text-green-600\" : \"text-red-600\"\n                        }`}>\n                          {metric.change}\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        {/* Navegação por Abas */}\n        <Tabs defaultValue=\"alunos\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-4\">\n            <TabsTrigger value=\"alunos\" className=\"flex items-center gap-2\">\n              <Users className=\"h-4 w-4\" />\n              Alunos\n            </TabsTrigger>\n            <TabsTrigger value=\"professores\" className=\"flex items-center gap-2\">\n              <GraduationCap className=\"h-4 w-4\" />\n              Professores\n            </TabsTrigger>\n            <TabsTrigger value=\"turmas\" className=\"flex items-center gap-2\">\n              <BookOpen className=\"h-4 w-4\" />\n              Turmas\n            </TabsTrigger>\n            <TabsTrigger value=\"relatorios\" className=\"flex items-center gap-2\">\n              <BarChart3 className=\"h-4 w-4\" />\n              Relatórios\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Tab Alunos */}\n          <TabsContent value=\"alunos\" className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Gestão de Alunos</h2>\n              <Button onClick={() => setLocation(\"/alunos\")}>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Novo Aluno\n              </Button>\n            </div>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle>Alunos Matriculados ({totalAlunos})</CardTitle>\n                  <div className=\"relative w-72\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n                    <Input\n                      placeholder=\"Buscar alunos...\"\n                      value={searchTerm}\n                      onChange={(e) => setSearchTerm(e.target.value)}\n                      className=\"pl-10\"\n                    />\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                {loadingAlunos ? (\n                  <div className=\"flex items-center justify-center py-8\">\n                    <div className=\"animate-spin w-6 h-6 border-4 border-primary border-t-transparent rounded-full\" />\n                  </div>\n                ) : filteredAlunos.length > 0 ? (\n                  <div className=\"space-y-4\">\n                    {filteredAlunos.map((aluno) => (\n                      <div\n                        key={aluno.id}\n                        className=\"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50\"\n                      >\n                        <div className=\"flex-1\">\n                          <h3 className=\"font-medium text-gray-900\">{aluno.nome}</h3>\n                          <p className=\"text-sm text-gray-600\">{aluno.email}</p>\n                          {aluno.cpf && (\n                            <p className=\"text-sm text-gray-500\">CPF: {aluno.cpf}</p>\n                          )}\n                        </div>\n                        <div className=\"flex items-center gap-3\">\n                          <Badge variant={aluno.statusPagamento?.emDia ? \"default\" : \"destructive\"}>\n                            {aluno.statusPagamento?.emDia ? \"Em dia\" : \"Pendente\"}\n                          </Badge>\n                          <Button size=\"sm\" variant=\"outline\">\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-8\">\n                    <Users className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                    <p className=\"text-gray-600\">\n                      {searchTerm ? \"Nenhum aluno encontrado\" : \"Nenhum aluno matriculado\"}\n                    </p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Tab Professores */}\n          <TabsContent value=\"professores\" className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Gestão de Professores</h2>\n              <Button onClick={() => setLocation(\"/professores\")}>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Novo Professor\n              </Button>\n            </div>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Professores Ativos ({totalProfessores})</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {loadingProfessores ? (\n                  <div className=\"flex items-center justify-center py-8\">\n                    <div className=\"animate-spin w-6 h-6 border-4 border-primary border-t-transparent rounded-full\" />\n                  </div>\n                ) : professores && professores.length > 0 ? (\n                  <div className=\"space-y-4\">\n                    {professores.map((professor) => (\n                      <div\n                        key={professor.id}\n                        className=\"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50\"\n                      >\n                        <div className=\"flex-1\">\n                          <h3 className=\"font-medium text-gray-900\">{professor.nome}</h3>\n                          <p className=\"text-sm text-gray-600\">{professor.email}</p>\n                          <p className=\"text-sm text-gray-500\">\n                            Especialidade: {professor.especialidade}\n                          </p>\n                        </div>\n                        <div className=\"flex items-center gap-3\">\n                          <Badge variant={professor.ativo ? \"default\" : \"secondary\"}>\n                            {professor.ativo ? \"Ativo\" : \"Inativo\"}\n                          </Badge>\n                          <Button size=\"sm\" variant=\"outline\">\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-8\">\n                    <GraduationCap className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                    <p className=\"text-gray-600\">Nenhum professor cadastrado</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Tab Turmas */}\n          <TabsContent value=\"turmas\" className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Gestão de Turmas</h2>\n              <Button onClick={() => setLocation(\"/turmas\")}>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Nova Turma\n              </Button>\n            </div>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Turmas Ativas ({totalTurmas})</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {loadingTurmas ? (\n                  <div className=\"flex items-center justify-center py-8\">\n                    <div className=\"animate-spin w-6 h-6 border-4 border-primary border-t-transparent rounded-full\" />\n                  </div>\n                ) : turmas && turmas.length > 0 ? (\n                  <div className=\"space-y-4\">\n                    {turmas.map((turma) => (\n                      <div\n                        key={turma.id}\n                        className=\"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50\"\n                      >\n                        <div className=\"flex-1\">\n                          <h3 className=\"font-medium text-gray-900\">{turma.nome}</h3>\n                          <p className=\"text-sm text-gray-600\">Categoria: {turma.categoria}</p>\n                          <p className=\"text-sm text-gray-500\">\n                            Professor: {turma.professor?.nome || \"Não definido\"}\n                          </p>\n                          <p className=\"text-sm text-gray-500\">Horário: {turma.horario}</p>\n                        </div>\n                        <div className=\"flex items-center gap-3\">\n                          <Badge variant=\"default\">\n                            {turma._count?.matriculas || 0} alunos\n                          </Badge>\n                          <Button size=\"sm\" variant=\"outline\">\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-8\">\n                    <BookOpen className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                    <p className=\"text-gray-600\">Nenhuma turma criada</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Tab Relatórios */}\n          <TabsContent value=\"relatorios\" className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Relatórios da Unidade</h2>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              <Card className=\"cursor-pointer hover:shadow-md transition-shadow\" \n                    onClick={() => setLocation(\"/relatorio-presencas\")}>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center\">\n                    <Calendar className=\"h-8 w-8 text-blue-600\" />\n                    <div className=\"ml-4\">\n                      <h3 className=\"font-medium\">Relatório de Presenças</h3>\n                      <p className=\"text-sm text-gray-600\">\n                        Controle de frequência dos alunos\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"cursor-pointer hover:shadow-md transition-shadow\"\n                    onClick={() => setLocation(\"/financeiro\")}>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center\">\n                    <DollarSign className=\"h-8 w-8 text-green-600\" />\n                    <div className=\"ml-4\">\n                      <h3 className=\"font-medium\">Relatório Financeiro</h3>\n                      <p className=\"text-sm text-gray-600\">\n                        Controle de pagamentos e receitas\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"cursor-pointer hover:shadow-md transition-shadow\"\n                    onClick={() => setLocation(\"/gestao-turmas\")}>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center\">\n                    <BookOpen className=\"h-8 w-8 text-purple-600\" />\n                    <div className=\"ml-4\">\n                      <h3 className=\"font-medium\">Gestão de Turmas</h3>\n                      <p className=\"text-sm text-gray-600\">\n                        Lista de presença e controle\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"cursor-pointer hover:shadow-md transition-shadow\"\n                    onClick={() => setLocation(\"/relatorios\")}>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center\">\n                    <FileText className=\"h-8 w-8 text-orange-600\" />\n                    <div className=\"ml-4\">\n                      <h3 className=\"font-medium\">Relatórios Gerais</h3>\n                      <p className=\"text-sm text-gray-600\">\n                        Todos os relatórios da unidade\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}","size_bytes":20059},"client/src/components/forms/CadastroResponsavelForm.tsx":{"content":"import { useState } from \"react\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Plus, Trash2, UserPlus, Users } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertAlunoSchema, type InsertAluno } from \"@shared/schema\";\nimport { z } from \"zod\";\n\nconst alunoFormSchema = insertAlunoSchema.extend({\n  dataNascimento: z.string().optional(),\n  email: z.string().optional(),\n  telefone: z.string().optional(),\n});\n\nconst responsavelFormSchema = z.object({\n  nomeResponsavel: z.string().min(1, \"Nome do responsável é obrigatório\"),\n  telefoneResponsavel: z.string().min(1, \"Telefone do responsável é obrigatório\"),\n  endereco: z.string().optional(),\n  alunos: z.array(alunoFormSchema).min(1, \"Pelo menos um aluno deve ser cadastrado\"),\n});\n\ntype FormData = z.infer<typeof responsavelFormSchema>;\n\ninterface CadastroResponsavelFormProps {\n  onSuccess: () => void;\n}\n\nexport default function CadastroResponsavelForm({ onSuccess }: CadastroResponsavelFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(responsavelFormSchema),\n    defaultValues: {\n      nomeResponsavel: \"\",\n      telefoneResponsavel: \"\",\n      endereco: \"\",\n      alunos: [\n        {\n          nome: \"\",\n          email: \"\",\n          telefone: \"\",\n          dataNascimento: \"\",\n          endereco: \"\",\n          nomeResponsavel: \"\",\n          telefoneResponsavel: \"\",\n          ativo: true,\n        }\n      ],\n    },\n  });\n\n  const { fields, append, remove } = useFieldArray({\n    control: form.control,\n    name: \"alunos\",\n  });\n\n  const createMultipleAlunosMutation = useMutation({\n    mutationFn: async (alunos: InsertAluno[]) => {\n      const results = [];\n      for (const aluno of alunos) {\n        const response = await apiRequest(\"POST\", \"/api/alunos\", aluno);\n        const result = await response.json();\n        results.push(result);\n      }\n      return results;\n    },\n    onSuccess: (results) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/alunos\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/metrics\"] });\n      toast({\n        title: \"Sucesso\",\n        description: `${results.length} aluno(s) cadastrado(s) com sucesso.`,\n      });\n      onSuccess();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao cadastrar alunos. Verifique os dados e tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const addAluno = () => {\n    const responsavelData = form.getValues();\n    append({\n      nome: \"\",\n      email: \"\",\n      telefone: \"\",\n      dataNascimento: \"\",\n      endereco: responsavelData.endereco || \"\",\n      nomeResponsavel: responsavelData.nomeResponsavel,\n      telefoneResponsavel: responsavelData.telefoneResponsavel,\n      ativo: true,\n    });\n  };\n\n  const removeAluno = (index: number) => {\n    if (fields.length > 1) {\n      remove(index);\n    }\n  };\n\n  const onSubmit = async (data: FormData) => {\n    setIsSubmitting(true);\n    \n    try {\n      const alunosToCreate: InsertAluno[] = data.alunos.map(aluno => ({\n        ...aluno,\n        dataNascimento: aluno.dataNascimento || null,\n        email: aluno.email || null,\n        telefone: aluno.telefone || null,\n        endereco: data.endereco || null,\n        nomeResponsavel: data.nomeResponsavel,\n        telefoneResponsavel: data.telefoneResponsavel,\n      }));\n\n      await createMultipleAlunosMutation.mutateAsync(alunosToCreate);\n    } catch (error) {\n      console.error(\"Erro ao cadastrar alunos:\", error);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const updateResponsavelDataInAlunos = () => {\n    const responsavelData = form.getValues();\n    const currentAlunos = form.getValues(\"alunos\");\n    \n    currentAlunos.forEach((_, index) => {\n      form.setValue(`alunos.${index}.nomeResponsavel`, responsavelData.nomeResponsavel);\n      form.setValue(`alunos.${index}.telefoneResponsavel`, responsavelData.telefoneResponsavel);\n      form.setValue(`alunos.${index}.endereco`, responsavelData.endereco || \"\");\n    });\n  };\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n        {/* Dados do Responsável */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <UserPlus className=\"w-5 h-5 mr-2\" />\n              Dados do Responsável\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"nomeResponsavel\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Nome Completo do Responsável *</FormLabel>\n                    <FormControl>\n                      <Input \n                        placeholder=\"Digite o nome completo\" \n                        {...field}\n                        onBlur={() => {\n                          field.onBlur();\n                          updateResponsavelDataInAlunos();\n                        }}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"telefoneResponsavel\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Telefone do Responsável *</FormLabel>\n                    <FormControl>\n                      <Input \n                        placeholder=\"(11) 99999-9999\" \n                        {...field}\n                        onBlur={() => {\n                          field.onBlur();\n                          updateResponsavelDataInAlunos();\n                        }}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <FormField\n              control={form.control}\n              name=\"endereco\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Endereço</FormLabel>\n                  <FormControl>\n                    <Textarea \n                      placeholder=\"Digite o endereço completo\"\n                      className=\"min-h-[80px]\"\n                      {...field}\n                      onBlur={() => {\n                        field.onBlur();\n                        updateResponsavelDataInAlunos();\n                      }}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </CardContent>\n        </Card>\n\n        {/* Dados dos Alunos */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"flex items-center\">\n                <Users className=\"w-5 h-5 mr-2\" />\n                Alunos ({fields.length})\n              </CardTitle>\n              <Button type=\"button\" onClick={addAluno} variant=\"outline\" size=\"sm\">\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Adicionar Aluno\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            {fields.map((field, index) => (\n              <div key={field.id} className=\"relative border rounded-lg p-4 bg-neutral-50\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h4 className=\"font-medium\">Aluno {index + 1}</h4>\n                  {fields.length > 1 && (\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => removeAluno(index)}\n                      className=\"text-red-600 hover:text-red-700\"\n                    >\n                      <Trash2 className=\"w-4 h-4\" />\n                    </Button>\n                  )}\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name={`alunos.${index}.nome`}\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Nome Completo *</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Digite o nome completo do aluno\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name={`alunos.${index}.dataNascimento`}\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Data de Nascimento</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name={`alunos.${index}.email`}\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>E-mail do Aluno</FormLabel>\n                        <FormControl>\n                          <Input type=\"email\" placeholder=\"email@exemplo.com\" {...field} value={field.value || \"\"} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name={`alunos.${index}.telefone`}\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Telefone do Aluno</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"(11) 99999-9999\" {...field} value={field.value || \"\"} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n\n        <div className=\"flex justify-end space-x-2 pt-4\">\n          <Button type=\"button\" variant=\"outline\" onClick={onSuccess}>\n            Cancelar\n          </Button>\n          <Button type=\"submit\" disabled={isSubmitting} className=\"bg-primary hover:bg-primary/90\">\n            {isSubmitting ? \"Cadastrando...\" : `Cadastrar ${fields.length} Aluno(s)`}\n          </Button>\n        </div>\n      </form>\n    </Form>\n  );\n}","size_bytes":11601},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });","size_bytes":482},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/PortalUnidadeNovo.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Building2, LogIn, Eye, EyeOff, ArrowLeft } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useUnidadeAuth } from \"@/contexts/UnidadeContext\";\n\nexport default function PortalUnidadeNovo() {\n  const [email, setEmail] = useState(\"\");\n  const [senha, setSenha] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { login } = useUnidadeAuth();\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    try {\n      const success = await login(email, senha);\n      \n      if (success) {\n        toast({\n          title: \"Login realizado com sucesso!\",\n          description: \"Redirecionando para o sistema da unidade...\",\n        });\n        \n        setLocation(\"/unidade/sistema\");\n      } else {\n        toast({\n          title: \"Erro no login\",\n          description: \"Email ou senha incorretos\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      toast({\n        title: \"Erro de conexão\",\n        description: \"Não foi possível conectar ao servidor\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md\">\n        <Card className=\"shadow-xl border-0\">\n          <CardHeader className=\"text-center pb-8\">\n            <div className=\"mx-auto mb-4 w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center\">\n              <Building2 className=\"w-8 h-8 text-white\" />\n            </div>\n            <CardTitle className=\"text-2xl font-bold text-gray-800\">\n              Portal da Unidade\n            </CardTitle>\n            <p className=\"text-gray-600 mt-2\">\n              Acesse o sistema de gestão da sua unidade\n            </p>\n          </CardHeader>\n          \n          <CardContent>\n            <form onSubmit={handleLogin} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\" className=\"text-sm font-medium text-gray-700\">\n                  Email\n                </Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  placeholder=\"seu.email@exemplo.com\"\n                  className=\"h-12\"\n                  required\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"senha\" className=\"text-sm font-medium text-gray-700\">\n                  Senha\n                </Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"senha\"\n                    type={showPassword ? \"text\" : \"password\"}\n                    value={senha}\n                    onChange={(e) => setSenha(e.target.value)}\n                    placeholder=\"Sua senha\"\n                    className=\"h-12 pr-12\"\n                    required\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"absolute right-0 top-0 h-12 px-3 py-2\"\n                    onClick={() => setShowPassword(!showPassword)}\n                  >\n                    {showPassword ? (\n                      <EyeOff className=\"h-4 w-4\" />\n                    ) : (\n                      <Eye className=\"h-4 w-4\" />\n                    )}\n                  </Button>\n                </div>\n              </div>\n\n              <Button\n                type=\"submit\"\n                className=\"w-full h-12 bg-blue-600 hover:bg-blue-700 text-white font-medium\"\n                disabled={isLoading}\n              >\n                {isLoading ? (\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full\" />\n                    Entrando...\n                  </div>\n                ) : (\n                  <div className=\"flex items-center gap-2\">\n                    <LogIn className=\"w-4 h-4\" />\n                    Entrar\n                  </div>\n                )}\n              </Button>\n            </form>\n\n            <div className=\"mt-6 pt-6 border-t border-gray-200\">\n              <Button\n                variant=\"ghost\"\n                onClick={() => setLocation(\"/\")}\n                className=\"w-full text-gray-600 hover:text-gray-800\"\n              >\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Voltar ao início\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":5282},"client/src/pages/ResponsavelLogin.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Eye, EyeOff, User, Lock, School, ArrowLeft } from \"lucide-react\";\nimport { InterLogo } from \"@/components/InterLogo\";\n\nconst loginSchema = z.object({\n  email: z.string().email(\"Email inválido\"),\n  senha: z.string().min(1, \"Senha é obrigatória\"),\n});\n\ntype LoginFormData = z.infer<typeof loginSchema>;\n\nexport default function ResponsavelLogin() {\n  const [showPassword, setShowPassword] = useState(false);\n  const [isLogin, setIsLogin] = useState(true);\n  const { toast } = useToast();\n\n  const {\n    register,\n    handleSubmit,\n    formState: { errors, isSubmitting },\n    reset,\n  } = useForm<LoginFormData>({\n    resolver: zodResolver(loginSchema),\n  });\n\n  const onSubmit = async (data: LoginFormData) => {\n    try {\n      const endpoint = isLogin ? \"/api/responsaveis/login\" : \"/api/responsaveis/cadastro\";\n      const result = await apiRequest(\"POST\", endpoint, data);\n      \n      if (isLogin) {\n        // Login successful - redirect to portal\n        toast({\n          title: \"Login realizado com sucesso!\",\n          description: `Bem-vindo, ${result.nome}!`,\n        });\n        setTimeout(() => {\n          window.location.href = \"/portal\";\n        }, 1000);\n      } else {\n        // Registration successful\n        toast({\n          title: \"Cadastro realizado com sucesso!\",\n          description: \"Agora você pode fazer login com suas credenciais.\",\n        });\n        setIsLogin(true);\n        reset();\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Erro\",\n        description: error.message || (isLogin ? \"Email ou senha incorretos.\" : \"Erro ao criar conta. Tente novamente.\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const registerSchema = loginSchema.extend({\n    nome: z.string().min(2, \"Nome deve ter pelo menos 2 caracteres\"),\n    telefone: z.string().optional(),\n    cpf: z.string().optional(),\n    confirmarSenha: z.string(),\n  }).refine((data) => data.senha === data.confirmarSenha, {\n    message: \"Senhas não coincidem\",\n    path: [\"confirmarSenha\"],\n  });\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-blue-50 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <div className=\"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 p-2\">\n            <InterLogo size={48} />\n          </div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">Portal do Responsável</h1>\n          <p className=\"text-gray-600 mt-2\">\n            {isLogin ? \"Acesse sua conta\" : \"Crie sua conta\"}\n          </p>\n        </div>\n\n        <Card className=\"shadow-lg\">\n          <CardHeader>\n            <CardTitle className=\"text-center\">\n              {isLogin ? \"Entrar\" : \"Criar Conta\"}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\">\n              {!isLogin && (\n                <>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"nome\">Nome Completo</Label>\n                    <Input\n                      id=\"nome\"\n                      type=\"text\"\n                      placeholder=\"Seu nome completo\"\n                      {...register(\"nome\" as any)}\n                    />\n                    {errors.nome && (\n                      <p className=\"text-sm text-red-600\">{(errors as any).nome.message}</p>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"telefone\">Telefone</Label>\n                    <Input\n                      id=\"telefone\"\n                      type=\"tel\"\n                      placeholder=\"(11) 99999-9999\"\n                      {...register(\"telefone\" as any)}\n                    />\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"cpf\">CPF</Label>\n                    <Input\n                      id=\"cpf\"\n                      type=\"text\"\n                      placeholder=\"000.000.000-00\"\n                      {...register(\"cpf\" as any)}\n                    />\n                  </div>\n                </>\n              )}\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Email</Label>\n                <div className=\"relative\">\n                  <User className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" />\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    placeholder=\"seu.email@exemplo.com\"\n                    className=\"pl-10\"\n                    {...register(\"email\")}\n                  />\n                </div>\n                {errors.email && (\n                  <p className=\"text-sm text-red-600\">{errors.email.message}</p>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"senha\">Senha</Label>\n                <div className=\"relative\">\n                  <Lock className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" />\n                  <Input\n                    id=\"senha\"\n                    type={showPassword ? \"text\" : \"password\"}\n                    placeholder=\"Sua senha\"\n                    className=\"pl-10 pr-10\"\n                    {...register(\"senha\")}\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowPassword(!showPassword)}\n                    className=\"absolute right-3 top-3 text-gray-400 hover:text-gray-600\"\n                  >\n                    {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                  </button>\n                </div>\n                {errors.senha && (\n                  <p className=\"text-sm text-red-600\">{errors.senha.message}</p>\n                )}\n              </div>\n\n              {!isLogin && (\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"confirmarSenha\">Confirmar Senha</Label>\n                  <div className=\"relative\">\n                    <Lock className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" />\n                    <Input\n                      id=\"confirmarSenha\"\n                      type=\"password\"\n                      placeholder=\"Confirme sua senha\"\n                      className=\"pl-10\"\n                      {...register(\"confirmarSenha\" as any)}\n                    />\n                  </div>\n                  {(errors as any).confirmarSenha && (\n                    <p className=\"text-sm text-red-600\">{(errors as any).confirmarSenha.message}</p>\n                  )}\n                </div>\n              )}\n\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-green-600 hover:bg-green-700\"\n                disabled={isSubmitting}\n              >\n                {isSubmitting ? \"Carregando...\" : isLogin ? \"Entrar\" : \"Criar Conta\"}\n              </Button>\n            </form>\n\n            <div className=\"mt-6 text-center\">\n              <p className=\"text-sm text-gray-600\">\n                {isLogin ? \"Não tem uma conta?\" : \"Já tem uma conta?\"}{\" \"}\n                <button\n                  onClick={() => {\n                    setIsLogin(!isLogin);\n                    reset();\n                  }}\n                  className=\"text-green-600 hover:text-green-700 font-medium\"\n                >\n                  {isLogin ? \"Criar conta\" : \"Fazer login\"}\n                </button>\n              </p>\n            </div>\n\n            {isLogin && (\n              <Alert className=\"mt-4 border-blue-200 bg-blue-50\">\n                <AlertDescription className=\"text-sm text-blue-800\">\n                  <strong>Primeira vez aqui?</strong> Crie sua conta para gerenciar os dados dos seus filhos,\n                  receber notificações de pagamento e acompanhar o progresso na escola de futebol.\n                </AlertDescription>\n              </Alert>\n            )}\n          </CardContent>\n        </Card>\n\n        <div className=\"text-center mt-6\">\n          <p className=\"text-sm text-gray-500\">\n            Precisa de ajuda? Entre em contato com a escola.\n          </p>\n          \n          <Button\n            variant=\"ghost\"\n            onClick={() => window.location.href = \"/\"}\n            className=\"mt-4 text-sm text-gray-600 hover:text-gray-800\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Voltar para Página de Apresentação\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":9159},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/pages/FinanceiroCompleto.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { \n  DollarSign, \n  Plus, \n  Edit, \n  Trash2, \n  Calendar, \n  ShoppingBag, \n  Users,\n  TrendingUp,\n  TrendingDown,\n  FileText,\n  Search,\n  Filter\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { \n  Pagamento, \n  AlunoWithFilial, \n  Evento, \n  Uniforme, \n  CompraUniforme,\n  InscricaoEvento,\n  InsertPagamento,\n  InsertEvento,\n  InsertUniforme,\n  InsertCompraUniforme,\n  InsertInscricaoEvento\n} from \"@shared/schema\";\n\nexport default function FinanceiroCompleto() {\n  const [activeTab, setActiveTab] = useState(\"pagamentos\");\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [dialogType, setDialogType] = useState<\"pagamento\" | \"evento\" | \"uniforme\" | \"compra-uniforme\" | \"inscricao-evento\">(\"pagamento\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Form handlers\n  const handleCreateUniforme = () => {\n    const formData = {\n      nome: (document.getElementById('nomeUniforme') as HTMLInputElement)?.value,\n      categoria: 'camisa',\n      descricao: (document.getElementById('descricaoUniforme') as HTMLTextAreaElement)?.value,\n      preco: (document.getElementById('precoUniforme') as HTMLInputElement)?.value,\n      tamanhos: (document.getElementById('tamanhos') as HTMLInputElement)?.value,\n      cores: (document.getElementById('cores') as HTMLInputElement)?.value,\n      estoque: parseInt((document.getElementById('estoque') as HTMLInputElement)?.value || '0'),\n    };\n\n    if (!formData.nome || !formData.preco || !formData.tamanhos || !formData.cores) {\n      toast({\n        title: \"Erro\",\n        description: \"Preencha todos os campos obrigatórios\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createUniformeMutation.mutate(formData as InsertUniforme);\n  };\n\n  const handleCreateEvento = () => {\n    const formData = {\n      nome: (document.getElementById('nomeEvento') as HTMLInputElement)?.value,\n      descricao: (document.getElementById('descricaoEvento') as HTMLTextAreaElement)?.value,\n      dataEvento: (document.getElementById('dataEvento') as HTMLInputElement)?.value,\n      local: (document.getElementById('localEvento') as HTMLInputElement)?.value,\n      preco: (document.getElementById('precoEvento') as HTMLInputElement)?.value,\n      vagasMaximas: parseInt((document.getElementById('vagasEvento') as HTMLInputElement)?.value || '0'),\n      horaInicio: (document.getElementById('horaInicio') as HTMLInputElement)?.value,\n      filialId: 1,\n    };\n\n    if (!formData.nome || !formData.dataEvento || !formData.preco || !formData.vagasMaximas) {\n      toast({\n        title: \"Erro\",\n        description: \"Preencha todos os campos obrigatórios\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createEventoMutation.mutate(formData as InsertEvento);\n  };\n\n  // Queries\n  const { data: pagamentos = [] } = useQuery<Pagamento[]>({\n    queryKey: [\"/api/pagamentos\"],\n  });\n\n  const { data: alunos = [] } = useQuery<AlunoWithFilial[]>({\n    queryKey: [\"/api/alunos\"],\n  });\n\n  const { data: eventos = [] } = useQuery<Evento[]>({\n    queryKey: [\"/api/eventos\"],\n  });\n\n  const { data: uniformes = [] } = useQuery<Uniforme[]>({\n    queryKey: [\"/api/uniformes\"],\n  });\n\n  const { data: comprasUniformes = [] } = useQuery<CompraUniforme[]>({\n    queryKey: [\"/api/compras-uniformes\"],\n  });\n\n  const { data: inscricoesEventos = [] } = useQuery<InscricaoEvento[]>({\n    queryKey: [\"/api/inscricoes-eventos\"],\n  });\n\n  const { data: pacotesTreino = [] } = useQuery({\n    queryKey: [\"/api/pacotes-treino\"],\n  });\n\n  const { data: assinaturasPacotes = [] } = useQuery({\n    queryKey: [\"/api/assinaturas-pacotes\"],\n  });\n\n  // Mutations\n  const createPagamentoMutation = useMutation({\n    mutationFn: async (data: InsertPagamento) => {\n      return await apiRequest(\"POST\", \"/api/pagamentos\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/pagamentos\"] });\n      setDialogOpen(false);\n      toast({\n        title: \"Sucesso\",\n        description: \"Pagamento registrado com sucesso!\",\n      });\n    },\n  });\n\n  const createEventoMutation = useMutation({\n    mutationFn: async (data: InsertEvento) => {\n      return await apiRequest(\"POST\", \"/api/eventos\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/eventos\"] });\n      setDialogOpen(false);\n      toast({\n        title: \"Sucesso\",\n        description: \"Evento criado com sucesso!\",\n      });\n    },\n  });\n\n  const createUniformeMutation = useMutation({\n    mutationFn: async (data: InsertUniforme) => {\n      return await apiRequest(\"POST\", \"/api/uniformes\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/uniformes\"] });\n      setDialogOpen(false);\n      toast({\n        title: \"Sucesso\",\n        description: \"Uniforme adicionado com sucesso!\",\n      });\n    },\n  });\n\n  const comprarUniformeMutation = useMutation({\n    mutationFn: async (data: InsertCompraUniforme) => {\n      return await apiRequest(\"POST\", \"/api/compras-uniformes\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/compras-uniformes\"] });\n      setDialogOpen(false);\n      toast({\n        title: \"Sucesso\",\n        description: \"Compra de uniforme registrada!\",\n      });\n    },\n  });\n\n  const inscreverEventoMutation = useMutation({\n    mutationFn: async (data: InsertInscricaoEvento) => {\n      return await apiRequest(\"POST\", \"/api/inscricoes-eventos\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/inscricoes-eventos\"] });\n      setDialogOpen(false);\n      toast({\n        title: \"Sucesso\",\n        description: \"Inscrição em evento realizada!\",\n      });\n    },\n  });\n\n  // Cálculos financeiros\n  const totalPagamentos = pagamentos.reduce((sum, p) => sum + parseFloat(p.valor || \"0\"), 0);\n  const totalUniformes = comprasUniformes.reduce((sum, c) => sum + parseFloat(c.preco || \"0\") * (c.quantidade || 1), 0);\n  const totalEventos = inscricoesEventos.length * 50; // Valor médio por evento\n  const receitaTotal = totalPagamentos + totalUniformes + totalEventos;\n\n  const openDialog = (type: typeof dialogType) => {\n    setDialogType(type);\n    setDialogOpen(true);\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-8\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Área Financeira Completa</h1>\n          <p className=\"text-muted-foreground\">\n            Gestão de pagamentos, uniformes e eventos\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button onClick={() => openDialog(\"pagamento\")} className=\"flex items-center gap-2\">\n            <Plus className=\"w-4 h-4\" />\n            Novo Pagamento\n          </Button>\n          <Button onClick={() => openDialog(\"evento\")} variant=\"outline\" className=\"flex items-center gap-2\">\n            <Calendar className=\"w-4 h-4\" />\n            Novo Evento\n          </Button>\n          <Button onClick={() => openDialog(\"uniforme\")} variant=\"outline\" className=\"flex items-center gap-2\">\n            <ShoppingBag className=\"w-4 h-4\" />\n            Novo Uniforme\n          </Button>\n        </div>\n      </div>\n\n      {/* Cards de Resumo */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center\">\n              <DollarSign className=\"h-8 w-8 text-green-600 bg-green-100 p-2 rounded-lg\" />\n              <div className=\"ml-4\">\n                <p className=\"text-sm font-medium text-gray-600\">Mensalidades</p>\n                <p className=\"text-2xl font-bold\">R$ {totalPagamentos.toFixed(2)}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center\">\n              <ShoppingBag className=\"h-8 w-8 text-blue-600 bg-blue-100 p-2 rounded-lg\" />\n              <div className=\"ml-4\">\n                <p className=\"text-sm font-medium text-gray-600\">Uniformes</p>\n                <p className=\"text-2xl font-bold\">R$ {totalUniformes.toFixed(2)}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center\">\n              <Calendar className=\"h-8 w-8 text-purple-600 bg-purple-100 p-2 rounded-lg\" />\n              <div className=\"ml-4\">\n                <p className=\"text-sm font-medium text-gray-600\">Eventos</p>\n                <p className=\"text-2xl font-bold\">R$ {totalEventos.toFixed(2)}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center\">\n              <TrendingUp className=\"h-8 w-8 text-emerald-600 bg-emerald-100 p-2 rounded-lg\" />\n              <div className=\"ml-4\">\n                <p className=\"text-sm font-medium text-gray-600\">Receita Total</p>\n                <p className=\"text-2xl font-bold\">R$ {receitaTotal.toFixed(2)}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid w-full grid-cols-6\">\n          <TabsTrigger value=\"pagamentos\">Pagamentos</TabsTrigger>\n          <TabsTrigger value=\"uniformes\">Uniformes</TabsTrigger>\n          <TabsTrigger value=\"compras-uniformes\">Compras</TabsTrigger>\n          <TabsTrigger value=\"eventos\">Eventos</TabsTrigger>\n          <TabsTrigger value=\"inscricoes\">Inscrições</TabsTrigger>\n          <TabsTrigger value=\"pacotes\">Pacotes de Treino</TabsTrigger>\n        </TabsList>\n\n        {/* Tab de Pagamentos */}\n        <TabsContent value=\"pagamentos\" className=\"space-y-4\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"relative flex-1 max-w-md\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4\" />\n              <Input\n                placeholder=\"Buscar pagamentos...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n            <Button onClick={() => openDialog(\"pagamento\")} className=\"flex items-center gap-2\">\n              <Plus className=\"w-4 h-4\" />\n              Novo Pagamento\n            </Button>\n          </div>\n\n          <div className=\"grid gap-4\">\n            {pagamentos.map((pagamento) => {\n              const aluno = alunos.find(a => a.id === pagamento.alunoId);\n              return (\n                <Card key={pagamento.id}>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <h3 className=\"font-semibold\">{aluno?.nome || \"Aluno não encontrado\"}</h3>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {pagamento.mesReferencia} • {pagamento.formaPagamento}\n                        </p>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"text-xl font-bold text-green-600\">\n                          R$ {parseFloat(pagamento.valor || \"0\").toFixed(2)}\n                        </p>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {new Date(pagamento.dataPagamento).toLocaleDateString('pt-BR')}\n                        </p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </TabsContent>\n\n        {/* Tab de Uniformes */}\n        <TabsContent value=\"uniformes\" className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-xl font-semibold\">Catálogo de Uniformes</h2>\n            <Button onClick={() => openDialog(\"uniforme\")} className=\"flex items-center gap-2\">\n              <Plus className=\"w-4 h-4\" />\n              Adicionar Uniforme\n            </Button>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {uniformes.map((uniforme) => (\n              <Card key={uniforme.id}>\n                <CardContent className=\"p-4\">\n                  <div className=\"space-y-2\">\n                    <h3 className=\"font-semibold\">{uniforme.nome}</h3>\n                    <p className=\"text-sm text-muted-foreground\">{uniforme.descricao}</p>\n                    <div className=\"flex items-center justify-between\">\n                      <Badge variant=\"outline\">{uniforme.tamanho}</Badge>\n                      <p className=\"text-lg font-bold text-blue-600\">\n                        R$ {parseFloat(uniforme.preco || \"0\").toFixed(2)}\n                      </p>\n                    </div>\n                    <Button \n                      onClick={() => openDialog(\"compra-uniforme\")} \n                      className=\"w-full\"\n                      size=\"sm\"\n                    >\n                      Comprar\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n\n        {/* Tab de Compras de Uniformes */}\n        <TabsContent value=\"compras-uniformes\" className=\"space-y-4\">\n          <h2 className=\"text-xl font-semibold\">Histórico de Compras</h2>\n          <div className=\"grid gap-4\">\n            {comprasUniformes.map((compra) => {\n              const aluno = alunos.find(a => a.id === compra.alunoId);\n              const uniforme = uniformes.find(u => u.id === compra.uniformeId);\n              return (\n                <Card key={compra.id}>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <h3 className=\"font-semibold\">{aluno?.nome}</h3>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {uniforme?.nome} • Qtd: {compra.quantidade}\n                        </p>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"text-lg font-bold\">\n                          R$ {(parseFloat(compra.preco || \"0\") * (compra.quantidade || 1)).toFixed(2)}\n                        </p>\n                        <div className=\"flex gap-2\">\n                          <Badge variant={compra.statusPagamento === \"pago\" ? \"default\" : \"secondary\"}>\n                            {compra.statusPagamento}\n                          </Badge>\n                          <Badge variant={compra.statusEntrega === \"entregue\" ? \"default\" : \"secondary\"}>\n                            {compra.statusEntrega}\n                          </Badge>\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </TabsContent>\n\n        {/* Tab de Eventos */}\n        <TabsContent value=\"eventos\" className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-xl font-semibold\">Eventos Disponíveis</h2>\n            <Button onClick={() => openDialog(\"evento\")} className=\"flex items-center gap-2\">\n              <Plus className=\"w-4 h-4\" />\n              Criar Evento\n            </Button>\n          </div>\n\n          <div className=\"grid gap-4\">\n            {eventos.map((evento) => (\n              <Card key={evento.id}>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex-1\">\n                      <h3 className=\"font-semibold\">{evento.nome}</h3>\n                      <p className=\"text-sm text-muted-foreground\">{evento.descricao}</p>\n                      <div className=\"flex items-center gap-4 mt-2\">\n                        <div className=\"flex items-center gap-1\">\n                          <Calendar className=\"w-4 h-4\" />\n                          <span className=\"text-sm\">\n                            {new Date(evento.dataEvento).toLocaleDateString('pt-BR')}\n                          </span>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Users className=\"w-4 h-4\" />\n                          <span className=\"text-sm\">\n                            {evento.capacidadeMaxima} vagas\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <p className=\"text-lg font-bold text-purple-600\">\n                        R$ {parseFloat(evento.preco || \"0\").toFixed(2)}\n                      </p>\n                      <Button \n                        onClick={() => openDialog(\"inscricao-evento\")} \n                        size=\"sm\"\n                        className=\"mt-2\"\n                      >\n                        Inscrever Aluno\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n\n        {/* Tab de Inscrições */}\n        <TabsContent value=\"inscricoes\" className=\"space-y-4\">\n          <h2 className=\"text-xl font-semibold\">Inscrições em Eventos</h2>\n          <div className=\"grid gap-4\">\n            {inscricoesEventos.map((inscricao) => {\n              const aluno = alunos.find(a => a.id === inscricao.alunoId);\n              const evento = eventos.find(e => e.id === inscricao.eventoId);\n              return (\n                <Card key={inscricao.id}>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <h3 className=\"font-semibold\">{aluno?.nome}</h3>\n                        <p className=\"text-sm text-muted-foreground\">{evento?.nome}</p>\n                      </div>\n                      <div className=\"text-right\">\n                        <Badge variant={inscricao.statusPagamento === \"pago\" ? \"default\" : \"secondary\"}>\n                          {inscricao.statusPagamento}\n                        </Badge>\n                        <p className=\"text-sm text-muted-foreground mt-1\">\n                          {new Date(inscricao.dataInscricao).toLocaleDateString('pt-BR')}\n                        </p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </TabsContent>\n\n        {/* Tab de Pacotes de Treino */}\n        <TabsContent value=\"pacotes\" className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-lg font-semibold\">Pacotes de Treino Disponíveis</h3>\n          </div>\n\n          {/* Pacotes Disponíveis */}\n          <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n            {pacotesTreino.map((pacote: any) => (\n              <Card key={pacote.id} className=\"relative\">\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <h4 className=\"font-semibold text-lg\">{pacote.nome}</h4>\n                    <Badge variant=\"secondary\">\n                      {pacote.frequenciaSemanal}x/semana\n                    </Badge>\n                  </div>\n                  \n                  <div className=\"space-y-2 mb-4\">\n                    <p className=\"text-sm text-muted-foreground\">{pacote.descricao}</p>\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-2xl font-bold text-green-600\">\n                        R$ {parseFloat(pacote.valor || \"0\").toFixed(2)}\n                      </span>\n                      <span className=\"text-sm text-muted-foreground\">\n                        {pacote.duracao} dias\n                      </span>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center text-sm\">\n                      <Users className=\"w-4 h-4 mr-2 text-blue-500\" />\n                      <span>Frequência: {pacote.frequenciaSemanal}x por semana</span>\n                    </div>\n                    <div className=\"flex items-center text-sm\">\n                      <Calendar className=\"w-4 h-4 mr-2 text-purple-500\" />\n                      <span>Duração: {pacote.duracao} dias</span>\n                    </div>\n                  </div>\n\n                  <Button \n                    className=\"w-full mt-4\"\n                    onClick={() => {\n                      const formData = {\n                        alunoId: 1,\n                        pacoteId: pacote.id,\n                        dataInicio: new Date().toISOString().split('T')[0],\n                        dataFim: new Date(Date.now() + pacote.duracao * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n                        status: 'ativo',\n                        valorPago: pacote.valor,\n                        formaPagamento: 'pix'\n                      };\n                      \n                      const handleContratarPacote = async () => {\n                        try {\n                          await apiRequest(\"POST\", \"/api/assinaturas-pacotes\", formData);\n                          toast({\n                            title: \"Sucesso\",\n                            description: `Pacote ${pacote.nome} contratado com sucesso!`,\n                          });\n                          queryClient.invalidateQueries({ queryKey: [\"/api/assinaturas-pacotes\"] });\n                        } catch (error) {\n                          toast({\n                            title: \"Erro\",\n                            description: \"Erro ao contratar pacote\",\n                            variant: \"destructive\",\n                          });\n                        }\n                      };\n                      \n                      handleContratarPacote();\n                    }}\n                  >\n                    Contratar Agora\n                  </Button>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n\n          {/* Assinaturas Ativas */}\n          <div className=\"mt-8\">\n            <h3 className=\"text-lg font-semibold mb-4\">Assinaturas Ativas</h3>\n            <div className=\"grid gap-4\">\n              {assinaturasPacotes.map((assinatura: any) => (\n                <Card key={assinatura.id}>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <h4 className=\"font-semibold\">{assinatura.aluno?.nome || \"Aluno não encontrado\"}</h4>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {assinatura.pacote?.nome || \"Pacote não encontrado\"} • {assinatura.pacote?.frequenciaSemanal}x/semana\n                        </p>\n                        <p className=\"text-xs text-muted-foreground\">\n                          {new Date(assinatura.dataInicio).toLocaleDateString('pt-BR')} - {new Date(assinatura.dataFim).toLocaleDateString('pt-BR')}\n                        </p>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"text-xl font-bold text-green-600\">\n                          R$ {parseFloat(assinatura.valorPago || \"0\").toFixed(2)}\n                        </p>\n                        <Badge variant={assinatura.status === 'ativo' ? 'default' : 'secondary'}>\n                          {assinatura.status}\n                        </Badge>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n              \n              {assinaturasPacotes.length === 0 && (\n                <Card>\n                  <CardContent className=\"p-8 text-center\">\n                    <Users className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                    <p className=\"text-muted-foreground\">Nenhuma assinatura de pacote encontrada</p>\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      {/* Dialogs para criação/edição */}\n      <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>\n              {dialogType === \"pagamento\" && \"Novo Pagamento\"}\n              {dialogType === \"evento\" && \"Criar Evento\"}\n              {dialogType === \"uniforme\" && \"Adicionar Uniforme\"}\n              {dialogType === \"compra-uniforme\" && \"Comprar Uniforme\"}\n              {dialogType === \"inscricao-evento\" && \"Inscrever em Evento\"}\n            </DialogTitle>\n          </DialogHeader>\n          \n          {/* Form de Pagamento */}\n          {dialogType === \"pagamento\" && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"aluno\">Aluno</Label>\n                  <Select>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione o aluno\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {alunos.map((aluno) => (\n                        <SelectItem key={aluno.id} value={aluno.id.toString()}>\n                          {aluno.nome}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"valor\">Valor (R$)</Label>\n                  <Input id=\"valor\" type=\"number\" step=\"0.01\" placeholder=\"0,00\" />\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"mesReferencia\">Mês de Referência</Label>\n                  <Input id=\"mesReferencia\" placeholder=\"Ex: Janeiro/2024\" />\n                </div>\n                <div>\n                  <Label htmlFor=\"dataPagamento\">Data do Pagamento</Label>\n                  <Input id=\"dataPagamento\" type=\"date\" />\n                </div>\n              </div>\n              <div>\n                <Label htmlFor=\"formaPagamento\">Forma de Pagamento</Label>\n                <Select>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Selecione a forma\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"dinheiro\">Dinheiro</SelectItem>\n                    <SelectItem value=\"cartao\">Cartão</SelectItem>\n                    <SelectItem value=\"pix\">PIX</SelectItem>\n                    <SelectItem value=\"transferencia\">Transferência</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"observacoes\">Observações</Label>\n                <Textarea id=\"observacoes\" placeholder=\"Observações adicionais...\" />\n              </div>\n              <div className=\"flex gap-2 pt-4\">\n                <Button onClick={() => setDialogOpen(false)} variant=\"outline\" className=\"flex-1\">\n                  Cancelar\n                </Button>\n                <Button className=\"flex-1\">\n                  Registrar Pagamento\n                </Button>\n              </div>\n            </div>\n          )}\n\n          {/* Form de Evento */}\n          {dialogType === \"evento\" && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"nomeEvento\">Nome do Evento</Label>\n                  <Input id=\"nomeEvento\" placeholder=\"Ex: Torneio de Futebol\" />\n                </div>\n                <div>\n                  <Label htmlFor=\"dataEvento\">Data do Evento</Label>\n                  <Input id=\"dataEvento\" type=\"date\" />\n                </div>\n              </div>\n              <div>\n                <Label htmlFor=\"descricaoEvento\">Descrição</Label>\n                <Textarea id=\"descricaoEvento\" placeholder=\"Descrição detalhada do evento...\" />\n              </div>\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"localEvento\">Local</Label>\n                  <Input id=\"localEvento\" placeholder=\"Local do evento\" />\n                </div>\n                <div>\n                  <Label htmlFor=\"precoEvento\">Preço (R$)</Label>\n                  <Input id=\"precoEvento\" type=\"number\" step=\"0.01\" placeholder=\"0,00\" />\n                </div>\n                <div>\n                  <Label htmlFor=\"vagasEvento\">Vagas Máximas</Label>\n                  <Input id=\"vagasEvento\" type=\"number\" placeholder=\"50\" />\n                </div>\n              </div>\n              <div>\n                <Label htmlFor=\"horaInicio\">Hora de Início</Label>\n                <Input id=\"horaInicio\" type=\"time\" />\n              </div>\n              <div className=\"flex gap-2 pt-4\">\n                <Button onClick={() => setDialogOpen(false)} variant=\"outline\" className=\"flex-1\">\n                  Cancelar\n                </Button>\n                <Button \n                  onClick={handleCreateEvento}\n                  disabled={createEventoMutation.isPending}\n                  className=\"flex-1\"\n                >\n                  {createEventoMutation.isPending ? \"Criando...\" : \"Criar Evento\"}\n                </Button>\n              </div>\n            </div>\n          )}\n\n          {/* Form de Uniforme */}\n          {dialogType === \"uniforme\" && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"nomeUniforme\">Nome do Item</Label>\n                  <Input id=\"nomeUniforme\" placeholder=\"Ex: Camisa Oficial\" />\n                </div>\n                <div>\n                  <Label htmlFor=\"categoria\">Categoria</Label>\n                  <Select>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione a categoria\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"camisa\">Camisa</SelectItem>\n                      <SelectItem value=\"short\">Short</SelectItem>\n                      <SelectItem value=\"meias\">Meias</SelectItem>\n                      <SelectItem value=\"chuteira\">Chuteira</SelectItem>\n                      <SelectItem value=\"acessorios\">Acessórios</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <div>\n                <Label htmlFor=\"descricaoUniforme\">Descrição</Label>\n                <Textarea id=\"descricaoUniforme\" placeholder=\"Descrição detalhada do item...\" />\n              </div>\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"precoUniforme\">Preço (R$)</Label>\n                  <Input id=\"precoUniforme\" type=\"number\" step=\"0.01\" placeholder=\"0,00\" />\n                </div>\n                <div>\n                  <Label htmlFor=\"tamanhos\">Tamanhos Disponíveis</Label>\n                  <Input id=\"tamanhos\" placeholder=\"P, M, G, GG\" />\n                </div>\n                <div>\n                  <Label htmlFor=\"cores\">Cores Disponíveis</Label>\n                  <Input id=\"cores\" placeholder=\"Azul, Branco, Vermelho\" />\n                </div>\n              </div>\n              <div>\n                <Label htmlFor=\"estoque\">Quantidade em Estoque</Label>\n                <Input id=\"estoque\" type=\"number\" placeholder=\"100\" />\n              </div>\n              <div className=\"flex gap-2 pt-4\">\n                <Button onClick={() => setDialogOpen(false)} variant=\"outline\" className=\"flex-1\">\n                  Cancelar\n                </Button>\n                <Button \n                  onClick={handleCreateUniforme}\n                  disabled={createUniformeMutation.isPending}\n                  className=\"flex-1\"\n                >\n                  {createUniformeMutation.isPending ? \"Criando...\" : \"Adicionar Uniforme\"}\n                </Button>\n              </div>\n            </div>\n          )}\n\n          {/* Form de Compra de Uniforme */}\n          {dialogType === \"compra-uniforme\" && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"alunoCompra\">Aluno</Label>\n                  <Select>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione o aluno\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {alunos.map((aluno) => (\n                        <SelectItem key={aluno.id} value={aluno.id.toString()}>\n                          {aluno.nome}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"uniformeCompra\">Uniforme</Label>\n                  <Select>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione o uniforme\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {uniformes.map((uniforme) => (\n                        <SelectItem key={uniforme.id} value={uniforme.id.toString()}>\n                          {uniforme.nome} - R$ {parseFloat(uniforme.preco || \"0\").toFixed(2)}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"quantidade\">Quantidade</Label>\n                  <Input id=\"quantidade\" type=\"number\" defaultValue=\"1\" min=\"1\" />\n                </div>\n                <div>\n                  <Label htmlFor=\"tamanhoEscolhido\">Tamanho</Label>\n                  <Select>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"P\">P</SelectItem>\n                      <SelectItem value=\"M\">M</SelectItem>\n                      <SelectItem value=\"G\">G</SelectItem>\n                      <SelectItem value=\"GG\">GG</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"corEscolhida\">Cor</Label>\n                  <Select>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"azul\">Azul</SelectItem>\n                      <SelectItem value=\"branco\">Branco</SelectItem>\n                      <SelectItem value=\"vermelho\">Vermelho</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"statusPagamentoUniforme\">Status do Pagamento</Label>\n                  <Select defaultValue=\"pendente\">\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"pendente\">Pendente</SelectItem>\n                      <SelectItem value=\"pago\">Pago</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"statusEntrega\">Status da Entrega</Label>\n                  <Select defaultValue=\"preparando\">\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"preparando\">Preparando</SelectItem>\n                      <SelectItem value=\"entregue\">Entregue</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <div className=\"flex gap-2 pt-4\">\n                <Button onClick={() => setDialogOpen(false)} variant=\"outline\" className=\"flex-1\">\n                  Cancelar\n                </Button>\n                <Button className=\"flex-1\">\n                  Registrar Compra\n                </Button>\n              </div>\n            </div>\n          )}\n\n          {/* Form de Inscrição em Evento */}\n          {dialogType === \"inscricao-evento\" && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"alunoInscricao\">Aluno</Label>\n                  <Select>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione o aluno\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {alunos.map((aluno) => (\n                        <SelectItem key={aluno.id} value={aluno.id.toString()}>\n                          {aluno.nome}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"eventoInscricao\">Evento</Label>\n                  <Select>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Selecione o evento\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {eventos.map((evento) => (\n                        <SelectItem key={evento.id} value={evento.id.toString()}>\n                          {evento.nome} - R$ {parseFloat(evento.preco || \"0\").toFixed(2)}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <div>\n                <Label htmlFor=\"statusPagamentoEvento\">Status do Pagamento</Label>\n                <Select defaultValue=\"pendente\">\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"pendente\">Pendente</SelectItem>\n                    <SelectItem value=\"pago\">Pago</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"observacoesInscricao\">Observações</Label>\n                <Textarea id=\"observacoesInscricao\" placeholder=\"Observações sobre a inscrição...\" />\n              </div>\n              <div className=\"flex gap-2 pt-4\">\n                <Button onClick={() => setDialogOpen(false)} variant=\"outline\" className=\"flex-1\">\n                  Cancelar\n                </Button>\n                <Button className=\"flex-1\">\n                  Confirmar Inscrição\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":41134},"client/src/pages/Professores.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { UserSquare2, Search, Edit, Trash2, Phone, Mail, DollarSign, Plus, CheckCircle2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Professor } from \"@shared/schema\";\nimport ProfessorForm from \"@/components/forms/ProfessorForm\";\n\nexport default function Professores() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingProfessor, setEditingProfessor] = useState<Professor | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: professores, isLoading } = useQuery<Professor[]>({\n    queryKey: [\"/api/professores\"],\n  });\n\n  const deleteProfessorMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/professores/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/professores\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Professor removido com sucesso.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao remover professor. Tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredProfessores = professores?.filter((professor) =>\n    professor.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    professor.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    professor.especialidade?.toLowerCase().includes(searchTerm.toLowerCase())\n  ) || [];\n\n  const handleEdit = (professor: Professor) => {\n    setEditingProfessor(professor);\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = (id: number) => {\n    if (confirm(\"Tem certeza que deseja remover este professor?\")) {\n      deleteProfessorMutation.mutate(id);\n    }\n  };\n\n  const handleDialogClose = () => {\n    setIsDialogOpen(false);\n    setEditingProfessor(null);\n  };\n\n  const formatCurrency = (value: string | null) => {\n    if (!value) return \"-\";\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(Number(value));\n  };\n\n  const activeCount = professores?.filter(p => p.ativo).length || 0;\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-4xl font-bold text-foreground mb-2\">Gestão de Professores</h1>\n          <p className=\"text-muted-foreground text-lg\">Cadastre e gerencie os professores da escola</p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button \n              data-testid=\"button-novo-professor\"\n              className=\"bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-600/30\"\n            >\n              <UserSquare2 className=\"w-4 h-4 mr-2\" />\n              Novo Professor\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingProfessor ? \"Editar Professor\" : \"Cadastrar Novo Professor\"}\n              </DialogTitle>\n            </DialogHeader>\n            <ProfessorForm \n              professor={editingProfessor} \n              onSuccess={handleDialogClose}\n            />\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground mb-1\">Total de Professores</p>\n                <p className=\"text-3xl font-bold text-foreground\">{professores?.length || 0}</p>\n              </div>\n              <div className=\"p-3 rounded-xl bg-blue-500/10\">\n                <UserSquare2 className=\"w-6 h-6 text-blue-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-border bg-card hover-lift\">\n          <CardContent className=\"p-5\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground mb-1\">Professores Ativos</p>\n                <p className=\"text-3xl font-bold text-green-600\">{activeCount}</p>\n              </div>\n              <div className=\"p-3 rounded-xl bg-green-500/10\">\n                <CheckCircle2 className=\"w-6 h-6 text-green-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <Card className=\"border-border bg-card\">\n        <CardContent className=\"p-6\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5\" />\n            <Input\n              placeholder=\"Buscar por nome, email ou especialidade...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              data-testid=\"input-search-professores\"\n              className=\"pl-11 h-11 bg-background border-border\"\n            />\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Professores Table */}\n      <Card className=\"border-border bg-card\">\n        <CardContent className=\"p-6\">\n          {isLoading ? (\n            <div className=\"space-y-4\">\n              {[...Array(5)].map((_, i) => (\n                <div key={i} className=\"flex items-center space-x-4 p-4 border border-border rounded-lg\">\n                  <Skeleton className=\"h-12 w-12 rounded-full\" />\n                  <div className=\"space-y-2 flex-1\">\n                    <Skeleton className=\"h-4 w-48\" />\n                    <Skeleton className=\"h-3 w-32\" />\n                  </div>\n                  <Skeleton className=\"h-8 w-20\" />\n                </div>\n              ))}\n            </div>\n          ) : filteredProfessores.length === 0 ? (\n            <div className=\"text-center py-16\">\n              <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-muted mb-4\">\n                <UserSquare2 className=\"w-8 h-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"text-xl font-semibold text-foreground mb-2\">\n                {searchTerm ? \"Nenhum professor encontrado\" : \"Nenhum professor cadastrado\"}\n              </h3>\n              <p className=\"text-muted-foreground mb-6 max-w-md mx-auto\">\n                {searchTerm \n                  ? \"Tente buscar com outros termos.\" \n                  : \"Comece cadastrando o primeiro professor da escola.\"}\n              </p>\n              {!searchTerm && (\n                <Button \n                  onClick={() => setIsDialogOpen(true)}\n                  className=\"bg-green-600 hover:bg-green-700\"\n                  data-testid=\"button-primeiro-professor\"\n                >\n                  <UserSquare2 className=\"w-4 h-4 mr-2\" />\n                  Cadastrar Primeiro Professor\n                </Button>\n              )}\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow className=\"border-border hover:bg-transparent\">\n                    <TableHead className=\"font-semibold\">Nome</TableHead>\n                    <TableHead className=\"font-semibold\">Contato</TableHead>\n                    <TableHead className=\"font-semibold\">Especialidade</TableHead>\n                    <TableHead className=\"font-semibold\">Salário</TableHead>\n                    <TableHead className=\"font-semibold\">Status</TableHead>\n                    <TableHead className=\"text-right font-semibold\">Ações</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredProfessores.map((professor) => (\n                    <TableRow key={professor.id} className=\"border-border hover:bg-muted/50\" data-testid={`row-professor-${professor.id}`}>\n                      <TableCell>\n                        <div>\n                          <p className=\"font-semibold text-foreground\">{professor.nome}</p>\n                          <p className=\"text-sm text-muted-foreground\">ID: {professor.id}</p>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"space-y-1\">\n                          {professor.email && (\n                            <div className=\"flex items-center text-sm text-muted-foreground\">\n                              <Mail className=\"w-3.5 h-3.5 mr-1.5\" />\n                              <span className=\"truncate max-w-[180px]\">{professor.email}</span>\n                            </div>\n                          )}\n                          {professor.telefone && (\n                            <div className=\"flex items-center text-sm text-muted-foreground\">\n                              <Phone className=\"w-3.5 h-3.5 mr-1.5\" />\n                              {professor.telefone}\n                            </div>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        {professor.especialidade ? (\n                          <Badge variant=\"outline\" className=\"border-blue-500/30 bg-blue-500/10 text-blue-700\">\n                            {professor.especialidade}\n                          </Badge>\n                        ) : (\n                          <span className=\"text-muted-foreground text-sm\">-</span>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center font-semibold\">\n                          <DollarSign className=\"w-4 h-4 mr-1 text-green-600\" />\n                          <span className=\"text-green-600\">\n                            {formatCurrency(professor.salario)}\n                          </span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge \n                          variant={professor.ativo ? \"default\" : \"secondary\"}\n                          className={professor.ativo ? \"bg-green-600 hover:bg-green-700\" : \"bg-muted\"}\n                        >\n                          {professor.ativo ? \"Ativo\" : \"Inativo\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end space-x-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleEdit(professor)}\n                            data-testid={`button-edit-${professor.id}`}\n                            className=\"hover:bg-blue-50 hover:text-blue-600 hover:border-blue-300\"\n                          >\n                            <Edit className=\"w-4 h-4\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleDelete(professor.id)}\n                            disabled={deleteProfessorMutation.isPending}\n                            data-testid={`button-delete-${professor.id}`}\n                            className=\"hover:bg-red-50 hover:text-red-600 hover:border-red-300\"\n                          >\n                            <Trash2 className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":12666},"client/src/pages/ResponsavelPortal.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useResponsavel, logoutResponsavel } from \"@/hooks/useResponsavel\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useLocation } from \"wouter\";\nimport { \n  Bell, \n  User, \n  CreditCard, \n  Calendar, \n  ShoppingBag, \n  LogOut,\n  AlertTriangle,\n  CheckCircle,\n  Users,\n  Edit,\n  Eye,\n  Loader2\n} from \"lucide-react\";\nimport type { \n  ResponsavelWithAlunos, \n  Notificacao, \n  EventoWithFilial, \n  Uniforme,\n  AlunoWithFilial,\n  Pagamento,\n  TurmaWithProfessor\n} from \"@shared/schema\";\n\nexport default function ResponsavelPortal() {\n  const [activeTab, setActiveTab] = useState(\"dashboard\");\n  const [editingAluno, setEditingAluno] = useState<AlunoWithFilial | null>(null);\n  const [selectedEventoId, setSelectedEventoId] = useState<number | null>(null);\n  const [selectedUniforme, setSelectedUniforme] = useState<Uniforme | null>(null);\n  const [selectedAlunoForAction, setSelectedAlunoForAction] = useState<number | null>(null);\n  \n  const { responsavel, isLoading, isAuthenticated } = useResponsavel();\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n\n  // Redirect to login if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      setLocation(\"/responsavel/login\");\n    }\n  }, [isLoading, isAuthenticated, setLocation]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-blue-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <Loader2 className=\"w-8 h-8 animate-spin mx-auto mb-4 text-green-600\" />\n          <p className=\"text-gray-600\">Carregando portal...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!responsavel) {\n    return null;\n  }\n\n  return (\n    <ResponsavelPortalContent\n      responsavel={responsavel}\n      activeTab={activeTab}\n      setActiveTab={setActiveTab}\n      editingAluno={editingAluno}\n      setEditingAluno={setEditingAluno}\n      selectedEventoId={selectedEventoId}\n      setSelectedEventoId={setSelectedEventoId}\n      selectedUniforme={selectedUniforme}\n      setSelectedUniforme={setSelectedUniforme}\n      selectedAlunoForAction={selectedAlunoForAction}\n      setSelectedAlunoForAction={setSelectedAlunoForAction}\n    />\n  );\n}\n\nfunction ResponsavelPortalContent({\n  responsavel,\n  activeTab,\n  setActiveTab,\n  editingAluno,\n  setEditingAluno,\n  selectedEventoId,\n  setSelectedEventoId,\n  selectedUniforme,\n  setSelectedUniforme,\n  selectedAlunoForAction,\n  setSelectedAlunoForAction,\n}: {\n  responsavel: ResponsavelWithAlunos;\n  activeTab: string;\n  setActiveTab: (tab: string) => void;\n  editingAluno: AlunoWithFilial | null;\n  setEditingAluno: (aluno: AlunoWithFilial | null) => void;\n  selectedEventoId: number | null;\n  setSelectedEventoId: (id: number | null) => void;\n  selectedUniforme: Uniforme | null;\n  setSelectedUniforme: (uniforme: Uniforme | null) => void;\n  selectedAlunoForAction: number | null;\n  setSelectedAlunoForAction: (id: number | null) => void;\n}) {\n  const { toast } = useToast();\n\n  // Fetch notifications\n  const { data: notificacoes } = useQuery<Notificacao[]>({\n    queryKey: [\"/api/portal/notificacoes\"],\n  });\n\n  // Fetch available events\n  const { data: eventos } = useQuery<EventoWithFilial[]>({\n    queryKey: [\"/api/portal/eventos\"],\n  });\n\n  // Fetch available uniforms\n  const { data: uniformes } = useQuery<Uniforme[]>({\n    queryKey: [\"/api/uniformes/disponiveis\"],\n  });\n\n  const handleLogout = async () => {\n    try {\n      await logoutResponsavel();\n    } catch (error) {\n      console.error(\"Erro ao fazer logout:\", error);\n      window.location.href = \"/responsavel/login\";\n    }\n  };\n\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(value);\n  };\n\n  const getStatusBadge = (status: boolean) => {\n    return status ? (\n      <Badge className=\"bg-green-100 text-green-800\">\n        <CheckCircle className=\"w-3 h-3 mr-1\" />\n        Em Dia\n      </Badge>\n    ) : (\n      <Badge className=\"bg-red-100 text-red-800\">\n        <AlertTriangle className=\"w-3 h-3 mr-1\" />\n        Atrasado\n      </Badge>\n    );\n  };\n\n  const notificacoesNaoLidas = notificacoes?.filter(n => !n.lida).length || 0;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center h-16\">\n            <div className=\"flex items-center\">\n              <div className=\"w-8 h-8 bg-green-600 rounded-full flex items-center justify-center mr-3\">\n                <Users className=\"w-4 h-4 text-white\" />\n              </div>\n              <h1 className=\"text-xl font-semibold text-gray-900\">Portal do Responsável</h1>\n            </div>\n            \n            <div className=\"flex items-center space-x-4\">\n              <div className=\"flex items-center text-sm text-gray-600\">\n                <User className=\"w-4 h-4 mr-2\" />\n                {responsavel?.nome}\n              </div>\n              \n              <div className=\"relative\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setActiveTab(\"notificacoes\")}\n                  className=\"relative\"\n                  data-testid=\"button-notifications\"\n                >\n                  <Bell className=\"w-4 h-4\" />\n                  {notificacoesNaoLidas > 0 && (\n                    <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center\">\n                      {notificacoesNaoLidas}\n                    </span>\n                  )}\n                </Button>\n              </div>\n              \n              <Button variant=\"ghost\" size=\"sm\" onClick={handleLogout} data-testid=\"button-logout\">\n                <LogOut className=\"w-4 h-4 mr-2\" />\n                Sair\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <Tabs value={activeTab} onValueChange={setActiveTab}>\n          <TabsList className=\"grid w-full grid-cols-5\">\n            <TabsTrigger value=\"dashboard\">Dashboard</TabsTrigger>\n            <TabsTrigger value=\"alunos\">Meus Filhos</TabsTrigger>\n            <TabsTrigger value=\"pagamentos\">Pagamentos</TabsTrigger>\n            <TabsTrigger value=\"eventos\">Eventos</TabsTrigger>\n            <TabsTrigger value=\"uniformes\">Uniformes</TabsTrigger>\n          </TabsList>\n\n          {/* Dashboard Tab */}\n          <TabsContent value=\"dashboard\" className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n              <Card>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center\">\n                    <Users className=\"w-8 h-8 text-blue-500\" />\n                    <div className=\"ml-4\">\n                      <p className=\"text-2xl font-bold\" data-testid=\"text-total-children\">{responsavel?.alunos?.length || 0}</p>\n                      <p className=\"text-gray-600\">Filhos Matriculados</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center\">\n                    <Bell className=\"w-8 h-8 text-orange-500\" />\n                    <div className=\"ml-4\">\n                      <p className=\"text-2xl font-bold\" data-testid=\"text-notifications\">{notificacoesNaoLidas}</p>\n                      <p className=\"text-gray-600\">Notificações</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center\">\n                    <Calendar className=\"w-8 h-8 text-green-500\" />\n                    <div className=\"ml-4\">\n                      <p className=\"text-2xl font-bold\" data-testid=\"text-events\">{eventos?.length || 0}</p>\n                      <p className=\"text-gray-600\">Eventos Disponíveis</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Children Status */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center\">\n                  <Users className=\"w-5 h-5 mr-2\" />\n                  Status dos Filhos\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  {responsavel?.alunos?.map((aluno) => (\n                    <div key={aluno.id} className=\"border rounded-lg p-4\" data-testid={`card-student-${aluno.id}`}>\n                      <div className=\"flex justify-between items-start mb-2\">\n                        <h3 className=\"font-medium\">{aluno.nome}</h3>\n                        {getStatusBadge(aluno.statusPagamento?.emDia || false)}\n                      </div>\n                      <p className=\"text-sm text-gray-600 mb-2\">\n                        Unidade: {aluno.filial?.nome || \"Não definida\"}\n                      </p>\n                      {aluno.statusPagamento?.ultimoPagamento && (\n                        <p className=\"text-sm text-gray-600\">\n                          Último pagamento: {aluno.statusPagamento.ultimoPagamento}\n                        </p>\n                      )}\n                      {aluno.statusPagamento?.diasAtraso && (\n                        <p className=\"text-sm text-red-600\">\n                          Atraso: {aluno.statusPagamento.diasAtraso} dias\n                        </p>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Students Tab */}\n          <TabsContent value=\"alunos\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Meus Filhos</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                  {responsavel?.alunos?.map((aluno) => (\n                    <StudentCard\n                      key={aluno.id}\n                      aluno={aluno}\n                      onEdit={() => setEditingAluno(aluno)}\n                    />\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Payments Tab */}\n          <TabsContent value=\"pagamentos\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center\">\n                  <CreditCard className=\"w-5 h-5 mr-2\" />\n                  Histórico de Pagamentos\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  {responsavel?.alunos?.map((aluno) => (\n                    <PaymentHistory key={aluno.id} aluno={aluno} />\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Events Tab */}\n          <TabsContent value=\"eventos\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center\">\n                  <Calendar className=\"w-5 h-5 mr-2\" />\n                  Eventos Disponíveis\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                {!eventos || eventos.length === 0 ? (\n                  <p className=\"text-gray-500 text-center py-8\">Nenhum evento disponível no momento</p>\n                ) : (\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    {eventos.map((evento) => (\n                      <EventoCard\n                        key={evento.id}\n                        evento={evento}\n                        alunos={responsavel.alunos || []}\n                        onEnroll={(eventoId, alunoId) => {\n                          setSelectedEventoId(eventoId);\n                          setSelectedAlunoForAction(alunoId);\n                        }}\n                      />\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Uniforms Tab */}\n          <TabsContent value=\"uniformes\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center\">\n                  <ShoppingBag className=\"w-5 h-5 mr-2\" />\n                  Loja de Uniformes\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                {!uniformes || uniformes.length === 0 ? (\n                  <p className=\"text-gray-500 text-center py-8\">Nenhum uniforme disponível no momento</p>\n                ) : (\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                    {uniformes.map((uniforme) => (\n                      <UniformeCard\n                        key={uniforme.id}\n                        uniforme={uniforme}\n                        alunos={responsavel.alunos || []}\n                        onPurchase={(uniformeData, alunoId) => {\n                          setSelectedUniforme(uniformeData);\n                          setSelectedAlunoForAction(alunoId);\n                        }}\n                      />\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n\n      {/* Edit Student Dialog */}\n      {editingAluno && (\n        <EditAlunoDialog\n          aluno={editingAluno}\n          onClose={() => setEditingAluno(null)}\n        />\n      )}\n\n      {/* Enroll in Event Dialog */}\n      {selectedEventoId && selectedAlunoForAction && (\n        <EnrollEventDialog\n          eventoId={selectedEventoId}\n          alunoId={selectedAlunoForAction}\n          onClose={() => {\n            setSelectedEventoId(null);\n            setSelectedAlunoForAction(null);\n          }}\n        />\n      )}\n\n      {/* Purchase Uniform Dialog */}\n      {selectedUniforme && selectedAlunoForAction && (\n        <PurchaseUniformDialog\n          uniforme={selectedUniforme}\n          alunoId={selectedAlunoForAction}\n          onClose={() => {\n            setSelectedUniforme(null);\n            setSelectedAlunoForAction(null);\n          }}\n        />\n      )}\n    </div>\n  );\n}\n\n// Student Card Component\nfunction StudentCard({ aluno, onEdit }: { aluno: AlunoWithFilial; onEdit: () => void }) {\n  const getStatusBadge = (status: boolean) => {\n    return status ? (\n      <Badge className=\"bg-green-100 text-green-800\">\n        <CheckCircle className=\"w-3 h-3 mr-1\" />\n        Em Dia\n      </Badge>\n    ) : (\n      <Badge className=\"bg-red-100 text-red-800\">\n        <AlertTriangle className=\"w-3 h-3 mr-1\" />\n        Atrasado\n      </Badge>\n    );\n  };\n\n  return (\n    <div className=\"border rounded-lg p-6\" data-testid={`card-student-details-${aluno.id}`}>\n      <div className=\"flex justify-between items-start mb-4\">\n        <h3 className=\"text-lg font-semibold\">{aluno.nome}</h3>\n        {getStatusBadge(aluno.statusPagamento?.emDia || false)}\n      </div>\n      \n      <div className=\"space-y-2 text-sm\">\n        <p><strong>Email:</strong> {aluno.email || \"Não informado\"}</p>\n        <p><strong>Telefone:</strong> {aluno.telefone || \"Não informado\"}</p>\n        <p><strong>Unidade:</strong> {aluno.filial?.nome || \"Não definida\"}</p>\n        <p><strong>Data de Nascimento:</strong> {aluno.dataNascimento || \"Não informado\"}</p>\n        <p><strong>Endereço:</strong> {aluno.endereco || \"Não informado\"}</p>\n      </div>\n\n      <div className=\"mt-4 pt-4 border-t flex gap-2\">\n        <Button \n          variant=\"outline\" \n          size=\"sm\" \n          className=\"flex-1\"\n          onClick={onEdit}\n          data-testid={`button-edit-student-${aluno.id}`}\n        >\n          <Edit className=\"w-4 h-4 mr-2\" />\n          Editar Dados\n        </Button>\n        <Button \n          variant=\"outline\" \n          size=\"sm\" \n          className=\"flex-1\"\n          data-testid={`button-view-classes-${aluno.id}`}\n        >\n          <Eye className=\"w-4 h-4 mr-2\" />\n          Ver Turmas\n        </Button>\n      </div>\n    </div>\n  );\n}\n\n// Payment History Component\nfunction PaymentHistory({ aluno }: { aluno: AlunoWithFilial }) {\n  const { data: pagamentos, isLoading } = useQuery<Pagamento[]>({\n    queryKey: [\"/api/portal/alunos\", aluno.id, \"pagamentos\"],\n  });\n\n  const formatCurrency = (value: string) => {\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(parseFloat(value));\n  };\n\n  return (\n    <div className=\"border rounded-lg p-4\" data-testid={`card-payment-history-${aluno.id}`}>\n      <h3 className=\"font-medium mb-3\">{aluno.nome}</h3>\n      \n      {isLoading ? (\n        <p className=\"text-sm text-gray-500\">Carregando...</p>\n      ) : !pagamentos || pagamentos.length === 0 ? (\n        <p className=\"text-sm text-gray-500\">Nenhum pagamento registrado</p>\n      ) : (\n        <div className=\"space-y-2\">\n          {pagamentos.slice(0, 5).map((pagamento) => (\n            <div key={pagamento.id} className=\"flex justify-between items-center text-sm border-b pb-2\">\n              <div>\n                <p className=\"font-medium\">{pagamento.mesReferencia}</p>\n                <p className=\"text-gray-600\">{pagamento.formaPagamento}</p>\n              </div>\n              <div className=\"text-right\">\n                <p className=\"font-medium\">{formatCurrency(pagamento.valor)}</p>\n                <p className=\"text-xs text-gray-500\">\n                  {new Date(pagamento.createdAt!).toLocaleDateString('pt-BR')}\n                </p>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Event Card Component\nfunction EventoCard({ \n  evento, \n  alunos, \n  onEnroll \n}: { \n  evento: EventoWithFilial; \n  alunos: AlunoWithFilial[]; \n  onEnroll: (eventoId: number, alunoId: number) => void;\n}) {\n  const [selectedAluno, setSelectedAluno] = useState<number | null>(null);\n\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(value);\n  };\n\n  return (\n    <div className=\"border rounded-lg p-6\" data-testid={`card-event-${evento.id}`}>\n      <h3 className=\"text-lg font-semibold mb-2\">{evento.nome}</h3>\n      <p className=\"text-gray-600 mb-4\">{evento.descricao}</p>\n      \n      <div className=\"space-y-2 text-sm mb-4\">\n        <p><strong>Data:</strong> {evento.dataEvento}</p>\n        <p><strong>Horário:</strong> {evento.horaInicio} - {evento.horaFim}</p>\n        <p><strong>Local:</strong> {evento.local}</p>\n        <p><strong>Preço:</strong> {formatCurrency(parseFloat(evento.preco || \"0\"))}</p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label>Selecione o filho</Label>\n        <Select \n          value={selectedAluno?.toString()} \n          onValueChange={(value) => setSelectedAluno(parseInt(value))}\n        >\n          <SelectTrigger data-testid={`select-student-event-${evento.id}`}>\n            <SelectValue placeholder=\"Escolha um filho\" />\n          </SelectTrigger>\n          <SelectContent>\n            {alunos.map((aluno) => (\n              <SelectItem key={aluno.id} value={aluno.id.toString()}>\n                {aluno.nome}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n        \n        <Button \n          className=\"w-full bg-blue-600 hover:bg-blue-700\"\n          disabled={!selectedAluno}\n          onClick={() => selectedAluno && onEnroll(evento.id, selectedAluno)}\n          data-testid={`button-enroll-event-${evento.id}`}\n        >\n          Inscrever Filho\n        </Button>\n      </div>\n    </div>\n  );\n}\n\n// Uniform Card Component\nfunction UniformeCard({\n  uniforme,\n  alunos,\n  onPurchase\n}: {\n  uniforme: Uniforme;\n  alunos: AlunoWithFilial[];\n  onPurchase: (uniforme: Uniforme, alunoId: number) => void;\n}) {\n  const [selectedAluno, setSelectedAluno] = useState<number | null>(null);\n\n  const formatCurrency = (value: string) => {\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(parseFloat(value));\n  };\n\n  return (\n    <div className=\"border rounded-lg p-6\" data-testid={`card-uniform-${uniforme.id}`}>\n      <h3 className=\"text-lg font-semibold mb-2\">{uniforme.nome}</h3>\n      <p className=\"text-gray-600 mb-2\">{uniforme.descricao}</p>\n      <p className=\"text-sm text-gray-500 mb-2\">Categoria: {uniforme.categoria}</p>\n      \n      <div className=\"mb-4\">\n        <p className=\"text-xl font-bold text-green-600\">\n          {formatCurrency(uniforme.preco)}\n        </p>\n      </div>\n\n      <div className=\"space-y-2 mb-4\">\n        <p className=\"text-sm\"><strong>Tamanhos:</strong> {JSON.parse(uniforme.tamanhos).join(\", \")}</p>\n        <p className=\"text-sm\"><strong>Cores:</strong> {JSON.parse(uniforme.cores).join(\", \")}</p>\n        <p className=\"text-sm\"><strong>Estoque:</strong> {uniforme.estoque} unidades</p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label>Selecione o filho</Label>\n        <Select \n          value={selectedAluno?.toString()} \n          onValueChange={(value) => setSelectedAluno(parseInt(value))}\n        >\n          <SelectTrigger data-testid={`select-student-uniform-${uniforme.id}`}>\n            <SelectValue placeholder=\"Escolha um filho\" />\n          </SelectTrigger>\n          <SelectContent>\n            {alunos.map((aluno) => (\n              <SelectItem key={aluno.id} value={aluno.id.toString()}>\n                {aluno.nome}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n\n        <Button \n          className=\"w-full bg-purple-600 hover:bg-purple-700\"\n          disabled={uniforme.estoque === 0 || !selectedAluno}\n          onClick={() => selectedAluno && onPurchase(uniforme, selectedAluno)}\n          data-testid={`button-buy-uniform-${uniforme.id}`}\n        >\n          <ShoppingBag className=\"w-4 h-4 mr-2\" />\n          {uniforme.estoque === 0 ? \"Esgotado\" : \"Comprar\"}\n        </Button>\n      </div>\n    </div>\n  );\n}\n\n// Edit Student Dialog\nfunction EditAlunoDialog({ aluno, onClose }: { aluno: AlunoWithFilial; onClose: () => void }) {\n  const { toast } = useToast();\n  const [formData, setFormData] = useState({\n    email: aluno.email || \"\",\n    telefone: aluno.telefone || \"\",\n    endereco: aluno.endereco || \"\",\n    bairro: aluno.bairro || \"\",\n    cep: aluno.cep || \"\",\n    cidade: aluno.cidade || \"\",\n    estado: aluno.estado || \"\",\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      return await apiRequest(\"PATCH\", `/api/portal/alunos/${aluno.id}/contact`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/responsaveis/me\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Dados atualizados com sucesso!\",\n      });\n      onClose();\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao atualizar dados\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <Dialog open={true} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-md max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-edit-student\">\n        <DialogHeader>\n          <DialogTitle>Editar Dados de {aluno.nome}</DialogTitle>\n          <DialogDescription>\n            Atualize as informações de contato e endereço\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"email\">Email</Label>\n            <Input\n              id=\"email\"\n              type=\"email\"\n              value={formData.email}\n              onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n              data-testid=\"input-email\"\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"telefone\">Telefone</Label>\n            <Input\n              id=\"telefone\"\n              value={formData.telefone}\n              onChange={(e) => setFormData({ ...formData, telefone: e.target.value })}\n              data-testid=\"input-telefone\"\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"endereco\">Endereço</Label>\n            <Input\n              id=\"endereco\"\n              value={formData.endereco}\n              onChange={(e) => setFormData({ ...formData, endereco: e.target.value })}\n              data-testid=\"input-endereco\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-2\">\n            <div>\n              <Label htmlFor=\"bairro\">Bairro</Label>\n              <Input\n                id=\"bairro\"\n                value={formData.bairro}\n                onChange={(e) => setFormData({ ...formData, bairro: e.target.value })}\n                data-testid=\"input-bairro\"\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"cep\">CEP</Label>\n              <Input\n                id=\"cep\"\n                value={formData.cep}\n                onChange={(e) => setFormData({ ...formData, cep: e.target.value })}\n                data-testid=\"input-cep\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-2\">\n            <div>\n              <Label htmlFor=\"cidade\">Cidade</Label>\n              <Input\n                id=\"cidade\"\n                value={formData.cidade}\n                onChange={(e) => setFormData({ ...formData, cidade: e.target.value })}\n                data-testid=\"input-cidade\"\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"estado\">Estado (UF)</Label>\n              <Input\n                id=\"estado\"\n                maxLength={2}\n                value={formData.estado}\n                onChange={(e) => setFormData({ ...formData, estado: e.target.value.toUpperCase() })}\n                data-testid=\"input-estado\"\n              />\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={onClose} data-testid=\"button-cancel-edit\">\n            Cancelar\n          </Button>\n          <Button \n            onClick={() => updateMutation.mutate(formData)}\n            disabled={updateMutation.isPending}\n            data-testid=\"button-save-edit\"\n          >\n            {updateMutation.isPending ? \"Salvando...\" : \"Salvar\"}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// Enroll Event Dialog\nfunction EnrollEventDialog({ \n  eventoId, \n  alunoId, \n  onClose \n}: { \n  eventoId: number; \n  alunoId: number; \n  onClose: () => void;\n}) {\n  const { toast } = useToast();\n  const [observacoes, setObservacoes] = useState(\"\");\n\n  const enrollMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", `/api/portal/eventos/${eventoId}/inscricoes`, { alunoId, observacoes });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/portal/eventos\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Filho inscrito no evento com sucesso!\",\n      });\n      onClose();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao inscrever no evento\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <Dialog open={true} onOpenChange={onClose}>\n      <DialogContent className=\"max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-enroll-event\">\n        <DialogHeader>\n          <DialogTitle>Confirmar Inscrição</DialogTitle>\n          <DialogDescription>\n            Confirme a inscrição do seu filho neste evento\n          </DialogDescription>\n        </DialogHeader>\n\n        <div>\n          <Label htmlFor=\"observacoes\">Observações (opcional)</Label>\n          <Input\n            id=\"observacoes\"\n            value={observacoes}\n            onChange={(e) => setObservacoes(e.target.value)}\n            placeholder=\"Ex: Necessidades especiais, alergias...\"\n            data-testid=\"input-observacoes\"\n          />\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={onClose} data-testid=\"button-cancel-enroll\">\n            Cancelar\n          </Button>\n          <Button \n            onClick={() => enrollMutation.mutate()}\n            disabled={enrollMutation.isPending}\n            data-testid=\"button-confirm-enroll\"\n          >\n            {enrollMutation.isPending ? \"Inscrevendo...\" : \"Confirmar Inscrição\"}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// Purchase Uniform Dialog\nfunction PurchaseUniformDialog({\n  uniforme,\n  alunoId,\n  onClose\n}: {\n  uniforme: Uniforme;\n  alunoId: number;\n  onClose: () => void;\n}) {\n  const { toast } = useToast();\n  const [tamanho, setTamanho] = useState(\"\");\n  const [cor, setCor] = useState(\"\");\n  const [quantidade, setQuantidade] = useState(1);\n\n  const tamanhos = JSON.parse(uniforme.tamanhos);\n  const cores = JSON.parse(uniforme.cores);\n\n  const purchaseMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", `/api/portal/uniformes/${uniforme.id}/compras`, { alunoId, tamanho, cor, quantidade });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/uniformes/disponiveis\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Compra realizada com sucesso!\",\n      });\n      onClose();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao realizar compra\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const formatCurrency = (value: string) => {\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(parseFloat(value) * quantidade);\n  };\n\n  return (\n    <Dialog open={true} onOpenChange={onClose}>\n      <DialogContent className=\"max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-purchase-uniform\">\n        <DialogHeader>\n          <DialogTitle>Comprar {uniforme.nome}</DialogTitle>\n          <DialogDescription>\n            Selecione tamanho, cor e quantidade\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          <div>\n            <Label>Tamanho</Label>\n            <Select value={tamanho} onValueChange={setTamanho}>\n              <SelectTrigger data-testid=\"select-size\">\n                <SelectValue placeholder=\"Selecione o tamanho\" />\n              </SelectTrigger>\n              <SelectContent>\n                {tamanhos.map((t: string) => (\n                  <SelectItem key={t} value={t}>{t}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div>\n            <Label>Cor</Label>\n            <Select value={cor} onValueChange={setCor}>\n              <SelectTrigger data-testid=\"select-color\">\n                <SelectValue placeholder=\"Selecione a cor\" />\n              </SelectTrigger>\n              <SelectContent>\n                {cores.map((c: string) => (\n                  <SelectItem key={c} value={c}>{c}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div>\n            <Label htmlFor=\"quantidade\">Quantidade</Label>\n            <Input\n              id=\"quantidade\"\n              type=\"number\"\n              min=\"1\"\n              max={uniforme.estoque || 1}\n              value={quantidade}\n              onChange={(e) => setQuantidade(parseInt(e.target.value) || 1)}\n              data-testid=\"input-quantity\"\n            />\n          </div>\n\n          <div className=\"border-t pt-4\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"font-medium\">Total:</span>\n              <span className=\"text-2xl font-bold text-green-600\" data-testid=\"text-total\">\n                {formatCurrency(uniforme.preco)}\n              </span>\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={onClose} data-testid=\"button-cancel-purchase\">\n            Cancelar\n          </Button>\n          <Button \n            onClick={() => purchaseMutation.mutate()}\n            disabled={!tamanho || !cor || purchaseMutation.isPending}\n            data-testid=\"button-confirm-purchase\"\n          >\n            {purchaseMutation.isPending ? \"Comprando...\" : \"Confirmar Compra\"}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":33892},"client/src/pages/CombosAulas.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Plus, Edit, Trash2, Package, Clock, DollarSign, Calendar, Users } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertComboAulasSchema, type InsertComboAulas, type ComboAulas } from \"@shared/schema\";\n\ntype ComboFormData = InsertComboAulas;\n\nexport default function CombosAulas() {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingCombo, setEditingCombo] = useState<ComboAulas | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: combos, isLoading } = useQuery<ComboAulas[]>({\n    queryKey: [\"/api/combos-aulas\"],\n  });\n\n  const form = useForm<ComboFormData>({\n    resolver: zodResolver(insertComboAulasSchema),\n    defaultValues: {\n      nome: \"\",\n      descricao: \"\",\n      preco: \"0.00\",\n      aulasPorSemana: 1,\n      duracaoMeses: 1,\n      ativo: true,\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: ComboFormData) => {\n      const response = await apiRequest(\"POST\", \"/api/combos-aulas\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/combos-aulas\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Combo de aulas criado com sucesso.\",\n      });\n      setIsDialogOpen(false);\n      form.reset();\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao criar combo de aulas.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: ComboFormData) => {\n      const response = await apiRequest(\"PUT\", `/api/combos-aulas/${editingCombo!.id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/combos-aulas\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Combo de aulas atualizado com sucesso.\",\n      });\n      setIsDialogOpen(false);\n      setEditingCombo(null);\n      form.reset();\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao atualizar combo de aulas.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/combos-aulas/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/combos-aulas\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Combo de aulas removido com sucesso.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro\",\n        description: \"Erro ao remover combo de aulas.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEdit = (combo: ComboAulas) => {\n    setEditingCombo(combo);\n    form.reset({\n      nome: combo.nome,\n      descricao: combo.descricao || \"\",\n      preco: combo.preco.toString(),\n      aulasPorSemana: combo.aulasPorSemana,\n      duracaoMeses: combo.duracaoMeses,\n      ativo: combo.ativo,\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = (id: number) => {\n    if (confirm(\"Tem certeza que deseja remover este combo?\")) {\n      deleteMutation.mutate(id);\n    }\n  };\n\n  const onSubmit = (data: ComboFormData) => {\n    if (editingCombo) {\n      updateMutation.mutate(data);\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const formatCurrency = (value: string | number) => {\n    const numValue = typeof value === 'string' ? parseFloat(value) : value;\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(numValue);\n  };\n\n  const handleDialogChange = (open: boolean) => {\n    setIsDialogOpen(open);\n    if (!open) {\n      setEditingCombo(null);\n      form.reset({\n        nome: \"\",\n        descricao: \"\",\n        preco: \"0.00\",\n        aulasPorSemana: 1,\n        duracaoMeses: 1,\n        ativo: true,\n      });\n    }\n  };\n\n  const handleDialogClose = () => {\n    handleDialogChange(false);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-3xl font-bold text-neutral-800\">Combos de Aulas</h2>\n          <p className=\"text-neutral-600\">Gerencie os pacotes de aulas da escola</p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={handleDialogChange}>\n          <DialogTrigger asChild>\n            <Button>\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Novo Combo\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"sm:max-w-md\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingCombo ? \"Editar Combo\" : \"Novo Combo de Aulas\"}\n              </DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"nome\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Nome do Combo</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Ex: Pacote Mensal Premium\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"descricao\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Descrição</FormLabel>\n                      <FormControl>\n                        <Textarea \n                          placeholder=\"Descrição do combo de aulas...\"\n                          {...field}\n                          value={field.value || \"\"}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"preco\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Preço (R$)</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"text\"\n                            placeholder=\"0,00\"\n                            {...field}\n                            onChange={(e) => field.onChange(e.target.value)}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"aulasPorSemana\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Aulas/Semana</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            min=\"1\"\n                            placeholder=\"2\"\n                            {...field}\n                            onChange={(e) => field.onChange(parseInt(e.target.value) || 1)}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"duracaoMeses\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Duração (meses)</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          min=\"1\"\n                          placeholder=\"1\"\n                          {...field}\n                          onChange={(e) => field.onChange(parseInt(e.target.value) || 1)}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"ativo\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n                      <div className=\"space-y-0.5\">\n                        <FormLabel className=\"text-base\">Status do Combo</FormLabel>\n                        <div className=\"text-sm text-muted-foreground\">\n                          Controla se o combo está disponível para contratação\n                        </div>\n                      </div>\n                      <FormControl>\n                        <Switch\n                          checked={!!field.value}\n                          onCheckedChange={field.onChange}\n                        />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex justify-end space-x-2 pt-4\">\n                  <Button type=\"button\" variant=\"outline\" onClick={handleDialogClose}>\n                    Cancelar\n                  </Button>\n                  <Button type=\"submit\" disabled={createMutation.isPending || updateMutation.isPending}>\n                    {editingCombo ? \"Atualizar\" : \"Criar\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Combos Cadastrados</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"space-y-3\">\n              {[...Array(3)].map((_, i) => (\n                <div key={i} className=\"h-16 bg-gray-100 rounded animate-pulse\"></div>\n              ))}\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Nome</TableHead>\n                  <TableHead>Descrição</TableHead>\n                  <TableHead>Preço</TableHead>\n                  <TableHead>Aulas/Semana</TableHead>\n                  <TableHead>Duração</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Ações</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {combos?.map((combo) => (\n                  <TableRow key={combo.id}>\n                    <TableCell className=\"font-medium\">{combo.nome}</TableCell>\n                    <TableCell>{combo.descricao || \"-\"}</TableCell>\n                    <TableCell>{formatCurrency(combo.preco)}</TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center\">\n                        <Clock className=\"w-4 h-4 mr-1 text-gray-500\" />\n                        {combo.aulasPorSemana}x\n                      </div>\n                    </TableCell>\n                    <TableCell>{combo.duracaoMeses} mês(es)</TableCell>\n                    <TableCell>\n                      <Badge variant={combo.ativo ? \"default\" : \"secondary\"}>\n                        {combo.ativo ? \"Ativo\" : \"Inativo\"}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex space-x-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleEdit(combo)}\n                        >\n                          <Edit className=\"w-4 h-4\" />\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleDelete(combo.id)}\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":13341},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/pages/Dashboard-old.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Users, SquareUser, UsersIcon, Wallet, Bell, Building2, BarChart3, Settings, Camera, Lock, Eye, EyeOff } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { InterLogo } from \"@/components/InterLogo\";\n\ninterface DashboardMetrics {\n  totalAlunos: number;\n  totalProfessores: number;\n  totalTurmas: number;\n  receitaMensal: number;\n}\n\nexport default function Dashboard() {\n  const { toast } = useToast();\n  const [isProfileDialogOpen, setIsProfileDialogOpen] = useState(false);\n\n  const [showPassword, setShowPassword] = useState(false);\n  const [adminData, setAdminData] = useState({\n    name: \"Marcello\",\n    role: \"Administrador\",\n    photo: \"\",\n    currentPassword: \"\",\n    newPassword: \"\",\n    confirmPassword: \"\"\n  });\n\n  const { data: metrics, isLoading } = useQuery<DashboardMetrics>({\n    queryKey: [\"/api/dashboard/metrics\"],\n  });\n\n  const { data: alunos } = useQuery({\n    queryKey: [\"/api/alunos\"],\n  });\n\n  const { data: filiais } = useQuery({\n    queryKey: [\"/api/filiais\"],\n  });\n\n\n\n  const handlePhotoChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        setAdminData(prev => ({ ...prev, photo: e.target?.result as string }));\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const handlePasswordChange = () => {\n    if (adminData.newPassword !== adminData.confirmPassword) {\n      toast({\n        title: \"Erro\",\n        description: \"As senhas não coincidem\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    toast({\n      title: \"Senha Atualizada\",\n      description: \"Sua senha foi alterada com sucesso.\",\n    });\n    setIsProfileDialogOpen(false);\n    setAdminData(prev => ({ ...prev, currentPassword: \"\", newPassword: \"\", confirmPassword: \"\" }));\n  };\n\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(value);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div>\n          <h2 className=\"text-3xl font-bold text-neutral-800\">Dashboard</h2>\n          <p className=\"text-neutral-600\">Visão geral da escola de futebol</p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {[...Array(4)].map((_, i) => (\n            <Card key={i}>\n              <CardContent className=\"p-6\">\n                <Skeleton className=\"h-4 w-24 mb-2\" />\n                <Skeleton className=\"h-8 w-16 mb-4\" />\n                <Skeleton className=\"h-4 w-32\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div>\n          <h2 className=\"text-2xl sm:text-3xl font-bold text-neutral-800\">Dashboard</h2>\n          <p className=\"text-neutral-600\">Visão geral da escola de futebol</p>\n        </div>\n        <div className=\"flex items-center space-x-2 sm:space-x-4\">\n          <Button variant=\"outline\" size=\"icon\" className=\"relative\">\n            <Bell className=\"h-4 w-4\" />\n            <span className=\"absolute -top-1 -right-1 w-3 h-3 bg-accent rounded-full\"></span>\n          </Button>\n\n          {/* Perfil do Administrador */}\n          <Dialog open={isProfileDialogOpen} onOpenChange={setIsProfileDialogOpen}>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\" className=\"flex items-center space-x-2 px-3\">\n                <Avatar className=\"w-8 h-8\">\n                  <AvatarImage src={adminData.photo} />\n                  <AvatarFallback className=\"bg-primary text-white text-sm\">M</AvatarFallback>\n                </Avatar>\n                <div className=\"hidden sm:block text-left\">\n                  <p className=\"text-sm font-medium\">{adminData.name}</p>\n                  <p className=\"text-xs text-gray-500\">{adminData.role}</p>\n                </div>\n                <Settings className=\"w-4 h-4\" />\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-md\">\n              <DialogHeader>\n                <DialogTitle>Perfil do Administrador</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-6 py-4\">\n                {/* Foto do Perfil */}\n                <div className=\"flex flex-col items-center space-y-4\">\n                  <Avatar className=\"w-24 h-24\">\n                    <AvatarImage src={adminData.photo} />\n                    <AvatarFallback className=\"bg-primary text-white text-2xl\">M</AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex items-center space-x-2\">\n                    <Label htmlFor=\"photo-upload\" className=\"cursor-pointer\">\n                      <Button variant=\"outline\" size=\"sm\" asChild>\n                        <span>\n                          <Camera className=\"w-4 h-4 mr-2\" />\n                          Alterar Foto\n                        </span>\n                      </Button>\n                    </Label>\n                    <Input\n                      id=\"photo-upload\"\n                      type=\"file\"\n                      accept=\"image/*\"\n                      onChange={handlePhotoChange}\n                      className=\"hidden\"\n                    />\n                  </div>\n                </div>\n\n                {/* Informações */}\n                <div className=\"space-y-3\">\n                  <div>\n                    <Label htmlFor=\"admin-name\">Nome</Label>\n                    <Input\n                      id=\"admin-name\"\n                      value={adminData.name}\n                      onChange={(e) => setAdminData(prev => ({ ...prev, name: e.target.value }))}\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"admin-role\">Cargo</Label>\n                    <Input id=\"admin-role\" value={adminData.role} disabled />\n                  </div>\n                </div>\n\n                {/* Alteração de Senha */}\n                <div className=\"space-y-3 border-t pt-4\">\n                  <h4 className=\"font-medium text-sm\">Alterar Senha</h4>\n                  <div>\n                    <Label htmlFor=\"current-password\">Senha Atual</Label>\n                    <div className=\"relative\">\n                      <Input\n                        id=\"current-password\"\n                        type={showPassword ? \"text\" : \"password\"}\n                        value={adminData.currentPassword}\n                        onChange={(e) => setAdminData(prev => ({ ...prev, currentPassword: e.target.value }))}\n                      />\n                      <Button\n                        type=\"button\"\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"absolute right-0 top-0 h-full px-3\"\n                        onClick={() => setShowPassword(!showPassword)}\n                      >\n                        {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                      </Button>\n                    </div>\n                  </div>\n                  <div>\n                    <Label htmlFor=\"new-password\">Nova Senha</Label>\n                    <Input\n                      id=\"new-password\"\n                      type={showPassword ? \"text\" : \"password\"}\n                      value={adminData.newPassword}\n                      onChange={(e) => setAdminData(prev => ({ ...prev, newPassword: e.target.value }))}\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"confirm-password\">Confirmar Senha</Label>\n                    <Input\n                      id=\"confirm-password\"\n                      type={showPassword ? \"text\" : \"password\"}\n                      value={adminData.confirmPassword}\n                      onChange={(e) => setAdminData(prev => ({ ...prev, confirmPassword: e.target.value }))}\n                    />\n                  </div>\n                  <Button onClick={handlePasswordChange} className=\"w-full\">\n                    <Lock className=\"w-4 h-4 mr-2\" />\n                    Atualizar Senha\n                  </Button>\n                </div>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {/* Metrics Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <Card className=\"border-neutral-200 hover:shadow-md transition-shadow\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-neutral-600\">Total de Alunos</p>\n                <p className=\"text-2xl font-bold text-neutral-800\">\n                  {metrics?.totalAlunos || 0}\n                </p>\n              </div>\n              <div className=\"w-12 h-12 bg-secondary/10 rounded-lg flex items-center justify-center\">\n                <Users className=\"w-6 h-6 text-secondary\" />\n              </div>\n            </div>\n            <div className=\"flex items-center mt-4 text-sm\">\n              <span className=\"text-secondary font-medium\">+8%</span>\n              <span className=\"text-neutral-400 ml-1\">vs mês anterior</span>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-neutral-200 hover:shadow-md transition-shadow\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-neutral-600\">Professores Ativos</p>\n                <p className=\"text-2xl font-bold text-neutral-800\">\n                  {metrics?.totalProfessores || 0}\n                </p>\n              </div>\n              <div className=\"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center\">\n                <SquareUser className=\"w-6 h-6 text-primary\" />\n              </div>\n            </div>\n            <div className=\"flex items-center mt-4 text-sm\">\n              <span className=\"text-secondary font-medium\">+2</span>\n              <span className=\"text-neutral-400 ml-1\">novos professores</span>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-neutral-200 hover:shadow-md transition-shadow\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-neutral-600\">Receita Mensal</p>\n                <p className=\"text-2xl font-bold text-neutral-800\">\n                  {formatCurrency(metrics?.receitaMensal || 0)}\n                </p>\n              </div>\n              <div className=\"w-12 h-12 bg-accent/10 rounded-lg flex items-center justify-center\">\n                <Wallet className=\"w-6 h-6 text-accent\" />\n              </div>\n            </div>\n            <div className=\"flex items-center mt-4 text-sm\">\n              <span className=\"text-secondary font-medium\">+12%</span>\n              <span className=\"text-neutral-400 ml-1\">vs mês anterior</span>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-neutral-200 hover:shadow-md transition-shadow\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-neutral-600\">Turmas Ativas</p>\n                <p className=\"text-2xl font-bold text-neutral-800\">\n                  {metrics?.totalTurmas || 0}\n                </p>\n              </div>\n              <div className=\"w-12 h-12 bg-blue-500/10 rounded-lg flex items-center justify-center\">\n                <UsersIcon className=\"w-6 h-6 text-blue-500\" />\n              </div>\n            </div>\n            <div className=\"flex items-center mt-4 text-sm\">\n              <span className=\"text-neutral-400\">\n                {metrics?.totalProfessores ? Math.round((metrics.totalTurmas || 0) / metrics.totalProfessores) : 0} turmas\n              </span>\n              <span className=\"text-neutral-400 ml-1\">por professor</span>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Dashboard das Unidades - Acesso Rápido */}\n      <Card className=\"border-blue-200 bg-blue-50/50\">\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center p-1\">\n                <InterLogo size={32} />\n              </div>\n              <div>\n                <CardTitle className=\"text-lg font-semibold text-blue-800\">Dashboard das Unidades</CardTitle>\n                <p className=\"text-sm text-blue-600\">Análise comparativa entre todas as unidades</p>\n              </div>\n            </div>\n            <Button \n              onClick={() => window.location.href = '/dashboard-unidades'}\n              className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n            >\n              <BarChart3 className=\"w-4 h-4 mr-2\" />\n              Ver Dashboard\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"text-center p-3 bg-blue-50 rounded-lg border border-blue-200\">\n              <p className=\"text-2xl font-bold text-blue-600\">1</p>\n              <p className=\"text-sm text-blue-700\">Unidades Ativas</p>\n            </div>\n            <div className=\"text-center p-3 bg-blue-50 rounded-lg border border-blue-200\">\n              <p className=\"text-2xl font-bold text-blue-600\">{metrics?.totalAlunos || 0}</p>\n              <p className=\"text-sm text-blue-700\">Total de Alunos</p>\n            </div>\n            <div className=\"text-center p-3 bg-blue-50 rounded-lg border border-blue-200\">\n              <p className=\"text-2xl font-bold text-blue-600\">{formatCurrency(metrics?.receitaMensal || 0)}</p>\n              <p className=\"text-sm text-blue-700\">Receita Total</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Charts and Activities */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Revenue Chart */}\n        <div className=\"lg:col-span-2\">\n          <Card className=\"border-neutral-200\">\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-lg font-semibold\">Receita Mensal</CardTitle>\n                <select className=\"text-sm border border-neutral-200 rounded-lg px-3 py-2\">\n                  <option>Últimos 6 meses</option>\n                  <option>Último ano</option>\n                </select>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-64 flex items-end justify-between space-x-2\">\n                <div className=\"flex flex-col items-center space-y-2\">\n                  <div className=\"w-8 bg-primary/20 rounded-t\" style={{ height: \"60px\" }}></div>\n                  <span className=\"text-xs text-neutral-400\">Jan</span>\n                </div>\n                <div className=\"flex flex-col items-center space-y-2\">\n                  <div className=\"w-8 bg-primary/40 rounded-t\" style={{ height: \"80px\" }}></div>\n                  <span className=\"text-xs text-neutral-400\">Fev</span>\n                </div>\n                <div className=\"flex flex-col items-center space-y-2\">\n                  <div className=\"w-8 bg-primary/60 rounded-t\" style={{ height: \"120px\" }}></div>\n                  <span className=\"text-xs text-neutral-400\">Mar</span>\n                </div>\n                <div className=\"flex flex-col items-center space-y-2\">\n                  <div className=\"w-8 bg-primary/80 rounded-t\" style={{ height: \"100px\" }}></div>\n                  <span className=\"text-xs text-neutral-400\">Abr</span>\n                </div>\n                <div className=\"flex flex-col items-center space-y-2\">\n                  <div className=\"w-8 bg-primary rounded-t\" style={{ height: \"140px\" }}></div>\n                  <span className=\"text-xs text-neutral-400\">Mai</span>\n                </div>\n                <div className=\"flex flex-col items-center space-y-2\">\n                  <div className=\"w-8 bg-primary rounded-t\" style={{ height: \"160px\" }}></div>\n                  <span className=\"text-xs text-neutral-400\">Jun</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Student Distribution by Unit */}\n        <Card className=\"border-neutral-200\">\n          <CardHeader>\n            <CardTitle className=\"text-lg font-semibold\">Distribuição de Alunos por Unidade</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {filiais?.map((filial: any) => {\n                const alunosCount = alunos?.filter((aluno: any) => aluno.filialId === filial.id).length || 0;\n                const maxAlunos = Math.max(...(filiais?.map((f: any) => \n                  alunos?.filter((a: any) => a.filialId === f.id).length || 0\n                ) || [1]));\n                const percentage = maxAlunos > 0 ? (alunosCount / maxAlunos) * 100 : 0;\n                \n                return (\n                  <div key={filial.id} className=\"space-y-2\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-sm font-medium text-gray-700\">{filial.nome}</span>\n                      <span className=\"text-sm font-bold text-primary\">{alunosCount}</span>\n                    </div>\n                    <div className=\"w-full bg-gray-200 rounded-full h-3\">\n                      <div \n                        className=\"bg-primary h-3 rounded-full transition-all duration-500 ease-out\"\n                        style={{ width: `${percentage}%` }}\n                      ></div>\n                    </div>\n                  </div>\n                );\n              })}\n              {(!filiais || filiais.length === 0) && (\n                <div className=\"text-center py-8 text-gray-500\">\n                  <BarChart3 className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                  <p className=\"text-sm\">Nenhuma unidade cadastrada</p>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":19264},"server/routes-backup-old.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { \n  adminLoginSchema,\n  updateAlunoContactSchema,\n  guardianInscricaoEventoSchema,\n  guardianCompraUniformeSchema\n} from \"@shared/schema\";\nimport { addToSync } from \"./sync\";\nimport session from \"express-session\";\nimport connectPg from \"connect-pg-simple\";\n\n// Extend session type for all authentication types\ndeclare module \"express-session\" {\n  interface SessionData {\n    responsavelId?: number;\n    gestorUnidadeId?: number;\n    filialId?: number;\n    adminId?: number;\n    adminUser?: {\n      id: number;\n      nome: string;\n      email: string;\n      papel: string;\n    };\n  }\n}\n\n// Admin authentication middleware\nconst requireAdminAuth = (req: Request, res: Response, next: NextFunction) => {\n  if (!req.session || !req.session.adminId || !req.session.adminUser) {\n    return res.status(401).json({ message: \"Admin authentication required\" });\n  }\n  next();\n};\n\n// Unit manager authentication middleware\nconst requireGestorAuth = (req: Request, res: Response, next: NextFunction) => {\n  if (!req.session?.gestorUnidadeId) {\n    return res.status(401).json({ message: \"Unit manager authentication required\" });\n  }\n  next();\n};\n\n// Guardian authentication middleware\nconst requireResponsavelAuth = (req: Request, res: Response, next: NextFunction) => {\n  if (!req.session?.responsavelId) {\n    return res.status(401).json({ message: \"Guardian authentication required\" });\n  }\n  next();\n};\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Setup session middleware for traditional authentication\n  let sessionStore;\n  \n  if (process.env.DATABASE_URL) {\n    const PostgresSessionStore = connectPg(session);\n    sessionStore = new PostgresSessionStore({\n      conString: process.env.DATABASE_URL,\n      createTableIfMissing: true,\n      ttl: 7 * 24 * 60 * 60, // 7 days\n    });\n    console.log('Using PostgreSQL session store');\n  } else {\n    // Fallback to memory store for development\n    const MemoryStore = require('memorystore')(session);\n    sessionStore = new MemoryStore({\n      checkPeriod: 86400000 // prune expired entries every 24h\n    });\n    console.log('Using memory session store (DATABASE_URL not found)');\n  }\n\n  app.use(session({\n    secret: process.env.SESSION_SECRET || 'escola-futebol-secret-2024',\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: false, // Set to true in production with HTTPS\n      maxAge: 7 * 24 * 60 * 60 * 1000, // 7 days\n    },\n  }));\n\n  // Traditional admin authentication routes\n  app.post('/api/admin/login', async (req, res) => {\n    try {\n      const { email, senha } = adminLoginSchema.parse(req.body);\n      console.log('Login attempt for:', email);\n      \n      const user = await storage.authenticateAdminUser(email, senha);\n      if (!user) {\n        console.log('Authentication failed for:', email);\n        return res.status(401).json({ message: \"Email ou senha inválidos\" });\n      }\n\n      console.log('Authentication successful for:', email);\n\n      // Store admin user in session\n      req.session.adminId = user.id;\n      req.session.adminUser = {\n        id: user.id,\n        nome: user.nome,\n        email: user.email,\n        papel: user.papel || 'admin'\n      };\n\n      // Explicitly save session\n      await new Promise<void>((resolve, reject) => {\n        req.session.save((err) => {\n          if (err) {\n            console.error('Session save error:', err);\n            reject(err);\n          } else {\n            console.log('Session saved successfully for user:', user.id);\n            resolve();\n          }\n        });\n      });\n\n      res.json({\n        success: true,\n        user: {\n          id: user.id,\n          nome: user.nome,\n          email: user.email,\n          papel: user.papel\n        }\n      });\n    } catch (error) {\n      console.error(\"Admin login error:\", error);\n      res.status(400).json({ message: \"Dados de login inválidos\" });\n    }\n  });\n\n  app.post('/api/admin/logout', (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ message: \"Erro ao fazer logout\" });\n      }\n      res.json({ success: true });\n    });\n  });\n\n  app.get('/api/admin/user', (req, res) => {\n    if (!req.session || !req.session.adminId || !req.session.adminUser) {\n      return res.status(401).json({ message: \"Não autenticado\" });\n    }\n    \n    res.json(req.session.adminUser);\n  });\n\n  // Dashboard routes - protected by admin authentication\n  app.get(\"/api/dashboard/metrics\", requireAdminAuth, async (req, res) => {\n    try {\n      const totalAlunos = (await storage.getAlunos()).length;\n      const totalProfessores = (await storage.getProfessores()).length;\n      const totalTurmas = (await storage.getTurmas()).length;\n      \n      const pagamentos = await storage.getPagamentos();\n      const receitaMensal = pagamentos\n        .filter(p => {\n          const currentMonth = new Date().toISOString().slice(0, 7);\n          return p.mesReferencia === currentMonth;\n        })\n        .reduce((total, p) => total + parseFloat(p.valor || \"0\"), 0);\n\n      res.json({\n        totalAlunos,\n        totalProfessores,\n        totalTurmas,\n        receitaMensal,\n      });\n    } catch (error) {\n      console.error(\"Error fetching dashboard metrics:\", error);\n      res.status(500).json({ message: \"Failed to fetch dashboard metrics\" });\n    }\n  });\n\n  // Alunos routes - protected by admin authentication\n  app.get(\"/api/alunos\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n      \n      let alunos = await storage.getAlunos();\n      \n      // If it's a unit manager, filter by filial\n      if (isGestor && !isAdmin) {\n        alunos = alunos.filter(aluno => aluno.filialId === req.session.filialId);\n      }\n      \n      res.json(alunos);\n    } catch (error) {\n      console.error(\"Error fetching alunos:\", error);\n      res.status(500).json({ message: \"Failed to fetch alunos\" });\n    }\n  });\n\n  app.get(\"/api/alunos/:id\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      const aluno = await storage.getAluno(id);\n      if (!aluno) {\n        return res.status(404).json({ message: \"Aluno not found\" });\n      }\n\n      // If it's a unit manager, check if aluno belongs to their filial\n      if (isGestor && !isAdmin && aluno.filialId !== req.session.filialId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      res.json(aluno);\n    } catch (error) {\n      console.error(\"Error fetching aluno:\", error);\n      res.status(500).json({ message: \"Failed to fetch aluno\" });\n    }\n  });\n\n  app.post(\"/api/alunos\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const alunoData = req.body;\n\n      // If it's a unit manager, ensure filialId matches their unit\n      if (isGestor && !isAdmin) {\n        alunoData.filialId = req.session.filialId;\n      }\n\n      const aluno = await storage.createAluno(alunoData);\n      res.status(201).json(aluno);\n    } catch (error) {\n      console.error(\"Error creating aluno:\", error);\n      res.status(500).json({ message: \"Failed to create aluno\" });\n    }\n  });\n\n  // Cadastro completo (aluno + responsável)\n  app.post(\"/api/alunos-completo\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const { aluno: alunoData, responsavel: responsavelData } = req.body;\n      \n      // If it's a unit manager, ensure filialId matches their unit\n      if (isGestor && !isAdmin) {\n        alunoData.filialId = req.session.filialId;\n      }\n      \n      // Primeiro, criar o responsável\n      const responsavel = await storage.createResponsavel(responsavelData);\n      \n      // Depois, criar o aluno vinculado ao responsável\n      const alunoCompleto = {\n        ...alunoData,\n        responsavelId: responsavel.id,\n      };\n      \n      const aluno = await storage.createAluno(alunoCompleto);\n      \n      res.status(201).json({\n        aluno,\n        responsavel,\n        message: \"Aluno e responsável cadastrados com sucesso\"\n      });\n    } catch (error) {\n      console.error(\"Error creating aluno completo:\", error);\n      res.status(500).json({ message: \"Failed to create aluno and responsavel\" });\n    }\n  });\n\n  app.put(\"/api/alunos/:id\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      const alunoData = req.body;\n\n      // If it's a unit manager, verify the aluno belongs to their filial\n      if (isGestor && !isAdmin) {\n        const existingAluno = await storage.getAluno(id);\n        if (!existingAluno || existingAluno.filialId !== req.session.filialId) {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n        // Ensure filialId cannot be changed\n        alunoData.filialId = req.session.filialId;\n      }\n\n      const aluno = await storage.updateAluno(id, alunoData);\n      res.json(aluno);\n    } catch (error) {\n      console.error(\"Error updating aluno:\", error);\n      res.status(500).json({ message: \"Failed to update aluno\" });\n    }\n  });\n\n  app.patch(\"/api/alunos/:id\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      const alunoData = req.body;\n\n      // If it's a unit manager, verify the aluno belongs to their filial\n      if (isGestor && !isAdmin) {\n        const existingAluno = await storage.getAluno(id);\n        if (!existingAluno || existingAluno.filialId !== req.session.filialId) {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n        // Ensure filialId cannot be changed\n        alunoData.filialId = req.session.filialId;\n      }\n\n      const aluno = await storage.updateAluno(id, alunoData);\n      res.json(aluno);\n    } catch (error) {\n      console.error(\"Error updating aluno:\", error);\n      res.status(500).json({ message: \"Failed to update aluno\" });\n    }\n  });\n\n  app.delete(\"/api/alunos/:id\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n\n      // If it's a unit manager, verify the aluno belongs to their filial\n      if (isGestor && !isAdmin) {\n        const existingAluno = await storage.getAluno(id);\n        if (!existingAluno || existingAluno.filialId !== req.session.filialId) {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n      }\n\n      await storage.deleteAluno(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting aluno:\", error);\n      res.status(500).json({ message: \"Failed to delete aluno\" });\n    }\n  });\n\n  // Professores routes - protected by admin or unit manager authentication\n  app.get(\"/api/professores\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n      \n      let professores = await storage.getProfessores();\n      \n      // If it's a unit manager, filter by filial\n      if (isGestor && !isAdmin) {\n        professores = professores.filter(professor => professor.filialId === req.session.filialId);\n      }\n      \n      res.json(professores);\n    } catch (error) {\n      console.error(\"Error fetching professores:\", error);\n      res.status(500).json({ message: \"Failed to fetch professores\" });\n    }\n  });\n\n  app.post(\"/api/professores\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const professor = await storage.createProfessor(req.body);\n      res.json(professor);\n    } catch (error) {\n      console.error(\"Error creating professor:\", error);\n      res.status(500).json({ message: \"Failed to create professor\" });\n    }\n  });\n\n  app.patch(\"/api/professores/:id\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      const professor = await storage.updateProfessor(id, req.body);\n      res.json(professor);\n    } catch (error) {\n      console.error(\"Error updating professor:\", error);\n      res.status(500).json({ message: \"Failed to update professor\" });\n    }\n  });\n\n  app.delete(\"/api/professores/:id\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      await storage.deleteProfessor(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting professor:\", error);\n      res.status(500).json({ message: \"Failed to delete professor\" });\n    }\n  });\n\n  // Turmas routes - protected by admin or unit manager authentication\n  app.get(\"/api/turmas\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n      \n      let turmas = await storage.getTurmas();\n      \n      // If it's a unit manager, filter by filial\n      if (isGestor && !isAdmin) {\n        turmas = turmas.filter(turma => turma.filialId === req.session.filialId);\n      }\n      \n      res.json(turmas);\n    } catch (error) {\n      console.error(\"Error fetching turmas:\", error);\n      res.status(500).json({ message: \"Failed to fetch turmas\" });\n    }\n  });\n\n  app.post(\"/api/turmas\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const turma = await storage.createTurma(req.body);\n      res.json(turma);\n    } catch (error) {\n      console.error(\"Error creating turma:\", error);\n      res.status(500).json({ message: \"Failed to create turma\" });\n    }\n  });\n\n  app.patch(\"/api/turmas/:id\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      const turma = await storage.updateTurma(id, req.body);\n      res.json(turma);\n    } catch (error) {\n      console.error(\"Error updating turma:\", error);\n      res.status(500).json({ message: \"Failed to update turma\" });\n    }\n  });\n\n  app.delete(\"/api/turmas/:id\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      await storage.deleteTurma(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting turma:\", error);\n      res.status(500).json({ message: \"Failed to delete turma\" });\n    }\n  });\n\n  // Filiais routes - protected by admin or unit manager authentication\n  app.get(\"/api/filiais\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n      \n      let filiais = await storage.getFiliais();\n      \n      // If it's a unit manager, filter to only their filial\n      if (isGestor && !isAdmin) {\n        filiais = filiais.filter(filial => filial.id === req.session.filialId);\n      }\n      \n      res.json(filiais);\n    } catch (error) {\n      console.error(\"Error fetching filiais:\", error);\n      res.status(500).json({ message: \"Failed to fetch filiais\" });\n    }\n  });\n\n  app.get(\"/api/filiais/detalhadas\", requireAdminAuth, async (req, res) => {\n    try {\n      const filiais = await storage.getFiliaisDetalhadas();\n      res.json(filiais);\n    } catch (error) {\n      console.error(\"Error fetching detailed filiais:\", error);\n      res.status(500).json({ message: \"Failed to fetch detailed filiais\" });\n    }\n  });\n\n  app.get(\"/api/filiais/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const filial = await storage.getFilial(id);\n      if (!filial) {\n        return res.status(404).json({ message: \"Filial not found\" });\n      }\n      res.json(filial);\n    } catch (error) {\n      console.error(\"Error fetching filial:\", error);\n      res.status(500).json({ message: \"Failed to fetch filial\" });\n    }\n  });\n\n  app.post(\"/api/filiais\", requireAdminAuth, async (req, res) => {\n    try {\n      const filialData = {\n        ...req.body,\n        ativa: true,\n      };\n      const filial = await storage.createFilial(filialData);\n      res.json(filial);\n    } catch (error) {\n      console.error(\"Error creating filial:\", error);\n      res.status(500).json({ message: \"Failed to create filial\" });\n    }\n  });\n\n  app.patch(\"/api/filiais/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const filial = await storage.updateFilial(id, req.body);\n      res.json(filial);\n    } catch (error) {\n      console.error(\"Error updating filial:\", error);\n      res.status(500).json({ message: \"Failed to update filial\" });\n    }\n  });\n\n  app.delete(\"/api/filiais/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteFilial(id);\n      res.json({ message: \"Filial deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting filial:\", error);\n      res.status(500).json({ message: \"Failed to delete filial\" });\n    }\n  });\n\n  app.get(\"/api/sync/status\", requireAdminAuth, async (req, res) => {\n    try {\n      // Return sync status for portal\n      res.json({\n        lastSync: new Date().toISOString(),\n        status: \"success\",\n        pendingChanges: 0\n      });\n    } catch (error) {\n      console.error(\"Error fetching sync status:\", error);\n      res.status(500).json({ message: \"Failed to fetch sync status\" });\n    }\n  });\n\n  // Pagamentos routes - protected by admin or unit manager authentication\n  app.get(\"/api/pagamentos\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n      \n      let pagamentos = await storage.getPagamentos();\n      \n      // If it's a unit manager, filter payments by students from their filial\n      if (isGestor && !isAdmin) {\n        const alunosDaFilial = await storage.getAlunosByFilial(req.session.filialId!);\n        const alunoIds = alunosDaFilial.map(a => a.id);\n        pagamentos = pagamentos.filter(p => p.alunoId && alunoIds.includes(p.alunoId));\n      }\n      \n      res.json(pagamentos);\n    } catch (error) {\n      console.error(\"Error fetching pagamentos:\", error);\n      res.status(500).json({ message: \"Failed to fetch pagamentos\" });\n    }\n  });\n\n  app.post(\"/api/pagamentos\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      // Validate and transform the request body\n      const { insertPagamentoSchema } = await import(\"@shared/schema\");\n      const validationResult = insertPagamentoSchema.safeParse(req.body);\n      \n      if (!validationResult.success) {\n        return res.status(400).json({ \n          message: \"Invalid payment data\", \n          errors: validationResult.error.errors \n        });\n      }\n\n      const pagamentoData = validationResult.data;\n\n      // If it's a unit manager, verify the student belongs to their filial\n      if (isGestor && !isAdmin && pagamentoData.alunoId) {\n        const aluno = await storage.getAluno(pagamentoData.alunoId);\n        if (!aluno || aluno.filialId !== req.session.filialId) {\n          return res.status(403).json({ message: \"Access denied - student not in your unit\" });\n        }\n      }\n\n      const pagamento = await storage.createPagamento(pagamentoData);\n      res.status(201).json(pagamento);\n    } catch (error) {\n      console.error(\"Error creating pagamento:\", error);\n      res.status(500).json({ message: \"Failed to create pagamento\" });\n    }\n  });\n\n  app.delete(\"/api/pagamentos/:id\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      \n      // Fetch the specific payment instead of loading all payments\n      const pagamento = await storage.getPagamento(id);\n      \n      if (!pagamento) {\n        return res.status(404).json({ message: \"Payment not found\" });\n      }\n      \n      // If it's a unit manager, verify the payment belongs to a student from their filial\n      if (isGestor && !isAdmin) {\n        if (pagamento.alunoId) {\n          const aluno = await storage.getAluno(pagamento.alunoId);\n          if (!aluno || aluno.filialId !== req.session.filialId) {\n            return res.status(403).json({ message: \"Access denied - payment not from your unit\" });\n          }\n        } else {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n      }\n\n      await storage.deletePagamento(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting pagamento:\", error);\n      res.status(500).json({ message: \"Failed to delete pagamento\" });\n    }\n  });\n\n  // Unit management authentication routes\n  app.post(\"/api/unidade/login\", async (req, res) => {\n    try {\n      const { email, senha } = req.body;\n      const gestor = await storage.authenticateGestorUnidade(email, senha);\n      \n      if (!gestor) {\n        return res.status(401).json({ message: \"Credenciais inválidas\" });\n      }\n\n      // Get filial data\n      const filial = await storage.getFilial(gestor.filialId);\n      if (!filial) {\n        return res.status(404).json({ message: \"Filial não encontrada\" });\n      }\n\n      req.session.gestorUnidadeId = gestor.id;\n      req.session.filialId = gestor.filialId;\n\n      await storage.updateGestorUltimoLogin(gestor.id);\n\n      res.json({\n        success: true,\n        gestor: {\n          id: gestor.id,\n          nome: gestor.nome,\n          email: gestor.email,\n          filialId: gestor.filialId\n        },\n        filial: {\n          id: filial.id,\n          nome: filial.nome\n        }\n      });\n    } catch (error) {\n      console.error(\"Unit login error:\", error);\n      res.status(500).json({ message: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.get(\"/api/unidade/me\", requireGestorAuth, async (req, res) => {\n    try {\n      const gestorId = req.session.gestorUnidadeId!;\n      const filialId = req.session.filialId!;\n      \n      const gestor = await storage.getGestorUnidade(gestorId);\n      const filial = await storage.getFilial(filialId);\n      \n      if (!gestor || !filial) {\n        return res.status(404).json({ message: \"Dados não encontrados\" });\n      }\n\n      res.json({\n        gestor: {\n          id: gestor.id,\n          nome: gestor.nome,\n          email: gestor.email,\n          filialId: gestor.filialId\n        },\n        filial: {\n          id: filial.id,\n          nome: filial.nome\n        }\n      });\n    } catch (error) {\n      console.error(\"Error fetching unidade session:\", error);\n      res.status(500).json({ message: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/unidade/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ message: \"Erro ao fazer logout\" });\n      }\n      res.json({ success: true });\n    });\n  });\n\n  // Guardian authentication routes\n  app.post(\"/api/responsavel/login\", async (req, res) => {\n    try {\n      const { email, senha } = req.body;\n      console.log('Guardian login attempt for:', email);\n      \n      const responsavel = await storage.authenticateResponsavel(email, senha);\n      \n      if (!responsavel) {\n        console.log('Guardian authentication failed for:', email);\n        return res.status(401).json({ message: \"Credenciais inválidas\" });\n      }\n\n      console.log('Guardian authentication successful for:', email);\n\n      req.session.responsavelId = responsavel.id;\n\n      // Explicitly save session\n      await new Promise<void>((resolve, reject) => {\n        req.session.save((err) => {\n          if (err) {\n            console.error('Guardian session save error:', err);\n            reject(err);\n          } else {\n            console.log('Guardian session saved successfully for responsavel:', responsavel.id);\n            resolve();\n          }\n        });\n      });\n\n      res.json({\n        success: true,\n        responsavel: {\n          id: responsavel.id,\n          nome: responsavel.nome,\n          email: responsavel.email\n        }\n      });\n    } catch (error) {\n      console.error(\"Guardian login error:\", error);\n      res.status(500).json({ message: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/responsavel/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ message: \"Erro ao fazer logout\" });\n      }\n      res.json({ success: true });\n    });\n  });\n\n  // Get responsavel data with students\n  app.get(\"/api/responsaveis/me\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const responsavel = await storage.getResponsavelWithAlunos(responsavelId);\n      \n      if (!responsavel) {\n        return res.status(404).json({ message: \"Responsável não encontrado\" });\n      }\n\n      res.json(responsavel);\n    } catch (error) {\n      console.error(\"Error fetching responsavel data:\", error);\n      res.status(500).json({ message: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Guardian portal routes\n  // Update aluno contact information\n  app.patch(\"/api/portal/alunos/:alunoId/contact\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const alunoId = parseInt(req.params.alunoId);\n      \n      const validated = updateAlunoContactSchema.parse(req.body);\n      \n      const updated = await storage.updateAlunoContact(alunoId, responsavelId, validated);\n      res.json(updated);\n    } catch (error: any) {\n      if (error.message === \"Aluno not found or unauthorized\") {\n        return res.status(403).json({ message: \"Não autorizado\" });\n      }\n      console.error(\"Error updating aluno contact:\", error);\n      res.status(500).json({ message: \"Erro ao atualizar dados do aluno\" });\n    }\n  });\n\n  // Get student's classes\n  app.get(\"/api/portal/alunos/:alunoId/turmas\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const alunoId = parseInt(req.params.alunoId);\n      \n      const turmas = await storage.getTurmasByAluno(alunoId, responsavelId);\n      res.json(turmas);\n    } catch (error) {\n      console.error(\"Error fetching turmas:\", error);\n      res.status(500).json({ message: \"Erro ao buscar turmas\" });\n    }\n  });\n\n  // Get student's payment history\n  app.get(\"/api/portal/alunos/:alunoId/pagamentos\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const alunoId = parseInt(req.params.alunoId);\n      \n      const pagamentos = await storage.getPagamentosByAlunoForGuardian(alunoId, responsavelId);\n      res.json(pagamentos);\n    } catch (error) {\n      console.error(\"Error fetching pagamentos:\", error);\n      res.status(500).json({ message: \"Erro ao buscar pagamentos\" });\n    }\n  });\n\n  // Get student's event enrollments\n  app.get(\"/api/portal/alunos/:alunoId/inscricoes\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const alunoId = parseInt(req.params.alunoId);\n      \n      const aluno = await storage.getAlunoForGuardian(alunoId, responsavelId);\n      if (!aluno) {\n        return res.status(403).json({ message: \"Não autorizado\" });\n      }\n      \n      const inscricoes = await storage.getInscricoesEventosByAluno(alunoId);\n      res.json(inscricoes);\n    } catch (error) {\n      console.error(\"Error fetching inscricoes:\", error);\n      res.status(500).json({ message: \"Erro ao buscar inscrições\" });\n    }\n  });\n\n  // Get available events for guardian's unit\n  app.get(\"/api/portal/eventos\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const responsavel = await storage.getResponsavelWithAlunos(responsavelId);\n      \n      if (!responsavel || !responsavel.alunos || responsavel.alunos.length === 0) {\n        return res.json([]);\n      }\n\n      const filialId = responsavel.alunos[0].filialId;\n      if (!filialId) {\n        return res.json([]);\n      }\n      \n      const eventos = await storage.getEventosDisponiveisByFilial(filialId);\n      res.json(eventos);\n    } catch (error) {\n      console.error(\"Error fetching eventos:\", error);\n      res.status(500).json({ message: \"Erro ao buscar eventos\" });\n    }\n  });\n\n  // Enroll student in event\n  app.post(\"/api/portal/eventos/:eventoId/inscricoes\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const eventoId = parseInt(req.params.eventoId);\n      \n      const validated = guardianInscricaoEventoSchema.parse(req.body);\n      \n      const inscricao = await storage.createGuardianInscricao(\n        eventoId,\n        validated.alunoId,\n        responsavelId,\n        validated.observacoes\n      );\n      \n      res.json(inscricao);\n    } catch (error: any) {\n      if (error.message?.includes(\"unauthorized\") || error.message?.includes(\"not found\")) {\n        return res.status(403).json({ message: \"Não autorizado\" });\n      }\n      if (error.message?.includes(\"already enrolled\")) {\n        return res.status(400).json({ message: \"Aluno já inscrito neste evento\" });\n      }\n      if (error.message?.includes(\"not available\")) {\n        return res.status(400).json({ message: error.message });\n      }\n      console.error(\"Error enrolling in event:\", error);\n      res.status(500).json({ message: \"Erro ao inscrever no evento\" });\n    }\n  });\n\n  // Purchase uniform\n  app.post(\"/api/portal/uniformes/:uniformeId/compras\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const uniformeId = parseInt(req.params.uniformeId);\n      \n      const validated = guardianCompraUniformeSchema.parse(req.body);\n      \n      const compra = await storage.createGuardianCompra(\n        uniformeId,\n        validated.alunoId,\n        responsavelId,\n        validated.tamanho,\n        validated.cor,\n        validated.quantidade\n      );\n      \n      res.json(compra);\n    } catch (error: any) {\n      if (error.message?.includes(\"unauthorized\") || error.message?.includes(\"not found\")) {\n        return res.status(403).json({ message: \"Não autorizado\" });\n      }\n      if (error.message?.includes(\"stock\") || error.message?.includes(\"available\")) {\n        return res.status(400).json({ message: error.message });\n      }\n      console.error(\"Error purchasing uniform:\", error);\n      res.status(500).json({ message: \"Erro ao comprar uniforme\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}","size_bytes":34789},"server/storage-backup-old.ts":{"content":"import {\n  users,\n  alunos,\n  professores,\n  turmas,\n  matriculas,\n  pagamentos,\n  filiais,\n  responsaveis,\n  eventos,\n  uniformes,\n  notificacoes,\n  inscricoesEventos,\n  comprasUniformes,\n  presencas,\n  pacotesTreino,\n  assinaturasPacotes,\n  categoriasTestes,\n  testes,\n  avaliacoesFisicas,\n  resultadosTestes,\n  metasAlunos,\n  gestoresUnidade,\n  combosAulas,\n  type User,\n  type UpsertUser,\n  adminUsers,\n  type AdminUser,\n  type InsertAdminUser,\n  type GestorUnidade,\n  type InsertGestorUnidade,\n  type GestorUnidadeWithFilial,\n  type Aluno,\n  type InsertAluno,\n  type Professor,\n  type InsertProfessor,\n  type Turma,\n  type InsertTurma,\n  type TurmaWithProfessor,\n  type Matricula,\n  type InsertMatricula,\n  type Pagamento,\n  type InsertPagamento,\n  type AlunoWithTurmas,\n  type AlunoWithFilial,\n  type Filial,\n  type InsertFilial,\n  type Responsavel,\n  type InsertResponsavel,\n  type ResponsavelWithAlunos,\n  type Evento,\n  type InsertEvento,\n  type EventoWithFilial,\n  type Uniforme,\n  type InsertUniforme,\n  type Notificacao,\n  type InsertNotificacao,\n  type InscricaoEvento,\n  type InsertInscricaoEvento,\n  type CompraUniforme,\n  type InsertCompraUniforme,\n  type Presenca,\n  type InsertPresenca,\n  type PacoteTreino,\n  type InsertPacoteTreino,\n  type AssinaturaPacote,\n  type InsertAssinaturaPacote,\n  type AssinaturaPacoteComplete,\n  type CategoriaTeste,\n  type InsertCategoriaTeste,\n  type Teste,\n  type InsertTeste,\n  type TesteWithCategoria,\n  type AvaliacaoFisica,\n  type InsertAvaliacaoFisica,\n  type AvaliacaoFisicaComplete,\n  type ResultadoTeste,\n  type InsertResultadoTeste,\n  type MetaAluno,\n  type InsertMetaAluno,\n  type MetaAlunoComplete,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, sql, count } from \"drizzle-orm\";\nimport bcrypt from \"bcrypt\";\n\nexport interface IStorage {\n  // User operations (mandatory for Replit Auth)\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n\n  // Admin user operations for traditional authentication\n  getAdminUser(id: number): Promise<AdminUser | undefined>;\n  getAdminUserByEmail(email: string): Promise<AdminUser | undefined>;\n  createAdminUser(user: InsertAdminUser): Promise<AdminUser>;\n  authenticateAdminUser(email: string, senha: string): Promise<AdminUser | null>;\n  updateAdminUserLastLogin(id: number): Promise<void>;\n\n  // Alunos operations\n  getAlunos(): Promise<AlunoWithFilial[]>;\n  getAluno(id: number): Promise<AlunoWithTurmas | undefined>;\n  createAluno(aluno: InsertAluno & { cpfResponsavel?: string; emailResponsavel?: string; senhaResponsavel?: string }): Promise<Aluno>;\n  updateAluno(id: number, aluno: Partial<InsertAluno>): Promise<Aluno>;\n  deleteAluno(id: number): Promise<void>;\n\n  // Professores operations\n  getProfessores(): Promise<(Professor & { filial: Filial | null })[]>;\n  getProfessor(id: number): Promise<Professor | undefined>;\n  createProfessor(professor: InsertProfessor): Promise<Professor>;\n  updateProfessor(id: number, professor: Partial<InsertProfessor>): Promise<Professor>;\n  deleteProfessor(id: number): Promise<void>;\n\n  // Turmas operations\n  getTurmas(): Promise<TurmaWithProfessor[]>;\n  getTurma(id: number): Promise<TurmaWithProfessor | undefined>;\n  createTurma(turma: InsertTurma): Promise<Turma>;\n  updateTurma(id: number, turma: Partial<InsertTurma>): Promise<Turma>;\n  deleteTurma(id: number): Promise<void>;\n\n  // Matriculas operations\n  getMatriculas(): Promise<Matricula[]>;\n  createMatricula(matricula: InsertMatricula): Promise<Matricula>;\n  deleteMatricula(id: number): Promise<void>;\n\n  // Pagamentos operations\n  getPagamentos(): Promise<Pagamento[]>;\n  getPagamento(id: number): Promise<Pagamento | undefined>;\n  getPagamentosByAluno(alunoId: number): Promise<Pagamento[]>;\n  createPagamento(pagamento: InsertPagamento): Promise<Pagamento>;\n  deletePagamento(id: number): Promise<void>;\n\n  // Filiais operations\n  getFiliais(): Promise<Filial[]>;\n  getFiliaisDetalhadas(): Promise<any[]>;\n  getFilial(id: number): Promise<Filial | undefined>;\n  createFilial(filial: InsertFilial): Promise<Filial>;\n  updateFilial(id: number, filial: Partial<InsertFilial>): Promise<Filial>;\n  deleteFilial(id: number): Promise<void>;\n  getAlunosByFilial(filialId: number): Promise<AlunoWithFilial[]>;\n  getProfessoresByFilial(filialId: number): Promise<Professor[]>;\n  getTurmasByFilial(filialId: number): Promise<TurmaWithProfessor[]>;\n\n  // Dashboard metrics\n  getDashboardMetrics(): Promise<{\n    totalAlunos: number;\n    totalProfessores: number;\n    totalTurmas: number;\n    receitaMensal: number;\n  }>;\n\n  // Responsáveis operations\n  getResponsavel(id: number): Promise<Responsavel | undefined>;\n  getResponsavelByEmail(email: string): Promise<Responsavel | undefined>;\n  createResponsavel(responsavel: InsertResponsavel): Promise<Responsavel>;\n  authenticateResponsavel(email: string, senha: string): Promise<Responsavel | null>;\n  getResponsavelWithAlunos(id: number): Promise<ResponsavelWithAlunos | undefined>;\n\n  // Gestores de Unidade operations\n  getGestorUnidade(id: number): Promise<GestorUnidade | undefined>;\n  getGestorUnidadeByEmail(email: string): Promise<GestorUnidade | undefined>;\n  createGestorUnidade(gestor: InsertGestorUnidade): Promise<GestorUnidade>;\n  authenticateGestorUnidade(email: string, senha: string): Promise<GestorUnidadeWithFilial | null>;\n  updateGestorUltimoLogin(id: number): Promise<void>;\n\n  // Eventos operations\n  getEventos(): Promise<EventoWithFilial[]>;\n  createEvento(evento: InsertEvento): Promise<Evento>;\n  inscreveAlunoEvento(inscricao: InsertInscricaoEvento): Promise<InscricaoEvento>;\n\n  // Uniformes operations\n  getUniformes(): Promise<Uniforme[]>;\n  comprarUniforme(compra: InsertCompraUniforme): Promise<CompraUniforme>;\n\n  // Notificações operations\n  getNotificacoesByResponsavel(responsavelId: number): Promise<Notificacao[]>;\n  createNotificacao(notificacao: InsertNotificacao): Promise<Notificacao>;\n  marcarNotificacaoLida(id: number): Promise<void>;\n\n  // Presenças operations\n  getPresencasByTurmaData(turmaId: number, data: string): Promise<Presenca[]>;\n  getPresencasDetalhadas(): Promise<any[]>;\n  registrarPresencas(presencas: InsertPresenca[]): Promise<Presenca[]>;\n\n  // Uniformes operations\n  getUniformes(): Promise<Uniforme[]>;\n  createUniforme(uniforme: InsertUniforme): Promise<Uniforme>;\n  getComprasUniformes(): Promise<any[]>;\n  comprarUniforme(compra: InsertCompraUniforme): Promise<CompraUniforme>;\n\n  // Eventos operations\n  getEventos(): Promise<EventoWithFilial[]>;\n  createEvento(evento: InsertEvento): Promise<Evento>;\n  getInscricoesEventos(): Promise<InscricaoEvento[]>;\n  inscreveAlunoEvento(inscricao: InsertInscricaoEvento): Promise<InscricaoEvento>;\n\n  // Pacotes de treino operations\n  getPacotesTreino(): Promise<PacoteTreino[]>;\n  createPacoteTreino(pacote: InsertPacoteTreino): Promise<PacoteTreino>;\n  getAssinaturasPacotes(): Promise<AssinaturaPacoteComplete[]>;\n  criarAssinaturaPacote(assinatura: InsertAssinaturaPacote): Promise<AssinaturaPacote>;\n\n  // Physical evaluation operations\n  getCategoriasTestes(): Promise<CategoriaTeste[]>;\n  createCategoriaTeste(categoria: InsertCategoriaTeste): Promise<CategoriaTeste>;\n  updateCategoriaTeste(id: number, categoria: Partial<InsertCategoriaTeste>): Promise<CategoriaTeste>;\n  deleteCategoriaTeste(id: number): Promise<void>;\n\n  getTestes(): Promise<TesteWithCategoria[]>;\n  getTestesByCategoria(categoriaId: number): Promise<TesteWithCategoria[]>;\n  createTeste(teste: InsertTeste): Promise<Teste>;\n  updateTeste(id: number, teste: Partial<InsertTeste>): Promise<Teste>;\n  deleteTeste(id: number): Promise<void>;\n\n  getAvaliacoesFisicas(): Promise<AvaliacaoFisicaComplete[]>;\n  getAvaliacoesByAluno(alunoId: number): Promise<AvaliacaoFisicaComplete[]>;\n  getAvaliacoesByFilial(filialId: number): Promise<AvaliacaoFisicaComplete[]>;\n  createAvaliacaoFisica(avaliacao: InsertAvaliacaoFisica): Promise<AvaliacaoFisica>;\n  updateAvaliacaoFisica(id: number, avaliacao: Partial<InsertAvaliacaoFisica>): Promise<AvaliacaoFisica>;\n  deleteAvaliacaoFisica(id: number): Promise<void>;\n\n  getResultadosTestes(): Promise<ResultadoTeste[]>;\n  getResultadosByAvaliacao(avaliacaoId: number): Promise<ResultadoTeste[]>;\n  createResultadoTeste(resultado: InsertResultadoTeste): Promise<ResultadoTeste>;\n  updateResultadoTeste(id: number, resultado: Partial<InsertResultadoTeste>): Promise<ResultadoTeste>;\n  deleteResultadoTeste(id: number): Promise<void>;\n\n  getMetasAlunos(): Promise<MetaAlunoComplete[]>;\n  getMetasByAluno(alunoId: number): Promise<MetaAlunoComplete[]>;\n  createMetaAluno(meta: InsertMetaAluno): Promise<MetaAluno>;\n  updateMetaAluno(id: number, meta: Partial<InsertMetaAluno>): Promise<MetaAluno>;\n  deleteMetaAluno(id: number): Promise<void>;\n\n  // Combos de Aulas operations\n  getCombosAulas(): Promise<any[]>;\n  createComboAulas(combo: any): Promise<any>;\n  updateComboAulas(id: number, combo: any): Promise<any>;\n  deleteComboAulas(id: number): Promise<void>;\n\n  // Guardian portal operations\n  getAlunoForGuardian(alunoId: number, responsavelId: number): Promise<AlunoWithTurmas | undefined>;\n  updateAlunoContact(alunoId: number, responsavelId: number, data: any): Promise<Aluno>;\n  getTurmasByAluno(alunoId: number, responsavelId: number): Promise<TurmaWithProfessor[]>;\n  getEventosDisponiveisByFilial(filialId: number): Promise<EventoWithFilial[]>;\n  createGuardianInscricao(eventoId: number, alunoId: number, responsavelId: number, observacoes?: string): Promise<InscricaoEvento>;\n  createGuardianCompra(uniformeId: number, alunoId: number, responsavelId: number, tamanho: string, cor: string, quantidade: number): Promise<CompraUniforme>;\n  getPagamentosByAlunoForGuardian(alunoId: number, responsavelId: number): Promise<Pagamento[]>;\n  getInscricoesEventosByAluno(alunoId: number): Promise<InscricaoEvento[]>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // User operations (mandatory for Replit Auth)\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  // Admin user operations for traditional authentication\n  async getAdminUser(id: number): Promise<AdminUser | undefined> {\n    const [user] = await db.select().from(adminUsers).where(eq(adminUsers.id, id));\n    return user || undefined;\n  }\n\n  async getAdminUserByEmail(email: string): Promise<AdminUser | undefined> {\n    const [user] = await db.select().from(adminUsers).where(eq(adminUsers.email, email));\n    return user || undefined;\n  }\n\n  async createAdminUser(userData: InsertAdminUser): Promise<AdminUser> {\n    // Hash password before storing\n    const hashedPassword = await bcrypt.hash(userData.senha, 10);\n    \n    const [user] = await db\n      .insert(adminUsers)\n      .values({\n        ...userData,\n        senha: hashedPassword,\n      })\n      .returning();\n    return user;\n  }\n\n  async authenticateAdminUser(email: string, senha: string): Promise<AdminUser | null> {\n    const user = await this.getAdminUserByEmail(email);\n    if (!user || !user.ativo) {\n      return null;\n    }\n\n    const isValidPassword = await bcrypt.compare(senha, user.senha);\n    if (!isValidPassword) {\n      return null;\n    }\n\n    // Update last login\n    await this.updateAdminUserLastLogin(user.id);\n    return user;\n  }\n\n  async updateAdminUserLastLogin(id: number): Promise<void> {\n    await db\n      .update(adminUsers)\n      .set({\n        ultimoLogin: new Date(),\n        updatedAt: new Date(),\n      })\n      .where(eq(adminUsers.id, id));\n  }\n\n  // Alunos operations\n  async getAlunos(): Promise<AlunoWithFilial[]> {\n    const alunosData = await db\n      .select({\n        id: alunos.id,\n        nome: alunos.nome,\n        cpf: alunos.cpf,\n        rg: alunos.rg,\n        email: alunos.email,\n        telefone: alunos.telefone,\n        dataNascimento: alunos.dataNascimento,\n        dataMatricula: alunos.dataMatricula,\n        fotoUrl: alunos.fotoUrl,\n        endereco: alunos.endereco,\n        bairro: alunos.bairro,\n        cep: alunos.cep,\n        cidade: alunos.cidade,\n        estado: alunos.estado,\n        responsavelId: alunos.responsavelId,\n        nomeResponsavel: alunos.nomeResponsavel,\n        telefoneResponsavel: alunos.telefoneResponsavel,\n        filialId: alunos.filialId,\n        ativo: alunos.ativo,\n        createdAt: alunos.createdAt,\n        updatedAt: alunos.updatedAt,\n        filial: filiais,\n      })\n      .from(alunos)\n      .leftJoin(filiais, eq(alunos.filialId, filiais.id))\n      .orderBy(desc(alunos.createdAt));\n\n    // Calcular status de pagamento para cada aluno\n    const alunosComStatus = await Promise.all(\n      alunosData.map(async (aluno) => {\n        const statusPagamento = await this.calcularStatusPagamento(aluno.id);\n        return {\n          ...aluno,\n          statusPagamento,\n        };\n      })\n    );\n\n    return alunosComStatus;\n  }\n\n  private async calcularStatusPagamento(alunoId: number) {\n    // Buscar o último pagamento do aluno\n    const ultimoPagamento = await db\n      .select()\n      .from(pagamentos)\n      .where(eq(pagamentos.alunoId, alunoId))\n      .orderBy(desc(pagamentos.mesReferencia))\n      .limit(1);\n\n    if (ultimoPagamento.length === 0) {\n      // Aluno nunca fez pagamento\n      return {\n        emDia: false,\n        ultimoPagamento: undefined,\n        diasAtraso: undefined,\n      };\n    }\n\n    const ultimoMesReferencia = ultimoPagamento[0].mesReferencia;\n    const agora = new Date();\n    const mesAtual = `${agora.getFullYear()}-${String(agora.getMonth() + 1).padStart(2, '0')}`;\n    \n    // Verificar se o último pagamento é do mês atual\n    const emDia = ultimoMesReferencia === mesAtual;\n    \n    // Calcular dias de atraso se não estiver em dia\n    let diasAtraso = 0;\n    if (!emDia) {\n      const [anoUltimo, mesUltimo] = ultimoMesReferencia.split('-').map(Number);\n      const dataUltimoPagamento = new Date(anoUltimo, mesUltimo - 1, 1);\n      const proximoMesDevido = new Date(anoUltimo, mesUltimo, 1);\n      const diffTempo = agora.getTime() - proximoMesDevido.getTime();\n      diasAtraso = Math.floor(diffTempo / (1000 * 60 * 60 * 24));\n    }\n\n    return {\n      emDia,\n      ultimoPagamento: ultimoMesReferencia,\n      diasAtraso: !emDia ? diasAtraso : undefined,\n    };\n  }\n\n  async getAluno(id: number): Promise<AlunoWithTurmas | undefined> {\n    const [aluno] = await db\n      .select()\n      .from(alunos)\n      .where(and(eq(alunos.id, id), eq(alunos.ativo, true)));\n\n    if (!aluno) return undefined;\n\n    const matriculasData = await db\n      .select({\n        matricula: matriculas,\n        turma: turmas,\n        professor: professores,\n      })\n      .from(matriculas)\n      .leftJoin(turmas, eq(matriculas.turmaId, turmas.id))\n      .leftJoin(professores, eq(turmas.professorId, professores.id))\n      .where(and(eq(matriculas.alunoId, id), eq(matriculas.ativo, true)));\n\n    return {\n      ...aluno,\n      matriculas: matriculasData.map((item) => ({\n        ...item.matricula,\n        turma: {\n          ...item.turma!,\n          professor: item.professor,\n        },\n      })),\n    };\n  }\n\n  async createAluno(aluno: InsertAluno & { cpfResponsavel?: string; emailResponsavel?: string; senhaResponsavel?: string }): Promise<Aluno> {\n    const { cpfResponsavel, emailResponsavel, senhaResponsavel, ...alunoData } = aluno;\n    \n    // Create responsável if portal access data is provided\n    let responsavelId: number | undefined;\n    if (cpfResponsavel && emailResponsavel && senhaResponsavel) {\n      const hashedPassword = await bcrypt.hash(senhaResponsavel, 10);\n      \n      const [newResponsavel] = await db.insert(responsaveis).values({\n        nome: alunoData.nomeResponsavel || \"Responsável\",\n        email: emailResponsavel,\n        senha: hashedPassword,\n        telefone: alunoData.telefoneResponsavel,\n        cpf: cpfResponsavel,\n        endereco: alunoData.endereco,\n        bairro: alunoData.bairro,\n        cep: alunoData.cep,\n        cidade: alunoData.cidade,\n        estado: alunoData.estado,\n        ativo: true,\n      }).returning();\n      \n      responsavelId = newResponsavel.id;\n    }\n    \n    const [newAluno] = await db.insert(alunos).values({\n      ...alunoData,\n      responsavelId,\n    }).returning();\n    \n    return newAluno;\n  }\n\n  async updateAluno(id: number, aluno: Partial<InsertAluno>): Promise<Aluno> {\n    const [updatedAluno] = await db\n      .update(alunos)\n      .set({ ...aluno, updatedAt: new Date() })\n      .where(eq(alunos.id, id))\n      .returning();\n    return updatedAluno;\n  }\n\n  async deleteAluno(id: number): Promise<void> {\n    // First delete all related records that reference the student\n    await db.delete(assinaturasPacotes).where(eq(assinaturasPacotes.alunoId, id));\n    await db.delete(matriculas).where(eq(matriculas.alunoId, id));\n    await db.delete(pagamentos).where(eq(pagamentos.alunoId, id));\n    await db.delete(presencas).where(eq(presencas.alunoId, id));\n    // Note: resultadosTestes table doesn't have alunoId directly, it's linked through avaliacaoId\n    await db.delete(metasAlunos).where(eq(metasAlunos.alunoId, id));\n    await db.delete(avaliacoesFisicas).where(eq(avaliacoesFisicas.alunoId, id));\n    await db.delete(inscricoesEventos).where(eq(inscricoesEventos.alunoId, id));\n    await db.delete(comprasUniformes).where(eq(comprasUniformes.alunoId, id));\n    \n    // Then delete the student record\n    await db.delete(alunos).where(eq(alunos.id, id));\n  }\n\n  // Professores operations\n  async getProfessores(): Promise<(Professor & { filial: Filial | null })[]> {\n    return await db\n      .select()\n      .from(professores)\n      .leftJoin(filiais, eq(professores.filialId, filiais.id))\n      .where(eq(professores.ativo, true))\n      .orderBy(desc(professores.createdAt))\n      .then(results => results.map(result => ({\n        ...result.professores,\n        filial: result.filiais,\n      })));\n  }\n\n  async getProfessor(id: number): Promise<Professor | undefined> {\n    const [professor] = await db\n      .select()\n      .from(professores)\n      .where(and(eq(professores.id, id), eq(professores.ativo, true)));\n    return professor;\n  }\n\n  async createProfessor(professor: InsertProfessor): Promise<Professor> {\n    const [newProfessor] = await db.insert(professores).values(professor).returning();\n    return newProfessor;\n  }\n\n  async updateProfessor(id: number, professor: Partial<InsertProfessor>): Promise<Professor> {\n    const [updatedProfessor] = await db\n      .update(professores)\n      .set({ ...professor, updatedAt: new Date() })\n      .where(eq(professores.id, id))\n      .returning();\n    return updatedProfessor;\n  }\n\n  async deleteProfessor(id: number): Promise<void> {\n    await db.update(professores).set({ ativo: false }).where(eq(professores.id, id));\n  }\n\n  // Turmas operations\n  async getTurmas(): Promise<TurmaWithProfessor[]> {\n    const turmasData = await db\n      .select({\n        turma: turmas,\n        professor: professores,\n        filial: filiais,\n        matriculasCount: count(matriculas.id),\n      })\n      .from(turmas)\n      .leftJoin(professores, eq(turmas.professorId, professores.id))\n      .leftJoin(filiais, eq(turmas.filialId, filiais.id))\n      .leftJoin(matriculas, and(eq(matriculas.turmaId, turmas.id), eq(matriculas.ativo, true)))\n      .where(eq(turmas.ativo, true))\n      .groupBy(turmas.id, professores.id, filiais.id)\n      .orderBy(desc(turmas.createdAt));\n\n    return turmasData.map((item) => ({\n      ...item.turma,\n      professor: item.professor,\n      filial: item.filial,\n      _count: {\n        matriculas: item.matriculasCount,\n      },\n    }));\n  }\n\n  async getTurma(id: number): Promise<TurmaWithProfessor | undefined> {\n    const [turmaData] = await db\n      .select({\n        turma: turmas,\n        professor: professores,\n        filial: filiais,\n      })\n      .from(turmas)\n      .leftJoin(professores, eq(turmas.professorId, professores.id))\n      .leftJoin(filiais, eq(turmas.filialId, filiais.id))\n      .where(and(eq(turmas.id, id), eq(turmas.ativo, true)));\n\n    if (!turmaData) return undefined;\n\n    return {\n      ...turmaData.turma,\n      professor: turmaData.professor,\n      filial: turmaData.filial,\n    };\n  }\n\n  async createTurma(turma: InsertTurma): Promise<Turma> {\n    const [newTurma] = await db.insert(turmas).values(turma).returning();\n    return newTurma;\n  }\n\n  async updateTurma(id: number, turma: Partial<InsertTurma>): Promise<Turma> {\n    const [updatedTurma] = await db\n      .update(turmas)\n      .set({ ...turma, updatedAt: new Date() })\n      .where(eq(turmas.id, id))\n      .returning();\n    return updatedTurma;\n  }\n\n  async deleteTurma(id: number): Promise<void> {\n    await db.update(turmas).set({ ativo: false }).where(eq(turmas.id, id));\n  }\n\n  // Matriculas operations\n  async getMatriculas(): Promise<Matricula[]> {\n    return await db.select().from(matriculas).where(eq(matriculas.ativo, true)).orderBy(desc(matriculas.createdAt));\n  }\n\n  async createMatricula(matricula: InsertMatricula): Promise<Matricula> {\n    const [newMatricula] = await db.insert(matriculas).values(matricula).returning();\n    return newMatricula;\n  }\n\n  async deleteMatricula(id: number): Promise<void> {\n    await db.update(matriculas).set({ ativo: false }).where(eq(matriculas.id, id));\n  }\n\n  // Pagamentos operations\n  async getPagamentos(): Promise<Pagamento[]> {\n    return await db.select().from(pagamentos).orderBy(desc(pagamentos.createdAt));\n  }\n\n  async getPagamento(id: number): Promise<Pagamento | undefined> {\n    const [pagamento] = await db.select().from(pagamentos).where(eq(pagamentos.id, id));\n    return pagamento;\n  }\n\n  async getPagamentosByAluno(alunoId: number): Promise<Pagamento[]> {\n    return await db.select().from(pagamentos).where(eq(pagamentos.alunoId, alunoId)).orderBy(desc(pagamentos.createdAt));\n  }\n\n  async createPagamento(pagamento: InsertPagamento): Promise<Pagamento> {\n    const [newPagamento] = await db.insert(pagamentos).values(pagamento).returning();\n    return newPagamento;\n  }\n\n  async deletePagamento(id: number): Promise<void> {\n    await db.delete(pagamentos).where(eq(pagamentos.id, id));\n  }\n\n  // Dashboard metrics\n  async getDashboardMetrics(): Promise<{\n    totalAlunos: number;\n    totalProfessores: number;\n    totalTurmas: number;\n    receitaMensal: number;\n  }> {\n    const currentMonth = new Date().toISOString().slice(0, 7); // YYYY-MM format\n\n    const [alunosCount] = await db\n      .select({ count: count() })\n      .from(alunos);\n\n    const [professoresCount] = await db\n      .select({ count: count() })\n      .from(professores)\n      .where(eq(professores.ativo, true));\n\n    const [turmasCount] = await db\n      .select({ count: count() })\n      .from(turmas)\n      .where(eq(turmas.ativo, true));\n\n    const [receitaResult] = await db\n      .select({\n        total: sql<number>`COALESCE(SUM(${pagamentos.valor}), 0)`,\n      })\n      .from(pagamentos)\n      .where(eq(pagamentos.mesReferencia, currentMonth));\n\n    return {\n      totalAlunos: alunosCount.count,\n      totalProfessores: professoresCount.count,\n      totalTurmas: turmasCount.count,\n      receitaMensal: Number(receitaResult.total),\n    };\n  }\n\n  // Filiais operations\n  async getFiliais(): Promise<Filial[]> {\n    return await db.select().from(filiais).where(eq(filiais.ativa, true)).orderBy(desc(filiais.createdAt));\n  }\n\n  async getFilial(id: number): Promise<Filial | undefined> {\n    const [filial] = await db.select().from(filiais).where(and(eq(filiais.id, id), eq(filiais.ativa, true)));\n    return filial;\n  }\n\n  async createFilial(filial: InsertFilial): Promise<Filial> {\n    const [newFilial] = await db.insert(filiais).values(filial).returning();\n    return newFilial;\n  }\n\n  async updateFilial(id: number, filial: Partial<InsertFilial>): Promise<Filial> {\n    const [updatedFilial] = await db\n      .update(filiais)\n      .set({ ...filial, updatedAt: new Date() })\n      .where(eq(filiais.id, id))\n      .returning();\n    return updatedFilial;\n  }\n\n  async deleteFilial(id: number): Promise<void> {\n    await db.update(filiais).set({ ativa: false }).where(eq(filiais.id, id));\n  }\n\n  async getFiliaisDetalhadas(): Promise<any[]> {\n    const filiaisData = await db.select().from(filiais).where(eq(filiais.ativa, true));\n    \n    const filiaisComDetalhes = await Promise.all(\n      filiaisData.map(async (filial) => {\n        // Contar alunos por filial\n        const totalAlunosResult = await db\n          .select({ count: sql<number>`count(*)` })\n          .from(alunos)\n          .where(eq(alunos.filialId, filial.id));\n        \n        // Contar professores por filial\n        const totalProfessoresResult = await db\n          .select({ count: sql<number>`count(*)` })\n          .from(professores)\n          .where(eq(professores.filialId, filial.id));\n        \n        // Contar turmas por filial\n        const totalTurmasResult = await db\n          .select({ count: sql<number>`count(*)` })\n          .from(turmas)\n          .where(eq(turmas.filialId, filial.id));\n        \n        // Calcular receita mensal (soma dos pagamentos do mês atual)\n        const currentMonth = new Date().getMonth() + 1;\n        const currentYear = new Date().getFullYear();\n        const receitaResult = await db\n          .select({ total: sql<number>`coalesce(sum(cast(valor as decimal)), 0)` })\n          .from(pagamentos)\n          .innerJoin(alunos, eq(pagamentos.alunoId, alunos.id))\n          .where(and(\n            eq(alunos.filialId, filial.id),\n            eq(sql`extract(month from ${pagamentos.dataPagamento})`, currentMonth),\n            eq(sql`extract(year from ${pagamentos.dataPagamento})`, currentYear)\n          ));\n\n        return {\n          ...filial,\n          totalAlunos: totalAlunosResult[0]?.count || 0,\n          totalProfessores: totalProfessoresResult[0]?.count || 0,\n          totalTurmas: totalTurmasResult[0]?.count || 0,\n          receitaMensal: Number(receitaResult[0]?.total || 0),\n        };\n      })\n    );\n\n    return filiaisComDetalhes;\n  }\n\n  async getAlunosByFilial(filialId: number): Promise<AlunoWithFilial[]> {\n    const alunosData = await db\n      .select({\n        aluno: alunos,\n        filial: filiais,\n      })\n      .from(alunos)\n      .leftJoin(filiais, eq(alunos.filialId, filiais.id))\n      .where(eq(alunos.filialId, filialId));\n\n    return alunosData.map(({ aluno, filial }) => ({\n      ...aluno,\n      filial,\n    }));\n  }\n\n  async getProfessoresByFilial(filialId: number): Promise<Professor[]> {\n    return await db\n      .select()\n      .from(professores)\n      .where(eq(professores.filialId, filialId));\n  }\n\n  async getTurmasByFilial(filialId: number): Promise<TurmaWithProfessor[]> {\n    const turmasData = await db\n      .select({\n        turma: turmas,\n        professor: professores,\n        filial: filiais,\n      })\n      .from(turmas)\n      .leftJoin(professores, eq(turmas.professorId, professores.id))\n      .leftJoin(filiais, eq(turmas.filialId, filiais.id))\n      .where(eq(turmas.filialId, filialId));\n\n    return turmasData.map(({ turma, professor, filial }) => ({\n      ...turma,\n      professor,\n      filial,\n    }));\n  }\n\n  // Responsáveis operations\n  async getResponsavel(id: number): Promise<Responsavel | undefined> {\n    const [responsavel] = await db.select().from(responsaveis).where(eq(responsaveis.id, id));\n    return responsavel;\n  }\n\n  async getResponsavelByEmail(email: string): Promise<Responsavel | undefined> {\n    const [responsavel] = await db.select().from(responsaveis).where(eq(responsaveis.email, email));\n    return responsavel;\n  }\n\n  async createResponsavel(responsavel: InsertResponsavel): Promise<Responsavel> {\n    const [novoResponsavel] = await db\n      .insert(responsaveis)\n      .values(responsavel)\n      .returning();\n    return novoResponsavel;\n  }\n\n  async authenticateResponsavel(email: string, senha: string): Promise<Responsavel | null> {\n    const [responsavel] = await db\n      .select()\n      .from(responsaveis)\n      .where(and(eq(responsaveis.email, email), eq(responsaveis.senha, senha)));\n    return responsavel || null;\n  }\n\n  async getResponsavelWithAlunos(id: number): Promise<ResponsavelWithAlunos | undefined> {\n    const responsavel = await this.getResponsavel(id);\n    if (!responsavel) return undefined;\n\n    const alunosDoResponsavel = await db\n      .select({\n        id: alunos.id,\n        nome: alunos.nome,\n        cpf: alunos.cpf,\n        rg: alunos.rg,\n        email: alunos.email,\n        telefone: alunos.telefone,\n        dataNascimento: alunos.dataNascimento,\n        dataMatricula: alunos.dataMatricula,\n        fotoUrl: alunos.fotoUrl,\n        endereco: alunos.endereco,\n        bairro: alunos.bairro,\n        cep: alunos.cep,\n        cidade: alunos.cidade,\n        estado: alunos.estado,\n        responsavelId: alunos.responsavelId,\n        nomeResponsavel: alunos.nomeResponsavel,\n        telefoneResponsavel: alunos.telefoneResponsavel,\n        filialId: alunos.filialId,\n        ativo: alunos.ativo,\n        createdAt: alunos.createdAt,\n        updatedAt: alunos.updatedAt,\n        filial: filiais,\n      })\n      .from(alunos)\n      .leftJoin(filiais, eq(alunos.filialId, filiais.id))\n      .where(eq(alunos.responsavelId, id));\n\n    // Calcular status de pagamento para cada aluno\n    const alunosComStatus = await Promise.all(\n      alunosDoResponsavel.map(async (aluno) => {\n        const statusPagamento = await this.calcularStatusPagamento(aluno.id);\n        return {\n          ...aluno,\n          statusPagamento,\n        };\n      })\n    );\n\n    return {\n      ...responsavel,\n      alunos: alunosComStatus,\n    };\n  }\n\n  // Eventos operations\n  async getEventos(): Promise<EventoWithFilial[]> {\n    return await db\n      .select({\n        id: eventos.id,\n        nome: eventos.nome,\n        descricao: eventos.descricao,\n        dataEvento: eventos.dataEvento,\n        horaInicio: eventos.horaInicio,\n        horaFim: eventos.horaFim,\n        local: eventos.local,\n        preco: eventos.preco,\n        vagasMaximas: eventos.vagasMaximas,\n        filialId: eventos.filialId,\n        ativo: eventos.ativo,\n        createdAt: eventos.createdAt,\n        updatedAt: eventos.updatedAt,\n        filial: filiais,\n      })\n      .from(eventos)\n      .leftJoin(filiais, eq(eventos.filialId, filiais.id))\n      .where(eq(eventos.ativo, true))\n      .orderBy(desc(eventos.dataEvento));\n  }\n\n  async createEvento(evento: InsertEvento): Promise<Evento> {\n    const [novoEvento] = await db\n      .insert(eventos)\n      .values(evento)\n      .returning();\n    return novoEvento;\n  }\n\n  async inscreveAlunoEvento(inscricao: InsertInscricaoEvento): Promise<InscricaoEvento> {\n    const [novaInscricao] = await db\n      .insert(inscricoesEventos)\n      .values(inscricao)\n      .returning();\n    return novaInscricao;\n  }\n\n\n\n  // Notificações operations\n  async getNotificacoesByResponsavel(responsavelId: number): Promise<Notificacao[]> {\n    return await db\n      .select()\n      .from(notificacoes)\n      .where(eq(notificacoes.responsavelId, responsavelId))\n      .orderBy(desc(notificacoes.createdAt));\n  }\n\n  async createNotificacao(notificacao: InsertNotificacao): Promise<Notificacao> {\n    const [novaNotificacao] = await db\n      .insert(notificacoes)\n      .values(notificacao)\n      .returning();\n    return novaNotificacao;\n  }\n\n  async marcarNotificacaoLida(id: number): Promise<void> {\n    await db\n      .update(notificacoes)\n      .set({ lida: true })\n      .where(eq(notificacoes.id, id));\n  }\n\n  // Presenças operations\n  async getPresencasByTurmaData(turmaId: number, data: string): Promise<Presenca[]> {\n    return await db\n      .select()\n      .from(presencas)\n      .where(and(\n        eq(presencas.turmaId, turmaId),\n        eq(presencas.data, data)\n      ))\n      .orderBy(presencas.alunoId);\n  }\n\n  async getPresencasDetalhadas(): Promise<any[]> {\n    const presencasComDetalhes = await db\n      .select({\n        id: presencas.id,\n        alunoId: presencas.alunoId,\n        turmaId: presencas.turmaId,\n        data: presencas.data,\n        presente: presencas.presente,\n        observacoes: presencas.observacoes,\n        createdAt: presencas.createdAt,\n        alunoNome: alunos.nome,\n        turmanome: turmas.nome,\n        professorNome: professores.nome,\n        filialNome: filiais.nome\n      })\n      .from(presencas)\n      .leftJoin(alunos, eq(presencas.alunoId, alunos.id))\n      .leftJoin(turmas, eq(presencas.turmaId, turmas.id))\n      .leftJoin(professores, eq(turmas.professorId, professores.id))\n      .leftJoin(filiais, eq(alunos.filialId, filiais.id))\n      .orderBy(desc(presencas.createdAt));\n\n    // Mapear para o formato esperado\n    return presencasComDetalhes.map(p => ({\n      id: p.id,\n      alunoId: p.alunoId,\n      turmaId: p.turmaId,\n      data: p.data,\n      presente: p.presente,\n      observacoes: p.observacoes,\n      createdAt: p.createdAt,\n      aluno: {\n        id: p.alunoId,\n        nome: p.alunoNome,\n        filial: {\n          nome: p.filialNome\n        }\n      },\n      turma: {\n        id: p.turmaId,\n        nome: p.turmanome,\n        professor: {\n          nome: p.professorNome\n        }\n      }\n    }));\n  }\n\n  async registrarPresencas(presencasData: InsertPresenca[]): Promise<Presenca[]> {\n    // Primeiro, deletar presenças existentes para a mesma turma e data\n    if (presencasData.length > 0) {\n      const { turmaId, data } = presencasData[0];\n      await db\n        .delete(presencas)\n        .where(and(\n          eq(presencas.turmaId, turmaId),\n          eq(presencas.data, data)\n        ));\n    }\n\n    // Inserir novas presenças\n    const novasPresencas = await db\n      .insert(presencas)\n      .values(presencasData)\n      .returning();\n\n    return novasPresencas;\n  }\n\n  // Uniformes operations\n  async getUniformes(): Promise<Uniforme[]> {\n    return await db.select().from(uniformes);\n  }\n\n  async createUniforme(uniformeData: InsertUniforme): Promise<Uniforme> {\n    const [uniforme] = await db\n      .insert(uniformes)\n      .values(uniformeData)\n      .returning();\n    return uniforme;\n  }\n\n  async getComprasUniformes(): Promise<any[]> {\n    const compras = await db\n      .select({\n        compra: comprasUniformes,\n        uniforme: uniformes,\n        aluno: alunos\n      })\n      .from(comprasUniformes)\n      .leftJoin(uniformes, eq(comprasUniformes.uniformeId, uniformes.id))\n      .leftJoin(alunos, eq(comprasUniformes.alunoId, alunos.id));\n\n    return compras.map(row => ({\n      ...row.compra,\n      uniforme: row.uniforme,\n      aluno: row.aluno\n    }));\n  }\n\n  async comprarUniforme(compraData: InsertCompraUniforme): Promise<CompraUniforme> {\n    const [compra] = await db\n      .insert(comprasUniformes)\n      .values(compraData)\n      .returning();\n    return compra;\n  }\n\n  // Eventos operations  \n  async getInscricoesEventos(): Promise<InscricaoEvento[]> {\n    return await db.select().from(inscricoesEventos);\n  }\n\n  // Pacotes de treino operations\n  async getPacotesTreino(): Promise<PacoteTreino[]> {\n    return await db.select().from(pacotesTreino).where(eq(pacotesTreino.ativo, true));\n  }\n\n  async createPacoteTreino(pacoteData: InsertPacoteTreino): Promise<PacoteTreino> {\n    const [pacote] = await db\n      .insert(pacotesTreino)\n      .values(pacoteData)\n      .returning();\n    return pacote;\n  }\n\n  async getAssinaturasPacotes(): Promise<AssinaturaPacoteComplete[]> {\n    const result = await db\n      .select()\n      .from(assinaturasPacotes)\n      .leftJoin(alunos, eq(assinaturasPacotes.alunoId, alunos.id))\n      .leftJoin(pacotesTreino, eq(assinaturasPacotes.pacoteId, pacotesTreino.id));\n\n    return result.map(row => ({\n      ...row.assinaturas_pacotes,\n      aluno: row.alunos || {},\n      pacote: row.pacotes_treino || {}\n    })) as AssinaturaPacoteComplete[];\n  }\n\n  async criarAssinaturaPacote(assinaturaData: InsertAssinaturaPacote): Promise<AssinaturaPacote> {\n    const [assinatura] = await db\n      .insert(assinaturasPacotes)\n      .values(assinaturaData)\n      .returning();\n    return assinatura;\n  }\n\n  // Physical evaluation operations\n  async getCategoriasTestes(): Promise<CategoriaTeste[]> {\n    return await db.select().from(categoriasTestes).where(eq(categoriasTestes.ativo, true));\n  }\n\n  async createCategoriaTeste(categoriaData: InsertCategoriaTeste): Promise<CategoriaTeste> {\n    const [categoria] = await db\n      .insert(categoriasTestes)\n      .values(categoriaData)\n      .returning();\n    return categoria;\n  }\n\n  async updateCategoriaTeste(id: number, categoriaData: Partial<InsertCategoriaTeste>): Promise<CategoriaTeste> {\n    const [categoria] = await db\n      .update(categoriasTestes)\n      .set({\n        ...categoriaData,\n        updatedAt: new Date(),\n      })\n      .where(eq(categoriasTestes.id, id))\n      .returning();\n    return categoria;\n  }\n\n  async deleteCategoriaTeste(id: number): Promise<void> {\n    await db.delete(categoriasTestes).where(eq(categoriasTestes.id, id));\n  }\n\n  async getTestes(): Promise<TesteWithCategoria[]> {\n    const result = await db\n      .select()\n      .from(testes)\n      .leftJoin(categoriasTestes, eq(testes.categoriaId, categoriasTestes.id))\n      .where(eq(testes.ativo, true));\n\n    return result.map(row => ({\n      ...row.testes,\n      categoria: row.categorias_testes || {} as CategoriaTeste\n    })) as TesteWithCategoria[];\n  }\n\n  async getTestesByCategoria(categoriaId: number): Promise<TesteWithCategoria[]> {\n    const result = await db\n      .select()\n      .from(testes)\n      .leftJoin(categoriasTestes, eq(testes.categoriaId, categoriasTestes.id))\n      .where(and(eq(testes.categoriaId, categoriaId), eq(testes.ativo, true)));\n\n    return result.map(row => ({\n      ...row.testes,\n      categoria: row.categorias_testes || {} as CategoriaTeste\n    })) as TesteWithCategoria[];\n  }\n\n  async createTeste(testeData: InsertTeste): Promise<Teste> {\n    const [teste] = await db\n      .insert(testes)\n      .values(testeData)\n      .returning();\n    return teste;\n  }\n\n  async updateTeste(id: number, testeData: Partial<InsertTeste>): Promise<Teste> {\n    const [teste] = await db\n      .update(testes)\n      .set({\n        ...testeData,\n        updatedAt: new Date(),\n      })\n      .where(eq(testes.id, id))\n      .returning();\n    return teste;\n  }\n\n  async deleteTeste(id: number): Promise<void> {\n    await db.delete(testes).where(eq(testes.id, id));\n  }\n\n  async getAvaliacoesFisicas(): Promise<AvaliacaoFisicaComplete[]> {\n    const result = await db\n      .select()\n      .from(avaliacoesFisicas)\n      .leftJoin(alunos, eq(avaliacoesFisicas.alunoId, alunos.id))\n      .leftJoin(professores, eq(avaliacoesFisicas.professorId, professores.id))\n      .leftJoin(filiais, eq(avaliacoesFisicas.filialId, filiais.id));\n\n    const avaliacoes = result.map(row => ({\n      ...row.avaliacoes_fisicas,\n      aluno: row.alunos || {} as Aluno,\n      professor: row.professores || {} as Professor,\n      filial: row.filiais || null,\n      resultados: []\n    })) as AvaliacaoFisicaComplete[];\n\n    // Get resultados for each avaliacao\n    for (const avaliacao of avaliacoes) {\n      const resultados = await this.getResultadosByAvaliacao(avaliacao.id);\n      avaliacao.resultados = resultados.map(resultado => ({\n        ...resultado,\n        teste: {} as TesteWithCategoria\n      }));\n    }\n\n    return avaliacoes;\n  }\n\n  async getAvaliacoesByAluno(alunoId: number): Promise<AvaliacaoFisicaComplete[]> {\n    const result = await db\n      .select()\n      .from(avaliacoesFisicas)\n      .leftJoin(alunos, eq(avaliacoesFisicas.alunoId, alunos.id))\n      .leftJoin(professores, eq(avaliacoesFisicas.professorId, professores.id))\n      .leftJoin(filiais, eq(avaliacoesFisicas.filialId, filiais.id))\n      .where(eq(avaliacoesFisicas.alunoId, alunoId));\n\n    return result.map(row => ({\n      ...row.avaliacoes_fisicas,\n      aluno: row.alunos || {} as Aluno,\n      professor: row.professores || {} as Professor,\n      filial: row.filiais || null,\n      resultados: []\n    })) as AvaliacaoFisicaComplete[];\n  }\n\n  async getAvaliacoesByFilial(filialId: number): Promise<AvaliacaoFisicaComplete[]> {\n    const result = await db\n      .select()\n      .from(avaliacoesFisicas)\n      .leftJoin(alunos, eq(avaliacoesFisicas.alunoId, alunos.id))\n      .leftJoin(professores, eq(avaliacoesFisicas.professorId, professores.id))\n      .leftJoin(filiais, eq(avaliacoesFisicas.filialId, filiais.id))\n      .where(eq(avaliacoesFisicas.filialId, filialId));\n\n    return result.map(row => ({\n      ...row.avaliacoes_fisicas,\n      aluno: row.alunos || {} as Aluno,\n      professor: row.professores || {} as Professor,\n      filial: row.filiais || null,\n      resultados: []\n    })) as AvaliacaoFisicaComplete[];\n  }\n\n  async createAvaliacaoFisica(avaliacaoData: InsertAvaliacaoFisica): Promise<AvaliacaoFisica> {\n    const [avaliacao] = await db\n      .insert(avaliacoesFisicas)\n      .values(avaliacaoData)\n      .returning();\n    return avaliacao;\n  }\n\n  async updateAvaliacaoFisica(id: number, avaliacaoData: Partial<InsertAvaliacaoFisica>): Promise<AvaliacaoFisica> {\n    const [avaliacao] = await db\n      .update(avaliacoesFisicas)\n      .set({\n        ...avaliacaoData,\n        updatedAt: new Date(),\n      })\n      .where(eq(avaliacoesFisicas.id, id))\n      .returning();\n    return avaliacao;\n  }\n\n  async deleteAvaliacaoFisica(id: number): Promise<void> {\n    // Delete related resultados first\n    await db.delete(resultadosTestes).where(eq(resultadosTestes.avaliacaoId, id));\n    // Then delete the avaliacao\n    await db.delete(avaliacoesFisicas).where(eq(avaliacoesFisicas.id, id));\n  }\n\n  // Gestores de Unidade operations\n  async getGestorUnidade(id: number): Promise<GestorUnidade | undefined> {\n    const [gestor] = await db\n      .select()\n      .from(gestoresUnidade)\n      .where(eq(gestoresUnidade.id, id));\n    return gestor;\n  }\n\n  async getGestorUnidadeByEmail(email: string): Promise<GestorUnidade | undefined> {\n    const [gestor] = await db\n      .select()\n      .from(gestoresUnidade)\n      .where(eq(gestoresUnidade.email, email));\n    return gestor;\n  }\n\n  async createGestorUnidade(gestorData: InsertGestorUnidade): Promise<GestorUnidade> {\n    // Hash the password before storing\n    const hashedPassword = await bcrypt.hash(gestorData.senha, 10);\n    \n    const [gestor] = await db\n      .insert(gestoresUnidade)\n      .values({\n        ...gestorData,\n        senha: hashedPassword,\n      })\n      .returning();\n    return gestor;\n  }\n\n  async authenticateGestorUnidade(email: string, senha: string): Promise<GestorUnidadeWithFilial | null> {\n    const gestor = await this.getGestorUnidadeByEmail(email);\n    if (!gestor || !gestor.ativo) {\n      return null;\n    }\n\n    const isValidPassword = await bcrypt.compare(senha, gestor.senha);\n    if (!isValidPassword) {\n      return null;\n    }\n\n    // Update last login\n    await this.updateGestorUltimoLogin(gestor.id);\n\n    // Get filial information\n    const filial = await this.getFilial(gestor.filialId);\n    \n    return {\n      ...gestor,\n      filial: filial || null,\n    };\n  }\n\n  async updateGestorUltimoLogin(id: number): Promise<void> {\n    await db\n      .update(gestoresUnidade)\n      .set({\n        ultimoLogin: new Date(),\n        updatedAt: new Date(),\n      })\n      .where(eq(gestoresUnidade.id, id));\n  }\n\n  async getResultadosTestes(): Promise<ResultadoTeste[]> {\n    return await db.select().from(resultadosTestes);\n  }\n\n  async getResultadosByAvaliacao(avaliacaoId: number): Promise<ResultadoTeste[]> {\n    return await db\n      .select()\n      .from(resultadosTestes)\n      .where(eq(resultadosTestes.avaliacaoId, avaliacaoId));\n  }\n\n  async createResultadoTeste(resultadoData: InsertResultadoTeste): Promise<ResultadoTeste> {\n    const [resultado] = await db\n      .insert(resultadosTestes)\n      .values(resultadoData)\n      .returning();\n    return resultado;\n  }\n\n  async updateResultadoTeste(id: number, resultadoData: Partial<InsertResultadoTeste>): Promise<ResultadoTeste> {\n    const [resultado] = await db\n      .update(resultadosTestes)\n      .set(resultadoData)\n      .where(eq(resultadosTestes.id, id))\n      .returning();\n    return resultado;\n  }\n\n  async deleteResultadoTeste(id: number): Promise<void> {\n    await db.delete(resultadosTestes).where(eq(resultadosTestes.id, id));\n  }\n\n  async getMetasAlunos(): Promise<MetaAlunoComplete[]> {\n    const result = await db\n      .select()\n      .from(metasAlunos)\n      .leftJoin(alunos, eq(metasAlunos.alunoId, alunos.id))\n      .leftJoin(testes, eq(metasAlunos.testeId, testes.id))\n      .leftJoin(categoriasTestes, eq(testes.categoriaId, categoriasTestes.id))\n      .leftJoin(professores, eq(metasAlunos.definidoPor, professores.id));\n\n    return result.map(row => ({\n      ...row.metas_alunos,\n      aluno: row.alunos || {} as Aluno,\n      teste: {\n        ...row.testes || {} as Teste,\n        categoria: row.categorias_testes || {} as CategoriaTeste\n      } as TesteWithCategoria,\n      definidoPorProfessor: row.professores || null\n    })) as MetaAlunoComplete[];\n  }\n\n  async getMetasByAluno(alunoId: number): Promise<MetaAlunoComplete[]> {\n    const result = await db\n      .select()\n      .from(metasAlunos)\n      .leftJoin(alunos, eq(metasAlunos.alunoId, alunos.id))\n      .leftJoin(testes, eq(metasAlunos.testeId, testes.id))\n      .leftJoin(categoriasTestes, eq(testes.categoriaId, categoriasTestes.id))\n      .leftJoin(professores, eq(metasAlunos.definidoPor, professores.id))\n      .where(eq(metasAlunos.alunoId, alunoId));\n\n    return result.map(row => ({\n      ...row.metas_alunos,\n      aluno: row.alunos || {} as Aluno,\n      teste: {\n        ...row.testes || {} as Teste,\n        categoria: row.categorias_testes || {} as CategoriaTeste\n      } as TesteWithCategoria,\n      definidoPorProfessor: row.professores || null\n    })) as MetaAlunoComplete[];\n  }\n\n  async createMetaAluno(metaData: InsertMetaAluno): Promise<MetaAluno> {\n    const [meta] = await db\n      .insert(metasAlunos)\n      .values(metaData)\n      .returning();\n    return meta;\n  }\n\n  async updateMetaAluno(id: number, metaData: Partial<InsertMetaAluno>): Promise<MetaAluno> {\n    const [meta] = await db\n      .update(metasAlunos)\n      .set({\n        ...metaData,\n        updatedAt: new Date(),\n      })\n      .where(eq(metasAlunos.id, id))\n      .returning();\n    return meta;\n  }\n\n  async deleteMetaAluno(id: number): Promise<void> {\n    await db.delete(metasAlunos).where(eq(metasAlunos.id, id));\n  }\n\n  // Combos de Aulas operations\n  async getCombosAulas(): Promise<any[]> {\n    return await db\n      .select()\n      .from(combosAulas)\n      .where(eq(combosAulas.ativo, true))\n      .orderBy(desc(combosAulas.createdAt));\n  }\n\n  async createComboAulas(comboData: any): Promise<any> {\n    const [combo] = await db\n      .insert(combosAulas)\n      .values(comboData)\n      .returning();\n    return combo;\n  }\n\n  async updateComboAulas(id: number, comboData: any): Promise<any> {\n    const [combo] = await db\n      .update(combosAulas)\n      .set({ ...comboData, updatedAt: new Date() })\n      .where(eq(combosAulas.id, id))\n      .returning();\n    return combo;\n  }\n\n  async deleteComboAulas(id: number): Promise<void> {\n    await db.delete(combosAulas).where(eq(combosAulas.id, id));\n  }\n\n  // Guardian portal operations\n  async getAlunoForGuardian(alunoId: number, responsavelId: number): Promise<AlunoWithTurmas | undefined> {\n    // Verify the aluno belongs to the responsavel\n    const [aluno] = await db\n      .select()\n      .from(alunos)\n      .where(and(eq(alunos.id, alunoId), eq(alunos.responsavelId, responsavelId)))\n      .limit(1);\n    \n    if (!aluno) {\n      return undefined;\n    }\n\n    return await this.getAluno(alunoId);\n  }\n\n  async updateAlunoContact(alunoId: number, responsavelId: number, data: any): Promise<Aluno> {\n    // First verify ownership\n    const aluno = await this.getAlunoForGuardian(alunoId, responsavelId);\n    if (!aluno) {\n      throw new Error(\"Aluno not found or unauthorized\");\n    }\n\n    const [updated] = await db\n      .update(alunos)\n      .set({\n        ...data,\n        updatedAt: new Date(),\n      })\n      .where(eq(alunos.id, alunoId))\n      .returning();\n    \n    return updated;\n  }\n\n  async getTurmasByAluno(alunoId: number, responsavelId: number): Promise<TurmaWithProfessor[]> {\n    // Verify ownership first\n    const aluno = await this.getAlunoForGuardian(alunoId, responsavelId);\n    if (!aluno) {\n      return [];\n    }\n\n    const result = await db\n      .select()\n      .from(turmas)\n      .leftJoin(professores, eq(turmas.professorId, professores.id))\n      .leftJoin(filiais, eq(turmas.filialId, filiais.id))\n      .leftJoin(matriculas, eq(matriculas.turmaId, turmas.id))\n      .where(and(\n        eq(matriculas.alunoId, alunoId),\n        eq(turmas.ativo, true)\n      ));\n\n    return result.map(row => ({\n      ...row.turmas,\n      professor: row.professores,\n      filial: row.filiais\n    })) as TurmaWithProfessor[];\n  }\n\n  async getEventosDisponiveisByFilial(filialId: number): Promise<EventoWithFilial[]> {\n    const result = await db\n      .select()\n      .from(eventos)\n      .leftJoin(filiais, eq(eventos.filialId, filiais.id))\n      .where(and(\n        eq(eventos.filialId, filialId),\n        eq(eventos.ativo, true)\n      ))\n      .orderBy(eventos.dataEvento);\n\n    return result.map(row => ({\n      ...row.eventos,\n      filial: row.filiais\n    })) as EventoWithFilial[];\n  }\n\n  async createGuardianInscricao(\n    eventoId: number, \n    alunoId: number, \n    responsavelId: number,\n    observacoes?: string\n  ): Promise<InscricaoEvento> {\n    // Verify aluno ownership\n    const aluno = await this.getAlunoForGuardian(alunoId, responsavelId);\n    if (!aluno) {\n      throw new Error(\"Aluno not found or unauthorized\");\n    }\n\n    // Get evento and verify it's in the same filial\n    const [evento] = await db\n      .select()\n      .from(eventos)\n      .where(eq(eventos.id, eventoId))\n      .limit(1);\n\n    if (!evento) {\n      throw new Error(\"Evento not found\");\n    }\n\n    if (evento.filialId !== aluno.filialId) {\n      throw new Error(\"Evento not available for this student's unit\");\n    }\n\n    if (!evento.ativo) {\n      throw new Error(\"Evento is not active\");\n    }\n\n    // Check for duplicate inscription\n    const [existing] = await db\n      .select()\n      .from(inscricoesEventos)\n      .where(and(\n        eq(inscricoesEventos.eventoId, eventoId),\n        eq(inscricoesEventos.alunoId, alunoId)\n      ))\n      .limit(1);\n\n    if (existing) {\n      throw new Error(\"Student already enrolled in this event\");\n    }\n\n    // Create inscription\n    const [inscricao] = await db\n      .insert(inscricoesEventos)\n      .values({\n        eventoId,\n        alunoId,\n        statusPagamento: \"pendente\",\n        observacoes: observacoes || null,\n      })\n      .returning();\n\n    return inscricao;\n  }\n\n  async createGuardianCompra(\n    uniformeId: number,\n    alunoId: number,\n    responsavelId: number,\n    tamanho: string,\n    cor: string,\n    quantidade: number\n  ): Promise<CompraUniforme> {\n    // Verify aluno ownership\n    const aluno = await this.getAlunoForGuardian(alunoId, responsavelId);\n    if (!aluno) {\n      throw new Error(\"Aluno not found or unauthorized\");\n    }\n\n    // Get uniforme and verify stock\n    const [uniforme] = await db\n      .select()\n      .from(uniformes)\n      .where(eq(uniformes.id, uniformeId))\n      .limit(1);\n\n    if (!uniforme) {\n      throw new Error(\"Uniforme not found\");\n    }\n\n    if (!uniforme.ativo) {\n      throw new Error(\"Uniforme is not available\");\n    }\n\n    const currentStock = uniforme.estoque ?? 0;\n    if (currentStock < quantidade) {\n      throw new Error(\"Insufficient stock\");\n    }\n\n    // Verify size and color are available\n    const tamanhos = JSON.parse(uniforme.tamanhos);\n    const cores = JSON.parse(uniforme.cores);\n\n    if (!tamanhos.includes(tamanho)) {\n      throw new Error(\"Size not available\");\n    }\n\n    if (!cores.includes(cor)) {\n      throw new Error(\"Color not available\");\n    }\n\n    // Calculate total price\n    const precoUnitario = parseFloat(uniforme.preco);\n    const precoTotal = (precoUnitario * quantidade).toFixed(2);\n\n    // Create purchase and update stock atomically\n    const [compra] = await db\n      .insert(comprasUniformes)\n      .values({\n        uniformeId,\n        alunoId,\n        tamanho,\n        cor,\n        quantidade,\n        preco: precoTotal,\n        statusPagamento: \"pendente\",\n      })\n      .returning();\n\n    // Update stock\n    await db\n      .update(uniformes)\n      .set({ estoque: currentStock - quantidade })\n      .where(eq(uniformes.id, uniformeId));\n\n    return compra;\n  }\n\n  async getPagamentosByAlunoForGuardian(alunoId: number, responsavelId: number): Promise<Pagamento[]> {\n    // Verify ownership\n    const aluno = await this.getAlunoForGuardian(alunoId, responsavelId);\n    if (!aluno) {\n      return [];\n    }\n\n    return await db\n      .select()\n      .from(pagamentos)\n      .where(eq(pagamentos.alunoId, alunoId))\n      .orderBy(desc(pagamentos.createdAt));\n  }\n\n  async getInscricoesEventosByAluno(alunoId: number): Promise<InscricaoEvento[]> {\n    return await db\n      .select()\n      .from(inscricoesEventos)\n      .where(eq(inscricoesEventos.alunoId, alunoId))\n      .orderBy(desc(inscricoesEventos.id));\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":53639},"client/src/App-old-complex.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useAdminAuth } from \"@/hooks/useAdminAuth\";\nimport { UnidadeProvider } from \"@/contexts/UnidadeContext\";\nimport NotFound from \"@/pages/not-found\";\nimport AdminLogin from \"@/pages/AdminLogin\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport Alunos from \"@/pages/AlunosFixed\";\nimport Professores from \"@/pages/Professores\";\nimport Turmas from \"@/pages/Turmas\";\nimport GestaoTurmas from \"@/pages/GestaoTurmas\";\nimport Financeiro from \"@/pages/Financeiro\";\nimport Relatorios from \"@/pages/Relatorios\";\nimport RelatorioPresencas from \"@/pages/RelatorioPresencas\";\nimport GestaoUnidades from \"@/pages/GestaoUnidades\";\nimport DashboardUnidadeWrapper from \"@/pages/DashboardUnidadeWrapper\";\nimport PainelUnidade from \"@/pages/PainelUnidade\";\nimport LoginUnidade from \"@/pages/LoginUnidade\";\nimport CadastroGestorUnidade from \"@/pages/CadastroGestorUnidade\";\nimport AlunosUnidade from \"@/pages/AlunosUnidade\";\nimport ProfessoresUnidade from \"@/pages/ProfessoresUnidade\";\nimport TurmasUnidade from \"@/pages/TurmasUnidade\";\nimport FinanceiroUnidade from \"@/pages/FinanceiroUnidade\";\nimport UnidadeAlunos from \"@/pages/UnidadeAlunos\";\nimport UnidadeProfessores from \"@/pages/UnidadeProfessores\";\nimport FinanceiroCompleto from \"@/pages/FinanceiroCompleto\";\nimport Filiais from \"@/pages/Filiais\";\nimport DashboardUnidades from \"@/pages/DashboardUnidades\";\nimport ResponsavelEntrada from \"@/pages/ResponsavelEntrada\";\nimport ResponsavelLogin from \"@/pages/ResponsavelLogin\";\nimport ResponsavelCadastro from \"@/pages/ResponsavelCadastro\";\nimport ResponsavelPortal from \"@/pages/ResponsavelPortal\";\nimport AvaliacaoFisica from \"@/pages/AvaliacaoFisica\";\nimport PortalUnidades from \"@/pages/PortalUnidades\";\nimport CombosAulas from \"@/pages/CombosAulas\";\nimport CadastroAluno from \"@/pages/CadastroAluno\";\nimport PortalUnidadeNovo from \"@/pages/PortalUnidadeNovo\";\nimport SistemaUnidadeNovo from \"@/pages/SistemaUnidadeNovo\";\nimport UnidadeProtectedRoute from \"@/components/UnidadeProtectedRoute\";\nimport UnidadeRedirect from \"@/components/UnidadeRedirect\";\nimport DashboardPortalUnidade from \"@/pages/DashboardPortalUnidade\";\nimport CadastroGestorUnidadePortal from \"@/pages/CadastroGestorUnidadePortal\";\nimport CadastroAlunoUnidade from \"@/pages/CadastroAlunoUnidade\";\nimport Landing from \"@/pages/Landing\";\nimport Layout from \"@/components/Layout\";\n\nfunction Router() {\n  const { isAuthenticated, isLoading } = useAdminAuth();\n\n  return (\n    <Switch>\n      {/* Portal do Responsável - Rotas independentes */}\n      <Route path=\"/responsavel\" component={ResponsavelLogin} />\n      <Route path=\"/responsavel/cadastro\" component={ResponsavelCadastro} />\n      <Route path=\"/responsavel/login\" component={ResponsavelLogin} />\n      <Route path=\"/portal\" component={ResponsavelPortal} />\n      \n      {/* Portal da Unidade - Novo Sistema Unificado */}\n      <Route path=\"/portal-unidade\" component={PortalUnidadeNovo} />\n      <Route path=\"/unidade/sistema\">\n        <UnidadeProtectedRoute>\n          <SistemaUnidadeNovo />\n        </UnidadeProtectedRoute>\n      </Route>\n      <Route path=\"/unidade/cadastro-aluno\">\n        <UnidadeProtectedRoute>\n          <CadastroAlunoUnidade />\n        </UnidadeProtectedRoute>\n      </Route>\n      \n      {/* Redirect para compatibilidade */}\n      <Route path=\"/unidade/:filialId/sistema\" component={UnidadeRedirect} />\n      <Route path=\"/cadastro-gestor-unidade\" component={CadastroGestorUnidadePortal} />\n      <Route path=\"/unidade/:filialId/dashboard\" component={DashboardPortalUnidade} />\n      <Route path=\"/unidade/:filialId/alunos\" component={AlunosUnidade} />\n      <Route path=\"/unidade/:filialId/professores\" component={ProfessoresUnidade} />\n      <Route path=\"/unidade/:filialId/turmas\" component={TurmasUnidade} />\n      <Route path=\"/unidade/:filialId/financeiro\" component={FinanceiroUnidade} />\n      <Route path=\"/unidade/:filialId/presencas\" component={RelatorioPresencas} />\n      <Route path=\"/unidade/:filialId/relatorios\" component={Relatorios} />\n      <Route path=\"/unidade/login\" component={LoginUnidade} />\n      <Route path=\"/unidade/cadastro\" component={CadastroGestorUnidade} />\n      <Route path=\"/login-unidade\" component={LoginUnidade} />\n      <Route path=\"/unidade/alunos\" component={UnidadeAlunos} />\n      <Route path=\"/unidade/professores\" component={UnidadeProfessores} />\n      <Route path=\"/unidade/turmas\" component={TurmasUnidade} />\n      <Route path=\"/unidade/financeiro\" component={FinanceiroUnidade} />\n      <Route path=\"/unidade/matriculas\" component={GestaoTurmas} />\n      <Route path=\"/unidade/relatorios\" component={Relatorios} />\n      <Route path=\"/unidade/presencas\" component={RelatorioPresencas} />\n      <Route path=\"/unidade/dashboard\" component={DashboardUnidadeWrapper} />\n      \n      {/* Sistema Administrativo Principal */}\n      {!isAuthenticated ? (\n        <>\n          <Route path=\"/\" component={Landing} />\n          <Route path=\"/admin-login\" component={AdminLogin} />\n        </>\n      ) : (\n        <Layout>\n          <Route path=\"/\" component={Dashboard} />\n          <Route path=\"/dashboard\" component={Dashboard} />\n          <Route path=\"/alunos\" component={Alunos} />\n          <Route path=\"/professores\" component={Professores} />\n          <Route path=\"/turmas\" component={Turmas} />\n          <Route path=\"/gestao-turmas\" component={GestaoTurmas} />\n          <Route path=\"/filiais\" component={Filiais} />\n          <Route path=\"/dashboard-unidades\" component={DashboardUnidades} />\n          <Route path=\"/financeiro\" component={FinanceiroCompleto} />\n          <Route path=\"/relatorios\" component={Relatorios} />\n          <Route path=\"/relatorio-presencas\" component={RelatorioPresencas} />\n          <Route path=\"/avaliacao-fisica\" component={AvaliacaoFisica} />\n          <Route path=\"/portal-unidades\" component={PortalUnidades} />\n          <Route path=\"/gestao-unidades\" component={GestaoUnidades} />\n          <Route path=\"/combos-aulas\" component={CombosAulas} />\n          <Route path=\"/cadastro-aluno\" component={CadastroAluno} />\n          <Route path=\"/unidade/:filialId\" component={DashboardUnidadeWrapper} />\n        </Layout>\n      )}\n      \n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <UnidadeProvider>\n          <Toaster />\n          <Router />\n        </UnidadeProvider>\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":6770},"client/src/pages/AdminLogin-old.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Eye, EyeOff, LogIn, ArrowLeft } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\nconst loginSchema = z.object({\n  email: z.string().email(\"Email inválido\"),\n  senha: z.string().min(1, \"Senha é obrigatória\"),\n});\n\ntype LoginData = z.infer<typeof loginSchema>;\n\nexport default function AdminLogin() {\n  const [showPassword, setShowPassword] = useState(false);\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n\n  const form = useForm<LoginData>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: {\n      email: \"\",\n      senha: \"\",\n    },\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: LoginData) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/login\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Login realizado com sucesso\",\n        description: \"Bem-vindo ao sistema!\",\n      });\n      // Force reload to ensure authentication state is updated\n      window.location.href = \"/dashboard\";\n    },\n    onError: (error: Error) => {\n      console.error(\"Login error:\", error);\n      toast({\n        title: \"Erro no login\",\n        description: \"Email ou senha inválidos\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: LoginData) => {\n    loginMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100 p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center\">\n          <div className=\"mx-auto mb-4 w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center\">\n            <LogIn className=\"w-8 h-8 text-white\" />\n          </div>\n          <CardTitle className=\"text-2xl font-bold text-gray-900\">\n            Sistema de Gestão\n          </CardTitle>\n          <p className=\"text-gray-600\">\n            Escola de Futebol\n          </p>\n        </CardHeader>\n        <CardContent>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Email</FormLabel>\n                    <FormControl>\n                      <Input\n                        {...field}\n                        type=\"email\"\n                        placeholder=\"seu@email.com\"\n                        disabled={loginMutation.isPending}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={form.control}\n                name=\"senha\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Senha</FormLabel>\n                    <FormControl>\n                      <div className=\"relative\">\n                        <Input\n                          {...field}\n                          type={showPassword ? \"text\" : \"password\"}\n                          placeholder=\"Digite sua senha\"\n                          disabled={loginMutation.isPending}\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                          onClick={() => setShowPassword(!showPassword)}\n                        >\n                          {showPassword ? (\n                            <EyeOff className=\"h-4 w-4\" />\n                          ) : (\n                            <Eye className=\"h-4 w-4\" />\n                          )}\n                        </Button>\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={loginMutation.isPending}\n              >\n                {loginMutation.isPending ? \"Entrando...\" : \"Entrar\"}\n              </Button>\n            </form>\n          </Form>\n\n          <div className=\"mt-6 text-center text-sm text-gray-600\">\n            <p>Credenciais padrão:</p>\n            <p>Email: admin@escola.com</p>\n            <p>Senha: password</p>\n          </div>\n          \n          <div className=\"mt-4 text-center\">\n            <Button\n              variant=\"ghost\"\n              onClick={() => navigate(\"/\")}\n              className=\"text-sm text-gray-600 hover:text-gray-800\"\n            >\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Voltar para Página de Apresentação\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":5584},"client/src/pages/LoginAdmin.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { LogIn } from \"lucide-react\";\n\nconst loginSchema = z.object({\n  email: z.string().email(\"Email inválido\"),\n  senha: z.string().min(1, \"Senha obrigatória\"),\n});\n\ntype LoginForm = z.infer<typeof loginSchema>;\n\nexport default function LoginAdmin() {\n  const { toast } = useToast();\n\n  const form = useForm<LoginForm>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: {\n      email: \"\",\n      senha: \"\",\n    },\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: LoginForm) => {\n      const response = await fetch(\"/api/auth/admin/login\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Login falhou\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Login realizado\",\n        description: \"Bem-vindo ao sistema!\",\n      });\n      window.location.href = \"/dashboard\";\n    },\n    onError: () => {\n      toast({\n        title: \"Erro no login\",\n        description: \"Email ou senha inválidos\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: LoginForm) => {\n    loginMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100 p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center space-y-4\">\n          <div className=\"mx-auto w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center\">\n            <LogIn className=\"w-8 h-8 text-white\" />\n          </div>\n          <CardTitle className=\"text-2xl font-bold\">Sistema de Gestão</CardTitle>\n          <p className=\"text-gray-600\">Escola de Futebol</p>\n        </CardHeader>\n        <CardContent>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Email</FormLabel>\n                    <FormControl>\n                      <Input\n                        {...field}\n                        type=\"email\"\n                        placeholder=\"admin@escola.com\"\n                        data-testid=\"input-email\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"senha\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Senha</FormLabel>\n                    <FormControl>\n                      <Input\n                        {...field}\n                        type=\"password\"\n                        placeholder=\"••••••••\"\n                        data-testid=\"input-password\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={loginMutation.isPending}\n                data-testid=\"button-login\"\n              >\n                {loginMutation.isPending ? \"Entrando...\" : \"Entrar\"}\n              </Button>\n            </form>\n          </Form>\n\n          <div className=\"mt-6 text-center text-sm text-gray-600 space-y-1\">\n            <p className=\"font-semibold\">Credenciais padrão:</p>\n            <p>Email: admin@escola.com</p>\n            <p>Senha: password</p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":4310},"server/routes-old-backup.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { \n  adminLoginSchema,\n  updateAlunoContactSchema,\n  guardianInscricaoEventoSchema,\n  guardianCompraUniformeSchema\n} from \"@shared/schema\";\nimport { addToSync } from \"./sync\";\nimport session from \"express-session\";\nimport connectPg from \"connect-pg-simple\";\n\n// Extend session type for all authentication types\ndeclare module \"express-session\" {\n  interface SessionData {\n    responsavelId?: number;\n    gestorUnidadeId?: number;\n    filialId?: number;\n    adminId?: number;\n    adminUser?: {\n      id: number;\n      nome: string;\n      email: string;\n      papel: string;\n    };\n  }\n}\n\n// Admin authentication middleware\nconst requireAdminAuth = (req: Request, res: Response, next: NextFunction) => {\n  if (!req.session || !req.session.adminId || !req.session.adminUser) {\n    return res.status(401).json({ message: \"Admin authentication required\" });\n  }\n  next();\n};\n\n// Unit manager authentication middleware\nconst requireGestorAuth = (req: Request, res: Response, next: NextFunction) => {\n  if (!req.session?.gestorUnidadeId) {\n    return res.status(401).json({ message: \"Unit manager authentication required\" });\n  }\n  next();\n};\n\n// Guardian authentication middleware\nconst requireResponsavelAuth = (req: Request, res: Response, next: NextFunction) => {\n  if (!req.session?.responsavelId) {\n    return res.status(401).json({ message: \"Guardian authentication required\" });\n  }\n  next();\n};\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Setup session middleware for traditional authentication\n  let sessionStore;\n  \n  if (process.env.DATABASE_URL) {\n    const PostgresSessionStore = connectPg(session);\n    sessionStore = new PostgresSessionStore({\n      conString: process.env.DATABASE_URL,\n      createTableIfMissing: true,\n      ttl: 7 * 24 * 60 * 60, // 7 days\n    });\n    console.log('Using PostgreSQL session store');\n  } else {\n    // Fallback to memory store for development\n    const MemoryStore = require('memorystore')(session);\n    sessionStore = new MemoryStore({\n      checkPeriod: 86400000 // prune expired entries every 24h\n    });\n    console.log('Using memory session store (DATABASE_URL not found)');\n  }\n\n  app.use(session({\n    secret: process.env.SESSION_SECRET || 'escola-futebol-secret-2024',\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: false, // Set to true in production with HTTPS\n      maxAge: 7 * 24 * 60 * 60 * 1000, // 7 days\n    },\n  }));\n\n  // Traditional admin authentication routes\n  app.post('/api/admin/login', async (req, res) => {\n    try {\n      const { email, senha } = adminLoginSchema.parse(req.body);\n      console.log('Login attempt for:', email);\n      \n      const user = await storage.authenticateAdminUser(email, senha);\n      if (!user) {\n        console.log('Authentication failed for:', email);\n        return res.status(401).json({ message: \"Email ou senha inválidos\" });\n      }\n\n      console.log('Authentication successful for:', email);\n\n      // Store admin user in session\n      req.session.adminId = user.id;\n      req.session.adminUser = {\n        id: user.id,\n        nome: user.nome,\n        email: user.email,\n        papel: user.papel || 'admin'\n      };\n\n      // Explicitly save session\n      await new Promise<void>((resolve, reject) => {\n        req.session.save((err) => {\n          if (err) {\n            console.error('Session save error:', err);\n            reject(err);\n          } else {\n            console.log('Session saved successfully for user:', user.id);\n            resolve();\n          }\n        });\n      });\n\n      res.json({\n        success: true,\n        user: {\n          id: user.id,\n          nome: user.nome,\n          email: user.email,\n          papel: user.papel\n        }\n      });\n    } catch (error) {\n      console.error(\"Admin login error:\", error);\n      res.status(400).json({ message: \"Dados de login inválidos\" });\n    }\n  });\n\n  app.post('/api/admin/logout', (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ message: \"Erro ao fazer logout\" });\n      }\n      res.json({ success: true });\n    });\n  });\n\n  app.get('/api/admin/user', (req, res) => {\n    if (!req.session || !req.session.adminId || !req.session.adminUser) {\n      return res.status(401).json({ message: \"Não autenticado\" });\n    }\n    \n    res.json(req.session.adminUser);\n  });\n\n  // Dashboard routes - protected by admin authentication\n  app.get(\"/api/dashboard/metrics\", requireAdminAuth, async (req, res) => {\n    try {\n      const totalAlunos = (await storage.getAlunos()).length;\n      const totalProfessores = (await storage.getProfessores()).length;\n      const totalTurmas = (await storage.getTurmas()).length;\n      \n      const pagamentos = await storage.getPagamentos();\n      const receitaMensal = pagamentos\n        .filter(p => {\n          const currentMonth = new Date().toISOString().slice(0, 7);\n          return p.mesReferencia === currentMonth;\n        })\n        .reduce((total, p) => total + parseFloat(p.valor || \"0\"), 0);\n\n      res.json({\n        totalAlunos,\n        totalProfessores,\n        totalTurmas,\n        receitaMensal,\n      });\n    } catch (error) {\n      console.error(\"Error fetching dashboard metrics:\", error);\n      res.status(500).json({ message: \"Failed to fetch dashboard metrics\" });\n    }\n  });\n\n  // Alunos routes - protected by admin authentication\n  app.get(\"/api/alunos\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n      \n      let alunos = await storage.getAlunos();\n      \n      // If it's a unit manager, filter by filial\n      if (isGestor && !isAdmin) {\n        alunos = alunos.filter(aluno => aluno.filialId === req.session.filialId);\n      }\n      \n      res.json(alunos);\n    } catch (error) {\n      console.error(\"Error fetching alunos:\", error);\n      res.status(500).json({ message: \"Failed to fetch alunos\" });\n    }\n  });\n\n  app.get(\"/api/alunos/:id\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      const aluno = await storage.getAluno(id);\n      if (!aluno) {\n        return res.status(404).json({ message: \"Aluno not found\" });\n      }\n\n      // If it's a unit manager, check if aluno belongs to their filial\n      if (isGestor && !isAdmin && aluno.filialId !== req.session.filialId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      res.json(aluno);\n    } catch (error) {\n      console.error(\"Error fetching aluno:\", error);\n      res.status(500).json({ message: \"Failed to fetch aluno\" });\n    }\n  });\n\n  app.post(\"/api/alunos\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const alunoData = req.body;\n\n      // If it's a unit manager, ensure filialId matches their unit\n      if (isGestor && !isAdmin) {\n        alunoData.filialId = req.session.filialId;\n      }\n\n      const aluno = await storage.createAluno(alunoData);\n      res.status(201).json(aluno);\n    } catch (error) {\n      console.error(\"Error creating aluno:\", error);\n      res.status(500).json({ message: \"Failed to create aluno\" });\n    }\n  });\n\n  // Cadastro completo (aluno + responsável)\n  app.post(\"/api/alunos-completo\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const { aluno: alunoData, responsavel: responsavelData } = req.body;\n      \n      // If it's a unit manager, ensure filialId matches their unit\n      if (isGestor && !isAdmin) {\n        alunoData.filialId = req.session.filialId;\n      }\n      \n      // Primeiro, criar o responsável\n      const responsavel = await storage.createResponsavel(responsavelData);\n      \n      // Depois, criar o aluno vinculado ao responsável\n      const alunoCompleto = {\n        ...alunoData,\n        responsavelId: responsavel.id,\n      };\n      \n      const aluno = await storage.createAluno(alunoCompleto);\n      \n      res.status(201).json({\n        aluno,\n        responsavel,\n        message: \"Aluno e responsável cadastrados com sucesso\"\n      });\n    } catch (error) {\n      console.error(\"Error creating aluno completo:\", error);\n      res.status(500).json({ message: \"Failed to create aluno and responsavel\" });\n    }\n  });\n\n  app.put(\"/api/alunos/:id\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      const alunoData = req.body;\n\n      // If it's a unit manager, verify the aluno belongs to their filial\n      if (isGestor && !isAdmin) {\n        const existingAluno = await storage.getAluno(id);\n        if (!existingAluno || existingAluno.filialId !== req.session.filialId) {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n        // Ensure filialId cannot be changed\n        alunoData.filialId = req.session.filialId;\n      }\n\n      const aluno = await storage.updateAluno(id, alunoData);\n      res.json(aluno);\n    } catch (error) {\n      console.error(\"Error updating aluno:\", error);\n      res.status(500).json({ message: \"Failed to update aluno\" });\n    }\n  });\n\n  app.patch(\"/api/alunos/:id\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      const alunoData = req.body;\n\n      // If it's a unit manager, verify the aluno belongs to their filial\n      if (isGestor && !isAdmin) {\n        const existingAluno = await storage.getAluno(id);\n        if (!existingAluno || existingAluno.filialId !== req.session.filialId) {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n        // Ensure filialId cannot be changed\n        alunoData.filialId = req.session.filialId;\n      }\n\n      const aluno = await storage.updateAluno(id, alunoData);\n      res.json(aluno);\n    } catch (error) {\n      console.error(\"Error updating aluno:\", error);\n      res.status(500).json({ message: \"Failed to update aluno\" });\n    }\n  });\n\n  app.delete(\"/api/alunos/:id\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n\n      // If it's a unit manager, verify the aluno belongs to their filial\n      if (isGestor && !isAdmin) {\n        const existingAluno = await storage.getAluno(id);\n        if (!existingAluno || existingAluno.filialId !== req.session.filialId) {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n      }\n\n      await storage.deleteAluno(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting aluno:\", error);\n      res.status(500).json({ message: \"Failed to delete aluno\" });\n    }\n  });\n\n  // Professores routes - protected by admin or unit manager authentication\n  app.get(\"/api/professores\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n      \n      let professores = await storage.getProfessores();\n      \n      // If it's a unit manager, filter by filial\n      if (isGestor && !isAdmin) {\n        professores = professores.filter(professor => professor.filialId === req.session.filialId);\n      }\n      \n      res.json(professores);\n    } catch (error) {\n      console.error(\"Error fetching professores:\", error);\n      res.status(500).json({ message: \"Failed to fetch professores\" });\n    }\n  });\n\n  app.post(\"/api/professores\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const professor = await storage.createProfessor(req.body);\n      res.json(professor);\n    } catch (error) {\n      console.error(\"Error creating professor:\", error);\n      res.status(500).json({ message: \"Failed to create professor\" });\n    }\n  });\n\n  app.patch(\"/api/professores/:id\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      const professor = await storage.updateProfessor(id, req.body);\n      res.json(professor);\n    } catch (error) {\n      console.error(\"Error updating professor:\", error);\n      res.status(500).json({ message: \"Failed to update professor\" });\n    }\n  });\n\n  app.delete(\"/api/professores/:id\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      await storage.deleteProfessor(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting professor:\", error);\n      res.status(500).json({ message: \"Failed to delete professor\" });\n    }\n  });\n\n  // Turmas routes - protected by admin or unit manager authentication\n  app.get(\"/api/turmas\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n      \n      let turmas = await storage.getTurmas();\n      \n      // If it's a unit manager, filter by filial\n      if (isGestor && !isAdmin) {\n        turmas = turmas.filter(turma => turma.filialId === req.session.filialId);\n      }\n      \n      res.json(turmas);\n    } catch (error) {\n      console.error(\"Error fetching turmas:\", error);\n      res.status(500).json({ message: \"Failed to fetch turmas\" });\n    }\n  });\n\n  app.post(\"/api/turmas\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const turma = await storage.createTurma(req.body);\n      res.json(turma);\n    } catch (error) {\n      console.error(\"Error creating turma:\", error);\n      res.status(500).json({ message: \"Failed to create turma\" });\n    }\n  });\n\n  app.patch(\"/api/turmas/:id\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      const turma = await storage.updateTurma(id, req.body);\n      res.json(turma);\n    } catch (error) {\n      console.error(\"Error updating turma:\", error);\n      res.status(500).json({ message: \"Failed to update turma\" });\n    }\n  });\n\n  app.delete(\"/api/turmas/:id\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      await storage.deleteTurma(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting turma:\", error);\n      res.status(500).json({ message: \"Failed to delete turma\" });\n    }\n  });\n\n  // Filiais routes - protected by admin or unit manager authentication\n  app.get(\"/api/filiais\", async (req, res) => {\n    try {\n      // Check if it's admin or unit manager auth\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n      \n      let filiais = await storage.getFiliais();\n      \n      // If it's a unit manager, filter to only their filial\n      if (isGestor && !isAdmin) {\n        filiais = filiais.filter(filial => filial.id === req.session.filialId);\n      }\n      \n      res.json(filiais);\n    } catch (error) {\n      console.error(\"Error fetching filiais:\", error);\n      res.status(500).json({ message: \"Failed to fetch filiais\" });\n    }\n  });\n\n  app.get(\"/api/filiais/detalhadas\", requireAdminAuth, async (req, res) => {\n    try {\n      const filiais = await storage.getFiliaisDetalhadas();\n      res.json(filiais);\n    } catch (error) {\n      console.error(\"Error fetching detailed filiais:\", error);\n      res.status(500).json({ message: \"Failed to fetch detailed filiais\" });\n    }\n  });\n\n  app.get(\"/api/filiais/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const filial = await storage.getFilial(id);\n      if (!filial) {\n        return res.status(404).json({ message: \"Filial not found\" });\n      }\n      res.json(filial);\n    } catch (error) {\n      console.error(\"Error fetching filial:\", error);\n      res.status(500).json({ message: \"Failed to fetch filial\" });\n    }\n  });\n\n  app.post(\"/api/filiais\", requireAdminAuth, async (req, res) => {\n    try {\n      const filialData = {\n        ...req.body,\n        ativa: true,\n      };\n      const filial = await storage.createFilial(filialData);\n      res.json(filial);\n    } catch (error) {\n      console.error(\"Error creating filial:\", error);\n      res.status(500).json({ message: \"Failed to create filial\" });\n    }\n  });\n\n  app.patch(\"/api/filiais/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const filial = await storage.updateFilial(id, req.body);\n      res.json(filial);\n    } catch (error) {\n      console.error(\"Error updating filial:\", error);\n      res.status(500).json({ message: \"Failed to update filial\" });\n    }\n  });\n\n  app.delete(\"/api/filiais/:id\", requireAdminAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteFilial(id);\n      res.json({ message: \"Filial deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting filial:\", error);\n      res.status(500).json({ message: \"Failed to delete filial\" });\n    }\n  });\n\n  app.get(\"/api/sync/status\", requireAdminAuth, async (req, res) => {\n    try {\n      // Return sync status for portal\n      res.json({\n        lastSync: new Date().toISOString(),\n        status: \"success\",\n        pendingChanges: 0\n      });\n    } catch (error) {\n      console.error(\"Error fetching sync status:\", error);\n      res.status(500).json({ message: \"Failed to fetch sync status\" });\n    }\n  });\n\n  // Pagamentos routes - protected by admin or unit manager authentication\n  app.get(\"/api/pagamentos\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n      \n      let pagamentos = await storage.getPagamentos();\n      \n      // If it's a unit manager, filter payments by students from their filial\n      if (isGestor && !isAdmin) {\n        const alunosDaFilial = await storage.getAlunosByFilial(req.session.filialId!);\n        const alunoIds = alunosDaFilial.map(a => a.id);\n        pagamentos = pagamentos.filter(p => p.alunoId && alunoIds.includes(p.alunoId));\n      }\n      \n      res.json(pagamentos);\n    } catch (error) {\n      console.error(\"Error fetching pagamentos:\", error);\n      res.status(500).json({ message: \"Failed to fetch pagamentos\" });\n    }\n  });\n\n  app.post(\"/api/pagamentos\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      // Validate and transform the request body\n      const { insertPagamentoSchema } = await import(\"@shared/schema\");\n      const validationResult = insertPagamentoSchema.safeParse(req.body);\n      \n      if (!validationResult.success) {\n        return res.status(400).json({ \n          message: \"Invalid payment data\", \n          errors: validationResult.error.errors \n        });\n      }\n\n      const pagamentoData = validationResult.data;\n\n      // If it's a unit manager, verify the student belongs to their filial\n      if (isGestor && !isAdmin && pagamentoData.alunoId) {\n        const aluno = await storage.getAluno(pagamentoData.alunoId);\n        if (!aluno || aluno.filialId !== req.session.filialId) {\n          return res.status(403).json({ message: \"Access denied - student not in your unit\" });\n        }\n      }\n\n      const pagamento = await storage.createPagamento(pagamentoData);\n      res.status(201).json(pagamento);\n    } catch (error) {\n      console.error(\"Error creating pagamento:\", error);\n      res.status(500).json({ message: \"Failed to create pagamento\" });\n    }\n  });\n\n  app.delete(\"/api/pagamentos/:id\", async (req, res) => {\n    try {\n      const isAdmin = req.session.adminId;\n      const isGestor = req.session.gestorUnidadeId && req.session.filialId;\n      \n      if (!isAdmin && !isGestor) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const id = parseInt(req.params.id);\n      \n      // Fetch the specific payment instead of loading all payments\n      const pagamento = await storage.getPagamento(id);\n      \n      if (!pagamento) {\n        return res.status(404).json({ message: \"Payment not found\" });\n      }\n      \n      // If it's a unit manager, verify the payment belongs to a student from their filial\n      if (isGestor && !isAdmin) {\n        if (pagamento.alunoId) {\n          const aluno = await storage.getAluno(pagamento.alunoId);\n          if (!aluno || aluno.filialId !== req.session.filialId) {\n            return res.status(403).json({ message: \"Access denied - payment not from your unit\" });\n          }\n        } else {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n      }\n\n      await storage.deletePagamento(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting pagamento:\", error);\n      res.status(500).json({ message: \"Failed to delete pagamento\" });\n    }\n  });\n\n  // Unit management authentication routes\n  app.post(\"/api/unidade/login\", async (req, res) => {\n    try {\n      const { email, senha } = req.body;\n      const gestor = await storage.authenticateGestorUnidade(email, senha);\n      \n      if (!gestor) {\n        return res.status(401).json({ message: \"Credenciais inválidas\" });\n      }\n\n      // Get filial data\n      const filial = await storage.getFilial(gestor.filialId);\n      if (!filial) {\n        return res.status(404).json({ message: \"Filial não encontrada\" });\n      }\n\n      req.session.gestorUnidadeId = gestor.id;\n      req.session.filialId = gestor.filialId;\n\n      await storage.updateGestorUltimoLogin(gestor.id);\n\n      res.json({\n        success: true,\n        gestor: {\n          id: gestor.id,\n          nome: gestor.nome,\n          email: gestor.email,\n          filialId: gestor.filialId\n        },\n        filial: {\n          id: filial.id,\n          nome: filial.nome\n        }\n      });\n    } catch (error) {\n      console.error(\"Unit login error:\", error);\n      res.status(500).json({ message: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.get(\"/api/unidade/me\", requireGestorAuth, async (req, res) => {\n    try {\n      const gestorId = req.session.gestorUnidadeId!;\n      const filialId = req.session.filialId!;\n      \n      const gestor = await storage.getGestorUnidade(gestorId);\n      const filial = await storage.getFilial(filialId);\n      \n      if (!gestor || !filial) {\n        return res.status(404).json({ message: \"Dados não encontrados\" });\n      }\n\n      res.json({\n        gestor: {\n          id: gestor.id,\n          nome: gestor.nome,\n          email: gestor.email,\n          filialId: gestor.filialId\n        },\n        filial: {\n          id: filial.id,\n          nome: filial.nome\n        }\n      });\n    } catch (error) {\n      console.error(\"Error fetching unidade session:\", error);\n      res.status(500).json({ message: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/unidade/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ message: \"Erro ao fazer logout\" });\n      }\n      res.json({ success: true });\n    });\n  });\n\n  // Guardian authentication routes\n  app.post(\"/api/responsavel/login\", async (req, res) => {\n    try {\n      const { email, senha } = req.body;\n      console.log('Guardian login attempt for:', email);\n      \n      const responsavel = await storage.authenticateResponsavel(email, senha);\n      \n      if (!responsavel) {\n        console.log('Guardian authentication failed for:', email);\n        return res.status(401).json({ message: \"Credenciais inválidas\" });\n      }\n\n      console.log('Guardian authentication successful for:', email);\n\n      req.session.responsavelId = responsavel.id;\n\n      // Explicitly save session\n      await new Promise<void>((resolve, reject) => {\n        req.session.save((err) => {\n          if (err) {\n            console.error('Guardian session save error:', err);\n            reject(err);\n          } else {\n            console.log('Guardian session saved successfully for responsavel:', responsavel.id);\n            resolve();\n          }\n        });\n      });\n\n      res.json({\n        success: true,\n        responsavel: {\n          id: responsavel.id,\n          nome: responsavel.nome,\n          email: responsavel.email\n        }\n      });\n    } catch (error) {\n      console.error(\"Guardian login error:\", error);\n      res.status(500).json({ message: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/responsavel/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ message: \"Erro ao fazer logout\" });\n      }\n      res.json({ success: true });\n    });\n  });\n\n  // Get responsavel data with students\n  app.get(\"/api/responsaveis/me\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const responsavel = await storage.getResponsavelWithAlunos(responsavelId);\n      \n      if (!responsavel) {\n        return res.status(404).json({ message: \"Responsável não encontrado\" });\n      }\n\n      res.json(responsavel);\n    } catch (error) {\n      console.error(\"Error fetching responsavel data:\", error);\n      res.status(500).json({ message: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Guardian portal routes\n  // Update aluno contact information\n  app.patch(\"/api/portal/alunos/:alunoId/contact\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const alunoId = parseInt(req.params.alunoId);\n      \n      const validated = updateAlunoContactSchema.parse(req.body);\n      \n      const updated = await storage.updateAlunoContact(alunoId, responsavelId, validated);\n      res.json(updated);\n    } catch (error: any) {\n      if (error.message === \"Aluno not found or unauthorized\") {\n        return res.status(403).json({ message: \"Não autorizado\" });\n      }\n      console.error(\"Error updating aluno contact:\", error);\n      res.status(500).json({ message: \"Erro ao atualizar dados do aluno\" });\n    }\n  });\n\n  // Get student's classes\n  app.get(\"/api/portal/alunos/:alunoId/turmas\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const alunoId = parseInt(req.params.alunoId);\n      \n      const turmas = await storage.getTurmasByAluno(alunoId, responsavelId);\n      res.json(turmas);\n    } catch (error) {\n      console.error(\"Error fetching turmas:\", error);\n      res.status(500).json({ message: \"Erro ao buscar turmas\" });\n    }\n  });\n\n  // Get student's payment history\n  app.get(\"/api/portal/alunos/:alunoId/pagamentos\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const alunoId = parseInt(req.params.alunoId);\n      \n      const pagamentos = await storage.getPagamentosByAlunoForGuardian(alunoId, responsavelId);\n      res.json(pagamentos);\n    } catch (error) {\n      console.error(\"Error fetching pagamentos:\", error);\n      res.status(500).json({ message: \"Erro ao buscar pagamentos\" });\n    }\n  });\n\n  // Get student's event enrollments\n  app.get(\"/api/portal/alunos/:alunoId/inscricoes\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const alunoId = parseInt(req.params.alunoId);\n      \n      const aluno = await storage.getAlunoForGuardian(alunoId, responsavelId);\n      if (!aluno) {\n        return res.status(403).json({ message: \"Não autorizado\" });\n      }\n      \n      const inscricoes = await storage.getInscricoesEventosByAluno(alunoId);\n      res.json(inscricoes);\n    } catch (error) {\n      console.error(\"Error fetching inscricoes:\", error);\n      res.status(500).json({ message: \"Erro ao buscar inscrições\" });\n    }\n  });\n\n  // Get available events for guardian's unit\n  app.get(\"/api/portal/eventos\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const responsavel = await storage.getResponsavelWithAlunos(responsavelId);\n      \n      if (!responsavel || !responsavel.alunos || responsavel.alunos.length === 0) {\n        return res.json([]);\n      }\n\n      const filialId = responsavel.alunos[0].filialId;\n      if (!filialId) {\n        return res.json([]);\n      }\n      \n      const eventos = await storage.getEventosDisponiveisByFilial(filialId);\n      res.json(eventos);\n    } catch (error) {\n      console.error(\"Error fetching eventos:\", error);\n      res.status(500).json({ message: \"Erro ao buscar eventos\" });\n    }\n  });\n\n  // Enroll student in event\n  app.post(\"/api/portal/eventos/:eventoId/inscricoes\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const eventoId = parseInt(req.params.eventoId);\n      \n      const validated = guardianInscricaoEventoSchema.parse(req.body);\n      \n      const inscricao = await storage.createGuardianInscricao(\n        eventoId,\n        validated.alunoId,\n        responsavelId,\n        validated.observacoes\n      );\n      \n      res.json(inscricao);\n    } catch (error: any) {\n      if (error.message?.includes(\"unauthorized\") || error.message?.includes(\"not found\")) {\n        return res.status(403).json({ message: \"Não autorizado\" });\n      }\n      if (error.message?.includes(\"already enrolled\")) {\n        return res.status(400).json({ message: \"Aluno já inscrito neste evento\" });\n      }\n      if (error.message?.includes(\"not available\")) {\n        return res.status(400).json({ message: error.message });\n      }\n      console.error(\"Error enrolling in event:\", error);\n      res.status(500).json({ message: \"Erro ao inscrever no evento\" });\n    }\n  });\n\n  // Purchase uniform\n  app.post(\"/api/portal/uniformes/:uniformeId/compras\", requireResponsavelAuth, async (req, res) => {\n    try {\n      const responsavelId = req.session.responsavelId!;\n      const uniformeId = parseInt(req.params.uniformeId);\n      \n      const validated = guardianCompraUniformeSchema.parse(req.body);\n      \n      const compra = await storage.createGuardianCompra(\n        uniformeId,\n        validated.alunoId,\n        responsavelId,\n        validated.tamanho,\n        validated.cor,\n        validated.quantidade\n      );\n      \n      res.json(compra);\n    } catch (error: any) {\n      if (error.message?.includes(\"unauthorized\") || error.message?.includes(\"not found\")) {\n        return res.status(403).json({ message: \"Não autorizado\" });\n      }\n      if (error.message?.includes(\"stock\") || error.message?.includes(\"available\")) {\n        return res.status(400).json({ message: error.message });\n      }\n      console.error(\"Error purchasing uniform:\", error);\n      res.status(500).json({ message: \"Erro ao comprar uniforme\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}","size_bytes":34789},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nif (!process.env.REPLIT_DOMAINS) {\n  throw new Error(\"Environment variable REPLIT_DOMAINS not provided\");\n}\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(\n  claims: any,\n) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  for (const domain of process.env\n    .REPLIT_DOMAINS!.split(\",\")) {\n    const strategy = new Strategy(\n      {\n        name: `replitauth:${domain}`,\n        config,\n        scope: \"openid email profile offline_access\",\n        callbackURL: `https://${domain}/api/callback`,\n      },\n      verify,\n    );\n    passport.use(strategy);\n  }\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","size_bytes":4221}},"version":2}